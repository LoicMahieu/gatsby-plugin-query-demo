patch-package
--- a/node_modules/gatsby/cache-dir/api-runner-ssr.js
+++ b/node_modules/gatsby/cache-dir/api-runner-ssr.js
@@ -40,3 +40,13 @@ module.exports = (api, args, defaultReturn, argTransform) => {
     return [defaultReturn]
   }
 }
+
+module.exports.apiRunnerAsync = (api, args, defaultReturn) =>
+  // eslint-disable-next-line no-undef
+  plugins.reduce(
+    (previous, next) =>
+      next.plugin[api]
+        ? previous.then(() => next.plugin[api](args, next.options))
+        : previous,
+    Promise.resolve()
+  )
--- a/node_modules/gatsby/cache-dir/commonjs/api-runner-browser.js
+++ b/node_modules/gatsby/cache-dir/commonjs/api-runner-browser.js
@@ -2,10 +2,11 @@
 
 const plugins = require(`./api-runner-browser-plugins`);
 
-const _require$publicLoader = require(`./loader`).publicLoader,
-      getResourcesForPathname = _require$publicLoader.getResourcesForPathname,
-      getResourcesForPathnameSync = _require$publicLoader.getResourcesForPathnameSync,
-      getResourceURLsForPathname = _require$publicLoader.getResourceURLsForPathname;
+const {
+  getResourcesForPathname,
+  getResourcesForPathnameSync,
+  getResourceURLsForPathname
+} = require(`./loader`).publicLoader;
 
 exports.apiRunner = (api, args = {}, defaultReturn, argTransform) => {
   // Hooks for cypress-gatsby's API handler
--- a/node_modules/gatsby/cache-dir/commonjs/api-runner-ssr.js
+++ b/node_modules/gatsby/cache-dir/commonjs/api-runner-ssr.js
@@ -46,3 +46,6 @@ module.exports = (api, args, defaultReturn, argTransform) => {
     return [defaultReturn];
   }
 };
+
+module.exports.apiRunnerAsync = (api, args, defaultReturn) => // eslint-disable-next-line no-undef
+plugins.reduce((previous, next) => next.plugin[api] ? previous.then(() => next.plugin[api](args, next.options)) : previous, Promise.resolve());
\ No newline at end of file
--- a/node_modules/gatsby/cache-dir/commonjs/app.js
+++ b/node_modules/gatsby/cache-dir/commonjs/app.js
@@ -1,9 +1,9 @@
 "use strict";
 
-var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");
-
 var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
 
+var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");
+
 var _react = _interopRequireDefault(require("react"));
 
 var _reactDom = _interopRequireDefault(require("react-dom"));
@@ -24,6 +24,7 @@ var _syncRequires = _interopRequireDefault(require("./sync-requires"));
 
 var _pages = _interopRequireDefault(require("./pages.json"));
 
+var _jsxFileName = "/Users/loicmahieu/Projects/gatsby/packages/gatsby/cache-dir/app.js";
 window.___emitter = _emitter.default;
 (0, _loader.setApiRunnerForLoader)(_apiRunnerBrowser.apiRunner); // Let the site/plugins run code very early.
 
@@ -48,19 +49,7 @@ window.___emitter = _emitter.default;
 
   if (supportsServiceWorkers(location, navigator)) {
     navigator.serviceWorker.getRegistrations().then(registrations => {
-      for (var _iterator = registrations, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {
-        var _ref;
-
-        if (_isArray) {
-          if (_i >= _iterator.length) break;
-          _ref = _iterator[_i++];
-        } else {
-          _i = _iterator.next();
-          if (_i.done) break;
-          _ref = _i.value;
-        }
-
-        let registration = _ref;
+      for (let registration of registrations) {
         registration.unregister();
       }
     });
@@ -76,7 +65,13 @@ window.___emitter = _emitter.default;
   _loader.default.getResourcesForPathname(window.location.pathname).then(() => {
     let Root = (0, _reactHotLoader.hot)(module)(preferDefault(require(`./root`)));
     (0, _domready.default)(() => {
-      renderer(_react.default.createElement(Root, null), rootElement, () => {
+      renderer(_react.default.createElement(Root, {
+        __source: {
+          fileName: _jsxFileName,
+          lineNumber: 56
+        },
+        __self: void 0
+      }), rootElement, () => {
         (0, _apiRunnerBrowser.apiRunner)(`onInitialClientRender`);
       });
     });
--- a/node_modules/gatsby/cache-dir/commonjs/default-html.js
+++ b/node_modules/gatsby/cache-dir/commonjs/default-html.js
@@ -5,26 +5,68 @@ var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefau
 exports.__esModule = true;
 exports.default = void 0;
 
+var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));
+
 var _react = _interopRequireDefault(require("react"));
 
 var _propTypes = _interopRequireDefault(require("prop-types"));
 
+var _jsxFileName = "/Users/loicmahieu/Projects/gatsby/packages/gatsby/cache-dir/default-html.js";
+
 class HTML extends _react.default.Component {
   render() {
-    return _react.default.createElement("html", this.props.htmlAttributes, _react.default.createElement("head", null, _react.default.createElement("meta", {
-      charSet: "utf-8"
+    return _react.default.createElement("html", (0, _extends2.default)({}, this.props.htmlAttributes, {
+      __source: {
+        fileName: _jsxFileName,
+        lineNumber: 7
+      },
+      __self: this
+    }), _react.default.createElement("head", {
+      __source: {
+        fileName: _jsxFileName,
+        lineNumber: 8
+      },
+      __self: this
+    }, _react.default.createElement("meta", {
+      charSet: "utf-8",
+      __source: {
+        fileName: _jsxFileName,
+        lineNumber: 9
+      },
+      __self: this
     }), _react.default.createElement("meta", {
       httpEquiv: "x-ua-compatible",
-      content: "ie=edge"
+      content: "ie=edge",
+      __source: {
+        fileName: _jsxFileName,
+        lineNumber: 10
+      },
+      __self: this
     }), _react.default.createElement("meta", {
       name: "viewport",
-      content: "width=device-width, initial-scale=1, shrink-to-fit=no"
-    }), this.props.headComponents), _react.default.createElement("body", this.props.bodyAttributes, this.props.preBodyComponents, _react.default.createElement("div", {
+      content: "width=device-width, initial-scale=1, shrink-to-fit=no",
+      __source: {
+        fileName: _jsxFileName,
+        lineNumber: 11
+      },
+      __self: this
+    }), this.props.headComponents), _react.default.createElement("body", (0, _extends2.default)({}, this.props.bodyAttributes, {
+      __source: {
+        fileName: _jsxFileName,
+        lineNumber: 17
+      },
+      __self: this
+    }), this.props.preBodyComponents, _react.default.createElement("div", {
       key: `body`,
       id: "___gatsby",
       dangerouslySetInnerHTML: {
         __html: this.props.body
-      }
+      },
+      __source: {
+        fileName: _jsxFileName,
+        lineNumber: 19
+      },
+      __self: this
     }), this.props.postBodyComponents));
   }
 
--- a/node_modules/gatsby/cache-dir/commonjs/develop-static-entry.js
+++ b/node_modules/gatsby/cache-dir/commonjs/develop-static-entry.js
@@ -13,6 +13,8 @@ var _lodash = require("lodash");
 
 var _apiRunnerSsr = _interopRequireDefault(require("./api-runner-ssr"));
 
+var _jsxFileName = "/Users/loicmahieu/Projects/gatsby/packages/gatsby/cache-dir/develop-static-entry.js";
+
 // import testRequireError from "./test-require-error"
 // For some extremely mysterious reason, webpack adds the above module *after*
 // this module so that when this code runs, testRequireError is undefined.
@@ -106,24 +108,36 @@ var _default = (pagePath, callback) => {
     replacePostBodyComponents
   });
 
-  const htmlElement = _react.default.createElement(Html, Object.assign({}, bodyProps, {
+  const htmlElement = _react.default.createElement(Html, { ...bodyProps,
     body: ``,
     headComponents: headComponents.concat([_react.default.createElement("script", {
       key: `io`,
-      src: "/socket.io/socket.io.js"
+      src: "/socket.io/socket.io.js",
+      __source: {
+        fileName: _jsxFileName,
+        lineNumber: 102
+      },
+      __self: void 0
     })]),
     htmlAttributes,
     bodyAttributes,
     preBodyComponents,
     postBodyComponents: postBodyComponents.concat([_react.default.createElement("script", {
       key: `commons`,
-      src: "/commons.js"
+      src: "/commons.js",
+      __source: {
+        fileName: _jsxFileName,
+        lineNumber: 108
+      },
+      __self: void 0
     })])
-  }));
+  });
 
   htmlStr = (0, _server.renderToStaticMarkup)(htmlElement);
   htmlStr = `<!DOCTYPE html>${htmlStr}`;
-  callback(null, htmlStr);
+  return {
+    html: htmlStr
+  };
 };
 
 exports.default = _default;
\ No newline at end of file
--- a/node_modules/gatsby/cache-dir/commonjs/ensure-resources.js
+++ b/node_modules/gatsby/cache-dir/commonjs/ensure-resources.js
@@ -23,7 +23,8 @@ class EnsureResources extends _react.default.Component {
     super();
     let location = props.location;
     this.state = {
-      location: Object.assign({}, location),
+      location: { ...location
+      },
       pageResources: _loader.default.getResourcesForPathnameSync(location.pathname)
     };
   }
@@ -38,7 +39,8 @@ class EnsureResources extends _react.default.Component {
       if (pageResources) {
         return {
           pageResources,
-          location: Object.assign({}, location)
+          location: { ...location
+          }
         };
       }
     }
@@ -48,7 +50,9 @@ class EnsureResources extends _react.default.Component {
 
   componentDidUpdate(prevProps) {
     if (prevProps === this.props) return;
-    const pathname = this.props.location.pathname;
+    const {
+      pathname
+    } = this.props.location;
     if (!_loader.default.getResourcesForPathnameSync(pathname)) // Page resources won't be set in cases where the browser back button
       // or forward button is pushed as we can't wait as normal for resources
       // to load before changing the page.
@@ -59,7 +63,8 @@ class EnsureResources extends _react.default.Component {
         }
 
         this.setState({
-          location: Object.assign({}, location),
+          location: { ...location
+          },
           pageResources
         });
       });
--- a/node_modules/gatsby/cache-dir/commonjs/gatsby-browser-entry.js
+++ b/node_modules/gatsby/cache-dir/commonjs/gatsby-browser-entry.js
@@ -1,9 +1,9 @@
 "use strict";
 
-var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");
-
 var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
 
+var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");
+
 exports.__esModule = true;
 exports.graphql = graphql;
 exports.StaticQuery = exports.StaticQueryContext = void 0;
@@ -28,16 +28,29 @@ exports.PageRenderer = _publicPageRenderer.default;
 var _parsePath = _interopRequireDefault(require("./parse-path"));
 
 exports.parsePath = _parsePath.default;
+var _jsxFileName = "/Users/loicmahieu/Projects/gatsby/packages/gatsby/cache-dir/gatsby-browser-entry.js";
 
 const StaticQueryContext = _react.default.createContext({});
 
 exports.StaticQueryContext = StaticQueryContext;
 
-const StaticQuery = props => _react.default.createElement(StaticQueryContext.Consumer, null, staticQueryData => {
+const StaticQuery = props => _react.default.createElement(StaticQueryContext.Consumer, {
+  __source: {
+    fileName: _jsxFileName,
+    lineNumber: 16
+  },
+  __self: void 0
+}, staticQueryData => {
   if (props.data || staticQueryData[props.query] && staticQueryData[props.query].data) {
     return (props.render || props.children)(props.data ? props.data.data : staticQueryData[props.query].data);
   } else {
-    return _react.default.createElement("div", null, "Loading (StaticQuery)");
+    return _react.default.createElement("div", {
+      __source: {
+        fileName: _jsxFileName,
+        lineNumber: 26
+      },
+      __self: void 0
+    }, "Loading (StaticQuery)");
   }
 });
 
--- a/node_modules/gatsby/cache-dir/commonjs/json-store.js
+++ b/node_modules/gatsby/cache-dir/commonjs/json-store.js
@@ -7,8 +7,6 @@ exports.default = void 0;
 
 var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));
 
-var _objectWithoutPropertiesLoose2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutPropertiesLoose"));
-
 var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));
 
 var _react = _interopRequireDefault(require("react"));
@@ -19,6 +17,8 @@ var _gatsby = require("gatsby");
 
 var _socketIo = require("./socketIo");
 
+var _jsxFileName = "/Users/loicmahieu/Projects/gatsby/packages/gatsby/cache-dir/json-store.js";
+
 if (process.env.NODE_ENV === `production`) {
   throw new Error(`It appears like Gatsby is misconfigured. JSONStore is Gatsby internal ` + `development-only component and should never be used in production.\n\n` + `Unless your site has a complex or custom webpack/Gatsby ` + `configuration this is likely a bug in Gatsby. ` + `Please report this at https://github.com/gatsbyjs/gatsby/issues ` + `with steps to reproduce this error.`);
 }
@@ -78,17 +78,35 @@ class JSONStore extends _react.default.Component {
   render() {
     const data = this.state.pageQueryData[getPathFromProps(this.props)]; // eslint-disable-next-line
 
-    const _this$props = this.props,
-          pages = _this$props.pages,
-          propsWithoutPages = (0, _objectWithoutPropertiesLoose2.default)(_this$props, ["pages"]);
+    const {
+      pages,
+      ...propsWithoutPages
+    } = this.props;
 
     if (!data) {
-      return _react.default.createElement("div", null);
+      return _react.default.createElement("div", {
+        __source: {
+          fileName: _jsxFileName,
+          lineNumber: 88
+        },
+        __self: this
+      });
     }
 
     return _react.default.createElement(_gatsby.StaticQueryContext.Provider, {
-      value: this.state.staticQueryData
-    }, _react.default.createElement(_pageRenderer.default, (0, _extends2.default)({}, propsWithoutPages, data)));
+      value: this.state.staticQueryData,
+      __source: {
+        fileName: _jsxFileName,
+        lineNumber: 92
+      },
+      __self: this
+    }, _react.default.createElement(_pageRenderer.default, (0, _extends2.default)({}, propsWithoutPages, data, {
+      __source: {
+        fileName: _jsxFileName,
+        lineNumber: 93
+      },
+      __self: this
+    })));
   }
 
 }
--- a/node_modules/gatsby/cache-dir/commonjs/navigation.js
+++ b/node_modules/gatsby/cache-dir/commonjs/navigation.js
@@ -21,7 +21,7 @@ var _emitter = _interopRequireDefault(require("./emitter"));
 
 var _router = require("@reach/router");
 
-var _parsePath2 = _interopRequireDefault(require("./parse-path"));
+var _parsePath = _interopRequireDefault(require("./parse-path"));
 
 // Convert to a map for faster lookup in maybeRedirect()
 const redirectMap = _redirects.default.reduce((map, redirect) => {
@@ -73,21 +73,23 @@ const navigate = (to, options = {}) => {
     window.__navigatingToLink = true;
   }
 
-  let _parsePath = (0, _parsePath2.default)(to),
-      pathname = _parsePath.pathname;
-
+  let {
+    pathname
+  } = (0, _parsePath.default)(to);
   const redirect = redirectMap[pathname]; // If we're redirecting, just replace the passed in pathname
   // to the one we want to redirect to.
 
   if (redirect) {
     to = redirect.toPath;
-    pathname = (0, _parsePath2.default)(to).pathname;
+    pathname = (0, _parsePath.default)(to).pathname;
   } // If we had a service worker update, no matter the path, reload window and
   // reset the pathname whitelist
 
 
   if (window.GATSBY_SW_UPDATED) {
-    const controller = navigator.serviceWorker.controller;
+    const {
+      controller
+    } = navigator.serviceWorker;
     controller.postMessage({
       gatsbyApi: `resetWhitelist`
     });
@@ -116,8 +118,10 @@ const navigate = (to, options = {}) => {
 function shouldUpdateScroll(prevRouterProps, {
   location
 }) {
-  const pathname = location.pathname,
-        hash = location.hash;
+  const {
+    pathname,
+    hash
+  } = location;
   const results = (0, _apiRunnerBrowser.apiRunner)(`shouldUpdateScroll`, {
     prevRouterProps,
     // `pathname` for backwards compatibility
@@ -133,7 +137,11 @@ function shouldUpdateScroll(prevRouterProps, {
   }
 
   if (prevRouterProps) {
-    const oldPathname = prevRouterProps.location.pathname;
+    const {
+      location: {
+        pathname: oldPathname
+      }
+    } = prevRouterProps;
 
     if (oldPathname === pathname) {
       // Scroll to element if it exists, if it doesn't, or no hash is provided,
--- a/node_modules/gatsby/cache-dir/commonjs/page-renderer.js
+++ b/node_modules/gatsby/cache-dir/commonjs/page-renderer.js
@@ -18,19 +18,16 @@ var _apiRunnerBrowser = require("./api-runner-browser");
 // Renders page
 class PageRenderer extends _react.default.Component {
   render() {
-    const props = Object.assign({}, this.props, {
+    const props = { ...this.props,
       pathContext: this.props.pageContext
-    });
-
-    const _apiRunner = (0, _apiRunnerBrowser.apiRunner)(`replaceComponentRenderer`, {
+    };
+    const [replacementElement] = (0, _apiRunnerBrowser.apiRunner)(`replaceComponentRenderer`, {
       props: this.props,
       loader: _loader.publicLoader
-    }),
-          replacementElement = _apiRunner[0];
-
-    const pageElement = replacementElement || (0, _react.createElement)(this.props.pageResources.component, Object.assign({}, props, {
+    });
+    const pageElement = replacementElement || (0, _react.createElement)(this.props.pageResources.component, { ...props,
       key: this.props.location.pathname
-    }));
+    });
     const wrappedPage = (0, _apiRunnerBrowser.apiRunner)(`wrapPageElement`, {
       element: pageElement,
       props
--- a/node_modules/gatsby/cache-dir/commonjs/prefetch.js
+++ b/node_modules/gatsby/cache-dir/commonjs/prefetch.js
@@ -3,7 +3,7 @@
 exports.__esModule = true;
 exports.default = void 0;
 
-const support = function support(feature) {
+const support = function (feature) {
   if (typeof document === `undefined`) {
     return false;
   }
@@ -21,7 +21,7 @@ const support = function support(feature) {
   return false;
 };
 
-const linkPrefetchStrategy = function linkPrefetchStrategy(url) {
+const linkPrefetchStrategy = function (url) {
   return new Promise((resolve, reject) => {
     if (typeof document === `undefined`) {
       reject();
@@ -38,7 +38,7 @@ const linkPrefetchStrategy = function linkPrefetchStrategy(url) {
   });
 };
 
-const xhrPrefetchStrategy = function xhrPrefetchStrategy(url) {
+const xhrPrefetchStrategy = function (url) {
   return new Promise((resolve, reject) => {
     const req = new XMLHttpRequest();
     req.open(`GET`, url, true);
@@ -59,7 +59,7 @@ const xhrPrefetchStrategy = function xhrPrefetchStrategy(url) {
 const supportedPrefetchStrategy = support(`prefetch`) ? linkPrefetchStrategy : xhrPrefetchStrategy;
 const preFetched = {};
 
-const prefetch = function prefetch(url) {
+const prefetch = function (url) {
   return new Promise(resolve => {
     if (preFetched[url]) {
       resolve();
--- a/node_modules/gatsby/cache-dir/commonjs/production-app.js
+++ b/node_modules/gatsby/cache-dir/commonjs/production-app.js
@@ -1,9 +1,9 @@
 "use strict";
 
-var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");
-
 var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
 
+var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");
+
 var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));
 
 var _apiRunnerBrowser = require("./api-runner-browser");
@@ -32,6 +32,7 @@ var _loader = _interopRequireWildcard(require("./loader"));
 
 var _ensureResources = _interopRequireDefault(require("./ensure-resources"));
 
+var _jsxFileName = "/Users/loicmahieu/Projects/gatsby/packages/gatsby/cache-dir/production-app.js";
 window.___emitter = _emitter.default;
 window.asyncRequires = _asyncRequires.default;
 window.___emitter = _emitter.default;
@@ -57,28 +58,52 @@ _loader.default.addProdRequires(_asyncRequires.default);
 
   class RouteHandler extends _react.default.Component {
     render() {
-      let location = this.props.location;
+      let {
+        location
+      } = this.props;
       return _react.default.createElement(_ensureResources.default, {
-        location: location
+        location: location,
+        __source: {
+          fileName: _jsxFileName,
+          lineNumber: 44
+        },
+        __self: this
       }, ({
         pageResources,
         location
       }) => _react.default.createElement(_navigation.RouteUpdates, {
-        location: location
+        location: location,
+        __source: {
+          fileName: _jsxFileName,
+          lineNumber: 46
+        },
+        __self: this
       }, _react.default.createElement(_gatsbyReactRouterScroll.ScrollContext, {
         location: location,
-        shouldUpdateScroll: _navigation.shouldUpdateScroll
+        shouldUpdateScroll: _navigation.shouldUpdateScroll,
+        __source: {
+          fileName: _jsxFileName,
+          lineNumber: 47
+        },
+        __self: this
       }, _react.default.createElement(_pageRenderer.default, (0, _extends2.default)({}, this.props, {
         location: location,
         pageResources: pageResources
-      }, pageResources.json)))));
+      }, pageResources.json, {
+        __source: {
+          fileName: _jsxFileName,
+          lineNumber: 51
+        },
+        __self: this
+      })))));
     }
 
   }
 
-  const _window = window,
-        page = _window.page,
-        browserLoc = _window.location;
+  const {
+    page,
+    location: browserLoc
+  } = window;
 
   if ( // Make sure the window.page object is defined
   page && // The canonical path doesn't match the actual path (i.e. the address bar)
@@ -100,8 +125,20 @@ _loader.default.addProdRequires(_asyncRequires.default);
     }));
 
     const WrappedRoot = (0, _apiRunnerBrowser.apiRunner)(`wrapRootElement`, {
-      element: _react.default.createElement(Root, null)
-    }, _react.default.createElement(Root, null), ({
+      element: _react.default.createElement(Root, {
+        __source: {
+          fileName: _jsxFileName,
+          lineNumber: 99
+        },
+        __self: void 0
+      })
+    }, _react.default.createElement(Root, {
+      __source: {
+        fileName: _jsxFileName,
+        lineNumber: 100
+      },
+      __self: void 0
+    }), ({
       result
     }) => {
       return {
@@ -113,7 +150,13 @@ _loader.default.addProdRequires(_asyncRequires.default);
 
     const renderer = (0, _apiRunnerBrowser.apiRunner)(`replaceHydrateFunction`, undefined, _reactDom.default.hydrate)[0];
     (0, _domready.default)(() => {
-      renderer(_react.default.createElement(NewRoot, null), typeof window !== `undefined` ? document.getElementById(`___gatsby`) : void 0, () => {
+      renderer(_react.default.createElement(NewRoot, {
+        __source: {
+          fileName: _jsxFileName,
+          lineNumber: 116
+        },
+        __self: void 0
+      }), typeof window !== `undefined` ? document.getElementById(`___gatsby`) : void 0, () => {
         (0, _apiRunnerBrowser.apiRunner)(`onInitialClientRender`);
       });
     });
--- a/node_modules/gatsby/cache-dir/commonjs/public-page-renderer-prod.js
+++ b/node_modules/gatsby/cache-dir/commonjs/public-page-renderer-prod.js
@@ -18,10 +18,11 @@ const ProdPageRenderer = ({
 }) => {
   const pageResources = _loader.default.getResourcesForPathnameSync(location.pathname);
 
-  return _react.default.createElement(_pageRenderer.default, Object.assign({
+  return _react.default.createElement(_pageRenderer.default, {
     location,
-    pageResources
-  }, pageResources.json));
+    pageResources,
+    ...pageResources.json
+  });
 };
 
 ProdPageRenderer.propTypes = {
--- a/node_modules/gatsby/cache-dir/commonjs/root.js
+++ b/node_modules/gatsby/cache-dir/commonjs/root.js
@@ -1,9 +1,9 @@
 "use strict";
 
-var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");
-
 var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
 
+var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");
+
 exports.__esModule = true;
 exports.default = void 0;
 
@@ -31,6 +31,8 @@ var _ensureResources = _interopRequireDefault(require("./ensure-resources"));
 
 var _errorOverlayHandler = require("./error-overlay-handler");
 
+var _jsxFileName = "/Users/loicmahieu/Projects/gatsby/packages/gatsby/cache-dir/root.js";
+
 if (window.__webpack_hot_middleware_reporter__ !== undefined) {
   const overlayErrorID = `webpack`; // Report build errors
 
@@ -55,35 +57,70 @@ if (window.__webpack_hot_middleware_reporter__ !== undefined) {
 
 class RouteHandler extends _react.default.Component {
   render() {
-    let location = this.props.location; // check if page exists - in dev pages are sync loaded, it's safe to use
+    let {
+      location
+    } = this.props; // check if page exists - in dev pages are sync loaded, it's safe to use
     // loader.getPage
 
     let page = _loader.default.getPage(location.pathname);
 
     if (page) {
       return _react.default.createElement(_ensureResources.default, {
-        location: location
+        location: location,
+        __source: {
+          fileName: _jsxFileName,
+          lineNumber: 47
+        },
+        __self: this
       }, locationAndPageResources => _react.default.createElement(_navigation.RouteUpdates, {
-        location: location
+        location: location,
+        __source: {
+          fileName: _jsxFileName,
+          lineNumber: 49
+        },
+        __self: this
       }, _react.default.createElement(_gatsbyReactRouterScroll.ScrollContext, {
         location: location,
-        shouldUpdateScroll: _navigation.shouldUpdateScroll
+        shouldUpdateScroll: _navigation.shouldUpdateScroll,
+        __source: {
+          fileName: _jsxFileName,
+          lineNumber: 50
+        },
+        __self: this
       }, _react.default.createElement(_jsonStore.default, (0, _extends2.default)({
         pages: _pages.default
-      }, this.props, locationAndPageResources)))));
+      }, this.props, locationAndPageResources, {
+        __source: {
+          fileName: _jsxFileName,
+          lineNumber: 54
+        },
+        __self: this
+      })))));
     } else {
       const dev404Page = _pages.default.find(p => /^\/dev-404-page\/?$/.test(p.path));
 
       const custom404 = locationAndPageResources => _loader.default.getPage(`/404.html`) ? _react.default.createElement(_jsonStore.default, (0, _extends2.default)({
         pages: _pages.default
-      }, this.props, locationAndPageResources)) : null;
+      }, this.props, locationAndPageResources, {
+        __source: {
+          fileName: _jsxFileName,
+          lineNumber: 68
+        },
+        __self: this
+      })) : null;
 
       return _react.default.createElement(_ensureResources.default, {
-        location: location
-      }, locationAndPageResources => (0, _react.createElement)(_syncRequires.default.components[dev404Page.componentChunkName], Object.assign({
+        location: location,
+        __source: {
+          fileName: _jsxFileName,
+          lineNumber: 76
+        },
+        __self: this
+      }, locationAndPageResources => (0, _react.createElement)(_syncRequires.default.components[dev404Page.componentChunkName], {
         pages: _pages.default,
-        custom404: custom404(locationAndPageResources)
-      }, this.props)));
+        custom404: custom404(locationAndPageResources),
+        ...this.props
+      }));
     }
   }
 
@@ -97,8 +134,20 @@ const Root = () => (0, _react.createElement)(_router.Router, {
 
 
 const WrappedRoot = (0, _apiRunnerBrowser.apiRunner)(`wrapRootElement`, {
-  element: _react.default.createElement(Root, null)
-}, _react.default.createElement(Root, null), ({
+  element: _react.default.createElement(Root, {
+    __source: {
+      fileName: _jsxFileName,
+      lineNumber: 105
+    },
+    __self: void 0
+  })
+}, _react.default.createElement(Root, {
+  __source: {
+    fileName: _jsxFileName,
+    lineNumber: 106
+  },
+  __self: void 0
+}), ({
   result,
   plugin
 }) => {
--- a/node_modules/gatsby/cache-dir/commonjs/socketIo.js
+++ b/node_modules/gatsby/cache-dir/commonjs/socketIo.js
@@ -39,15 +39,15 @@ function socketIo() {
         socket.on(`message`, msg => {
           if (msg.type === `staticQueryResult`) {
             if (didDataChange(msg, staticQueryData)) {
-              staticQueryData = Object.assign({}, staticQueryData, {
+              staticQueryData = { ...staticQueryData,
                 [msg.payload.id]: msg.payload.result
-              });
+              };
             }
           } else if (msg.type === `pageQueryResult`) {
             if (didDataChange(msg, pageQueryData)) {
-              pageQueryData = Object.assign({}, pageQueryData, {
+              pageQueryData = { ...pageQueryData,
                 [msg.payload.id]: msg.payload.result
-              });
+              };
             }
           } else if (msg.type === `overlayError`) {
             if (msg.payload.message) {
--- a/node_modules/gatsby/cache-dir/commonjs/static-entry.js
+++ b/node_modules/gatsby/cache-dir/commonjs/static-entry.js
@@ -7,39 +7,51 @@ exports.default = void 0;
 
 var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));
 
+var _jsxFileName = "/Users/loicmahieu/Projects/gatsby/packages/gatsby/cache-dir/static-entry.js";
+
 const React = require(`react`);
 
 const fs = require(`fs`);
 
-const _require = require(`path`),
-      join = _require.join;
-
-const _require2 = require(`react-dom/server`),
-      renderToString = _require2.renderToString,
-      renderToStaticMarkup = _require2.renderToStaticMarkup;
-
-const _require3 = require(`@reach/router`),
-      ServerLocation = _require3.ServerLocation,
-      Router = _require3.Router,
-      isRedirect = _require3.isRedirect;
-
-const _require4 = require(`lodash`),
-      get = _require4.get,
-      merge = _require4.merge,
-      isObject = _require4.isObject,
-      flatten = _require4.flatten,
-      uniqBy = _require4.uniqBy;
+const {
+  join
+} = require(`path`);
+
+const {
+  renderToString,
+  renderToStaticMarkup
+} = require(`react-dom/server`);
+
+const {
+  ServerLocation,
+  Router,
+  isRedirect
+} = require(`@reach/router`);
+
+const {
+  get,
+  merge,
+  isObject,
+  flatten,
+  uniqBy
+} = require(`lodash`);
 
 const apiRunner = require(`./api-runner-ssr`);
 
+const {
+  apiRunnerAsync
+} = apiRunner;
+
 const syncRequires = require(`./sync-requires`);
 
-const _require5 = require(`./data.json`),
-      dataPaths = _require5.dataPaths,
-      pages = _require5.pages;
+const {
+  dataPaths,
+  pages
+} = require(`./data.json`);
 
-const _require6 = require(`gatsby/package.json`),
-      gatsbyVersion = _require6.version; // Speed up looking up pages.
+const {
+  version: gatsbyVersion
+} = require(`gatsby/package.json`); // Speed up looking up pages.
 
 
 const pagesObjectMap = new Map();
@@ -74,17 +86,29 @@ const getPage = path => pagesObjectMap.get(path);
 
 const createElement = React.createElement;
 
-var _default = (pagePath, callback) => {
+var _default = async (pagePath, callback) => {
   let bodyHtml = ``;
   let headComponents = [React.createElement("meta", {
     name: "generator",
-    content: `Gatsby ${gatsbyVersion}`
+    content: `Gatsby ${gatsbyVersion}`,
+    __source: {
+      fileName: _jsxFileName,
+      lineNumber: 56
+    },
+    __self: void 0
   })];
   let htmlAttributes = {};
   let bodyAttributes = {};
   let preBodyComponents = [];
   let postBodyComponents = [];
   let bodyProps = {};
+  let renderData = {};
+
+  const getRenderData = () => renderData;
+
+  const setRenderData = _data => {
+    renderData = _data;
+  };
 
   const replaceBodyHTMLString = body => {
     bodyHtml = body;
@@ -148,9 +172,10 @@ var _default = (pagePath, callback) => {
 
   class RouteHandler extends React.Component {
     render() {
-      const props = Object.assign({}, this.props, dataAndContext, {
+      const props = { ...this.props,
+        ...dataAndContext,
         pathContext: dataAndContext.pageContext
-      });
+      };
       const pageElement = createElement(syncRequires.components[page.componentChunkName], props);
       const wrappedPage = apiRunner(`wrapPageElement`, {
         element: pageElement,
@@ -187,7 +212,7 @@ var _default = (pagePath, callback) => {
     };
   }).pop(); // Let the site or plugin render the page component.
 
-  apiRunner(`replaceRenderer`, {
+  await apiRunnerAsync(`replaceRenderer`, {
     bodyComponent,
     replaceBodyHTMLString,
     setHeadComponents,
@@ -269,7 +294,12 @@ var _default = (pagePath, callback) => {
       as: "script",
       rel: script.rel,
       key: script.name,
-      href: `${__PATH_PREFIX__}/${script.name}`
+      href: `${__PATH_PREFIX__}/${script.name}`,
+      __source: {
+        fileName: _jsxFileName,
+        lineNumber: 272
+      },
+      __self: void 0
     }));
   });
 
@@ -280,7 +310,12 @@ var _default = (pagePath, callback) => {
       key: dataPath,
       href: dataPath,
       as: "fetch",
-      crossOrigin: "use-credentials"
+      crossOrigin: "use-credentials",
+      __source: {
+        fileName: _jsxFileName,
+        lineNumber: 286
+      },
+      __self: void 0
     }));
   }
 
@@ -292,14 +327,24 @@ var _default = (pagePath, callback) => {
         as: "style",
         rel: style.rel,
         key: style.name,
-        href: `${__PATH_PREFIX__}/${style.name}`
+        href: `${__PATH_PREFIX__}/${style.name}`,
+        __source: {
+          fileName: _jsxFileName,
+          lineNumber: 305
+        },
+        __self: void 0
       }));
     } else {
       headComponents.unshift(React.createElement("style", {
         "data-href": `${__PATH_PREFIX__}/${style.name}`,
         dangerouslySetInnerHTML: {
           __html: fs.readFileSync(join(process.cwd(), `public`, style.name), `utf-8`)
-        }
+        },
+        __source: {
+          fileName: _jsxFileName,
+          lineNumber: 314
+        },
+        __self: void 0
       }));
     }
   }); // Add page metadata for the current page
@@ -310,7 +355,12 @@ var _default = (pagePath, callback) => {
     id: `gatsby-script-loader`,
     dangerouslySetInnerHTML: {
       __html: windowData
-    }
+    },
+    __source: {
+      fileName: _jsxFileName,
+      lineNumber: 335
+    },
+    __self: void 0
   })); // Add chunk mapping metadata
 
   const scriptChunkMapping = `/*<![CDATA[*/window.___chunkMapping=${JSON.stringify(chunkMapping)};/*]]>*/`;
@@ -319,7 +369,12 @@ var _default = (pagePath, callback) => {
     id: `gatsby-chunk-mapping`,
     dangerouslySetInnerHTML: {
       __html: scriptChunkMapping
-    }
+    },
+    __source: {
+      fileName: _jsxFileName,
+      lineNumber: 350
+    },
+    __self: void 0
   })); // Filter out prefetched bundles as adding them as a script tag
   // would force high priority fetching.
 
@@ -328,7 +383,12 @@ var _default = (pagePath, callback) => {
     return React.createElement("script", {
       key: scriptPath,
       src: scriptPath,
-      async: true
+      async: true,
+      __source: {
+        fileName: _jsxFileName,
+        lineNumber: 366
+      },
+      __self: void 0
     });
   });
   postBodyComponents.push(...bodyScripts);
@@ -339,6 +399,8 @@ var _default = (pagePath, callback) => {
     replacePreBodyComponents,
     getPostBodyComponents,
     replacePostBodyComponents,
+    setRenderData,
+    getRenderData,
     pathname: pagePath,
     pathPrefix: __PATH_PREFIX__
   });
@@ -349,9 +411,17 @@ var _default = (pagePath, callback) => {
     preBodyComponents: preBodyComponents,
     postBodyComponents: postBodyComponents,
     body: bodyHtml,
-    path: pagePath
+    path: pagePath,
+    __source: {
+      fileName: _jsxFileName,
+      lineNumber: 385
+    },
+    __self: void 0
   })))}`;
-  callback(null, html);
+  return {
+    html,
+    renderData
+  };
 };
 
 exports.default = _default;
\ No newline at end of file
--- a/node_modules/gatsby/cache-dir/develop-static-entry.js
+++ b/node_modules/gatsby/cache-dir/develop-static-entry.js
@@ -111,5 +111,5 @@ export default (pagePath, callback) => {
   htmlStr = renderToStaticMarkup(htmlElement)
   htmlStr = `<!DOCTYPE html>${htmlStr}`
 
-  callback(null, htmlStr)
+  return { html: htmlStr }
 }
--- a/node_modules/gatsby/cache-dir/static-entry.js
+++ b/node_modules/gatsby/cache-dir/static-entry.js
@@ -6,6 +6,7 @@ const { ServerLocation, Router, isRedirect } = require(`@reach/router`)
 const { get, merge, isObject, flatten, uniqBy } = require(`lodash`)
 
 const apiRunner = require(`./api-runner-ssr`)
+const { apiRunnerAsync } = apiRunner
 const syncRequires = require(`./sync-requires`)
 const { dataPaths, pages } = require(`./data.json`)
 const { version: gatsbyVersion } = require(`gatsby/package.json`)
@@ -49,7 +50,7 @@ const getPage = path => pagesObjectMap.get(path)
 
 const createElement = React.createElement
 
-export default (pagePath, callback) => {
+export default async (pagePath, callback) => {
   let bodyHtml = ``
   let headComponents = [
     <meta name="generator" content={`Gatsby ${gatsbyVersion}`} />,
@@ -59,6 +60,12 @@ export default (pagePath, callback) => {
   let preBodyComponents = []
   let postBodyComponents = []
   let bodyProps = {}
+  let renderData = {}
+
+  const getRenderData = () => renderData
+  const setRenderData = _data => {
+    renderData = _data
+  }
 
   const replaceBodyHTMLString = body => {
     bodyHtml = body
@@ -171,7 +178,7 @@ export default (pagePath, callback) => {
   ).pop()
 
   // Let the site or plugin render the page component.
-  apiRunner(`replaceRenderer`, {
+  await apiRunnerAsync(`replaceRenderer`, {
     bodyComponent,
     replaceBodyHTMLString,
     setHeadComponents,
@@ -368,6 +375,8 @@ export default (pagePath, callback) => {
     replacePreBodyComponents,
     getPostBodyComponents,
     replacePostBodyComponents,
+    setRenderData,
+    getRenderData,
     pathname: pagePath,
     pathPrefix: __PATH_PREFIX__,
   })
@@ -385,5 +394,5 @@ export default (pagePath, callback) => {
     />
   )}`
 
-  callback(null, html)
+  return { html, renderData }
 }
--- a/node_modules/gatsby/dist/bootstrap/get-config-file.js
+++ b/node_modules/gatsby/dist/bootstrap/get-config-file.js
@@ -1,9 +1,5 @@
 "use strict";
 
-var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
-
-var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
-
 const levenshtein = require(`fast-levenshtein`);
 
 const fs = require(`fs-extra`);
@@ -22,35 +18,27 @@ function isNearMatch(fileName, configName, distance) {
   return levenshtein.get(fileName, configName) <= distance;
 }
 
-module.exports =
-/*#__PURE__*/
-function () {
-  var _getConfigFile = (0, _asyncToGenerator2.default)(function* (rootDir, configName, distance = 3) {
-    const configPath = path.join(rootDir, configName);
-    let configModule;
-
-    try {
-      configModule = require(configPath);
-    } catch (err) {
-      const nearMatch = yield fs.readdir(rootDir).then(files => files.find(file => {
-        const fileName = file.split(rootDir).pop();
-        return isNearMatch(fileName, configName, distance);
-      }));
-
-      if (!testRequireError(configPath, err)) {
-        report.panic(`We encountered an error while trying to load your site's ${configName}. Please fix the error and try again.`, err);
-      } else if (nearMatch) {
-        report.panic(`It looks like you were trying to add the config file? Please rename "${chalk.bold(nearMatch)}" to "${chalk.bold(configName)}"`);
-      } else if (existsSync(path.join(rootDir, `src`, configName))) {
-        report.panic(`Your ${configName} file is in the wrong place. You've placed it in the src/ directory. It must instead be at the root of your site next to your package.json file.`);
-      }
+module.exports = async function getConfigFile(rootDir, configName, distance = 3) {
+  const configPath = path.join(rootDir, configName);
+  let configModule;
+
+  try {
+    configModule = require(configPath);
+  } catch (err) {
+    const nearMatch = await fs.readdir(rootDir).then(files => files.find(file => {
+      const fileName = file.split(rootDir).pop();
+      return isNearMatch(fileName, configName, distance);
+    }));
+
+    if (!testRequireError(configPath, err)) {
+      report.panic(`We encountered an error while trying to load your site's ${configName}. Please fix the error and try again.`, err);
+    } else if (nearMatch) {
+      report.panic(`It looks like you were trying to add the config file? Please rename "${chalk.bold(nearMatch)}" to "${chalk.bold(configName)}"`);
+    } else if (existsSync(path.join(rootDir, `src`, configName))) {
+      report.panic(`Your ${configName} file is in the wrong place. You've placed it in the src/ directory. It must instead be at the root of your site next to your package.json file.`);
     }
+  }
 
-    return configModule;
-  });
-
-  return function getConfigFile(_x, _x2) {
-    return _getConfigFile.apply(this, arguments);
-  };
-}();
+  return configModule;
+};
 //# sourceMappingURL=get-config-file.js.map
\ No newline at end of file
--- a/node_modules/gatsby/dist/bootstrap/get-config-file.js.map
+++ b/node_modules/gatsby/dist/bootstrap/get-config-file.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/bootstrap/get-config-file.js"],"names":["levenshtein","require","fs","testRequireError","default","report","chalk","path","existsSync","sync","isNearMatch","fileName","configName","distance","get","module","exports","rootDir","configPath","join","configModule","err","nearMatch","readdir","then","files","find","file","split","pop","panic","bold","getConfigFile"],"mappings":";;;;;;AACA,MAAMA,WAAW,GAAGC,OAAO,CAAE,kBAAF,CAA3B;;AACA,MAAMC,EAAE,GAAGD,OAAO,CAAE,UAAF,CAAlB;;AACA,MAAME,gBAAgB,GAAGF,OAAO,CAAE,6BAAF,CAAP,CAAuCG,OAAhE;;AACA,MAAMC,MAAM,GAAGJ,OAAO,CAAE,yBAAF,CAAtB;;AACA,MAAMK,KAAK,GAAGL,OAAO,CAAE,OAAF,CAArB;;AACA,MAAMM,IAAI,GAAGN,OAAO,CAAE,MAAF,CAApB;;AACA,MAAMO,UAAU,GAAGP,OAAO,CAAE,kBAAF,CAAP,CAA4BQ,IAA/C;;AAEA,SAASC,WAAT,CACEC,QADF,EAEEC,UAFF,EAGEC,QAHF,EAIW;AACT,SAAOb,WAAW,CAACc,GAAZ,CAAgBH,QAAhB,EAA0BC,UAA1B,KAAyCC,QAAhD;AACD;;AAEDE,MAAM,CAACC,OAAP;AAAA;AAAA;AAAA,uDAAiB,WACfC,OADe,EAEfL,UAFe,EAGfC,QAAgB,GAAG,CAHJ,EAIf;AACA,UAAMK,UAAU,GAAGX,IAAI,CAACY,IAAL,CAAUF,OAAV,EAAmBL,UAAnB,CAAnB;AACA,QAAIQ,YAAJ;;AACA,QAAI;AACFA,MAAAA,YAAY,GAAGnB,OAAO,CAACiB,UAAD,CAAtB;AACD,KAFD,CAEE,OAAOG,GAAP,EAAY;AACZ,YAAMC,SAAS,SAASpB,EAAE,CAACqB,OAAH,CAAWN,OAAX,EAAoBO,IAApB,CAAyBC,KAAK,IACpDA,KAAK,CAACC,IAAN,CAAWC,IAAI,IAAI;AACjB,cAAMhB,QAAQ,GAAGgB,IAAI,CAACC,KAAL,CAAWX,OAAX,EAAoBY,GAApB,EAAjB;AACA,eAAOnB,WAAW,CAACC,QAAD,EAAWC,UAAX,EAAuBC,QAAvB,CAAlB;AACD,OAHD,CADsB,CAAxB;;AAMA,UAAI,CAACV,gBAAgB,CAACe,UAAD,EAAaG,GAAb,CAArB,EAAwC;AACtChB,QAAAA,MAAM,CAACyB,KAAP,CACG,4DAA2DlB,UAAW,uCADzE,EAEES,GAFF;AAID,OALD,MAKO,IAAIC,SAAJ,EAAe;AACpBjB,QAAAA,MAAM,CAACyB,KAAP,CACG,wEAAuExB,KAAK,CAACyB,IAAN,CACtET,SADsE,CAEtE,SAAQhB,KAAK,CAACyB,IAAN,CAAWnB,UAAX,CAAuB,GAHnC;AAKD,OANM,MAMA,IAAIJ,UAAU,CAACD,IAAI,CAACY,IAAL,CAAUF,OAAV,EAAoB,KAApB,EAA0BL,UAA1B,CAAD,CAAd,EAAuD;AAC5DP,QAAAA,MAAM,CAACyB,KAAP,CACG,QAAOlB,UAAW,kJADrB;AAGD;AACF;;AAED,WAAOQ,YAAP;AACD,GAnCD;;AAAA,kBAAgCY,aAAhC;AAAA;AAAA;AAAA","sourcesContent":["/* @flow */\nconst levenshtein = require(`fast-levenshtein`)\nconst fs = require(`fs-extra`)\nconst testRequireError = require(`../utils/test-require-error`).default\nconst report = require(`gatsby-cli/lib/reporter`)\nconst chalk = require(`chalk`)\nconst path = require(`path`)\nconst existsSync = require(`fs-exists-cached`).sync\n\nfunction isNearMatch(\n  fileName: string,\n  configName: string,\n  distance: number\n): boolean {\n  return levenshtein.get(fileName, configName) <= distance\n}\n\nmodule.exports = async function getConfigFile(\n  rootDir: string,\n  configName: string,\n  distance: number = 3\n) {\n  const configPath = path.join(rootDir, configName)\n  let configModule\n  try {\n    configModule = require(configPath)\n  } catch (err) {\n    const nearMatch = await fs.readdir(rootDir).then(files =>\n      files.find(file => {\n        const fileName = file.split(rootDir).pop()\n        return isNearMatch(fileName, configName, distance)\n      })\n    )\n    if (!testRequireError(configPath, err)) {\n      report.panic(\n        `We encountered an error while trying to load your site's ${configName}. Please fix the error and try again.`,\n        err\n      )\n    } else if (nearMatch) {\n      report.panic(\n        `It looks like you were trying to add the config file? Please rename \"${chalk.bold(\n          nearMatch\n        )}\" to \"${chalk.bold(configName)}\"`\n      )\n    } else if (existsSync(path.join(rootDir, `src`, configName))) {\n      report.panic(\n        `Your ${configName} file is in the wrong place. You've placed it in the src/ directory. It must instead be at the root of your site next to your package.json file.`\n      )\n    }\n  }\n\n  return configModule\n}\n"],"file":"get-config-file.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/bootstrap/get-config-file.js"],"names":["levenshtein","require","fs","testRequireError","default","report","chalk","path","existsSync","sync","isNearMatch","fileName","configName","distance","get","module","exports","getConfigFile","rootDir","configPath","join","configModule","err","nearMatch","readdir","then","files","find","file","split","pop","panic","bold"],"mappings":";;AACA,MAAMA,WAAW,GAAGC,OAAO,CAAE,kBAAF,CAA3B;;AACA,MAAMC,EAAE,GAAGD,OAAO,CAAE,UAAF,CAAlB;;AACA,MAAME,gBAAgB,GAAGF,OAAO,CAAE,6BAAF,CAAP,CAAuCG,OAAhE;;AACA,MAAMC,MAAM,GAAGJ,OAAO,CAAE,yBAAF,CAAtB;;AACA,MAAMK,KAAK,GAAGL,OAAO,CAAE,OAAF,CAArB;;AACA,MAAMM,IAAI,GAAGN,OAAO,CAAE,MAAF,CAApB;;AACA,MAAMO,UAAU,GAAGP,OAAO,CAAE,kBAAF,CAAP,CAA4BQ,IAA/C;;AAEA,SAASC,WAAT,CACEC,QADF,EAEEC,UAFF,EAGEC,QAHF,EAIW;AACT,SAAOb,WAAW,CAACc,GAAZ,CAAgBH,QAAhB,EAA0BC,UAA1B,KAAyCC,QAAhD;AACD;;AAEDE,MAAM,CAACC,OAAP,GAAiB,eAAeC,aAAf,CACfC,OADe,EAEfN,UAFe,EAGfC,QAAgB,GAAG,CAHJ,EAIf;AACA,QAAMM,UAAU,GAAGZ,IAAI,CAACa,IAAL,CAAUF,OAAV,EAAmBN,UAAnB,CAAnB;AACA,MAAIS,YAAJ;;AACA,MAAI;AACFA,IAAAA,YAAY,GAAGpB,OAAO,CAACkB,UAAD,CAAtB;AACD,GAFD,CAEE,OAAOG,GAAP,EAAY;AACZ,UAAMC,SAAS,GAAG,MAAMrB,EAAE,CAACsB,OAAH,CAAWN,OAAX,EAAoBO,IAApB,CAAyBC,KAAK,IACpDA,KAAK,CAACC,IAAN,CAAWC,IAAI,IAAI;AACjB,YAAMjB,QAAQ,GAAGiB,IAAI,CAACC,KAAL,CAAWX,OAAX,EAAoBY,GAApB,EAAjB;AACA,aAAOpB,WAAW,CAACC,QAAD,EAAWC,UAAX,EAAuBC,QAAvB,CAAlB;AACD,KAHD,CADsB,CAAxB;;AAMA,QAAI,CAACV,gBAAgB,CAACgB,UAAD,EAAaG,GAAb,CAArB,EAAwC;AACtCjB,MAAAA,MAAM,CAAC0B,KAAP,CACG,4DAA2DnB,UAAW,uCADzE,EAEEU,GAFF;AAID,KALD,MAKO,IAAIC,SAAJ,EAAe;AACpBlB,MAAAA,MAAM,CAAC0B,KAAP,CACG,wEAAuEzB,KAAK,CAAC0B,IAAN,CACtET,SADsE,CAEtE,SAAQjB,KAAK,CAAC0B,IAAN,CAAWpB,UAAX,CAAuB,GAHnC;AAKD,KANM,MAMA,IAAIJ,UAAU,CAACD,IAAI,CAACa,IAAL,CAAUF,OAAV,EAAoB,KAApB,EAA0BN,UAA1B,CAAD,CAAd,EAAuD;AAC5DP,MAAAA,MAAM,CAAC0B,KAAP,CACG,QAAOnB,UAAW,kJADrB;AAGD;AACF;;AAED,SAAOS,YAAP;AACD,CAnCD","sourcesContent":["/* @flow */\nconst levenshtein = require(`fast-levenshtein`)\nconst fs = require(`fs-extra`)\nconst testRequireError = require(`../utils/test-require-error`).default\nconst report = require(`gatsby-cli/lib/reporter`)\nconst chalk = require(`chalk`)\nconst path = require(`path`)\nconst existsSync = require(`fs-exists-cached`).sync\n\nfunction isNearMatch(\n  fileName: string,\n  configName: string,\n  distance: number\n): boolean {\n  return levenshtein.get(fileName, configName) <= distance\n}\n\nmodule.exports = async function getConfigFile(\n  rootDir: string,\n  configName: string,\n  distance: number = 3\n) {\n  const configPath = path.join(rootDir, configName)\n  let configModule\n  try {\n    configModule = require(configPath)\n  } catch (err) {\n    const nearMatch = await fs.readdir(rootDir).then(files =>\n      files.find(file => {\n        const fileName = file.split(rootDir).pop()\n        return isNearMatch(fileName, configName, distance)\n      })\n    )\n    if (!testRequireError(configPath, err)) {\n      report.panic(\n        `We encountered an error while trying to load your site's ${configName}. Please fix the error and try again.`,\n        err\n      )\n    } else if (nearMatch) {\n      report.panic(\n        `It looks like you were trying to add the config file? Please rename \"${chalk.bold(\n          nearMatch\n        )}\" to \"${chalk.bold(configName)}\"`\n      )\n    } else if (existsSync(path.join(rootDir, `src`, configName))) {\n      report.panic(\n        `Your ${configName} file is in the wrong place. You've placed it in the src/ directory. It must instead be at the root of your site next to your package.json file.`\n      )\n    }\n  }\n\n  return configModule\n}\n"],"file":"get-config-file.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/bootstrap/index.js
+++ b/node_modules/gatsby/dist/bootstrap/index.js
@@ -1,9 +1,5 @@
 "use strict";
 
-var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
-
-var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
-
 const _ = require(`lodash`);
 
 const slash = require(`slash`);
@@ -28,12 +24,14 @@ const mergeGatsbyConfig = require(`../utils/merge-gatsby-config`);
 
 const getBrowserslist = require(`../utils/browserslist`);
 
-const _require = require(`graphql`),
-      graphql = _require.graphql;
+const {
+  graphql
+} = require(`graphql`);
 
-const _require2 = require(`../redux`),
-      store = _require2.store,
-      emitter = _require2.emitter;
+const {
+  store,
+  emitter
+} = require(`../redux`);
 
 const loadPlugins = require(`./load-plugins`);
 
@@ -50,441 +48,430 @@ process.on(`unhandledRejection`, (reason, p) => {
   report.panic(reason);
 });
 
-const _require3 = require(`../internal-plugins/query-runner/query-watcher`),
-      extractQueries = _require3.extractQueries;
+const {
+  extractQueries
+} = require(`../internal-plugins/query-runner/query-watcher`);
 
-const _require4 = require(`../internal-plugins/query-runner/page-query-runner`),
-      runInitialQueries = _require4.runInitialQueries;
+const {
+  runInitialQueries
+} = require(`../internal-plugins/query-runner/page-query-runner`);
 
 const queryQueue = require(`../internal-plugins/query-runner/query-queue`);
 
-const _require5 = require(`../internal-plugins/query-runner/pages-writer`),
-      writePages = _require5.writePages;
+const {
+  writePages
+} = require(`../internal-plugins/query-runner/pages-writer`);
 
-const _require6 = require(`../internal-plugins/query-runner/redirects-writer`),
-      writeRedirects = _require6.writeRedirects; // Override console.log to add the source file + line number.
+const {
+  writeRedirects
+} = require(`../internal-plugins/query-runner/redirects-writer`); // Override console.log to add the source file + line number.
 // Useful for debugging if you lose a console.log somewhere.
 // Otherwise leave commented out.
 // require(`./log-line-function`)
 
 
-module.exports =
-/*#__PURE__*/
-function () {
-  var _ref = (0, _asyncToGenerator2.default)(function* (args) {
-    const spanArgs = args.parentSpan ? {
-      childOf: args.parentSpan
-    } : {};
-    const bootstrapSpan = tracer.startSpan(`bootstrap`, spanArgs); // Start plugin runner which listens to the store
-    // and invokes Gatsby API based on actions.
+module.exports = async args => {
+  const spanArgs = args.parentSpan ? {
+    childOf: args.parentSpan
+  } : {};
+  const bootstrapSpan = tracer.startSpan(`bootstrap`, spanArgs); // Start plugin runner which listens to the store
+  // and invokes Gatsby API based on actions.
 
-    require(`../redux/plugin-runner`);
+  require(`../redux/plugin-runner`);
 
-    const directory = slash(args.directory);
-    const program = Object.assign({}, args, {
-      browserslist: getBrowserslist(directory),
-      // Fix program directory path for windows env.
-      directory
-    });
-    store.dispatch({
-      type: `SET_PROGRAM`,
-      payload: program
-    }); // Try opening the site's gatsby-config.js file.
+  const directory = slash(args.directory);
+  const program = { ...args,
+    browserslist: getBrowserslist(directory),
+    // Fix program directory path for windows env.
+    directory
+  };
+  store.dispatch({
+    type: `SET_PROGRAM`,
+    payload: program
+  }); // Try opening the site's gatsby-config.js file.
 
-    let activity = report.activityTimer(`open and validate gatsby-configs`, {
-      parentSpan: bootstrapSpan
-    });
-    activity.start();
-    let config = yield preferDefault(getConfigFile(program.directory, `gatsby-config`)); // theme gatsby configs can be functions or objects
-
-    if (config && config.__experimentalThemes) {
-      const themesConfig = yield Promise.mapSeries(config.__experimentalThemes,
-      /*#__PURE__*/
-      function () {
-        var _ref2 = (0, _asyncToGenerator2.default)(function* (plugin) {
-          const themeName = plugin.resolve || plugin;
-          const themeConfig = plugin.options || {};
-          const theme = yield preferDefault(getConfigFile(themeName, `gatsby-config`)); // if theme is a function, call it with the themeConfig
-
-          let themeConfigObj = theme;
-
-          if (_.isFunction(theme)) {
-            themeConfigObj = theme(themeConfig);
-          } // themes function as plugins too (gatsby-node, etc)
-
-
-          return Object.assign({}, themeConfigObj, {
-            plugins: [...(themeConfigObj.plugins || []), // theme plugin is last so it's gatsby-node, etc can override it's declared plugins, like a normal site.
-            {
-              resolve: themeName,
-              options: themeConfig
-            }]
-          });
-        });
+  let activity = report.activityTimer(`open and validate gatsby-configs`, {
+    parentSpan: bootstrapSpan
+  });
+  activity.start();
+  let config = await preferDefault(getConfigFile(program.directory, `gatsby-config`)); // theme gatsby configs can be functions or objects
 
-        return function (_x2) {
-          return _ref2.apply(this, arguments);
-        };
-      }()).reduce(mergeGatsbyConfig, {});
-      config = mergeGatsbyConfig(themesConfig, config);
-    }
+  if (config && config.__experimentalThemes) {
+    const themesConfig = await Promise.mapSeries(config.__experimentalThemes, async plugin => {
+      const themeName = plugin.resolve || plugin;
+      const themeConfig = plugin.options || {};
+      const theme = await preferDefault(getConfigFile(themeName, `gatsby-config`)); // if theme is a function, call it with the themeConfig
 
-    if (config && config.polyfill) {
-      report.warn(`Support for custom Promise polyfills has been removed in Gatsby v2. We only support Babel 7's new automatic polyfilling behavior.`);
-    }
+      let themeConfigObj = theme;
 
-    store.dispatch({
-      type: `SET_SITE_CONFIG`,
-      payload: config
-    });
-    activity.end();
-    activity = report.activityTimer(`load plugins`);
-    activity.start();
-    const flattenedPlugins = yield loadPlugins(config);
-    activity.end(); // onPreInit
+      if (_.isFunction(theme)) {
+        themeConfigObj = theme(themeConfig);
+      } // themes function as plugins too (gatsby-node, etc)
 
-    activity = report.activityTimer(`onPreInit`, {
-      parentSpan: bootstrapSpan
-    });
-    activity.start();
-    yield apiRunnerNode(`onPreInit`, {
-      parentSpan: activity.span
-    });
-    activity.end(); // Delete html and css files from the public directory as we don't want
-    // deleted pages and styles from previous builds to stick around.
 
-    activity = report.activityTimer(`delete html and css files from previous builds`, {
-      parentSpan: bootstrapSpan
-    });
-    activity.start();
-    yield del([`public/*.{html,css}`, `public/**/*.{html,css}`, `!public/static`, `!public/static/**/*.{html,css}`]);
-    activity.end();
-    activity = report.activityTimer(`initialize cache`);
-    activity.start(); // Check if any plugins have been updated since our last run. If so
-    // we delete the cache is there's likely been changes
-    // since the previous run.
-    //
-    // We do this by creating a hash of all the version numbers of installed
-    // plugins, the site's package.json, gatsby-config.js, and gatsby-node.js.
-    // The last, gatsby-node.js, is important as many gatsby sites put important
-    // logic in there e.g. generating slugs for custom pages.
-
-    const pluginVersions = flattenedPlugins.map(p => p.version);
-    const hashes = yield Promise.all([md5File(`package.json`), Promise.resolve(md5File(`${program.directory}/gatsby-config.js`).catch(() => {})), // ignore as this file isn't required),
-    Promise.resolve(md5File(`${program.directory}/gatsby-node.js`).catch(() => {}))]);
-    const pluginsHash = crypto.createHash(`md5`).update(JSON.stringify(pluginVersions.concat(hashes))).digest(`hex`);
-    let state = store.getState();
-    const oldPluginsHash = state && state.status ? state.status.PLUGINS_HASH : ``; // Check if anything has changed. If it has, delete the site's .cache
-    // directory and tell reducers to empty themselves.
-    //
-    // Also if the hash isn't there, then delete things just in case something
-    // is weird.
-
-    if (oldPluginsHash && pluginsHash !== oldPluginsHash) {
-      report.info(report.stripIndent`
+      return { ...themeConfigObj,
+        plugins: [...(themeConfigObj.plugins || []), // theme plugin is last so it's gatsby-node, etc can override it's declared plugins, like a normal site.
+        {
+          resolve: themeName,
+          options: themeConfig
+        }]
+      };
+    }).reduce(mergeGatsbyConfig, {});
+    config = mergeGatsbyConfig(themesConfig, config);
+  }
+
+  if (config && config.polyfill) {
+    report.warn(`Support for custom Promise polyfills has been removed in Gatsby v2. We only support Babel 7's new automatic polyfilling behavior.`);
+  }
+
+  store.dispatch({
+    type: `SET_SITE_CONFIG`,
+    payload: config
+  });
+  activity.end();
+  activity = report.activityTimer(`load plugins`);
+  activity.start();
+  const flattenedPlugins = await loadPlugins(config);
+  activity.end(); // onPreInit
+
+  activity = report.activityTimer(`onPreInit`, {
+    parentSpan: bootstrapSpan
+  });
+  activity.start();
+  await apiRunnerNode(`onPreInit`, {
+    parentSpan: activity.span
+  });
+  activity.end(); // Delete html and css files from the public directory as we don't want
+  // deleted pages and styles from previous builds to stick around.
+
+  activity = report.activityTimer(`delete html and css files from previous builds`, {
+    parentSpan: bootstrapSpan
+  });
+  activity.start();
+  await del([`public/*.{html,css}`, `public/**/*.{html,css}`, `!public/static`, `!public/static/**/*.{html,css}`]);
+  activity.end();
+  activity = report.activityTimer(`initialize cache`);
+  activity.start(); // Check if any plugins have been updated since our last run. If so
+  // we delete the cache is there's likely been changes
+  // since the previous run.
+  //
+  // We do this by creating a hash of all the version numbers of installed
+  // plugins, the site's package.json, gatsby-config.js, and gatsby-node.js.
+  // The last, gatsby-node.js, is important as many gatsby sites put important
+  // logic in there e.g. generating slugs for custom pages.
+
+  const pluginVersions = flattenedPlugins.map(p => p.version);
+  const hashes = await Promise.all([md5File(`package.json`), Promise.resolve(md5File(`${program.directory}/gatsby-config.js`).catch(() => {})), // ignore as this file isn't required),
+  Promise.resolve(md5File(`${program.directory}/gatsby-node.js`).catch(() => {}))]);
+  const pluginsHash = crypto.createHash(`md5`).update(JSON.stringify(pluginVersions.concat(hashes))).digest(`hex`);
+  let state = store.getState();
+  const oldPluginsHash = state && state.status ? state.status.PLUGINS_HASH : ``; // Check if anything has changed. If it has, delete the site's .cache
+  // directory and tell reducers to empty themselves.
+  //
+  // Also if the hash isn't there, then delete things just in case something
+  // is weird.
+
+  if (oldPluginsHash && pluginsHash !== oldPluginsHash) {
+    report.info(report.stripIndent`
       One or more of your plugins have changed since the last time you ran Gatsby. As
       a precaution, we're deleting your site's cache to ensure there's not any stale
       data
     `);
-    }
+  }
 
-    if (!oldPluginsHash || pluginsHash !== oldPluginsHash) {
-      try {
-        yield fs.remove(`${program.directory}/.cache`);
-      } catch (e) {
-        report.error(`Failed to remove .cache files.`, e);
-      } // Tell reducers to delete their data (the store will already have
-      // been loaded from the file system cache).
+  if (!oldPluginsHash || pluginsHash !== oldPluginsHash) {
+    try {
+      await fs.remove(`${program.directory}/.cache`);
+    } catch (e) {
+      report.error(`Failed to remove .cache files.`, e);
+    } // Tell reducers to delete their data (the store will already have
+    // been loaded from the file system cache).
 
 
-      store.dispatch({
-        type: `DELETE_CACHE`
-      });
-    } // Update the store with the new plugins hash.
+    store.dispatch({
+      type: `DELETE_CACHE`
+    });
+  } // Update the store with the new plugins hash.
 
 
-    store.dispatch({
-      type: `UPDATE_PLUGINS_HASH`,
-      payload: pluginsHash
-    }); // Now that we know the .cache directory is safe, initialize the cache
-    // directory.
+  store.dispatch({
+    type: `UPDATE_PLUGINS_HASH`,
+    payload: pluginsHash
+  }); // Now that we know the .cache directory is safe, initialize the cache
+  // directory.
 
-    yield fs.ensureDir(`${program.directory}/.cache`); // Ensure the public/static directory
+  await fs.ensureDir(`${program.directory}/.cache`); // Ensure the public/static directory
 
-    yield fs.ensureDir(`${program.directory}/public/static`);
-    activity.end(); // Copy our site files to the root of the site.
+  await fs.ensureDir(`${program.directory}/public/static`);
+  activity.end(); // Copy our site files to the root of the site.
 
-    activity = report.activityTimer(`copy gatsby files`, {
-      parentSpan: bootstrapSpan
+  activity = report.activityTimer(`copy gatsby files`, {
+    parentSpan: bootstrapSpan
+  });
+  activity.start();
+  const srcDir = `${__dirname}/../../cache-dir`;
+  const siteDir = `${program.directory}/.cache`;
+  const tryRequire = `${__dirname}/../utils/test-require-error.js`;
+
+  try {
+    await fs.copy(srcDir, siteDir, {
+      clobber: true
     });
-    activity.start();
-    const srcDir = `${__dirname}/../../cache-dir`;
-    const siteDir = `${program.directory}/.cache`;
-    const tryRequire = `${__dirname}/../utils/test-require-error.js`;
+    await fs.copy(tryRequire, `${siteDir}/test-require-error.js`, {
+      clobber: true
+    });
+    await fs.ensureDirSync(`${program.directory}/.cache/json`); // Ensure .cache/fragments exists and is empty. We want fragments to be
+    // added on every run in response to data as fragments can only be added if
+    // the data used to create the schema they're dependent on is available.
+
+    await fs.emptyDir(`${program.directory}/.cache/fragments`);
+  } catch (err) {
+    report.panic(`Unable to copy site files to .cache`, err);
+  } // Find plugins which implement gatsby-browser and gatsby-ssr and write
+  // out api-runners for them.
+
+
+  const hasAPIFile = (env, plugin) => {
+    // The plugin loader has disabled SSR APIs for this plugin. Usually due to
+    // multiple implementations of an API that can only be implemented once
+    if (env === `ssr` && plugin.skipSSR === true) return undefined;
+    const envAPIs = plugin[`${env}APIs`]; // Always include the site's gatsby-browser.js if it exists as it's
+    // a handy place to include global styles and other global imports.
 
     try {
-      yield fs.copy(srcDir, siteDir, {
-        clobber: true
-      });
-      yield fs.copy(tryRequire, `${siteDir}/test-require-error.js`, {
-        clobber: true
-      });
-      yield fs.ensureDirSync(`${program.directory}/.cache/json`); // Ensure .cache/fragments exists and is empty. We want fragments to be
-      // added on every run in response to data as fragments can only be added if
-      // the data used to create the schema they're dependent on is available.
-
-      yield fs.emptyDir(`${program.directory}/.cache/fragments`);
-    } catch (err) {
-      report.panic(`Unable to copy site files to .cache`, err);
-    } // Find plugins which implement gatsby-browser and gatsby-ssr and write
-    // out api-runners for them.
-
-
-    const hasAPIFile = (env, plugin) => {
-      // The plugin loader has disabled SSR APIs for this plugin. Usually due to
-      // multiple implementations of an API that can only be implemented once
-      if (env === `ssr` && plugin.skipSSR === true) return undefined;
-      const envAPIs = plugin[`${env}APIs`]; // Always include the site's gatsby-browser.js if it exists as it's
-      // a handy place to include global styles and other global imports.
-
-      try {
-        if (env === `browser` && plugin.name === `default-site-plugin`) {
-          return slash(require.resolve(path.join(plugin.resolve, `gatsby-${env}`)));
-        }
-      } catch (e) {// ignore
+      if (env === `browser` && plugin.name === `default-site-plugin`) {
+        return slash(require.resolve(path.join(plugin.resolve, `gatsby-${env}`)));
       }
+    } catch (e) {// ignore
+    }
 
-      if (envAPIs && Array.isArray(envAPIs) && envAPIs.length > 0) {
-        return slash(path.join(plugin.resolve, `gatsby-${env}`));
-      }
+    if (envAPIs && Array.isArray(envAPIs) && envAPIs.length > 0) {
+      return slash(path.join(plugin.resolve, `gatsby-${env}`));
+    }
 
-      return undefined;
-    };
+    return undefined;
+  };
 
-    const ssrPlugins = _.filter(flattenedPlugins.map(plugin => {
-      return {
-        resolve: hasAPIFile(`ssr`, plugin),
-        options: plugin.pluginOptions
-      };
-    }), plugin => plugin.resolve);
+  const ssrPlugins = _.filter(flattenedPlugins.map(plugin => {
+    return {
+      resolve: hasAPIFile(`ssr`, plugin),
+      options: plugin.pluginOptions
+    };
+  }), plugin => plugin.resolve);
 
-    const browserPlugins = _.filter(flattenedPlugins.map(plugin => {
-      return {
-        resolve: hasAPIFile(`browser`, plugin),
-        options: plugin.pluginOptions
-      };
-    }), plugin => plugin.resolve);
+  const browserPlugins = _.filter(flattenedPlugins.map(plugin => {
+    return {
+      resolve: hasAPIFile(`browser`, plugin),
+      options: plugin.pluginOptions
+    };
+  }), plugin => plugin.resolve);
 
-    const browserPluginsRequires = browserPlugins.map(plugin => `{
+  const browserPluginsRequires = browserPlugins.map(plugin => `{
       plugin: require('${plugin.resolve}'),
       options: ${JSON.stringify(plugin.options)},
     }`).join(`,`);
-    const browserAPIRunner = `module.exports = [${browserPluginsRequires}]\n`;
-    let sSRAPIRunner = ``;
+  const browserAPIRunner = `module.exports = [${browserPluginsRequires}]\n`;
+  let sSRAPIRunner = ``;
 
-    try {
-      sSRAPIRunner = fs.readFileSync(`${siteDir}/api-runner-ssr.js`, `utf-8`);
-    } catch (err) {
-      report.panic(`Failed to read ${siteDir}/api-runner-ssr.js`, err);
-    }
+  try {
+    sSRAPIRunner = fs.readFileSync(`${siteDir}/api-runner-ssr.js`, `utf-8`);
+  } catch (err) {
+    report.panic(`Failed to read ${siteDir}/api-runner-ssr.js`, err);
+  }
 
-    const ssrPluginsRequires = ssrPlugins.map(plugin => `{
+  const ssrPluginsRequires = ssrPlugins.map(plugin => `{
       plugin: require('${plugin.resolve}'),
       options: ${JSON.stringify(plugin.options)},
     }`).join(`,`);
-    sSRAPIRunner = `var plugins = [${ssrPluginsRequires}]\n${sSRAPIRunner}`;
-    fs.writeFileSync(`${siteDir}/api-runner-browser-plugins.js`, browserAPIRunner, `utf-8`);
-    fs.writeFileSync(`${siteDir}/api-runner-ssr.js`, sSRAPIRunner, `utf-8`);
-    activity.end();
-    /**
-     * Start the main bootstrap processes.
-     */
-    // onPreBootstrap
-
-    activity = report.activityTimer(`onPreBootstrap`);
-    activity.start();
-    yield apiRunnerNode(`onPreBootstrap`);
-    activity.end(); // Source nodes
-
-    activity = report.activityTimer(`source and transform nodes`, {
-      parentSpan: bootstrapSpan
-    });
-    activity.start();
-    yield require(`../utils/source-nodes`)({
-      parentSpan: activity.span
-    });
-    activity.end(); // Create Schema.
-
-    activity = report.activityTimer(`building schema`, {
-      parentSpan: bootstrapSpan
-    });
-    activity.start();
-    yield require(`../schema`).build({
-      parentSpan: activity.span
-    });
-    activity.end(); // Collect resolvable extensions and attach to program.
+  sSRAPIRunner = `var plugins = [${ssrPluginsRequires}]\n${sSRAPIRunner}`;
+  fs.writeFileSync(`${siteDir}/api-runner-browser-plugins.js`, browserAPIRunner, `utf-8`);
+  fs.writeFileSync(`${siteDir}/api-runner-ssr.js`, sSRAPIRunner, `utf-8`);
+  activity.end();
+  /**
+   * Start the main bootstrap processes.
+   */
+  // onPreBootstrap
+
+  activity = report.activityTimer(`onPreBootstrap`);
+  activity.start();
+  await apiRunnerNode(`onPreBootstrap`);
+  activity.end(); // Source nodes
+
+  activity = report.activityTimer(`source and transform nodes`, {
+    parentSpan: bootstrapSpan
+  });
+  activity.start();
+  await require(`../utils/source-nodes`)({
+    parentSpan: activity.span
+  });
+  activity.end(); // Create Schema.
 
-    const extensions = [`.mjs`, `.js`, `.jsx`, `.wasm`, `.json`]; // Change to this being an action and plugins implement `onPreBootstrap`
-    // for adding extensions.
+  activity = report.activityTimer(`building schema`, {
+    parentSpan: bootstrapSpan
+  });
+  activity.start();
+  await require(`../schema`).build({
+    parentSpan: activity.span
+  });
+  activity.end(); // Collect resolvable extensions and attach to program.
 
-    const apiResults = yield apiRunnerNode(`resolvableExtensions`, {
-      traceId: `initial-resolvableExtensions`,
-      parentSpan: bootstrapSpan
-    });
-    store.dispatch({
-      type: `SET_PROGRAM_EXTENSIONS`,
-      payload: _.flattenDeep([extensions, apiResults])
-    });
+  const extensions = [`.mjs`, `.js`, `.jsx`, `.wasm`, `.json`]; // Change to this being an action and plugins implement `onPreBootstrap`
+  // for adding extensions.
 
-    const graphqlRunner = (query, context = {}) => {
-      const schema = store.getState().schema;
-      return graphql(schema, query, context, context, context);
-    }; // Collect pages.
+  const apiResults = await apiRunnerNode(`resolvableExtensions`, {
+    traceId: `initial-resolvableExtensions`,
+    parentSpan: bootstrapSpan
+  });
+  store.dispatch({
+    type: `SET_PROGRAM_EXTENSIONS`,
+    payload: _.flattenDeep([extensions, apiResults])
+  });
 
+  const graphqlRunner = (query, context = {}) => {
+    const schema = store.getState().schema;
+    return graphql(schema, query, context, context, context);
+  }; // Collect pages.
 
-    activity = report.activityTimer(`createPages`, {
-      parentSpan: bootstrapSpan
-    });
-    activity.start();
-    yield apiRunnerNode(`createPages`, {
-      graphql: graphqlRunner,
-      traceId: `initial-createPages`,
-      waitForCascadingActions: true,
-      parentSpan: activity.span
-    });
-    activity.end(); // A variant on createPages for plugins that want to
-    // have full control over adding/removing pages. The normal
-    // "createPages" API is called every time (during development)
-    // that data changes.
 
-    activity = report.activityTimer(`createPagesStatefully`, {
-      parentSpan: bootstrapSpan
-    });
-    activity.start();
-    yield apiRunnerNode(`createPagesStatefully`, {
-      graphql: graphqlRunner,
-      traceId: `initial-createPagesStatefully`,
-      waitForCascadingActions: true,
-      parentSpan: activity.span
-    });
-    activity.end();
-    activity = report.activityTimer(`onPreExtractQueries`, {
-      parentSpan: bootstrapSpan
-    });
-    activity.start();
-    yield apiRunnerNode(`onPreExtractQueries`, {
-      parentSpan: activity.span
-    });
-    activity.end(); // Update Schema for SitePage.
+  activity = report.activityTimer(`createPages`, {
+    parentSpan: bootstrapSpan
+  });
+  activity.start();
+  await apiRunnerNode(`createPages`, {
+    graphql: graphqlRunner,
+    traceId: `initial-createPages`,
+    waitForCascadingActions: true,
+    parentSpan: activity.span
+  });
+  activity.end(); // A variant on createPages for plugins that want to
+  // have full control over adding/removing pages. The normal
+  // "createPages" API is called every time (during development)
+  // that data changes.
 
-    activity = report.activityTimer(`update schema`, {
-      parentSpan: bootstrapSpan
-    });
-    activity.start();
-    yield require(`../schema`).build({
-      parentSpan: activity.span
-    });
-    activity.end();
+  activity = report.activityTimer(`createPagesStatefully`, {
+    parentSpan: bootstrapSpan
+  });
+  activity.start();
+  await apiRunnerNode(`createPagesStatefully`, {
+    graphql: graphqlRunner,
+    traceId: `initial-createPagesStatefully`,
+    waitForCascadingActions: true,
+    parentSpan: activity.span
+  });
+  activity.end();
+  activity = report.activityTimer(`onPreExtractQueries`, {
+    parentSpan: bootstrapSpan
+  });
+  activity.start();
+  await apiRunnerNode(`onPreExtractQueries`, {
+    parentSpan: activity.span
+  });
+  activity.end(); // Update Schema for SitePage.
 
-    require(`../schema/type-conflict-reporter`).printConflicts(); // Extract queries
+  activity = report.activityTimer(`update schema`, {
+    parentSpan: bootstrapSpan
+  });
+  activity.start();
+  await require(`../schema`).build({
+    parentSpan: activity.span
+  });
+  activity.end();
 
+  require(`../schema/type-conflict-reporter`).printConflicts(); // Extract queries
 
-    activity = report.activityTimer(`extract queries from components`, {
-      parentSpan: bootstrapSpan
-    });
-    activity.start();
-    yield extractQueries();
-    activity.end(); // Start the createPages hot reloader.
 
-    if (process.env.NODE_ENV !== `production`) {
-      require(`./page-hot-reloader`)(graphqlRunner);
-    } // Run queries
+  activity = report.activityTimer(`extract queries from components`, {
+    parentSpan: bootstrapSpan
+  });
+  activity.start();
+  await extractQueries();
+  activity.end(); // Start the createPages hot reloader.
 
+  if (process.env.NODE_ENV !== `production`) {
+    require(`./page-hot-reloader`)(graphqlRunner);
+  } // Run queries
 
-    activity = report.activityTimer(`run graphql queries`, {
-      parentSpan: bootstrapSpan
-    });
-    activity.start();
-    const startQueries = process.hrtime();
-    queryQueue.on(`task_finish`, () => {
-      const stats = queryQueue.getStats();
-      activity.setStatus(`${stats.total}/${stats.peak} ${(stats.total / convertHrtime(process.hrtime(startQueries)).seconds).toFixed(2)} queries/second`);
-    });
-    yield runInitialQueries(activity);
-    activity.end(); // Write out files.
 
-    activity = report.activityTimer(`write out page data`, {
-      parentSpan: bootstrapSpan
-    });
-    activity.start();
+  activity = report.activityTimer(`run graphql queries`, {
+    parentSpan: bootstrapSpan
+  });
+  activity.start();
+  const startQueries = process.hrtime();
+  queryQueue.on(`task_finish`, () => {
+    const stats = queryQueue.getStats();
+    activity.setStatus(`${stats.total}/${stats.peak} ${(stats.total / convertHrtime(process.hrtime(startQueries)).seconds).toFixed(2)} queries/second`);
+  });
+  await runInitialQueries(activity);
+  activity.end(); // Write out files.
 
-    try {
-      yield writePages();
-    } catch (err) {
-      report.panic(`Failed to write out page data`, err);
-    }
+  activity = report.activityTimer(`write out page data`, {
+    parentSpan: bootstrapSpan
+  });
+  activity.start();
 
-    activity.end(); // Write out redirects.
+  try {
+    await writePages();
+  } catch (err) {
+    report.panic(`Failed to write out page data`, err);
+  }
 
-    activity = report.activityTimer(`write out redirect data`, {
-      parentSpan: bootstrapSpan
-    });
-    activity.start();
-    yield writeRedirects();
-    activity.end();
+  activity.end(); // Write out redirects.
 
-    const checkJobsDone = _.debounce(resolve => {
-      const state = store.getState();
+  activity = report.activityTimer(`write out redirect data`, {
+    parentSpan: bootstrapSpan
+  });
+  activity.start();
+  await writeRedirects();
+  activity.end();
 
-      if (state.jobs.active.length === 0) {
-        report.log(``);
-        report.info(`bootstrap finished - ${process.uptime()} s`);
-        report.log(``); // onPostBootstrap
+  const checkJobsDone = _.debounce(resolve => {
+    const state = store.getState();
 
-        activity = report.activityTimer(`onPostBootstrap`, {
-          parentSpan: bootstrapSpan
-        });
-        activity.start();
-        apiRunnerNode(`onPostBootstrap`, {
-          parentSpan: activity.span
-        }).then(() => {
-          activity.end();
-          bootstrapSpan.finish();
-          resolve({
-            graphqlRunner
-          });
-        });
-      }
-    }, 100);
+    if (state.jobs.active.length === 0) {
+      report.log(``);
+      report.info(`bootstrap finished - ${process.uptime()} s`);
+      report.log(``); // onPostBootstrap
 
-    if (store.getState().jobs.active.length === 0) {
-      // onPostBootstrap
       activity = report.activityTimer(`onPostBootstrap`, {
         parentSpan: bootstrapSpan
       });
       activity.start();
-      yield apiRunnerNode(`onPostBootstrap`, {
+      apiRunnerNode(`onPostBootstrap`, {
         parentSpan: activity.span
-      });
-      activity.end();
-      bootstrapSpan.finish();
-      report.log(``);
-      report.info(`bootstrap finished - ${process.uptime()} s`);
-      report.log(``);
-      emitter.emit(`BOOTSTRAP_FINISHED`);
-      return {
-        graphqlRunner
-      };
-    } else {
-      return new Promise(resolve => {
-        // Wait until all side effect jobs are finished.
-        emitter.on(`END_JOB`, () => checkJobsDone(resolve));
+      }).then(() => {
+        activity.end();
+        bootstrapSpan.finish();
+        resolve({
+          graphqlRunner
+        });
       });
     }
-  });
+  }, 100);
 
-  return function (_x) {
-    return _ref.apply(this, arguments);
-  };
-}();
+  if (store.getState().jobs.active.length === 0) {
+    // onPostBootstrap
+    activity = report.activityTimer(`onPostBootstrap`, {
+      parentSpan: bootstrapSpan
+    });
+    activity.start();
+    await apiRunnerNode(`onPostBootstrap`, {
+      store,
+      parentSpan: activity.span
+    });
+    activity.end();
+    bootstrapSpan.finish();
+    report.log(``);
+    report.info(`bootstrap finished - ${process.uptime()} s`);
+    report.log(``);
+    emitter.emit(`BOOTSTRAP_FINISHED`);
+    return {
+      graphqlRunner
+    };
+  } else {
+    return new Promise(resolve => {
+      // Wait until all side effect jobs are finished.
+      emitter.on(`END_JOB`, () => checkJobsDone(resolve));
+    });
+  }
+};
 //# sourceMappingURL=index.js.map
\ No newline at end of file
--- a/node_modules/gatsby/dist/bootstrap/index.js.map
+++ b/node_modules/gatsby/dist/bootstrap/index.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/bootstrap/index.js"],"names":["_","require","slash","fs","md5File","crypto","del","path","convertHrtime","Promise","apiRunnerNode","mergeGatsbyConfig","getBrowserslist","graphql","store","emitter","loadPlugins","report","getConfigFile","tracer","globalTracer","preferDefault","process","on","reason","p","panic","extractQueries","runInitialQueries","queryQueue","writePages","writeRedirects","module","exports","args","spanArgs","parentSpan","childOf","bootstrapSpan","startSpan","directory","program","browserslist","dispatch","type","payload","activity","activityTimer","start","config","__experimentalThemes","themesConfig","mapSeries","plugin","themeName","resolve","themeConfig","options","theme","themeConfigObj","isFunction","plugins","reduce","polyfill","warn","end","flattenedPlugins","span","pluginVersions","map","version","hashes","all","catch","pluginsHash","createHash","update","JSON","stringify","concat","digest","state","getState","oldPluginsHash","status","PLUGINS_HASH","info","stripIndent","remove","e","error","ensureDir","srcDir","__dirname","siteDir","tryRequire","copy","clobber","ensureDirSync","emptyDir","err","hasAPIFile","env","skipSSR","undefined","envAPIs","name","join","Array","isArray","length","ssrPlugins","filter","pluginOptions","browserPlugins","browserPluginsRequires","browserAPIRunner","sSRAPIRunner","readFileSync","ssrPluginsRequires","writeFileSync","build","extensions","apiResults","traceId","flattenDeep","graphqlRunner","query","context","schema","waitForCascadingActions","printConflicts","NODE_ENV","startQueries","hrtime","stats","getStats","setStatus","total","peak","seconds","toFixed","checkJobsDone","debounce","jobs","active","log","uptime","then","finish","emit"],"mappings":"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","sourcesContent":["/* @flow */\n\nconst _ = require(`lodash`)\nconst slash = require(`slash`)\nconst fs = require(`fs-extra`)\nconst md5File = require(`md5-file/promise`)\nconst crypto = require(`crypto`)\nconst del = require(`del`)\nconst path = require(`path`)\nconst convertHrtime = require(`convert-hrtime`)\nconst Promise = require(`bluebird`)\n\nconst apiRunnerNode = require(`../utils/api-runner-node`)\nconst mergeGatsbyConfig = require(`../utils/merge-gatsby-config`)\nconst getBrowserslist = require(`../utils/browserslist`)\nconst { graphql } = require(`graphql`)\nconst { store, emitter } = require(`../redux`)\nconst loadPlugins = require(`./load-plugins`)\nconst report = require(`gatsby-cli/lib/reporter`)\nconst getConfigFile = require(`./get-config-file`)\nconst tracer = require(`opentracing`).globalTracer()\nconst preferDefault = require(`./prefer-default`)\n\n// Show stack trace on unhandled promises.\nprocess.on(`unhandledRejection`, (reason, p) => {\n  report.panic(reason)\n})\n\nconst {\n  extractQueries,\n} = require(`../internal-plugins/query-runner/query-watcher`)\nconst {\n  runInitialQueries,\n} = require(`../internal-plugins/query-runner/page-query-runner`)\nconst queryQueue = require(`../internal-plugins/query-runner/query-queue`)\nconst { writePages } = require(`../internal-plugins/query-runner/pages-writer`)\nconst {\n  writeRedirects,\n} = require(`../internal-plugins/query-runner/redirects-writer`)\n\n// Override console.log to add the source file + line number.\n// Useful for debugging if you lose a console.log somewhere.\n// Otherwise leave commented out.\n// require(`./log-line-function`)\n\ntype BootstrapArgs = {\n  directory: string,\n  prefixPaths?: boolean,\n  parentSpan: Object,\n}\n\nmodule.exports = async (args: BootstrapArgs) => {\n  const spanArgs = args.parentSpan ? { childOf: args.parentSpan } : {}\n  const bootstrapSpan = tracer.startSpan(`bootstrap`, spanArgs)\n\n  // Start plugin runner which listens to the store\n  // and invokes Gatsby API based on actions.\n  require(`../redux/plugin-runner`)\n\n  const directory = slash(args.directory)\n\n  const program = {\n    ...args,\n    browserslist: getBrowserslist(directory),\n    // Fix program directory path for windows env.\n    directory,\n  }\n\n  store.dispatch({\n    type: `SET_PROGRAM`,\n    payload: program,\n  })\n\n  // Try opening the site's gatsby-config.js file.\n  let activity = report.activityTimer(`open and validate gatsby-configs`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  let config = await preferDefault(\n    getConfigFile(program.directory, `gatsby-config`)\n  )\n\n  // theme gatsby configs can be functions or objects\n  if (config && config.__experimentalThemes) {\n    const themesConfig = await Promise.mapSeries(\n      config.__experimentalThemes,\n      async plugin => {\n        const themeName = plugin.resolve || plugin\n        const themeConfig = plugin.options || {}\n        const theme = await preferDefault(\n          getConfigFile(themeName, `gatsby-config`)\n        )\n        // if theme is a function, call it with the themeConfig\n        let themeConfigObj = theme\n        if (_.isFunction(theme)) {\n          themeConfigObj = theme(themeConfig)\n        }\n        // themes function as plugins too (gatsby-node, etc)\n        return {\n          ...themeConfigObj,\n          plugins: [\n            ...(themeConfigObj.plugins || []),\n            // theme plugin is last so it's gatsby-node, etc can override it's declared plugins, like a normal site.\n            { resolve: themeName, options: themeConfig },\n          ],\n        }\n      }\n    ).reduce(mergeGatsbyConfig, {})\n\n    config = mergeGatsbyConfig(themesConfig, config)\n  }\n\n  if (config && config.polyfill) {\n    report.warn(\n      `Support for custom Promise polyfills has been removed in Gatsby v2. We only support Babel 7's new automatic polyfilling behavior.`\n    )\n  }\n\n  store.dispatch({\n    type: `SET_SITE_CONFIG`,\n    payload: config,\n  })\n\n  activity.end()\n\n  activity = report.activityTimer(`load plugins`)\n  activity.start()\n  const flattenedPlugins = await loadPlugins(config)\n  activity.end()\n\n  // onPreInit\n  activity = report.activityTimer(`onPreInit`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await apiRunnerNode(`onPreInit`, { parentSpan: activity.span })\n  activity.end()\n\n  // Delete html and css files from the public directory as we don't want\n  // deleted pages and styles from previous builds to stick around.\n  activity = report.activityTimer(\n    `delete html and css files from previous builds`,\n    {\n      parentSpan: bootstrapSpan,\n    }\n  )\n  activity.start()\n  await del([\n    `public/*.{html,css}`,\n    `public/**/*.{html,css}`,\n    `!public/static`,\n    `!public/static/**/*.{html,css}`,\n  ])\n  activity.end()\n\n  activity = report.activityTimer(`initialize cache`)\n  activity.start()\n  // Check if any plugins have been updated since our last run. If so\n  // we delete the cache is there's likely been changes\n  // since the previous run.\n  //\n  // We do this by creating a hash of all the version numbers of installed\n  // plugins, the site's package.json, gatsby-config.js, and gatsby-node.js.\n  // The last, gatsby-node.js, is important as many gatsby sites put important\n  // logic in there e.g. generating slugs for custom pages.\n  const pluginVersions = flattenedPlugins.map(p => p.version)\n  const hashes = await Promise.all([\n    md5File(`package.json`),\n    Promise.resolve(\n      md5File(`${program.directory}/gatsby-config.js`).catch(() => {})\n    ), // ignore as this file isn't required),\n    Promise.resolve(\n      md5File(`${program.directory}/gatsby-node.js`).catch(() => {})\n    ), // ignore as this file isn't required),\n  ])\n  const pluginsHash = crypto\n    .createHash(`md5`)\n    .update(JSON.stringify(pluginVersions.concat(hashes)))\n    .digest(`hex`)\n  let state = store.getState()\n  const oldPluginsHash = state && state.status ? state.status.PLUGINS_HASH : ``\n\n  // Check if anything has changed. If it has, delete the site's .cache\n  // directory and tell reducers to empty themselves.\n  //\n  // Also if the hash isn't there, then delete things just in case something\n  // is weird.\n  if (oldPluginsHash && pluginsHash !== oldPluginsHash) {\n    report.info(report.stripIndent`\n      One or more of your plugins have changed since the last time you ran Gatsby. As\n      a precaution, we're deleting your site's cache to ensure there's not any stale\n      data\n    `)\n  }\n\n  if (!oldPluginsHash || pluginsHash !== oldPluginsHash) {\n    try {\n      await fs.remove(`${program.directory}/.cache`)\n    } catch (e) {\n      report.error(`Failed to remove .cache files.`, e)\n    }\n    // Tell reducers to delete their data (the store will already have\n    // been loaded from the file system cache).\n    store.dispatch({\n      type: `DELETE_CACHE`,\n    })\n  }\n\n  // Update the store with the new plugins hash.\n  store.dispatch({\n    type: `UPDATE_PLUGINS_HASH`,\n    payload: pluginsHash,\n  })\n\n  // Now that we know the .cache directory is safe, initialize the cache\n  // directory.\n  await fs.ensureDir(`${program.directory}/.cache`)\n\n  // Ensure the public/static directory\n  await fs.ensureDir(`${program.directory}/public/static`)\n\n  activity.end()\n\n  // Copy our site files to the root of the site.\n  activity = report.activityTimer(`copy gatsby files`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  const srcDir = `${__dirname}/../../cache-dir`\n  const siteDir = `${program.directory}/.cache`\n  const tryRequire = `${__dirname}/../utils/test-require-error.js`\n  try {\n    await fs.copy(srcDir, siteDir, {\n      clobber: true,\n    })\n    await fs.copy(tryRequire, `${siteDir}/test-require-error.js`, {\n      clobber: true,\n    })\n    await fs.ensureDirSync(`${program.directory}/.cache/json`)\n\n    // Ensure .cache/fragments exists and is empty. We want fragments to be\n    // added on every run in response to data as fragments can only be added if\n    // the data used to create the schema they're dependent on is available.\n    await fs.emptyDir(`${program.directory}/.cache/fragments`)\n  } catch (err) {\n    report.panic(`Unable to copy site files to .cache`, err)\n  }\n\n  // Find plugins which implement gatsby-browser and gatsby-ssr and write\n  // out api-runners for them.\n  const hasAPIFile = (env, plugin) => {\n    // The plugin loader has disabled SSR APIs for this plugin. Usually due to\n    // multiple implementations of an API that can only be implemented once\n    if (env === `ssr` && plugin.skipSSR === true) return undefined\n\n    const envAPIs = plugin[`${env}APIs`]\n\n    // Always include the site's gatsby-browser.js if it exists as it's\n    // a handy place to include global styles and other global imports.\n    try {\n      if (env === `browser` && plugin.name === `default-site-plugin`) {\n        return slash(\n          require.resolve(path.join(plugin.resolve, `gatsby-${env}`))\n        )\n      }\n    } catch (e) {\n      // ignore\n    }\n\n    if (envAPIs && Array.isArray(envAPIs) && envAPIs.length > 0) {\n      return slash(path.join(plugin.resolve, `gatsby-${env}`))\n    }\n    return undefined\n  }\n\n  const ssrPlugins = _.filter(\n    flattenedPlugins.map(plugin => {\n      return {\n        resolve: hasAPIFile(`ssr`, plugin),\n        options: plugin.pluginOptions,\n      }\n    }),\n    plugin => plugin.resolve\n  )\n\n  const browserPlugins = _.filter(\n    flattenedPlugins.map(plugin => {\n      return {\n        resolve: hasAPIFile(`browser`, plugin),\n        options: plugin.pluginOptions,\n      }\n    }),\n    plugin => plugin.resolve\n  )\n\n  const browserPluginsRequires = browserPlugins\n    .map(\n      plugin =>\n        `{\n      plugin: require('${plugin.resolve}'),\n      options: ${JSON.stringify(plugin.options)},\n    }`\n    )\n    .join(`,`)\n\n  const browserAPIRunner = `module.exports = [${browserPluginsRequires}]\\n`\n\n  let sSRAPIRunner = ``\n\n  try {\n    sSRAPIRunner = fs.readFileSync(`${siteDir}/api-runner-ssr.js`, `utf-8`)\n  } catch (err) {\n    report.panic(`Failed to read ${siteDir}/api-runner-ssr.js`, err)\n  }\n\n  const ssrPluginsRequires = ssrPlugins\n    .map(\n      plugin =>\n        `{\n      plugin: require('${plugin.resolve}'),\n      options: ${JSON.stringify(plugin.options)},\n    }`\n    )\n    .join(`,`)\n  sSRAPIRunner = `var plugins = [${ssrPluginsRequires}]\\n${sSRAPIRunner}`\n\n  fs.writeFileSync(\n    `${siteDir}/api-runner-browser-plugins.js`,\n    browserAPIRunner,\n    `utf-8`\n  )\n  fs.writeFileSync(`${siteDir}/api-runner-ssr.js`, sSRAPIRunner, `utf-8`)\n\n  activity.end()\n  /**\n   * Start the main bootstrap processes.\n   */\n\n  // onPreBootstrap\n  activity = report.activityTimer(`onPreBootstrap`)\n  activity.start()\n  await apiRunnerNode(`onPreBootstrap`)\n  activity.end()\n\n  // Source nodes\n  activity = report.activityTimer(`source and transform nodes`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await require(`../utils/source-nodes`)({ parentSpan: activity.span })\n  activity.end()\n\n  // Create Schema.\n  activity = report.activityTimer(`building schema`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await require(`../schema`).build({ parentSpan: activity.span })\n  activity.end()\n\n  // Collect resolvable extensions and attach to program.\n  const extensions = [`.mjs`, `.js`, `.jsx`, `.wasm`, `.json`]\n  // Change to this being an action and plugins implement `onPreBootstrap`\n  // for adding extensions.\n  const apiResults = await apiRunnerNode(`resolvableExtensions`, {\n    traceId: `initial-resolvableExtensions`,\n    parentSpan: bootstrapSpan,\n  })\n\n  store.dispatch({\n    type: `SET_PROGRAM_EXTENSIONS`,\n    payload: _.flattenDeep([extensions, apiResults]),\n  })\n\n  const graphqlRunner = (query, context = {}) => {\n    const schema = store.getState().schema\n    return graphql(schema, query, context, context, context)\n  }\n\n  // Collect pages.\n  activity = report.activityTimer(`createPages`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await apiRunnerNode(`createPages`, {\n    graphql: graphqlRunner,\n    traceId: `initial-createPages`,\n    waitForCascadingActions: true,\n    parentSpan: activity.span,\n  })\n  activity.end()\n\n  // A variant on createPages for plugins that want to\n  // have full control over adding/removing pages. The normal\n  // \"createPages\" API is called every time (during development)\n  // that data changes.\n  activity = report.activityTimer(`createPagesStatefully`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await apiRunnerNode(`createPagesStatefully`, {\n    graphql: graphqlRunner,\n    traceId: `initial-createPagesStatefully`,\n    waitForCascadingActions: true,\n    parentSpan: activity.span,\n  })\n  activity.end()\n\n  activity = report.activityTimer(`onPreExtractQueries`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await apiRunnerNode(`onPreExtractQueries`, { parentSpan: activity.span })\n  activity.end()\n\n  // Update Schema for SitePage.\n  activity = report.activityTimer(`update schema`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await require(`../schema`).build({ parentSpan: activity.span })\n  activity.end()\n\n  require(`../schema/type-conflict-reporter`).printConflicts()\n\n  // Extract queries\n  activity = report.activityTimer(`extract queries from components`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await extractQueries()\n  activity.end()\n\n  // Start the createPages hot reloader.\n  if (process.env.NODE_ENV !== `production`) {\n    require(`./page-hot-reloader`)(graphqlRunner)\n  }\n\n  // Run queries\n  activity = report.activityTimer(`run graphql queries`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  const startQueries = process.hrtime()\n  queryQueue.on(`task_finish`, () => {\n    const stats = queryQueue.getStats()\n    activity.setStatus(\n      `${stats.total}/${stats.peak} ${(\n        stats.total / convertHrtime(process.hrtime(startQueries)).seconds\n      ).toFixed(2)} queries/second`\n    )\n  })\n  await runInitialQueries(activity)\n  activity.end()\n\n  // Write out files.\n  activity = report.activityTimer(`write out page data`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  try {\n    await writePages()\n  } catch (err) {\n    report.panic(`Failed to write out page data`, err)\n  }\n  activity.end()\n\n  // Write out redirects.\n  activity = report.activityTimer(`write out redirect data`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await writeRedirects()\n  activity.end()\n\n  const checkJobsDone = _.debounce(resolve => {\n    const state = store.getState()\n    if (state.jobs.active.length === 0) {\n      report.log(``)\n      report.info(`bootstrap finished - ${process.uptime()} s`)\n      report.log(``)\n\n      // onPostBootstrap\n      activity = report.activityTimer(`onPostBootstrap`, {\n        parentSpan: bootstrapSpan,\n      })\n      activity.start()\n      apiRunnerNode(`onPostBootstrap`, { parentSpan: activity.span }).then(\n        () => {\n          activity.end()\n          bootstrapSpan.finish()\n          resolve({ graphqlRunner })\n        }\n      )\n    }\n  }, 100)\n\n  if (store.getState().jobs.active.length === 0) {\n    // onPostBootstrap\n    activity = report.activityTimer(`onPostBootstrap`, {\n      parentSpan: bootstrapSpan,\n    })\n    activity.start()\n    await apiRunnerNode(`onPostBootstrap`, { parentSpan: activity.span })\n    activity.end()\n\n    bootstrapSpan.finish()\n\n    report.log(``)\n    report.info(`bootstrap finished - ${process.uptime()} s`)\n    report.log(``)\n    emitter.emit(`BOOTSTRAP_FINISHED`)\n    return {\n      graphqlRunner,\n    }\n  } else {\n    return new Promise(resolve => {\n      // Wait until all side effect jobs are finished.\n      emitter.on(`END_JOB`, () => checkJobsDone(resolve))\n    })\n  }\n}\n"],"file":"index.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/bootstrap/index.js"],"names":["_","require","slash","fs","md5File","crypto","del","path","convertHrtime","Promise","apiRunnerNode","mergeGatsbyConfig","getBrowserslist","graphql","store","emitter","loadPlugins","report","getConfigFile","tracer","globalTracer","preferDefault","process","on","reason","p","panic","extractQueries","runInitialQueries","queryQueue","writePages","writeRedirects","module","exports","args","spanArgs","parentSpan","childOf","bootstrapSpan","startSpan","directory","program","browserslist","dispatch","type","payload","activity","activityTimer","start","config","__experimentalThemes","themesConfig","mapSeries","plugin","themeName","resolve","themeConfig","options","theme","themeConfigObj","isFunction","plugins","reduce","polyfill","warn","end","flattenedPlugins","span","pluginVersions","map","version","hashes","all","catch","pluginsHash","createHash","update","JSON","stringify","concat","digest","state","getState","oldPluginsHash","status","PLUGINS_HASH","info","stripIndent","remove","e","error","ensureDir","srcDir","__dirname","siteDir","tryRequire","copy","clobber","ensureDirSync","emptyDir","err","hasAPIFile","env","skipSSR","undefined","envAPIs","name","join","Array","isArray","length","ssrPlugins","filter","pluginOptions","browserPlugins","browserPluginsRequires","browserAPIRunner","sSRAPIRunner","readFileSync","ssrPluginsRequires","writeFileSync","build","extensions","apiResults","traceId","flattenDeep","graphqlRunner","query","context","schema","waitForCascadingActions","printConflicts","NODE_ENV","startQueries","hrtime","stats","getStats","setStatus","total","peak","seconds","toFixed","checkJobsDone","debounce","jobs","active","log","uptime","then","finish","emit"],"mappings":"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","sourcesContent":["/* @flow */\n\nconst _ = require(`lodash`)\nconst slash = require(`slash`)\nconst fs = require(`fs-extra`)\nconst md5File = require(`md5-file/promise`)\nconst crypto = require(`crypto`)\nconst del = require(`del`)\nconst path = require(`path`)\nconst convertHrtime = require(`convert-hrtime`)\nconst Promise = require(`bluebird`)\n\nconst apiRunnerNode = require(`../utils/api-runner-node`)\nconst mergeGatsbyConfig = require(`../utils/merge-gatsby-config`)\nconst getBrowserslist = require(`../utils/browserslist`)\nconst { graphql } = require(`graphql`)\nconst { store, emitter } = require(`../redux`)\nconst loadPlugins = require(`./load-plugins`)\nconst report = require(`gatsby-cli/lib/reporter`)\nconst getConfigFile = require(`./get-config-file`)\nconst tracer = require(`opentracing`).globalTracer()\nconst preferDefault = require(`./prefer-default`)\n\n// Show stack trace on unhandled promises.\nprocess.on(`unhandledRejection`, (reason, p) => {\n  report.panic(reason)\n})\n\nconst {\n  extractQueries,\n} = require(`../internal-plugins/query-runner/query-watcher`)\nconst {\n  runInitialQueries,\n} = require(`../internal-plugins/query-runner/page-query-runner`)\nconst queryQueue = require(`../internal-plugins/query-runner/query-queue`)\nconst { writePages } = require(`../internal-plugins/query-runner/pages-writer`)\nconst {\n  writeRedirects,\n} = require(`../internal-plugins/query-runner/redirects-writer`)\n\n// Override console.log to add the source file + line number.\n// Useful for debugging if you lose a console.log somewhere.\n// Otherwise leave commented out.\n// require(`./log-line-function`)\n\ntype BootstrapArgs = {\n  directory: string,\n  prefixPaths?: boolean,\n  parentSpan: Object,\n}\n\nmodule.exports = async (args: BootstrapArgs) => {\n  const spanArgs = args.parentSpan ? { childOf: args.parentSpan } : {}\n  const bootstrapSpan = tracer.startSpan(`bootstrap`, spanArgs)\n\n  // Start plugin runner which listens to the store\n  // and invokes Gatsby API based on actions.\n  require(`../redux/plugin-runner`)\n\n  const directory = slash(args.directory)\n\n  const program = {\n    ...args,\n    browserslist: getBrowserslist(directory),\n    // Fix program directory path for windows env.\n    directory,\n  }\n\n  store.dispatch({\n    type: `SET_PROGRAM`,\n    payload: program,\n  })\n\n  // Try opening the site's gatsby-config.js file.\n  let activity = report.activityTimer(`open and validate gatsby-configs`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  let config = await preferDefault(\n    getConfigFile(program.directory, `gatsby-config`)\n  )\n\n  // theme gatsby configs can be functions or objects\n  if (config && config.__experimentalThemes) {\n    const themesConfig = await Promise.mapSeries(\n      config.__experimentalThemes,\n      async plugin => {\n        const themeName = plugin.resolve || plugin\n        const themeConfig = plugin.options || {}\n        const theme = await preferDefault(\n          getConfigFile(themeName, `gatsby-config`)\n        )\n        // if theme is a function, call it with the themeConfig\n        let themeConfigObj = theme\n        if (_.isFunction(theme)) {\n          themeConfigObj = theme(themeConfig)\n        }\n        // themes function as plugins too (gatsby-node, etc)\n        return {\n          ...themeConfigObj,\n          plugins: [\n            ...(themeConfigObj.plugins || []),\n            // theme plugin is last so it's gatsby-node, etc can override it's declared plugins, like a normal site.\n            { resolve: themeName, options: themeConfig },\n          ],\n        }\n      }\n    ).reduce(mergeGatsbyConfig, {})\n\n    config = mergeGatsbyConfig(themesConfig, config)\n  }\n\n  if (config && config.polyfill) {\n    report.warn(\n      `Support for custom Promise polyfills has been removed in Gatsby v2. We only support Babel 7's new automatic polyfilling behavior.`\n    )\n  }\n\n  store.dispatch({\n    type: `SET_SITE_CONFIG`,\n    payload: config,\n  })\n\n  activity.end()\n\n  activity = report.activityTimer(`load plugins`)\n  activity.start()\n  const flattenedPlugins = await loadPlugins(config)\n  activity.end()\n\n  // onPreInit\n  activity = report.activityTimer(`onPreInit`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await apiRunnerNode(`onPreInit`, { parentSpan: activity.span })\n  activity.end()\n\n  // Delete html and css files from the public directory as we don't want\n  // deleted pages and styles from previous builds to stick around.\n  activity = report.activityTimer(\n    `delete html and css files from previous builds`,\n    {\n      parentSpan: bootstrapSpan,\n    }\n  )\n  activity.start()\n  await del([\n    `public/*.{html,css}`,\n    `public/**/*.{html,css}`,\n    `!public/static`,\n    `!public/static/**/*.{html,css}`,\n  ])\n  activity.end()\n\n  activity = report.activityTimer(`initialize cache`)\n  activity.start()\n  // Check if any plugins have been updated since our last run. If so\n  // we delete the cache is there's likely been changes\n  // since the previous run.\n  //\n  // We do this by creating a hash of all the version numbers of installed\n  // plugins, the site's package.json, gatsby-config.js, and gatsby-node.js.\n  // The last, gatsby-node.js, is important as many gatsby sites put important\n  // logic in there e.g. generating slugs for custom pages.\n  const pluginVersions = flattenedPlugins.map(p => p.version)\n  const hashes = await Promise.all([\n    md5File(`package.json`),\n    Promise.resolve(\n      md5File(`${program.directory}/gatsby-config.js`).catch(() => {})\n    ), // ignore as this file isn't required),\n    Promise.resolve(\n      md5File(`${program.directory}/gatsby-node.js`).catch(() => {})\n    ), // ignore as this file isn't required),\n  ])\n  const pluginsHash = crypto\n    .createHash(`md5`)\n    .update(JSON.stringify(pluginVersions.concat(hashes)))\n    .digest(`hex`)\n  let state = store.getState()\n  const oldPluginsHash = state && state.status ? state.status.PLUGINS_HASH : ``\n\n  // Check if anything has changed. If it has, delete the site's .cache\n  // directory and tell reducers to empty themselves.\n  //\n  // Also if the hash isn't there, then delete things just in case something\n  // is weird.\n  if (oldPluginsHash && pluginsHash !== oldPluginsHash) {\n    report.info(report.stripIndent`\n      One or more of your plugins have changed since the last time you ran Gatsby. As\n      a precaution, we're deleting your site's cache to ensure there's not any stale\n      data\n    `)\n  }\n\n  if (!oldPluginsHash || pluginsHash !== oldPluginsHash) {\n    try {\n      await fs.remove(`${program.directory}/.cache`)\n    } catch (e) {\n      report.error(`Failed to remove .cache files.`, e)\n    }\n    // Tell reducers to delete their data (the store will already have\n    // been loaded from the file system cache).\n    store.dispatch({\n      type: `DELETE_CACHE`,\n    })\n  }\n\n  // Update the store with the new plugins hash.\n  store.dispatch({\n    type: `UPDATE_PLUGINS_HASH`,\n    payload: pluginsHash,\n  })\n\n  // Now that we know the .cache directory is safe, initialize the cache\n  // directory.\n  await fs.ensureDir(`${program.directory}/.cache`)\n\n  // Ensure the public/static directory\n  await fs.ensureDir(`${program.directory}/public/static`)\n\n  activity.end()\n\n  // Copy our site files to the root of the site.\n  activity = report.activityTimer(`copy gatsby files`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  const srcDir = `${__dirname}/../../cache-dir`\n  const siteDir = `${program.directory}/.cache`\n  const tryRequire = `${__dirname}/../utils/test-require-error.js`\n  try {\n    await fs.copy(srcDir, siteDir, {\n      clobber: true,\n    })\n    await fs.copy(tryRequire, `${siteDir}/test-require-error.js`, {\n      clobber: true,\n    })\n    await fs.ensureDirSync(`${program.directory}/.cache/json`)\n\n    // Ensure .cache/fragments exists and is empty. We want fragments to be\n    // added on every run in response to data as fragments can only be added if\n    // the data used to create the schema they're dependent on is available.\n    await fs.emptyDir(`${program.directory}/.cache/fragments`)\n  } catch (err) {\n    report.panic(`Unable to copy site files to .cache`, err)\n  }\n\n  // Find plugins which implement gatsby-browser and gatsby-ssr and write\n  // out api-runners for them.\n  const hasAPIFile = (env, plugin) => {\n    // The plugin loader has disabled SSR APIs for this plugin. Usually due to\n    // multiple implementations of an API that can only be implemented once\n    if (env === `ssr` && plugin.skipSSR === true) return undefined\n\n    const envAPIs = plugin[`${env}APIs`]\n\n    // Always include the site's gatsby-browser.js if it exists as it's\n    // a handy place to include global styles and other global imports.\n    try {\n      if (env === `browser` && plugin.name === `default-site-plugin`) {\n        return slash(\n          require.resolve(path.join(plugin.resolve, `gatsby-${env}`))\n        )\n      }\n    } catch (e) {\n      // ignore\n    }\n\n    if (envAPIs && Array.isArray(envAPIs) && envAPIs.length > 0) {\n      return slash(path.join(plugin.resolve, `gatsby-${env}`))\n    }\n    return undefined\n  }\n\n  const ssrPlugins = _.filter(\n    flattenedPlugins.map(plugin => {\n      return {\n        resolve: hasAPIFile(`ssr`, plugin),\n        options: plugin.pluginOptions,\n      }\n    }),\n    plugin => plugin.resolve\n  )\n\n  const browserPlugins = _.filter(\n    flattenedPlugins.map(plugin => {\n      return {\n        resolve: hasAPIFile(`browser`, plugin),\n        options: plugin.pluginOptions,\n      }\n    }),\n    plugin => plugin.resolve\n  )\n\n  const browserPluginsRequires = browserPlugins\n    .map(\n      plugin =>\n        `{\n      plugin: require('${plugin.resolve}'),\n      options: ${JSON.stringify(plugin.options)},\n    }`\n    )\n    .join(`,`)\n\n  const browserAPIRunner = `module.exports = [${browserPluginsRequires}]\\n`\n\n  let sSRAPIRunner = ``\n\n  try {\n    sSRAPIRunner = fs.readFileSync(`${siteDir}/api-runner-ssr.js`, `utf-8`)\n  } catch (err) {\n    report.panic(`Failed to read ${siteDir}/api-runner-ssr.js`, err)\n  }\n\n  const ssrPluginsRequires = ssrPlugins\n    .map(\n      plugin =>\n        `{\n      plugin: require('${plugin.resolve}'),\n      options: ${JSON.stringify(plugin.options)},\n    }`\n    )\n    .join(`,`)\n  sSRAPIRunner = `var plugins = [${ssrPluginsRequires}]\\n${sSRAPIRunner}`\n\n  fs.writeFileSync(\n    `${siteDir}/api-runner-browser-plugins.js`,\n    browserAPIRunner,\n    `utf-8`\n  )\n  fs.writeFileSync(`${siteDir}/api-runner-ssr.js`, sSRAPIRunner, `utf-8`)\n\n  activity.end()\n  /**\n   * Start the main bootstrap processes.\n   */\n\n  // onPreBootstrap\n  activity = report.activityTimer(`onPreBootstrap`)\n  activity.start()\n  await apiRunnerNode(`onPreBootstrap`)\n  activity.end()\n\n  // Source nodes\n  activity = report.activityTimer(`source and transform nodes`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await require(`../utils/source-nodes`)({ parentSpan: activity.span })\n  activity.end()\n\n  // Create Schema.\n  activity = report.activityTimer(`building schema`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await require(`../schema`).build({ parentSpan: activity.span })\n  activity.end()\n\n  // Collect resolvable extensions and attach to program.\n  const extensions = [`.mjs`, `.js`, `.jsx`, `.wasm`, `.json`]\n  // Change to this being an action and plugins implement `onPreBootstrap`\n  // for adding extensions.\n  const apiResults = await apiRunnerNode(`resolvableExtensions`, {\n    traceId: `initial-resolvableExtensions`,\n    parentSpan: bootstrapSpan,\n  })\n\n  store.dispatch({\n    type: `SET_PROGRAM_EXTENSIONS`,\n    payload: _.flattenDeep([extensions, apiResults]),\n  })\n\n  const graphqlRunner = (query, context = {}) => {\n    const schema = store.getState().schema\n    return graphql(schema, query, context, context, context)\n  }\n\n  // Collect pages.\n  activity = report.activityTimer(`createPages`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await apiRunnerNode(`createPages`, {\n    graphql: graphqlRunner,\n    traceId: `initial-createPages`,\n    waitForCascadingActions: true,\n    parentSpan: activity.span,\n  })\n  activity.end()\n\n  // A variant on createPages for plugins that want to\n  // have full control over adding/removing pages. The normal\n  // \"createPages\" API is called every time (during development)\n  // that data changes.\n  activity = report.activityTimer(`createPagesStatefully`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await apiRunnerNode(`createPagesStatefully`, {\n    graphql: graphqlRunner,\n    traceId: `initial-createPagesStatefully`,\n    waitForCascadingActions: true,\n    parentSpan: activity.span,\n  })\n  activity.end()\n\n  activity = report.activityTimer(`onPreExtractQueries`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await apiRunnerNode(`onPreExtractQueries`, { parentSpan: activity.span })\n  activity.end()\n\n  // Update Schema for SitePage.\n  activity = report.activityTimer(`update schema`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await require(`../schema`).build({ parentSpan: activity.span })\n  activity.end()\n\n  require(`../schema/type-conflict-reporter`).printConflicts()\n\n  // Extract queries\n  activity = report.activityTimer(`extract queries from components`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await extractQueries()\n  activity.end()\n\n  // Start the createPages hot reloader.\n  if (process.env.NODE_ENV !== `production`) {\n    require(`./page-hot-reloader`)(graphqlRunner)\n  }\n\n  // Run queries\n  activity = report.activityTimer(`run graphql queries`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  const startQueries = process.hrtime()\n  queryQueue.on(`task_finish`, () => {\n    const stats = queryQueue.getStats()\n    activity.setStatus(\n      `${stats.total}/${stats.peak} ${(\n        stats.total / convertHrtime(process.hrtime(startQueries)).seconds\n      ).toFixed(2)} queries/second`\n    )\n  })\n  await runInitialQueries(activity)\n  activity.end()\n\n  // Write out files.\n  activity = report.activityTimer(`write out page data`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  try {\n    await writePages()\n  } catch (err) {\n    report.panic(`Failed to write out page data`, err)\n  }\n  activity.end()\n\n  // Write out redirects.\n  activity = report.activityTimer(`write out redirect data`, {\n    parentSpan: bootstrapSpan,\n  })\n  activity.start()\n  await writeRedirects()\n  activity.end()\n\n  const checkJobsDone = _.debounce(resolve => {\n    const state = store.getState()\n    if (state.jobs.active.length === 0) {\n      report.log(``)\n      report.info(`bootstrap finished - ${process.uptime()} s`)\n      report.log(``)\n\n      // onPostBootstrap\n      activity = report.activityTimer(`onPostBootstrap`, {\n        parentSpan: bootstrapSpan,\n      })\n      activity.start()\n      apiRunnerNode(`onPostBootstrap`, { parentSpan: activity.span }).then(\n        () => {\n          activity.end()\n          bootstrapSpan.finish()\n          resolve({ graphqlRunner })\n        }\n      )\n    }\n  }, 100)\n\n  if (store.getState().jobs.active.length === 0) {\n    // onPostBootstrap\n    activity = report.activityTimer(`onPostBootstrap`, {\n      parentSpan: bootstrapSpan,\n    })\n    activity.start()\n    await apiRunnerNode(`onPostBootstrap`, { store, parentSpan: activity.span })\n    activity.end()\n\n    bootstrapSpan.finish()\n\n    report.log(``)\n    report.info(`bootstrap finished - ${process.uptime()} s`)\n    report.log(``)\n    emitter.emit(`BOOTSTRAP_FINISHED`)\n    return {\n      graphqlRunner,\n    }\n  } else {\n    return new Promise(resolve => {\n      // Wait until all side effect jobs are finished.\n      emitter.on(`END_JOB`, () => checkJobsDone(resolve))\n    })\n  }\n}\n"],"file":"index.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/bootstrap/load-plugins/index.js
+++ b/node_modules/gatsby/dist/bootstrap/load-plugins/index.js
@@ -1,13 +1,10 @@
 "use strict";
 
-var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
-
-var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
-
 const _ = require(`lodash`);
 
-const _require = require(`../../redux`),
-      store = _require.store;
+const {
+  store
+} = require(`../../redux`);
 
 const nodeAPIs = require(`../../utils/api-node-docs`);
 
@@ -17,10 +14,11 @@ const ssrAPIs = require(`../../../cache-dir/api-ssr-docs`);
 
 const loadPlugins = require(`./load`);
 
-const _require2 = require(`./validate`),
-      collatePluginAPIs = _require2.collatePluginAPIs,
-      handleBadExports = _require2.handleBadExports,
-      handleMultipleReplaceRenderers = _require2.handleMultipleReplaceRenderers;
+const {
+  collatePluginAPIs,
+  handleBadExports,
+  handleMultipleReplaceRenderers
+} = require(`./validate`);
 
 const apis = {
   node: _.keys(nodeAPIs),
@@ -48,52 +46,44 @@ const flattenPlugins = plugins => {
   return flattened;
 };
 
-module.exports =
-/*#__PURE__*/
-function () {
-  var _ref = (0, _asyncToGenerator2.default)(function* (config = {}) {
-    // Collate internal plugins, site config plugins, site default plugins
-    const plugins = loadPlugins(config); // Create a flattened array of the plugins
+module.exports = async (config = {}) => {
+  // Collate internal plugins, site config plugins, site default plugins
+  const plugins = loadPlugins(config); // Create a flattened array of the plugins
 
-    let flattenedPlugins = flattenPlugins(plugins); // Work out which plugins use which APIs, including those which are not
-    // valid Gatsby APIs, aka 'badExports'
+  let flattenedPlugins = flattenPlugins(plugins); // Work out which plugins use which APIs, including those which are not
+  // valid Gatsby APIs, aka 'badExports'
 
-    const x = collatePluginAPIs({
-      apis,
-      flattenedPlugins
-    });
-    flattenedPlugins = x.flattenedPlugins;
-    const apiToPlugins = x.apiToPlugins;
-    const badExports = x.badExports; // Show errors for any non-Gatsby APIs exported from plugins
-
-    handleBadExports({
-      apis,
-      badExports
-    }); // Show errors when ReplaceRenderer has been implemented multiple times
-
-    flattenedPlugins = handleMultipleReplaceRenderers({
-      apiToPlugins,
-      flattenedPlugins
-    }); // If we get this far, everything looks good. Update the store
-
-    store.dispatch({
-      type: `SET_SITE_FLATTENED_PLUGINS`,
-      payload: flattenedPlugins
-    });
-    store.dispatch({
-      type: `SET_SITE_API_TO_PLUGINS`,
-      payload: apiToPlugins
-    }); // TODO: Is this used? plugins and flattenedPlugins may be out of sync
-
-    store.dispatch({
-      type: `SET_SITE_PLUGINS`,
-      payload: plugins
-    });
-    return flattenedPlugins;
+  const x = collatePluginAPIs({
+    apis,
+    flattenedPlugins
   });
-
-  return function () {
-    return _ref.apply(this, arguments);
-  };
-}();
+  flattenedPlugins = x.flattenedPlugins;
+  const apiToPlugins = x.apiToPlugins;
+  const badExports = x.badExports; // Show errors for any non-Gatsby APIs exported from plugins
+
+  handleBadExports({
+    apis,
+    badExports
+  }); // Show errors when ReplaceRenderer has been implemented multiple times
+
+  flattenedPlugins = handleMultipleReplaceRenderers({
+    apiToPlugins,
+    flattenedPlugins
+  }); // If we get this far, everything looks good. Update the store
+
+  store.dispatch({
+    type: `SET_SITE_FLATTENED_PLUGINS`,
+    payload: flattenedPlugins
+  });
+  store.dispatch({
+    type: `SET_SITE_API_TO_PLUGINS`,
+    payload: apiToPlugins
+  }); // TODO: Is this used? plugins and flattenedPlugins may be out of sync
+
+  store.dispatch({
+    type: `SET_SITE_PLUGINS`,
+    payload: plugins
+  });
+  return flattenedPlugins;
+};
 //# sourceMappingURL=index.js.map
\ No newline at end of file
--- a/node_modules/gatsby/dist/bootstrap/load-plugins/index.js.map
+++ b/node_modules/gatsby/dist/bootstrap/load-plugins/index.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../../src/bootstrap/load-plugins/index.js"],"names":["_","require","store","nodeAPIs","browserAPIs","ssrAPIs","loadPlugins","collatePluginAPIs","handleBadExports","handleMultipleReplaceRenderers","apis","node","keys","browser","ssr","flattenPlugins","plugins","flattened","extractPlugins","plugin","pluginOptions","forEach","subPlugin","push","module","exports","config","flattenedPlugins","x","apiToPlugins","badExports","dispatch","type","payload"],"mappings":";;;;;;AAAA,MAAMA,CAAC,GAAGC,OAAO,CAAE,QAAF,CAAjB;;iBAEkBA,OAAO,CAAE,aAAF,C;MAAjBC,K,YAAAA,K;;AACR,MAAMC,QAAQ,GAAGF,OAAO,CAAE,2BAAF,CAAxB;;AACA,MAAMG,WAAW,GAAGH,OAAO,CAAE,8BAAF,CAA3B;;AACA,MAAMI,OAAO,GAAGJ,OAAO,CAAE,iCAAF,CAAvB;;AACA,MAAMK,WAAW,GAAGL,OAAO,CAAE,QAAF,CAA3B;;kBAKIA,OAAO,CAAE,YAAF,C;MAHTM,iB,aAAAA,iB;MACAC,gB,aAAAA,gB;MACAC,8B,aAAAA,8B;;AAGF,MAAMC,IAAI,GAAG;AACXC,EAAAA,IAAI,EAAEX,CAAC,CAACY,IAAF,CAAOT,QAAP,CADK;AAEXU,EAAAA,OAAO,EAAEb,CAAC,CAACY,IAAF,CAAOR,WAAP,CAFE;AAGXU,EAAAA,GAAG,EAAEd,CAAC,CAACY,IAAF,CAAOP,OAAP,CAHM,CAMb;AACA;AACA;;AARa,CAAb;;AASA,MAAMU,cAAc,GAAGC,OAAO,IAAI;AAChC,QAAMC,SAAS,GAAG,EAAlB;;AACA,QAAMC,cAAc,GAAGC,MAAM,IAAI;AAC/BA,IAAAA,MAAM,CAACC,aAAP,CAAqBJ,OAArB,CAA6BK,OAA7B,CAAqCC,SAAS,IAAI;AAChDL,MAAAA,SAAS,CAACM,IAAV,CAAeD,SAAf;AACAJ,MAAAA,cAAc,CAACI,SAAD,CAAd;AACD,KAHD;AAID,GALD;;AAOAN,EAAAA,OAAO,CAACK,OAAR,CAAgBF,MAAM,IAAI;AACxBF,IAAAA,SAAS,CAACM,IAAV,CAAeJ,MAAf;AACAD,IAAAA,cAAc,CAACC,MAAD,CAAd;AACD,GAHD;AAKA,SAAOF,SAAP;AACD,CAfD;;AAiBAO,MAAM,CAACC,OAAP;AAAA;AAAA;AAAA,6CAAiB,WAAOC,MAAM,GAAG,EAAhB,EAAuB;AACtC;AACA,UAAMV,OAAO,GAAGV,WAAW,CAACoB,MAAD,CAA3B,CAFsC,CAItC;;AACA,QAAIC,gBAAgB,GAAGZ,cAAc,CAACC,OAAD,CAArC,CALsC,CAOtC;AACA;;AACA,UAAMY,CAAC,GAAGrB,iBAAiB,CAAC;AAAEG,MAAAA,IAAF;AAAQiB,MAAAA;AAAR,KAAD,CAA3B;AACAA,IAAAA,gBAAgB,GAAGC,CAAC,CAACD,gBAArB;AACA,UAAME,YAAY,GAAGD,CAAC,CAACC,YAAvB;AACA,UAAMC,UAAU,GAAGF,CAAC,CAACE,UAArB,CAZsC,CActC;;AACAtB,IAAAA,gBAAgB,CAAC;AAAEE,MAAAA,IAAF;AAAQoB,MAAAA;AAAR,KAAD,CAAhB,CAfsC,CAiBtC;;AACAH,IAAAA,gBAAgB,GAAGlB,8BAA8B,CAAC;AAChDoB,MAAAA,YADgD;AAEhDF,MAAAA;AAFgD,KAAD,CAAjD,CAlBsC,CAuBtC;;AACAzB,IAAAA,KAAK,CAAC6B,QAAN,CAAe;AACbC,MAAAA,IAAI,EAAG,4BADM;AAEbC,MAAAA,OAAO,EAAEN;AAFI,KAAf;AAKAzB,IAAAA,KAAK,CAAC6B,QAAN,CAAe;AACbC,MAAAA,IAAI,EAAG,yBADM;AAEbC,MAAAA,OAAO,EAAEJ;AAFI,KAAf,EA7BsC,CAkCtC;;AACA3B,IAAAA,KAAK,CAAC6B,QAAN,CAAe;AACbC,MAAAA,IAAI,EAAG,kBADM;AAEbC,MAAAA,OAAO,EAAEjB;AAFI,KAAf;AAKA,WAAOW,gBAAP;AACD,GAzCD;;AAAA;AAAA;AAAA;AAAA","sourcesContent":["const _ = require(`lodash`)\n\nconst { store } = require(`../../redux`)\nconst nodeAPIs = require(`../../utils/api-node-docs`)\nconst browserAPIs = require(`../../utils/api-browser-docs`)\nconst ssrAPIs = require(`../../../cache-dir/api-ssr-docs`)\nconst loadPlugins = require(`./load`)\nconst {\n  collatePluginAPIs,\n  handleBadExports,\n  handleMultipleReplaceRenderers,\n} = require(`./validate`)\n\nconst apis = {\n  node: _.keys(nodeAPIs),\n  browser: _.keys(browserAPIs),\n  ssr: _.keys(ssrAPIs),\n}\n\n// Create a \"flattened\" array of plugins with all subplugins\n// brought to the top-level. This simplifies running gatsby-* files\n// for subplugins.\nconst flattenPlugins = plugins => {\n  const flattened = []\n  const extractPlugins = plugin => {\n    plugin.pluginOptions.plugins.forEach(subPlugin => {\n      flattened.push(subPlugin)\n      extractPlugins(subPlugin)\n    })\n  }\n\n  plugins.forEach(plugin => {\n    flattened.push(plugin)\n    extractPlugins(plugin)\n  })\n\n  return flattened\n}\n\nmodule.exports = async (config = {}) => {\n  // Collate internal plugins, site config plugins, site default plugins\n  const plugins = loadPlugins(config)\n\n  // Create a flattened array of the plugins\n  let flattenedPlugins = flattenPlugins(plugins)\n\n  // Work out which plugins use which APIs, including those which are not\n  // valid Gatsby APIs, aka 'badExports'\n  const x = collatePluginAPIs({ apis, flattenedPlugins })\n  flattenedPlugins = x.flattenedPlugins\n  const apiToPlugins = x.apiToPlugins\n  const badExports = x.badExports\n\n  // Show errors for any non-Gatsby APIs exported from plugins\n  handleBadExports({ apis, badExports })\n\n  // Show errors when ReplaceRenderer has been implemented multiple times\n  flattenedPlugins = handleMultipleReplaceRenderers({\n    apiToPlugins,\n    flattenedPlugins,\n  })\n\n  // If we get this far, everything looks good. Update the store\n  store.dispatch({\n    type: `SET_SITE_FLATTENED_PLUGINS`,\n    payload: flattenedPlugins,\n  })\n\n  store.dispatch({\n    type: `SET_SITE_API_TO_PLUGINS`,\n    payload: apiToPlugins,\n  })\n\n  // TODO: Is this used? plugins and flattenedPlugins may be out of sync\n  store.dispatch({\n    type: `SET_SITE_PLUGINS`,\n    payload: plugins,\n  })\n\n  return flattenedPlugins\n}\n"],"file":"index.js"}
\ No newline at end of file
+{"version":3,"sources":["../../../src/bootstrap/load-plugins/index.js"],"names":["_","require","store","nodeAPIs","browserAPIs","ssrAPIs","loadPlugins","collatePluginAPIs","handleBadExports","handleMultipleReplaceRenderers","apis","node","keys","browser","ssr","flattenPlugins","plugins","flattened","extractPlugins","plugin","pluginOptions","forEach","subPlugin","push","module","exports","config","flattenedPlugins","x","apiToPlugins","badExports","dispatch","type","payload"],"mappings":";;AAAA,MAAMA,CAAC,GAAGC,OAAO,CAAE,QAAF,CAAjB;;AAEA,MAAM;AAAEC,EAAAA;AAAF,IAAYD,OAAO,CAAE,aAAF,CAAzB;;AACA,MAAME,QAAQ,GAAGF,OAAO,CAAE,2BAAF,CAAxB;;AACA,MAAMG,WAAW,GAAGH,OAAO,CAAE,8BAAF,CAA3B;;AACA,MAAMI,OAAO,GAAGJ,OAAO,CAAE,iCAAF,CAAvB;;AACA,MAAMK,WAAW,GAAGL,OAAO,CAAE,QAAF,CAA3B;;AACA,MAAM;AACJM,EAAAA,iBADI;AAEJC,EAAAA,gBAFI;AAGJC,EAAAA;AAHI,IAIFR,OAAO,CAAE,YAAF,CAJX;;AAMA,MAAMS,IAAI,GAAG;AACXC,EAAAA,IAAI,EAAEX,CAAC,CAACY,IAAF,CAAOT,QAAP,CADK;AAEXU,EAAAA,OAAO,EAAEb,CAAC,CAACY,IAAF,CAAOR,WAAP,CAFE;AAGXU,EAAAA,GAAG,EAAEd,CAAC,CAACY,IAAF,CAAOP,OAAP,CAHM,CAMb;AACA;AACA;;AARa,CAAb;;AASA,MAAMU,cAAc,GAAGC,OAAO,IAAI;AAChC,QAAMC,SAAS,GAAG,EAAlB;;AACA,QAAMC,cAAc,GAAGC,MAAM,IAAI;AAC/BA,IAAAA,MAAM,CAACC,aAAP,CAAqBJ,OAArB,CAA6BK,OAA7B,CAAqCC,SAAS,IAAI;AAChDL,MAAAA,SAAS,CAACM,IAAV,CAAeD,SAAf;AACAJ,MAAAA,cAAc,CAACI,SAAD,CAAd;AACD,KAHD;AAID,GALD;;AAOAN,EAAAA,OAAO,CAACK,OAAR,CAAgBF,MAAM,IAAI;AACxBF,IAAAA,SAAS,CAACM,IAAV,CAAeJ,MAAf;AACAD,IAAAA,cAAc,CAACC,MAAD,CAAd;AACD,GAHD;AAKA,SAAOF,SAAP;AACD,CAfD;;AAiBAO,MAAM,CAACC,OAAP,GAAiB,OAAOC,MAAM,GAAG,EAAhB,KAAuB;AACtC;AACA,QAAMV,OAAO,GAAGV,WAAW,CAACoB,MAAD,CAA3B,CAFsC,CAItC;;AACA,MAAIC,gBAAgB,GAAGZ,cAAc,CAACC,OAAD,CAArC,CALsC,CAOtC;AACA;;AACA,QAAMY,CAAC,GAAGrB,iBAAiB,CAAC;AAAEG,IAAAA,IAAF;AAAQiB,IAAAA;AAAR,GAAD,CAA3B;AACAA,EAAAA,gBAAgB,GAAGC,CAAC,CAACD,gBAArB;AACA,QAAME,YAAY,GAAGD,CAAC,CAACC,YAAvB;AACA,QAAMC,UAAU,GAAGF,CAAC,CAACE,UAArB,CAZsC,CActC;;AACAtB,EAAAA,gBAAgB,CAAC;AAAEE,IAAAA,IAAF;AAAQoB,IAAAA;AAAR,GAAD,CAAhB,CAfsC,CAiBtC;;AACAH,EAAAA,gBAAgB,GAAGlB,8BAA8B,CAAC;AAChDoB,IAAAA,YADgD;AAEhDF,IAAAA;AAFgD,GAAD,CAAjD,CAlBsC,CAuBtC;;AACAzB,EAAAA,KAAK,CAAC6B,QAAN,CAAe;AACbC,IAAAA,IAAI,EAAG,4BADM;AAEbC,IAAAA,OAAO,EAAEN;AAFI,GAAf;AAKAzB,EAAAA,KAAK,CAAC6B,QAAN,CAAe;AACbC,IAAAA,IAAI,EAAG,yBADM;AAEbC,IAAAA,OAAO,EAAEJ;AAFI,GAAf,EA7BsC,CAkCtC;;AACA3B,EAAAA,KAAK,CAAC6B,QAAN,CAAe;AACbC,IAAAA,IAAI,EAAG,kBADM;AAEbC,IAAAA,OAAO,EAAEjB;AAFI,GAAf;AAKA,SAAOW,gBAAP;AACD,CAzCD","sourcesContent":["const _ = require(`lodash`)\n\nconst { store } = require(`../../redux`)\nconst nodeAPIs = require(`../../utils/api-node-docs`)\nconst browserAPIs = require(`../../utils/api-browser-docs`)\nconst ssrAPIs = require(`../../../cache-dir/api-ssr-docs`)\nconst loadPlugins = require(`./load`)\nconst {\n  collatePluginAPIs,\n  handleBadExports,\n  handleMultipleReplaceRenderers,\n} = require(`./validate`)\n\nconst apis = {\n  node: _.keys(nodeAPIs),\n  browser: _.keys(browserAPIs),\n  ssr: _.keys(ssrAPIs),\n}\n\n// Create a \"flattened\" array of plugins with all subplugins\n// brought to the top-level. This simplifies running gatsby-* files\n// for subplugins.\nconst flattenPlugins = plugins => {\n  const flattened = []\n  const extractPlugins = plugin => {\n    plugin.pluginOptions.plugins.forEach(subPlugin => {\n      flattened.push(subPlugin)\n      extractPlugins(subPlugin)\n    })\n  }\n\n  plugins.forEach(plugin => {\n    flattened.push(plugin)\n    extractPlugins(plugin)\n  })\n\n  return flattened\n}\n\nmodule.exports = async (config = {}) => {\n  // Collate internal plugins, site config plugins, site default plugins\n  const plugins = loadPlugins(config)\n\n  // Create a flattened array of the plugins\n  let flattenedPlugins = flattenPlugins(plugins)\n\n  // Work out which plugins use which APIs, including those which are not\n  // valid Gatsby APIs, aka 'badExports'\n  const x = collatePluginAPIs({ apis, flattenedPlugins })\n  flattenedPlugins = x.flattenedPlugins\n  const apiToPlugins = x.apiToPlugins\n  const badExports = x.badExports\n\n  // Show errors for any non-Gatsby APIs exported from plugins\n  handleBadExports({ apis, badExports })\n\n  // Show errors when ReplaceRenderer has been implemented multiple times\n  flattenedPlugins = handleMultipleReplaceRenderers({\n    apiToPlugins,\n    flattenedPlugins,\n  })\n\n  // If we get this far, everything looks good. Update the store\n  store.dispatch({\n    type: `SET_SITE_FLATTENED_PLUGINS`,\n    payload: flattenedPlugins,\n  })\n\n  store.dispatch({\n    type: `SET_SITE_API_TO_PLUGINS`,\n    payload: apiToPlugins,\n  })\n\n  // TODO: Is this used? plugins and flattenedPlugins may be out of sync\n  store.dispatch({\n    type: `SET_SITE_PLUGINS`,\n    payload: plugins,\n  })\n\n  return flattenedPlugins\n}\n"],"file":"index.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/bootstrap/load-plugins/load.js
+++ b/node_modules/gatsby/dist/bootstrap/load-plugins/load.js
@@ -12,11 +12,13 @@ const crypto = require(`crypto`);
 
 const glob = require(`glob`);
 
-const _require = require(`./validate`),
-      warnOnIncompatiblePeerDependency = _require.warnOnIncompatiblePeerDependency;
+const {
+  warnOnIncompatiblePeerDependency
+} = require(`./validate`);
 
-const _require2 = require(`../../redux`),
-      store = _require2.store;
+const {
+  store
+} = require(`../../redux`);
 
 const existsSync = require(`fs-exists-cached`).sync;
 
@@ -112,11 +114,11 @@ module.exports = (config = {}) => {
   const processPlugin = plugin => {
     if (_.isString(plugin)) {
       const info = resolvePlugin(plugin);
-      return Object.assign({}, info, {
+      return { ...info,
         pluginOptions: {
           plugins: []
         }
-      });
+      };
     } else {
       plugin.options = plugin.options || {}; // Plugins can have plugins.
 
@@ -143,12 +145,12 @@ module.exports = (config = {}) => {
       }
 
       const info = resolvePlugin(plugin.resolve);
-      return Object.assign({}, info, {
+      return { ...info,
         id: createPluginId(info.name, plugin),
         pluginOptions: _.merge({
           plugins: []
         }, plugin.options)
-      });
+      };
     }
   }; // Add internal plugins
 
--- a/node_modules/gatsby/dist/bootstrap/load-plugins/load.js.map
+++ b/node_modules/gatsby/dist/bootstrap/load-plugins/load.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../../src/bootstrap/load-plugins/load.js"],"names":["_","require","slash","fs","path","crypto","glob","warnOnIncompatiblePeerDependency","store","existsSync","sync","createNodeId","createFileContentHash","root","globPattern","hash","createHash","files","nodir","forEach","filepath","update","readFileSync","digest","createPluginId","name","pluginObject","JSON","stringify","options","resolvePlugin","pluginName","resolvedPath","resolve","packageJSON","parse","id","version","Error","dirname","err","module","exports","config","plugins","processPlugin","plugin","isString","info","pluginOptions","subplugins","p","push","merge","internalPlugins","relPath","absPath","join","__dirname","process","cwd","program","getState","directory","pathCheck"],"mappings":"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","sourcesContent":["const _ = require(`lodash`)\nconst slash = require(`slash`)\nconst fs = require(`fs`)\nconst path = require(`path`)\nconst crypto = require(`crypto`)\nconst glob = require(`glob`)\nconst { warnOnIncompatiblePeerDependency } = require(`./validate`)\nconst { store } = require(`../../redux`)\nconst existsSync = require(`fs-exists-cached`).sync\nconst createNodeId = require(`../../utils/create-node-id`)\n\nfunction createFileContentHash(root, globPattern) {\n  const hash = crypto.createHash(`md5`)\n  const files = glob.sync(`${root}/${globPattern}`, { nodir: true })\n\n  files.forEach(filepath => {\n    hash.update(fs.readFileSync(filepath))\n  })\n\n  return hash.digest(`hex`)\n}\n\n/**\n * Make sure key is unique to plugin options. E.g there could\n * be multiple source-filesystem plugins, with different names\n * (docs, blogs).\n * @param {*} name Name of the plugin\n * @param {*} pluginObject\n */\nconst createPluginId = (name, pluginObject = null) =>\n  createNodeId(\n    name + (pluginObject ? JSON.stringify(pluginObject.options) : ``),\n    `Plugin`\n  )\n\n/**\n * @typedef {Object} PluginInfo\n * @property {string} resolve The absolute path to the plugin\n * @property {string} name The plugin name\n * @property {string} version The plugin version (can be content hash)\n */\n\n/**\n * resolvePlugin\n * @param {string} pluginName\n * This can be a name of a local plugin, the name of a plugin located in\n * node_modules, or a Gatsby internal plugin. In the last case the pluginName\n * will be an absolute path.\n * @return {PluginInfo}\n */\nfunction resolvePlugin(pluginName) {\n  // Only find plugins when we're not given an absolute path\n  if (!existsSync(pluginName)) {\n    // Find the plugin in the local plugins folder\n    const resolvedPath = slash(path.resolve(`./plugins/${pluginName}`))\n\n    if (existsSync(resolvedPath)) {\n      if (existsSync(`${resolvedPath}/package.json`)) {\n        const packageJSON = JSON.parse(\n          fs.readFileSync(`${resolvedPath}/package.json`, `utf-8`)\n        )\n        const name = packageJSON.name || pluginName\n        warnOnIncompatiblePeerDependency(name, packageJSON)\n\n        return {\n          resolve: resolvedPath,\n          name,\n          id: createPluginId(name),\n          version:\n            packageJSON.version || createFileContentHash(resolvedPath, `**`),\n        }\n      } else {\n        // Make package.json a requirement for local plugins too\n        throw new Error(`Plugin ${pluginName} requires a package.json file`)\n      }\n    }\n  }\n\n  /**\n   * Here we have an absolute path to an internal plugin, or a name of a module\n   * which should be located in node_modules.\n   */\n  try {\n    const resolvedPath = slash(path.dirname(require.resolve(pluginName)))\n\n    const packageJSON = JSON.parse(\n      fs.readFileSync(`${resolvedPath}/package.json`, `utf-8`)\n    )\n    warnOnIncompatiblePeerDependency(packageJSON.name, packageJSON)\n\n    return {\n      resolve: resolvedPath,\n      id: createPluginId(packageJSON.name),\n      name: packageJSON.name,\n      version: packageJSON.version,\n    }\n  } catch (err) {\n    throw new Error(\n      `Unable to find plugin \"${pluginName}\". Perhaps you need to install its package?`\n    )\n  }\n}\n\nmodule.exports = (config = {}) => {\n  // Instantiate plugins.\n  const plugins = []\n\n  // Create fake little site with a plugin for testing this\n  // w/ snapshots. Move plugin processing to its own module.\n  // Also test adding to redux store.\n  const processPlugin = plugin => {\n    if (_.isString(plugin)) {\n      const info = resolvePlugin(plugin)\n\n      return {\n        ...info,\n        pluginOptions: {\n          plugins: [],\n        },\n      }\n    } else {\n      plugin.options = plugin.options || {}\n\n      // Plugins can have plugins.\n      const subplugins = []\n      if (plugin.options.plugins) {\n        plugin.options.plugins.forEach(p => {\n          subplugins.push(processPlugin(p))\n        })\n\n        plugin.options.plugins = subplugins\n      }\n\n      // Add some default values for tests as we don't actually\n      // want to try to load anything during tests.\n      if (plugin.resolve === `___TEST___`) {\n        const name = `TEST`\n\n        return {\n          id: createPluginId(name, plugin),\n          name,\n          pluginOptions: {\n            plugins: [],\n          },\n        }\n      }\n\n      const info = resolvePlugin(plugin.resolve)\n\n      return {\n        ...info,\n        id: createPluginId(info.name, plugin),\n        pluginOptions: _.merge({ plugins: [] }, plugin.options),\n      }\n    }\n  }\n\n  // Add internal plugins\n  const internalPlugins = [\n    `../../internal-plugins/dev-404-page`,\n    `../../internal-plugins/load-babel-config`,\n    `../../internal-plugins/internal-data-bridge`,\n    `../../internal-plugins/prod-404`,\n    `../../internal-plugins/query-runner`,\n  ]\n  internalPlugins.forEach(relPath => {\n    const absPath = path.join(__dirname, relPath)\n    plugins.push(processPlugin(absPath))\n  })\n\n  // Add plugins from the site config.\n  if (config.plugins) {\n    config.plugins.forEach(plugin => {\n      plugins.push(processPlugin(plugin))\n    })\n  }\n\n  // Add the site's default \"plugin\" i.e. gatsby-x files in root of site.\n  plugins.push({\n    resolve: slash(process.cwd()),\n    id: createPluginId(`default-site-plugin`),\n    name: `default-site-plugin`,\n    version: createFileContentHash(process.cwd(), `gatsby-*`),\n    pluginOptions: {\n      plugins: [],\n    },\n  })\n\n  const program = store.getState().program\n  plugins.push(\n    processPlugin({\n      resolve: `gatsby-plugin-page-creator`,\n      options: {\n        path: slash(path.join(program.directory, `src/pages`)),\n        pathCheck: false,\n      },\n    })\n  )\n\n  return plugins\n}\n"],"file":"load.js"}
\ No newline at end of file
+{"version":3,"sources":["../../../src/bootstrap/load-plugins/load.js"],"names":["_","require","slash","fs","path","crypto","glob","warnOnIncompatiblePeerDependency","store","existsSync","sync","createNodeId","createFileContentHash","root","globPattern","hash","createHash","files","nodir","forEach","filepath","update","readFileSync","digest","createPluginId","name","pluginObject","JSON","stringify","options","resolvePlugin","pluginName","resolvedPath","resolve","packageJSON","parse","id","version","Error","dirname","err","module","exports","config","plugins","processPlugin","plugin","isString","info","pluginOptions","subplugins","p","push","merge","internalPlugins","relPath","absPath","join","__dirname","process","cwd","program","getState","directory","pathCheck"],"mappings":"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","sourcesContent":["const _ = require(`lodash`)\nconst slash = require(`slash`)\nconst fs = require(`fs`)\nconst path = require(`path`)\nconst crypto = require(`crypto`)\nconst glob = require(`glob`)\nconst { warnOnIncompatiblePeerDependency } = require(`./validate`)\nconst { store } = require(`../../redux`)\nconst existsSync = require(`fs-exists-cached`).sync\nconst createNodeId = require(`../../utils/create-node-id`)\n\nfunction createFileContentHash(root, globPattern) {\n  const hash = crypto.createHash(`md5`)\n  const files = glob.sync(`${root}/${globPattern}`, { nodir: true })\n\n  files.forEach(filepath => {\n    hash.update(fs.readFileSync(filepath))\n  })\n\n  return hash.digest(`hex`)\n}\n\n/**\n * Make sure key is unique to plugin options. E.g there could\n * be multiple source-filesystem plugins, with different names\n * (docs, blogs).\n * @param {*} name Name of the plugin\n * @param {*} pluginObject\n */\nconst createPluginId = (name, pluginObject = null) =>\n  createNodeId(\n    name + (pluginObject ? JSON.stringify(pluginObject.options) : ``),\n    `Plugin`\n  )\n\n/**\n * @typedef {Object} PluginInfo\n * @property {string} resolve The absolute path to the plugin\n * @property {string} name The plugin name\n * @property {string} version The plugin version (can be content hash)\n */\n\n/**\n * resolvePlugin\n * @param {string} pluginName\n * This can be a name of a local plugin, the name of a plugin located in\n * node_modules, or a Gatsby internal plugin. In the last case the pluginName\n * will be an absolute path.\n * @return {PluginInfo}\n */\nfunction resolvePlugin(pluginName) {\n  // Only find plugins when we're not given an absolute path\n  if (!existsSync(pluginName)) {\n    // Find the plugin in the local plugins folder\n    const resolvedPath = slash(path.resolve(`./plugins/${pluginName}`))\n\n    if (existsSync(resolvedPath)) {\n      if (existsSync(`${resolvedPath}/package.json`)) {\n        const packageJSON = JSON.parse(\n          fs.readFileSync(`${resolvedPath}/package.json`, `utf-8`)\n        )\n        const name = packageJSON.name || pluginName\n        warnOnIncompatiblePeerDependency(name, packageJSON)\n\n        return {\n          resolve: resolvedPath,\n          name,\n          id: createPluginId(name),\n          version:\n            packageJSON.version || createFileContentHash(resolvedPath, `**`),\n        }\n      } else {\n        // Make package.json a requirement for local plugins too\n        throw new Error(`Plugin ${pluginName} requires a package.json file`)\n      }\n    }\n  }\n\n  /**\n   * Here we have an absolute path to an internal plugin, or a name of a module\n   * which should be located in node_modules.\n   */\n  try {\n    const resolvedPath = slash(path.dirname(require.resolve(pluginName)))\n\n    const packageJSON = JSON.parse(\n      fs.readFileSync(`${resolvedPath}/package.json`, `utf-8`)\n    )\n    warnOnIncompatiblePeerDependency(packageJSON.name, packageJSON)\n\n    return {\n      resolve: resolvedPath,\n      id: createPluginId(packageJSON.name),\n      name: packageJSON.name,\n      version: packageJSON.version,\n    }\n  } catch (err) {\n    throw new Error(\n      `Unable to find plugin \"${pluginName}\". Perhaps you need to install its package?`\n    )\n  }\n}\n\nmodule.exports = (config = {}) => {\n  // Instantiate plugins.\n  const plugins = []\n\n  // Create fake little site with a plugin for testing this\n  // w/ snapshots. Move plugin processing to its own module.\n  // Also test adding to redux store.\n  const processPlugin = plugin => {\n    if (_.isString(plugin)) {\n      const info = resolvePlugin(plugin)\n\n      return {\n        ...info,\n        pluginOptions: {\n          plugins: [],\n        },\n      }\n    } else {\n      plugin.options = plugin.options || {}\n\n      // Plugins can have plugins.\n      const subplugins = []\n      if (plugin.options.plugins) {\n        plugin.options.plugins.forEach(p => {\n          subplugins.push(processPlugin(p))\n        })\n\n        plugin.options.plugins = subplugins\n      }\n\n      // Add some default values for tests as we don't actually\n      // want to try to load anything during tests.\n      if (plugin.resolve === `___TEST___`) {\n        const name = `TEST`\n\n        return {\n          id: createPluginId(name, plugin),\n          name,\n          pluginOptions: {\n            plugins: [],\n          },\n        }\n      }\n\n      const info = resolvePlugin(plugin.resolve)\n\n      return {\n        ...info,\n        id: createPluginId(info.name, plugin),\n        pluginOptions: _.merge({ plugins: [] }, plugin.options),\n      }\n    }\n  }\n\n  // Add internal plugins\n  const internalPlugins = [\n    `../../internal-plugins/dev-404-page`,\n    `../../internal-plugins/load-babel-config`,\n    `../../internal-plugins/internal-data-bridge`,\n    `../../internal-plugins/prod-404`,\n    `../../internal-plugins/query-runner`,\n  ]\n  internalPlugins.forEach(relPath => {\n    const absPath = path.join(__dirname, relPath)\n    plugins.push(processPlugin(absPath))\n  })\n\n  // Add plugins from the site config.\n  if (config.plugins) {\n    config.plugins.forEach(plugin => {\n      plugins.push(processPlugin(plugin))\n    })\n  }\n\n  // Add the site's default \"plugin\" i.e. gatsby-x files in root of site.\n  plugins.push({\n    resolve: slash(process.cwd()),\n    id: createPluginId(`default-site-plugin`),\n    name: `default-site-plugin`,\n    version: createFileContentHash(process.cwd(), `gatsby-*`),\n    pluginOptions: {\n      plugins: [],\n    },\n  })\n\n  const program = store.getState().program\n  plugins.push(\n    processPlugin({\n      resolve: `gatsby-plugin-page-creator`,\n      options: {\n        path: slash(path.join(program.directory, `src/pages`)),\n        pathCheck: false,\n      },\n    })\n  )\n\n  return plugins\n}\n"],"file":"load.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/bootstrap/load-plugins/validate.js
+++ b/node_modules/gatsby/dist/bootstrap/load-plugins/validate.js
@@ -4,8 +4,9 @@ const _ = require(`lodash`);
 
 const semver = require(`semver`);
 
-const _require = require(`gatsby/package.json`),
-      gatsbyVersion = _require.version;
+const {
+  version: gatsbyVersion
+} = require(`gatsby/package.json`);
 
 const reporter = require(`gatsby-cli/lib/reporter`);
 
@@ -27,8 +28,9 @@ const getBadExports = (plugin, pluginAPIKeys, apis) => {
 };
 
 const getBadExportsMessage = (badExports, exportType, apis) => {
-  const _require2 = require(`common-tags`),
-        stripIndent = _require2.stripIndent;
+  const {
+    stripIndent
+  } = require(`common-tags`);
 
   const stringSimiliarity = require(`string-similarity`);
 
@@ -58,9 +60,10 @@ const getBadExportsMessage = (badExports, exportType, apis) => {
     const isOldAPI = Object.keys(badExportsMigrationMap).includes(bady.exportName);
 
     if (isDefaultPlugin && isOldAPI) {
-      const _badExportsMigrationM = badExportsMigrationMap[bady.exportName],
-            replacement = _badExportsMigrationM.replacement,
-            migrationLink = _badExportsMigrationM.migrationLink;
+      const {
+        replacement,
+        migrationLink
+      } = badExportsMigrationMap[bady.exportName];
       message += stripIndent`
         - Your site's gatsby-${exportType}.js is exporting "${bady.exportName}" which was removed in Gatsby v2. Refer to the migration guide for more info on upgrading to "${replacement}":
       `;
@@ -89,8 +92,7 @@ const handleBadExports = ({
 }) => {
   // Output error messages for all bad exports
   _.toPairs(badExports).forEach(badItem => {
-    const exportType = badItem[0],
-          entries = badItem[1];
+    const [exportType, entries] = badItem;
 
     if (entries.length > 0) {
       reporter.panicOnBuild(getBadExportsMessage(entries, exportType, apis[exportType]));
--- a/node_modules/gatsby/dist/bootstrap/load-plugins/validate.js.map
+++ b/node_modules/gatsby/dist/bootstrap/load-plugins/validate.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../../src/bootstrap/load-plugins/validate.js"],"names":["_","require","semver","gatsbyVersion","version","reporter","resolveModuleExports","getBadExports","plugin","pluginAPIKeys","apis","badExports","concat","difference","map","e","exportName","pluginName","name","pluginVersion","getBadExportsMessage","exportType","stripIndent","stringSimiliarity","capitalized","toUpperCase","slice","message","forEach","bady","similarities","findBestMatch","isDefaultPlugin","badExportsMigrationMap","modifyWebpackConfig","replacement","migrationLink","wrapRootComponent","isOldAPI","Object","keys","includes","bestMatch","rating","target","handleBadExports","toPairs","badItem","entries","length","panicOnBuild","collatePluginAPIs","flattenedPlugins","allAPIs","node","browser","ssr","apiToPlugins","reduce","acc","value","nodeAPIs","browserAPIs","ssrAPIs","pluginNodeExports","resolve","pluginBrowserExports","pluginSSRExports","intersection","nodeAPI","push","browserAPI","ssrAPI","handleMultipleReplaceRenderers","replaceRenderer","rendererPlugins","warn","join","console","log","error","process","env","NODE_ENV","exit","ignorable","messages","fp","i","skipSSR","m","warnOnIncompatiblePeerDependency","packageJSON","gatsbyPeerDependency","get","satisfies","module","exports"],"mappings":"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","sourcesContent":["const _ = require(`lodash`)\nconst semver = require(`semver`)\nconst { version: gatsbyVersion } = require(`gatsby/package.json`)\nconst reporter = require(`gatsby-cli/lib/reporter`)\nconst resolveModuleExports = require(`../resolve-module-exports`)\n\n// Given a plugin object, an array of the API names it exports and an\n// array of valid API names, return an array of invalid API exports.\nconst getBadExports = (plugin, pluginAPIKeys, apis) => {\n  let badExports = []\n  // Discover any exports from plugins which are not \"known\"\n  badExports = badExports.concat(\n    _.difference(pluginAPIKeys, apis).map(e => {\n      return {\n        exportName: e,\n        pluginName: plugin.name,\n        pluginVersion: plugin.version,\n      }\n    })\n  )\n  return badExports\n}\n\nconst getBadExportsMessage = (badExports, exportType, apis) => {\n  const { stripIndent } = require(`common-tags`)\n  const stringSimiliarity = require(`string-similarity`)\n  let capitalized = `${exportType[0].toUpperCase()}${exportType.slice(1)}`\n  if (capitalized === `Ssr`) capitalized = `SSR`\n\n  let message = `\\n`\n  message += stripIndent`\n    Your plugins must export known APIs from their gatsby-${exportType}.js.\n    The following exports aren't APIs. Perhaps you made a typo or your plugin is outdated?\n\n    See https://www.gatsbyjs.org/docs/${exportType}-apis/ for the list of Gatsby ${capitalized} APIs\n  `\n\n  badExports.forEach(bady => {\n    message += `\\n\\n`\n    const similarities = stringSimiliarity.findBestMatch(bady.exportName, apis)\n    const isDefaultPlugin = bady.pluginName == `default-site-plugin`\n    const badExportsMigrationMap = {\n      modifyWebpackConfig: {\n        replacement: `onCreateWebpackConfig`,\n        migrationLink: `https://gatsby.app/update-webpack-config`,\n      },\n      wrapRootComponent: {\n        replacement: `wrapRootElement`,\n        migrationLink: `https://gatsby.app/update-wraprootcomponent`,\n      },\n    }\n    const isOldAPI = Object.keys(badExportsMigrationMap).includes(\n      bady.exportName\n    )\n\n    if (isDefaultPlugin && isOldAPI) {\n      const { replacement, migrationLink } = badExportsMigrationMap[\n        bady.exportName\n      ]\n      message += stripIndent`\n        - Your site's gatsby-${exportType}.js is exporting \"${\n        bady.exportName\n      }\" which was removed in Gatsby v2. Refer to the migration guide for more info on upgrading to \"${replacement}\":\n      `\n      message += `\\n ${migrationLink}`\n    } else if (isDefaultPlugin) {\n      message += stripIndent`\n        - Your site's gatsby-${exportType}.js is exporting a variable named \"${\n        bady.exportName\n      }\" which isn't an API.\n      `\n    } else {\n      message += stripIndent`\n        - The plugin \"${bady.pluginName}@${\n        bady.pluginVersion\n      }\" is exporting a variable named \"${bady.exportName}\" which isn't an API.\n      `\n    }\n\n    if (similarities.bestMatch.rating > 0.5 && !isOldAPI) {\n      message += `\\n\\n`\n      message += `Perhaps you meant to export \"${\n        similarities.bestMatch.target\n      }\"?`\n    }\n  })\n\n  return message\n}\n\nconst handleBadExports = ({ apis, badExports }) => {\n  // Output error messages for all bad exports\n  _.toPairs(badExports).forEach(badItem => {\n    const [exportType, entries] = badItem\n    if (entries.length > 0) {\n      reporter.panicOnBuild(\n        getBadExportsMessage(entries, exportType, apis[exportType])\n      )\n    }\n  })\n}\n\n/**\n * Identify which APIs each plugin exports\n */\nconst collatePluginAPIs = ({ apis, flattenedPlugins }) => {\n  const allAPIs = [...apis.node, ...apis.browser, ...apis.ssr]\n  const apiToPlugins = allAPIs.reduce((acc, value) => {\n    acc[value] = []\n    return acc\n  }, {})\n\n  // Get a list of bad exports\n  const badExports = {\n    node: [],\n    browser: [],\n    ssr: [],\n  }\n\n  flattenedPlugins.forEach(plugin => {\n    plugin.nodeAPIs = []\n    plugin.browserAPIs = []\n    plugin.ssrAPIs = []\n\n    // Discover which APIs this plugin implements and store an array against\n    // the plugin node itself *and* in an API to plugins map for faster lookups\n    // later.\n    const pluginNodeExports = resolveModuleExports(\n      `${plugin.resolve}/gatsby-node`\n    )\n    const pluginBrowserExports = resolveModuleExports(\n      `${plugin.resolve}/gatsby-browser`\n    )\n    const pluginSSRExports = resolveModuleExports(\n      `${plugin.resolve}/gatsby-ssr`\n    )\n\n    if (pluginNodeExports.length > 0) {\n      plugin.nodeAPIs = _.intersection(pluginNodeExports, apis.node)\n      plugin.nodeAPIs.map(nodeAPI => apiToPlugins[nodeAPI].push(plugin.name))\n      badExports.node = badExports.node.concat(\n        getBadExports(plugin, pluginNodeExports, apis.node)\n      ) // Collate any bad exports\n    }\n\n    if (pluginBrowserExports.length > 0) {\n      plugin.browserAPIs = _.intersection(pluginBrowserExports, apis.browser)\n      plugin.browserAPIs.map(browserAPI =>\n        apiToPlugins[browserAPI].push(plugin.name)\n      )\n      badExports.browser = badExports.browser.concat(\n        getBadExports(plugin, pluginBrowserExports, apis.browser)\n      ) // Collate any bad exports\n    }\n\n    if (pluginSSRExports.length > 0) {\n      plugin.ssrAPIs = _.intersection(pluginSSRExports, apis.ssr)\n      plugin.ssrAPIs.map(ssrAPI => apiToPlugins[ssrAPI].push(plugin.name))\n      badExports.ssr = badExports.ssr.concat(\n        getBadExports(plugin, pluginSSRExports, apis.ssr)\n      ) // Collate any bad exports\n    }\n  })\n\n  return { apiToPlugins, flattenedPlugins, badExports }\n}\n\nconst handleMultipleReplaceRenderers = ({ apiToPlugins, flattenedPlugins }) => {\n  // multiple replaceRenderers may cause problems at build time\n  if (apiToPlugins.replaceRenderer.length > 1) {\n    const rendererPlugins = [...apiToPlugins.replaceRenderer]\n\n    if (rendererPlugins.includes(`default-site-plugin`)) {\n      reporter.warn(`replaceRenderer API found in these plugins:`)\n      reporter.warn(rendererPlugins.join(`, `))\n      reporter.warn(\n        `This might be an error, see: https://www.gatsbyjs.org/docs/debugging-replace-renderer-api/`\n      )\n    } else {\n      console.log(``)\n      reporter.error(\n        `Gatsby's replaceRenderer API is implemented by multiple plugins:`\n      )\n      reporter.error(rendererPlugins.join(`, `))\n      reporter.error(`This will break your build`)\n      reporter.error(\n        `See: https://www.gatsbyjs.org/docs/debugging-replace-renderer-api/`\n      )\n      if (process.env.NODE_ENV === `production`) process.exit(1)\n    }\n\n    // Now update plugin list so only final replaceRenderer will run\n    const ignorable = rendererPlugins.slice(0, -1)\n\n    // For each plugin in ignorable, set a skipSSR flag to true\n    // This prevents apiRunnerSSR() from attempting to run it later\n    const messages = []\n    flattenedPlugins.forEach((fp, i) => {\n      if (ignorable.includes(fp.name)) {\n        messages.push(\n          `Duplicate replaceRenderer found, skipping gatsby-ssr.js for plugin: ${\n            fp.name\n          }`\n        )\n        flattenedPlugins[i].skipSSR = true\n      }\n    })\n    if (messages.length > 0) {\n      console.log(``)\n      messages.forEach(m => reporter.warn(m))\n      console.log(``)\n    }\n  }\n\n  return flattenedPlugins\n}\n\nfunction warnOnIncompatiblePeerDependency(name, packageJSON) {\n  // Note: In the future the peer dependency should be enforced for all plugins.\n  const gatsbyPeerDependency = _.get(packageJSON, `peerDependencies.gatsby`)\n  if (\n    gatsbyPeerDependency &&\n    !semver.satisfies(gatsbyVersion, gatsbyPeerDependency)\n  ) {\n    reporter.warn(\n      `Plugin ${name} is not compatible with your gatsby version ${gatsbyVersion} - It requires gatsby@${gatsbyPeerDependency}`\n    )\n  }\n}\n\nmodule.exports = {\n  collatePluginAPIs,\n  handleBadExports,\n  handleMultipleReplaceRenderers,\n  warnOnIncompatiblePeerDependency,\n}\n"],"file":"validate.js"}
\ No newline at end of file
+{"version":3,"sources":["../../../src/bootstrap/load-plugins/validate.js"],"names":["_","require","semver","version","gatsbyVersion","reporter","resolveModuleExports","getBadExports","plugin","pluginAPIKeys","apis","badExports","concat","difference","map","e","exportName","pluginName","name","pluginVersion","getBadExportsMessage","exportType","stripIndent","stringSimiliarity","capitalized","toUpperCase","slice","message","forEach","bady","similarities","findBestMatch","isDefaultPlugin","badExportsMigrationMap","modifyWebpackConfig","replacement","migrationLink","wrapRootComponent","isOldAPI","Object","keys","includes","bestMatch","rating","target","handleBadExports","toPairs","badItem","entries","length","panicOnBuild","collatePluginAPIs","flattenedPlugins","allAPIs","node","browser","ssr","apiToPlugins","reduce","acc","value","nodeAPIs","browserAPIs","ssrAPIs","pluginNodeExports","resolve","pluginBrowserExports","pluginSSRExports","intersection","nodeAPI","push","browserAPI","ssrAPI","handleMultipleReplaceRenderers","replaceRenderer","rendererPlugins","warn","join","console","log","error","process","env","NODE_ENV","exit","ignorable","messages","fp","i","skipSSR","m","warnOnIncompatiblePeerDependency","packageJSON","gatsbyPeerDependency","get","satisfies","module","exports"],"mappings":"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","sourcesContent":["const _ = require(`lodash`)\nconst semver = require(`semver`)\nconst { version: gatsbyVersion } = require(`gatsby/package.json`)\nconst reporter = require(`gatsby-cli/lib/reporter`)\nconst resolveModuleExports = require(`../resolve-module-exports`)\n\n// Given a plugin object, an array of the API names it exports and an\n// array of valid API names, return an array of invalid API exports.\nconst getBadExports = (plugin, pluginAPIKeys, apis) => {\n  let badExports = []\n  // Discover any exports from plugins which are not \"known\"\n  badExports = badExports.concat(\n    _.difference(pluginAPIKeys, apis).map(e => {\n      return {\n        exportName: e,\n        pluginName: plugin.name,\n        pluginVersion: plugin.version,\n      }\n    })\n  )\n  return badExports\n}\n\nconst getBadExportsMessage = (badExports, exportType, apis) => {\n  const { stripIndent } = require(`common-tags`)\n  const stringSimiliarity = require(`string-similarity`)\n  let capitalized = `${exportType[0].toUpperCase()}${exportType.slice(1)}`\n  if (capitalized === `Ssr`) capitalized = `SSR`\n\n  let message = `\\n`\n  message += stripIndent`\n    Your plugins must export known APIs from their gatsby-${exportType}.js.\n    The following exports aren't APIs. Perhaps you made a typo or your plugin is outdated?\n\n    See https://www.gatsbyjs.org/docs/${exportType}-apis/ for the list of Gatsby ${capitalized} APIs\n  `\n\n  badExports.forEach(bady => {\n    message += `\\n\\n`\n    const similarities = stringSimiliarity.findBestMatch(bady.exportName, apis)\n    const isDefaultPlugin = bady.pluginName == `default-site-plugin`\n    const badExportsMigrationMap = {\n      modifyWebpackConfig: {\n        replacement: `onCreateWebpackConfig`,\n        migrationLink: `https://gatsby.app/update-webpack-config`,\n      },\n      wrapRootComponent: {\n        replacement: `wrapRootElement`,\n        migrationLink: `https://gatsby.app/update-wraprootcomponent`,\n      },\n    }\n    const isOldAPI = Object.keys(badExportsMigrationMap).includes(\n      bady.exportName\n    )\n\n    if (isDefaultPlugin && isOldAPI) {\n      const { replacement, migrationLink } = badExportsMigrationMap[\n        bady.exportName\n      ]\n      message += stripIndent`\n        - Your site's gatsby-${exportType}.js is exporting \"${\n        bady.exportName\n      }\" which was removed in Gatsby v2. Refer to the migration guide for more info on upgrading to \"${replacement}\":\n      `\n      message += `\\n ${migrationLink}`\n    } else if (isDefaultPlugin) {\n      message += stripIndent`\n        - Your site's gatsby-${exportType}.js is exporting a variable named \"${\n        bady.exportName\n      }\" which isn't an API.\n      `\n    } else {\n      message += stripIndent`\n        - The plugin \"${bady.pluginName}@${\n        bady.pluginVersion\n      }\" is exporting a variable named \"${bady.exportName}\" which isn't an API.\n      `\n    }\n\n    if (similarities.bestMatch.rating > 0.5 && !isOldAPI) {\n      message += `\\n\\n`\n      message += `Perhaps you meant to export \"${\n        similarities.bestMatch.target\n      }\"?`\n    }\n  })\n\n  return message\n}\n\nconst handleBadExports = ({ apis, badExports }) => {\n  // Output error messages for all bad exports\n  _.toPairs(badExports).forEach(badItem => {\n    const [exportType, entries] = badItem\n    if (entries.length > 0) {\n      reporter.panicOnBuild(\n        getBadExportsMessage(entries, exportType, apis[exportType])\n      )\n    }\n  })\n}\n\n/**\n * Identify which APIs each plugin exports\n */\nconst collatePluginAPIs = ({ apis, flattenedPlugins }) => {\n  const allAPIs = [...apis.node, ...apis.browser, ...apis.ssr]\n  const apiToPlugins = allAPIs.reduce((acc, value) => {\n    acc[value] = []\n    return acc\n  }, {})\n\n  // Get a list of bad exports\n  const badExports = {\n    node: [],\n    browser: [],\n    ssr: [],\n  }\n\n  flattenedPlugins.forEach(plugin => {\n    plugin.nodeAPIs = []\n    plugin.browserAPIs = []\n    plugin.ssrAPIs = []\n\n    // Discover which APIs this plugin implements and store an array against\n    // the plugin node itself *and* in an API to plugins map for faster lookups\n    // later.\n    const pluginNodeExports = resolveModuleExports(\n      `${plugin.resolve}/gatsby-node`\n    )\n    const pluginBrowserExports = resolveModuleExports(\n      `${plugin.resolve}/gatsby-browser`\n    )\n    const pluginSSRExports = resolveModuleExports(\n      `${plugin.resolve}/gatsby-ssr`\n    )\n\n    if (pluginNodeExports.length > 0) {\n      plugin.nodeAPIs = _.intersection(pluginNodeExports, apis.node)\n      plugin.nodeAPIs.map(nodeAPI => apiToPlugins[nodeAPI].push(plugin.name))\n      badExports.node = badExports.node.concat(\n        getBadExports(plugin, pluginNodeExports, apis.node)\n      ) // Collate any bad exports\n    }\n\n    if (pluginBrowserExports.length > 0) {\n      plugin.browserAPIs = _.intersection(pluginBrowserExports, apis.browser)\n      plugin.browserAPIs.map(browserAPI =>\n        apiToPlugins[browserAPI].push(plugin.name)\n      )\n      badExports.browser = badExports.browser.concat(\n        getBadExports(plugin, pluginBrowserExports, apis.browser)\n      ) // Collate any bad exports\n    }\n\n    if (pluginSSRExports.length > 0) {\n      plugin.ssrAPIs = _.intersection(pluginSSRExports, apis.ssr)\n      plugin.ssrAPIs.map(ssrAPI => apiToPlugins[ssrAPI].push(plugin.name))\n      badExports.ssr = badExports.ssr.concat(\n        getBadExports(plugin, pluginSSRExports, apis.ssr)\n      ) // Collate any bad exports\n    }\n  })\n\n  return { apiToPlugins, flattenedPlugins, badExports }\n}\n\nconst handleMultipleReplaceRenderers = ({ apiToPlugins, flattenedPlugins }) => {\n  // multiple replaceRenderers may cause problems at build time\n  if (apiToPlugins.replaceRenderer.length > 1) {\n    const rendererPlugins = [...apiToPlugins.replaceRenderer]\n\n    if (rendererPlugins.includes(`default-site-plugin`)) {\n      reporter.warn(`replaceRenderer API found in these plugins:`)\n      reporter.warn(rendererPlugins.join(`, `))\n      reporter.warn(\n        `This might be an error, see: https://www.gatsbyjs.org/docs/debugging-replace-renderer-api/`\n      )\n    } else {\n      console.log(``)\n      reporter.error(\n        `Gatsby's replaceRenderer API is implemented by multiple plugins:`\n      )\n      reporter.error(rendererPlugins.join(`, `))\n      reporter.error(`This will break your build`)\n      reporter.error(\n        `See: https://www.gatsbyjs.org/docs/debugging-replace-renderer-api/`\n      )\n      if (process.env.NODE_ENV === `production`) process.exit(1)\n    }\n\n    // Now update plugin list so only final replaceRenderer will run\n    const ignorable = rendererPlugins.slice(0, -1)\n\n    // For each plugin in ignorable, set a skipSSR flag to true\n    // This prevents apiRunnerSSR() from attempting to run it later\n    const messages = []\n    flattenedPlugins.forEach((fp, i) => {\n      if (ignorable.includes(fp.name)) {\n        messages.push(\n          `Duplicate replaceRenderer found, skipping gatsby-ssr.js for plugin: ${\n            fp.name\n          }`\n        )\n        flattenedPlugins[i].skipSSR = true\n      }\n    })\n    if (messages.length > 0) {\n      console.log(``)\n      messages.forEach(m => reporter.warn(m))\n      console.log(``)\n    }\n  }\n\n  return flattenedPlugins\n}\n\nfunction warnOnIncompatiblePeerDependency(name, packageJSON) {\n  // Note: In the future the peer dependency should be enforced for all plugins.\n  const gatsbyPeerDependency = _.get(packageJSON, `peerDependencies.gatsby`)\n  if (\n    gatsbyPeerDependency &&\n    !semver.satisfies(gatsbyVersion, gatsbyPeerDependency)\n  ) {\n    reporter.warn(\n      `Plugin ${name} is not compatible with your gatsby version ${gatsbyVersion} - It requires gatsby@${gatsbyPeerDependency}`\n    )\n  }\n}\n\nmodule.exports = {\n  collatePluginAPIs,\n  handleBadExports,\n  handleMultipleReplaceRenderers,\n  warnOnIncompatiblePeerDependency,\n}\n"],"file":"validate.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/bootstrap/page-hot-reloader.js
+++ b/node_modules/gatsby/dist/bootstrap/page-hot-reloader.js
@@ -1,22 +1,22 @@
 "use strict";
 
-var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
-
-var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
-
 const _ = require(`lodash`);
 
-const _require = require(`../redux`),
-      emitter = _require.emitter,
-      store = _require.store;
+const {
+  emitter,
+  store
+} = require(`../redux`);
 
 const apiRunnerNode = require(`../utils/api-runner-node`);
 
-const _require2 = require(`../redux/actions`),
-      boundActionCreators = _require2.boundActionCreators;
+const {
+  boundActionCreators
+} = require(`../redux/actions`);
 
-const deletePage = boundActionCreators.deletePage,
-      deleteComponentsDependencies = boundActionCreators.deleteComponentsDependencies;
+const {
+  deletePage,
+  deleteComponentsDependencies
+} = boundActionCreators;
 let pagesDirty = false;
 let graphql;
 emitter.on(`CREATE_NODE`, action => {
@@ -35,47 +35,39 @@ emitter.on(`API_RUNNING_QUEUE_EMPTY`, () => {
   }
 });
 
-const runCreatePages =
-/*#__PURE__*/
-function () {
-  var _ref = (0, _asyncToGenerator2.default)(function* () {
-    pagesDirty = false;
-    const plugins = store.getState().plugins; // Test which plugins implement createPagesStatefully so we can
-    // ignore their pages.
+const runCreatePages = async () => {
+  pagesDirty = false;
+  const plugins = store.getState().plugins; // Test which plugins implement createPagesStatefully so we can
+  // ignore their pages.
 
-    const statefulPlugins = plugins.filter(p => {
-      try {
-        const gatsbyNode = require(`${p.resolve}/gatsby-node`);
+  const statefulPlugins = plugins.filter(p => {
+    try {
+      const gatsbyNode = require(`${p.resolve}/gatsby-node`);
 
-        if (gatsbyNode.createPagesStatefully) {
-          return true;
-        } else {
-          return false;
-        }
-      } catch (e) {
+      if (gatsbyNode.createPagesStatefully) {
+        return true;
+      } else {
         return false;
       }
-    }).map(p => p.id);
-    const timestamp = new Date().toJSON();
-    yield apiRunnerNode(`createPages`, {
-      graphql,
-      traceId: `createPages`,
-      waitForCascadingActions: true
-    }); // Delete pages that weren't updated when running createPages.
+    } catch (e) {
+      return false;
+    }
+  }).map(p => p.id);
+  const timestamp = new Date().toJSON();
+  await apiRunnerNode(`createPages`, {
+    graphql,
+    traceId: `createPages`,
+    waitForCascadingActions: true
+  }); // Delete pages that weren't updated when running createPages.
 
-    Array.from(store.getState().pages.values()).forEach(page => {
-      if (!_.includes(statefulPlugins, page.pluginCreatorId) && page.updatedAt < timestamp) {
-        deleteComponentsDependencies([page.path]);
-        deletePage(page);
-      }
-    });
-    emitter.emit(`CREATE_PAGE_END`);
+  Array.from(store.getState().pages.values()).forEach(page => {
+    if (!_.includes(statefulPlugins, page.pluginCreatorId) && page.updatedAt < timestamp) {
+      deleteComponentsDependencies([page.path]);
+      deletePage(page);
+    }
   });
-
-  return function runCreatePages() {
-    return _ref.apply(this, arguments);
-  };
-}();
+  emitter.emit(`CREATE_PAGE_END`);
+};
 
 module.exports = graphqlRunner => {
   graphql = graphqlRunner;
--- a/node_modules/gatsby/dist/bootstrap/page-hot-reloader.js.map
+++ b/node_modules/gatsby/dist/bootstrap/page-hot-reloader.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/bootstrap/page-hot-reloader.js"],"names":["_","require","emitter","store","apiRunnerNode","boundActionCreators","deletePage","deleteComponentsDependencies","pagesDirty","graphql","on","action","payload","internal","type","runCreatePages","plugins","getState","statefulPlugins","filter","p","gatsbyNode","resolve","createPagesStatefully","e","map","id","timestamp","Date","toJSON","traceId","waitForCascadingActions","Array","from","pages","values","forEach","page","includes","pluginCreatorId","updatedAt","path","emit","module","exports","graphqlRunner"],"mappings":";;;;;;AAAA,MAAMA,CAAC,GAAGC,OAAO,CAAE,QAAF,CAAjB;;iBAE2BA,OAAO,CAAE,UAAF,C;MAA1BC,O,YAAAA,O;MAASC,K,YAAAA,K;;AACjB,MAAMC,aAAa,GAAGH,OAAO,CAAE,0BAAF,CAA7B;;kBACgCA,OAAO,CAAE,kBAAF,C;MAA/BI,mB,aAAAA,mB;;MACAC,U,GAA6CD,mB,CAA7CC,U;MAAYC,4B,GAAiCF,mB,CAAjCE,4B;AAEpB,IAAIC,UAAU,GAAG,KAAjB;AACA,IAAIC,OAAJ;AAEAP,OAAO,CAACQ,EAAR,CAAY,aAAZ,EAA0BC,MAAM,IAAI;AAClC,MAAIA,MAAM,CAACC,OAAP,CAAeC,QAAf,CAAwBC,IAAxB,KAAkC,UAAtC,EAAiD;AAC/CN,IAAAA,UAAU,GAAG,IAAb;AACD;AACF,CAJD;AAKAN,OAAO,CAACQ,EAAR,CAAY,aAAZ,EAA0BC,MAAM,IAAI;AAClC,MAAIA,MAAM,CAACC,OAAP,CAAeC,QAAf,CAAwBC,IAAxB,KAAkC,UAAtC,EAAiD;AAC/CN,IAAAA,UAAU,GAAG,IAAb;AACD;AACF,CAJD;AAMAN,OAAO,CAACQ,EAAR,CAAY,yBAAZ,EAAsC,MAAM;AAC1C,MAAIF,UAAJ,EAAgB;AACdO,IAAAA,cAAc;AACf;AACF,CAJD;;AAMA,MAAMA,cAAc;AAAA;AAAA;AAAA,6CAAG,aAAY;AACjCP,IAAAA,UAAU,GAAG,KAAb;AACA,UAAMQ,OAAO,GAAGb,KAAK,CAACc,QAAN,GAAiBD,OAAjC,CAFiC,CAGjC;AACA;;AACA,UAAME,eAAe,GAAGF,OAAO,CAC5BG,MADqB,CACdC,CAAC,IAAI;AACX,UAAI;AACF,cAAMC,UAAU,GAAGpB,OAAO,CAAE,GAAEmB,CAAC,CAACE,OAAQ,cAAd,CAA1B;;AACA,YAAID,UAAU,CAACE,qBAAf,EAAsC;AACpC,iBAAO,IAAP;AACD,SAFD,MAEO;AACL,iBAAO,KAAP;AACD;AACF,OAPD,CAOE,OAAOC,CAAP,EAAU;AACV,eAAO,KAAP;AACD;AACF,KAZqB,EAarBC,GAbqB,CAajBL,CAAC,IAAIA,CAAC,CAACM,EAbU,CAAxB;AAeA,UAAMC,SAAS,GAAG,IAAIC,IAAJ,GAAWC,MAAX,EAAlB;AAEA,UAAMzB,aAAa,CAAE,aAAF,EAAgB;AACjCK,MAAAA,OADiC;AAEjCqB,MAAAA,OAAO,EAAG,aAFuB;AAGjCC,MAAAA,uBAAuB,EAAE;AAHQ,KAAhB,CAAnB,CAtBiC,CA4BjC;;AACAC,IAAAA,KAAK,CAACC,IAAN,CAAW9B,KAAK,CAACc,QAAN,GAAiBiB,KAAjB,CAAuBC,MAAvB,EAAX,EAA4CC,OAA5C,CAAoDC,IAAI,IAAI;AAC1D,UACE,CAACrC,CAAC,CAACsC,QAAF,CAAWpB,eAAX,EAA4BmB,IAAI,CAACE,eAAjC,CAAD,IACAF,IAAI,CAACG,SAAL,GAAiBb,SAFnB,EAGE;AACApB,QAAAA,4BAA4B,CAAC,CAAC8B,IAAI,CAACI,IAAN,CAAD,CAA5B;AACAnC,QAAAA,UAAU,CAAC+B,IAAD,CAAV;AACD;AACF,KARD;AAUAnC,IAAAA,OAAO,CAACwC,IAAR,CAAc,iBAAd;AACD,GAxCmB;;AAAA,kBAAd3B,cAAc;AAAA;AAAA;AAAA,GAApB;;AA0CA4B,MAAM,CAACC,OAAP,GAAiBC,aAAa,IAAI;AAChCpC,EAAAA,OAAO,GAAGoC,aAAV;AACD,CAFD","sourcesContent":["const _ = require(`lodash`)\n\nconst { emitter, store } = require(`../redux`)\nconst apiRunnerNode = require(`../utils/api-runner-node`)\nconst { boundActionCreators } = require(`../redux/actions`)\nconst { deletePage, deleteComponentsDependencies } = boundActionCreators\n\nlet pagesDirty = false\nlet graphql\n\nemitter.on(`CREATE_NODE`, action => {\n  if (action.payload.internal.type !== `SitePage`) {\n    pagesDirty = true\n  }\n})\nemitter.on(`DELETE_NODE`, action => {\n  if (action.payload.internal.type !== `SitePage`) {\n    pagesDirty = true\n  }\n})\n\nemitter.on(`API_RUNNING_QUEUE_EMPTY`, () => {\n  if (pagesDirty) {\n    runCreatePages()\n  }\n})\n\nconst runCreatePages = async () => {\n  pagesDirty = false\n  const plugins = store.getState().plugins\n  // Test which plugins implement createPagesStatefully so we can\n  // ignore their pages.\n  const statefulPlugins = plugins\n    .filter(p => {\n      try {\n        const gatsbyNode = require(`${p.resolve}/gatsby-node`)\n        if (gatsbyNode.createPagesStatefully) {\n          return true\n        } else {\n          return false\n        }\n      } catch (e) {\n        return false\n      }\n    })\n    .map(p => p.id)\n\n  const timestamp = new Date().toJSON()\n\n  await apiRunnerNode(`createPages`, {\n    graphql,\n    traceId: `createPages`,\n    waitForCascadingActions: true,\n  })\n\n  // Delete pages that weren't updated when running createPages.\n  Array.from(store.getState().pages.values()).forEach(page => {\n    if (\n      !_.includes(statefulPlugins, page.pluginCreatorId) &&\n      page.updatedAt < timestamp\n    ) {\n      deleteComponentsDependencies([page.path])\n      deletePage(page)\n    }\n  })\n\n  emitter.emit(`CREATE_PAGE_END`)\n}\n\nmodule.exports = graphqlRunner => {\n  graphql = graphqlRunner\n}\n"],"file":"page-hot-reloader.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/bootstrap/page-hot-reloader.js"],"names":["_","require","emitter","store","apiRunnerNode","boundActionCreators","deletePage","deleteComponentsDependencies","pagesDirty","graphql","on","action","payload","internal","type","runCreatePages","plugins","getState","statefulPlugins","filter","p","gatsbyNode","resolve","createPagesStatefully","e","map","id","timestamp","Date","toJSON","traceId","waitForCascadingActions","Array","from","pages","values","forEach","page","includes","pluginCreatorId","updatedAt","path","emit","module","exports","graphqlRunner"],"mappings":";;AAAA,MAAMA,CAAC,GAAGC,OAAO,CAAE,QAAF,CAAjB;;AAEA,MAAM;AAAEC,EAAAA,OAAF;AAAWC,EAAAA;AAAX,IAAqBF,OAAO,CAAE,UAAF,CAAlC;;AACA,MAAMG,aAAa,GAAGH,OAAO,CAAE,0BAAF,CAA7B;;AACA,MAAM;AAAEI,EAAAA;AAAF,IAA0BJ,OAAO,CAAE,kBAAF,CAAvC;;AACA,MAAM;AAAEK,EAAAA,UAAF;AAAcC,EAAAA;AAAd,IAA+CF,mBAArD;AAEA,IAAIG,UAAU,GAAG,KAAjB;AACA,IAAIC,OAAJ;AAEAP,OAAO,CAACQ,EAAR,CAAY,aAAZ,EAA0BC,MAAM,IAAI;AAClC,MAAIA,MAAM,CAACC,OAAP,CAAeC,QAAf,CAAwBC,IAAxB,KAAkC,UAAtC,EAAiD;AAC/CN,IAAAA,UAAU,GAAG,IAAb;AACD;AACF,CAJD;AAKAN,OAAO,CAACQ,EAAR,CAAY,aAAZ,EAA0BC,MAAM,IAAI;AAClC,MAAIA,MAAM,CAACC,OAAP,CAAeC,QAAf,CAAwBC,IAAxB,KAAkC,UAAtC,EAAiD;AAC/CN,IAAAA,UAAU,GAAG,IAAb;AACD;AACF,CAJD;AAMAN,OAAO,CAACQ,EAAR,CAAY,yBAAZ,EAAsC,MAAM;AAC1C,MAAIF,UAAJ,EAAgB;AACdO,IAAAA,cAAc;AACf;AACF,CAJD;;AAMA,MAAMA,cAAc,GAAG,YAAY;AACjCP,EAAAA,UAAU,GAAG,KAAb;AACA,QAAMQ,OAAO,GAAGb,KAAK,CAACc,QAAN,GAAiBD,OAAjC,CAFiC,CAGjC;AACA;;AACA,QAAME,eAAe,GAAGF,OAAO,CAC5BG,MADqB,CACdC,CAAC,IAAI;AACX,QAAI;AACF,YAAMC,UAAU,GAAGpB,OAAO,CAAE,GAAEmB,CAAC,CAACE,OAAQ,cAAd,CAA1B;;AACA,UAAID,UAAU,CAACE,qBAAf,EAAsC;AACpC,eAAO,IAAP;AACD,OAFD,MAEO;AACL,eAAO,KAAP;AACD;AACF,KAPD,CAOE,OAAOC,CAAP,EAAU;AACV,aAAO,KAAP;AACD;AACF,GAZqB,EAarBC,GAbqB,CAajBL,CAAC,IAAIA,CAAC,CAACM,EAbU,CAAxB;AAeA,QAAMC,SAAS,GAAG,IAAIC,IAAJ,GAAWC,MAAX,EAAlB;AAEA,QAAMzB,aAAa,CAAE,aAAF,EAAgB;AACjCK,IAAAA,OADiC;AAEjCqB,IAAAA,OAAO,EAAG,aAFuB;AAGjCC,IAAAA,uBAAuB,EAAE;AAHQ,GAAhB,CAAnB,CAtBiC,CA4BjC;;AACAC,EAAAA,KAAK,CAACC,IAAN,CAAW9B,KAAK,CAACc,QAAN,GAAiBiB,KAAjB,CAAuBC,MAAvB,EAAX,EAA4CC,OAA5C,CAAoDC,IAAI,IAAI;AAC1D,QACE,CAACrC,CAAC,CAACsC,QAAF,CAAWpB,eAAX,EAA4BmB,IAAI,CAACE,eAAjC,CAAD,IACAF,IAAI,CAACG,SAAL,GAAiBb,SAFnB,EAGE;AACApB,MAAAA,4BAA4B,CAAC,CAAC8B,IAAI,CAACI,IAAN,CAAD,CAA5B;AACAnC,MAAAA,UAAU,CAAC+B,IAAD,CAAV;AACD;AACF,GARD;AAUAnC,EAAAA,OAAO,CAACwC,IAAR,CAAc,iBAAd;AACD,CAxCD;;AA0CAC,MAAM,CAACC,OAAP,GAAiBC,aAAa,IAAI;AAChCpC,EAAAA,OAAO,GAAGoC,aAAV;AACD,CAFD","sourcesContent":["const _ = require(`lodash`)\n\nconst { emitter, store } = require(`../redux`)\nconst apiRunnerNode = require(`../utils/api-runner-node`)\nconst { boundActionCreators } = require(`../redux/actions`)\nconst { deletePage, deleteComponentsDependencies } = boundActionCreators\n\nlet pagesDirty = false\nlet graphql\n\nemitter.on(`CREATE_NODE`, action => {\n  if (action.payload.internal.type !== `SitePage`) {\n    pagesDirty = true\n  }\n})\nemitter.on(`DELETE_NODE`, action => {\n  if (action.payload.internal.type !== `SitePage`) {\n    pagesDirty = true\n  }\n})\n\nemitter.on(`API_RUNNING_QUEUE_EMPTY`, () => {\n  if (pagesDirty) {\n    runCreatePages()\n  }\n})\n\nconst runCreatePages = async () => {\n  pagesDirty = false\n  const plugins = store.getState().plugins\n  // Test which plugins implement createPagesStatefully so we can\n  // ignore their pages.\n  const statefulPlugins = plugins\n    .filter(p => {\n      try {\n        const gatsbyNode = require(`${p.resolve}/gatsby-node`)\n        if (gatsbyNode.createPagesStatefully) {\n          return true\n        } else {\n          return false\n        }\n      } catch (e) {\n        return false\n      }\n    })\n    .map(p => p.id)\n\n  const timestamp = new Date().toJSON()\n\n  await apiRunnerNode(`createPages`, {\n    graphql,\n    traceId: `createPages`,\n    waitForCascadingActions: true,\n  })\n\n  // Delete pages that weren't updated when running createPages.\n  Array.from(store.getState().pages.values()).forEach(page => {\n    if (\n      !_.includes(statefulPlugins, page.pluginCreatorId) &&\n      page.updatedAt < timestamp\n    ) {\n      deleteComponentsDependencies([page.path])\n      deletePage(page)\n    }\n  })\n\n  emitter.emit(`CREATE_PAGE_END`)\n}\n\nmodule.exports = graphqlRunner => {\n  graphql = graphqlRunner\n}\n"],"file":"page-hot-reloader.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/bootstrap/resolve-module-exports.js
+++ b/node_modules/gatsby/dist/bootstrap/resolve-module-exports.js
@@ -6,11 +6,13 @@ const traverse = require(`babel-traverse`).default;
 
 const get = require(`lodash/get`);
 
-const _require = require(`@babel/code-frame`),
-      codeFrameColumns = _require.codeFrameColumns;
+const {
+  codeFrameColumns
+} = require(`@babel/code-frame`);
 
-const _require2 = require(`../utils/babel-parse-to-ast`),
-      babelParseToAst = _require2.babelParseToAst;
+const {
+  babelParseToAst
+} = require(`../utils/babel-parse-to-ast`);
 
 const report = require(`gatsby-cli/lib/reporter`);
 /**
--- a/node_modules/gatsby/dist/bootstrap/resolve-module-exports.js.map
+++ b/node_modules/gatsby/dist/bootstrap/resolve-module-exports.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/bootstrap/resolve-module-exports.js"],"names":["fs","require","traverse","default","get","codeFrameColumns","babelParseToAst","report","module","exports","modulePath","resolver","resolve","absPath","exportNames","err","code","readFileSync","ast","SyntaxError","codeFrame","start","loc","highlightCode","panic","message","isCommonJS","isES6","ImportDeclaration","astPath","ExportNamedDeclaration","exportName","push","AssignmentExpression","nodeLeft","node","left","type","property","name","process","env","NODE_ENV"],"mappings":"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","sourcesContent":["// @flow\nconst fs = require(`fs`)\nconst traverse = require(`babel-traverse`).default\nconst get = require(`lodash/get`)\nconst { codeFrameColumns } = require(`@babel/code-frame`)\nconst { babelParseToAst } = require(`../utils/babel-parse-to-ast`)\nconst report = require(`gatsby-cli/lib/reporter`)\n\n/**\n * Given a `require.resolve()` compatible path pointing to a JS module,\n * return an array listing the names of the module's exports.\n *\n * Returns [] for invalid paths and modules without exports.\n *\n * @param {string} modulePath\n * @param {function} resolver\n */\nmodule.exports = (modulePath, resolver = require.resolve) => {\n  let absPath\n  const exportNames = []\n\n  try {\n    absPath = resolver(modulePath)\n  } catch (err) {\n    return exportNames // doesn't exist\n  }\n  const code = fs.readFileSync(absPath, `utf8`) // get file contents\n\n  let ast\n  try {\n    ast = babelParseToAst(code, absPath)\n  } catch (err) {\n    if (err instanceof SyntaxError) {\n      // Pretty print syntax errors\n      const codeFrame = codeFrameColumns(\n        code,\n        {\n          start: err.loc,\n        },\n        {\n          highlightCode: true,\n        }\n      )\n\n      report.panic(\n        `Syntax error in \"${absPath}\":\\n${err.message}\\n${codeFrame}`\n      )\n    } else {\n      // if it's not syntax error, just throw it\n      throw err\n    }\n  }\n\n  let isCommonJS = false\n  let isES6 = false\n\n  // extract names of exports from file\n  traverse(ast, {\n    // Check if the file is using ES6 imports\n    ImportDeclaration: function ImportDeclaration(astPath) {\n      isES6 = true\n    },\n\n    // get foo from `export const foo = bar`\n    ExportNamedDeclaration: function ExportNamedDeclaration(astPath) {\n      const exportName = get(\n        astPath,\n        `node.declaration.declarations[0].id.name`\n      )\n      isES6 = true\n      if (exportName) exportNames.push(exportName)\n    },\n    AssignmentExpression: function AssignmentExpression(astPath) {\n      const nodeLeft = astPath.node.left\n\n      if (nodeLeft.type !== `MemberExpression`) return\n\n      // ignore marker property `__esModule`\n      if (get(nodeLeft, `property.name`) === `__esModule`) return\n\n      // get foo from `exports.foo = bar`\n      if (get(nodeLeft, `object.name`) === `exports`) {\n        isCommonJS = true\n        exportNames.push(nodeLeft.property.name)\n      }\n\n      // get foo from `module.exports.foo = bar`\n      if (\n        get(nodeLeft, `object.object.name`) === `module` &&\n        get(nodeLeft, `object.property.name`) === `exports`\n      ) {\n        isCommonJS = true\n        exportNames.push(nodeLeft.property.name)\n      }\n    },\n  })\n\n  if (isES6 && isCommonJS && process.env.NODE_ENV !== `test`) {\n    report.panic(\n      `This plugin file is using both CommonJS and ES6 module systems together which we don't support.\nYou'll need to edit the file to use just one or the other.\n\nplugin: ${modulePath}.js\n\nThis didn't cause a problem in Gatsby v1 so you might want to review the migration doc for this:\nhttps://gatsby.app/no-mixed-modules\n      `\n    )\n  }\n  return exportNames\n}\n"],"file":"resolve-module-exports.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/bootstrap/resolve-module-exports.js"],"names":["fs","require","traverse","default","get","codeFrameColumns","babelParseToAst","report","module","exports","modulePath","resolver","resolve","absPath","exportNames","err","code","readFileSync","ast","SyntaxError","codeFrame","start","loc","highlightCode","panic","message","isCommonJS","isES6","ImportDeclaration","astPath","ExportNamedDeclaration","exportName","push","AssignmentExpression","nodeLeft","node","left","type","property","name","process","env","NODE_ENV"],"mappings":"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","sourcesContent":["// @flow\nconst fs = require(`fs`)\nconst traverse = require(`babel-traverse`).default\nconst get = require(`lodash/get`)\nconst { codeFrameColumns } = require(`@babel/code-frame`)\nconst { babelParseToAst } = require(`../utils/babel-parse-to-ast`)\nconst report = require(`gatsby-cli/lib/reporter`)\n\n/**\n * Given a `require.resolve()` compatible path pointing to a JS module,\n * return an array listing the names of the module's exports.\n *\n * Returns [] for invalid paths and modules without exports.\n *\n * @param {string} modulePath\n * @param {function} resolver\n */\nmodule.exports = (modulePath, resolver = require.resolve) => {\n  let absPath\n  const exportNames = []\n\n  try {\n    absPath = resolver(modulePath)\n  } catch (err) {\n    return exportNames // doesn't exist\n  }\n  const code = fs.readFileSync(absPath, `utf8`) // get file contents\n\n  let ast\n  try {\n    ast = babelParseToAst(code, absPath)\n  } catch (err) {\n    if (err instanceof SyntaxError) {\n      // Pretty print syntax errors\n      const codeFrame = codeFrameColumns(\n        code,\n        {\n          start: err.loc,\n        },\n        {\n          highlightCode: true,\n        }\n      )\n\n      report.panic(\n        `Syntax error in \"${absPath}\":\\n${err.message}\\n${codeFrame}`\n      )\n    } else {\n      // if it's not syntax error, just throw it\n      throw err\n    }\n  }\n\n  let isCommonJS = false\n  let isES6 = false\n\n  // extract names of exports from file\n  traverse(ast, {\n    // Check if the file is using ES6 imports\n    ImportDeclaration: function ImportDeclaration(astPath) {\n      isES6 = true\n    },\n\n    // get foo from `export const foo = bar`\n    ExportNamedDeclaration: function ExportNamedDeclaration(astPath) {\n      const exportName = get(\n        astPath,\n        `node.declaration.declarations[0].id.name`\n      )\n      isES6 = true\n      if (exportName) exportNames.push(exportName)\n    },\n    AssignmentExpression: function AssignmentExpression(astPath) {\n      const nodeLeft = astPath.node.left\n\n      if (nodeLeft.type !== `MemberExpression`) return\n\n      // ignore marker property `__esModule`\n      if (get(nodeLeft, `property.name`) === `__esModule`) return\n\n      // get foo from `exports.foo = bar`\n      if (get(nodeLeft, `object.name`) === `exports`) {\n        isCommonJS = true\n        exportNames.push(nodeLeft.property.name)\n      }\n\n      // get foo from `module.exports.foo = bar`\n      if (\n        get(nodeLeft, `object.object.name`) === `module` &&\n        get(nodeLeft, `object.property.name`) === `exports`\n      ) {\n        isCommonJS = true\n        exportNames.push(nodeLeft.property.name)\n      }\n    },\n  })\n\n  if (isES6 && isCommonJS && process.env.NODE_ENV !== `test`) {\n    report.panic(\n      `This plugin file is using both CommonJS and ES6 module systems together which we don't support.\nYou'll need to edit the file to use just one or the other.\n\nplugin: ${modulePath}.js\n\nThis didn't cause a problem in Gatsby v1 so you might want to review the migration doc for this:\nhttps://gatsby.app/no-mixed-modules\n      `\n    )\n  }\n  return exportNames\n}\n"],"file":"resolve-module-exports.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/commands/build-html.js
+++ b/node_modules/gatsby/dist/commands/build-html.js
@@ -1,9 +1,5 @@
 "use strict";
 
-var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
-
-var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
-
 const webpack = require(`webpack`);
 
 const fs = require(`fs`);
@@ -12,55 +8,51 @@ const debug = require(`debug`)(`gatsby:html`);
 
 const webpackConfig = require(`../utils/webpack.config`);
 
-const _require = require(`../redux`),
-      store = _require.store;
+const {
+  store
+} = require(`../redux`);
 
-const _require2 = require(`gatsby-cli/lib/reporter/errors`),
-      createErrorFromString = _require2.createErrorFromString;
+const {
+  createErrorFromString
+} = require(`gatsby-cli/lib/reporter/errors`);
 
 const renderHTMLQueue = require(`../utils/html-renderer-queue`);
 
-module.exports =
-/*#__PURE__*/
-function () {
-  var _ref = (0, _asyncToGenerator2.default)(function* (program, activity) {
-    const directory = program.directory;
-    debug(`generating static HTML`); // Reduce pages objects to an array of paths.
-
-    const pages = Array.from(store.getState().pages.values(), page => page.path); // Static site generation.
-
-    const compilerConfig = yield webpackConfig(program, directory, `build-html`, null);
-    return new Promise((resolve, reject) => {
-      webpack(compilerConfig).run((e, stats) => {
-        if (e) {
-          return reject(e);
+module.exports = async (program, activity) => {
+  const {
+    directory
+  } = program;
+  debug(`generating static HTML`); // Reduce pages objects to an array of paths.
+
+  const pages = Array.from(store.getState().pages.values(), page => page.path); // Static site generation.
+
+  const compilerConfig = await webpackConfig(program, directory, `build-html`, null);
+  return new Promise((resolve, reject) => {
+    webpack(compilerConfig).run((e, stats) => {
+      if (e) {
+        return reject(e);
+      }
+
+      const outputFile = `${directory}/public/render-page.js`;
+
+      if (stats.hasErrors()) {
+        let webpackErrors = stats.toJson().errors.filter(Boolean);
+        return reject(webpackErrors.length ? createErrorFromString(webpackErrors[0], `${outputFile}.map`) : new Error(`There was an issue while building the site: ` + `\n\n${stats.toString()}`));
+      }
+
+      return renderHTMLQueue(outputFile, pages, activity).then(() => {
+        // Remove the temp JS bundle file built for the static-site-generator-plugin
+        try {
+          fs.unlinkSync(outputFile);
+          fs.unlinkSync(`${outputFile}.map`);
+        } catch (e) {// This function will fail on Windows with no further consequences.
         }
 
-        const outputFile = `${directory}/public/render-page.js`;
-
-        if (stats.hasErrors()) {
-          let webpackErrors = stats.toJson().errors.filter(Boolean);
-          return reject(webpackErrors.length ? createErrorFromString(webpackErrors[0], `${outputFile}.map`) : new Error(`There was an issue while building the site: ` + `\n\n${stats.toString()}`));
-        }
-
-        return renderHTMLQueue(outputFile, pages, activity).then(() => {
-          // Remove the temp JS bundle file built for the static-site-generator-plugin
-          try {
-            fs.unlinkSync(outputFile);
-            fs.unlinkSync(`${outputFile}.map`);
-          } catch (e) {// This function will fail on Windows with no further consequences.
-          }
-
-          return resolve(null, stats);
-        }).catch(e => {
-          reject(createErrorFromString(e.stack, `${outputFile}.map`));
-        });
+        return resolve(null, stats);
+      }).catch(e => {
+        reject(createErrorFromString(e.stack, `${outputFile}.map`));
       });
     });
   });
-
-  return function (_x, _x2) {
-    return _ref.apply(this, arguments);
-  };
-}();
+};
 //# sourceMappingURL=build-html.js.map
\ No newline at end of file
--- a/node_modules/gatsby/dist/commands/build-html.js.map
+++ b/node_modules/gatsby/dist/commands/build-html.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/commands/build-html.js"],"names":["webpack","require","fs","debug","webpackConfig","store","createErrorFromString","renderHTMLQueue","module","exports","program","activity","directory","pages","Array","from","getState","values","page","path","compilerConfig","Promise","resolve","reject","run","e","stats","outputFile","hasErrors","webpackErrors","toJson","errors","filter","Boolean","length","Error","toString","then","unlinkSync","catch","stack"],"mappings":";;;;;;AACA,MAAMA,OAAO,GAAGC,OAAO,CAAE,SAAF,CAAvB;;AACA,MAAMC,EAAE,GAAGD,OAAO,CAAE,IAAF,CAAlB;;AACA,MAAME,KAAK,GAAGF,OAAO,CAAE,OAAF,CAAP,CAAkB,aAAlB,CAAd;;AAEA,MAAMG,aAAa,GAAGH,OAAO,CAAE,yBAAF,CAA7B;;iBACkBA,OAAO,CAAE,UAAF,C;MAAjBI,K,YAAAA,K;;kBAC0BJ,OAAO,CAAE,gCAAF,C;MAAjCK,qB,aAAAA,qB;;AACR,MAAMC,eAAe,GAAGN,OAAO,CAAE,8BAAF,CAA/B;;AAEAO,MAAM,CAACC,OAAP;AAAA;AAAA;AAAA,6CAAiB,WAAOC,OAAP,EAAqBC,QAArB,EAAuC;AAAA,UAC9CC,SAD8C,GAChCF,OADgC,CAC9CE,SAD8C;AAGtDT,IAAAA,KAAK,CAAE,wBAAF,CAAL,CAHsD,CAItD;;AACA,UAAMU,KAAK,GAAGC,KAAK,CAACC,IAAN,CAAWV,KAAK,CAACW,QAAN,GAAiBH,KAAjB,CAAuBI,MAAvB,EAAX,EAA4CC,IAAI,IAAIA,IAAI,CAACC,IAAzD,CAAd,CALsD,CAOtD;;AACA,UAAMC,cAAc,SAAShB,aAAa,CACxCM,OADwC,EAExCE,SAFwC,EAGvC,YAHuC,EAIxC,IAJwC,CAA1C;AAOA,WAAO,IAAIS,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtCvB,MAAAA,OAAO,CAACoB,cAAD,CAAP,CAAwBI,GAAxB,CAA4B,CAACC,CAAD,EAAIC,KAAJ,KAAc;AACxC,YAAID,CAAJ,EAAO;AACL,iBAAOF,MAAM,CAACE,CAAD,CAAb;AACD;;AACD,cAAME,UAAU,GAAI,GAAEf,SAAU,wBAAhC;;AACA,YAAIc,KAAK,CAACE,SAAN,EAAJ,EAAuB;AACrB,cAAIC,aAAa,GAAGH,KAAK,CAACI,MAAN,GAAeC,MAAf,CAAsBC,MAAtB,CAA6BC,OAA7B,CAApB;AACA,iBAAOV,MAAM,CACXM,aAAa,CAACK,MAAd,GACI5B,qBAAqB,CAACuB,aAAa,CAAC,CAAD,CAAd,EAAoB,GAAEF,UAAW,MAAjC,CADzB,GAEI,IAAIQ,KAAJ,CACG,8CAAD,GACG,OAAMT,KAAK,CAACU,QAAN,EAAiB,EAF5B,CAHO,CAAb;AAQD;;AAED,eAAO7B,eAAe,CAACoB,UAAD,EAAad,KAAb,EAAoBF,QAApB,CAAf,CACJ0B,IADI,CACC,MAAM;AACV;AACA,cAAI;AACFnC,YAAAA,EAAE,CAACoC,UAAH,CAAcX,UAAd;AACAzB,YAAAA,EAAE,CAACoC,UAAH,CAAe,GAAEX,UAAW,MAA5B;AACD,WAHD,CAGE,OAAOF,CAAP,EAAU,CACV;AACD;;AACD,iBAAOH,OAAO,CAAC,IAAD,EAAOI,KAAP,CAAd;AACD,SAVI,EAWJa,KAXI,CAWEd,CAAC,IAAI;AACVF,UAAAA,MAAM,CAACjB,qBAAqB,CAACmB,CAAC,CAACe,KAAH,EAAW,GAAEb,UAAW,MAAxB,CAAtB,CAAN;AACD,SAbI,CAAP;AAcD,OA/BD;AAgCD,KAjCM,CAAP;AAkCD,GAjDD;;AAAA;AAAA;AAAA;AAAA","sourcesContent":["/* @flow */\nconst webpack = require(`webpack`)\nconst fs = require(`fs`)\nconst debug = require(`debug`)(`gatsby:html`)\n\nconst webpackConfig = require(`../utils/webpack.config`)\nconst { store } = require(`../redux`)\nconst { createErrorFromString } = require(`gatsby-cli/lib/reporter/errors`)\nconst renderHTMLQueue = require(`../utils/html-renderer-queue`)\n\nmodule.exports = async (program: any, activity: any) => {\n  const { directory } = program\n\n  debug(`generating static HTML`)\n  // Reduce pages objects to an array of paths.\n  const pages = Array.from(store.getState().pages.values(), page => page.path)\n\n  // Static site generation.\n  const compilerConfig = await webpackConfig(\n    program,\n    directory,\n    `build-html`,\n    null\n  )\n\n  return new Promise((resolve, reject) => {\n    webpack(compilerConfig).run((e, stats) => {\n      if (e) {\n        return reject(e)\n      }\n      const outputFile = `${directory}/public/render-page.js`\n      if (stats.hasErrors()) {\n        let webpackErrors = stats.toJson().errors.filter(Boolean)\n        return reject(\n          webpackErrors.length\n            ? createErrorFromString(webpackErrors[0], `${outputFile}.map`)\n            : new Error(\n                `There was an issue while building the site: ` +\n                  `\\n\\n${stats.toString()}`\n              )\n        )\n      }\n\n      return renderHTMLQueue(outputFile, pages, activity)\n        .then(() => {\n          // Remove the temp JS bundle file built for the static-site-generator-plugin\n          try {\n            fs.unlinkSync(outputFile)\n            fs.unlinkSync(`${outputFile}.map`)\n          } catch (e) {\n            // This function will fail on Windows with no further consequences.\n          }\n          return resolve(null, stats)\n        })\n        .catch(e => {\n          reject(createErrorFromString(e.stack, `${outputFile}.map`))\n        })\n    })\n  })\n}\n"],"file":"build-html.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/commands/build-html.js"],"names":["webpack","require","fs","debug","webpackConfig","store","createErrorFromString","renderHTMLQueue","module","exports","program","activity","directory","pages","Array","from","getState","values","page","path","compilerConfig","Promise","resolve","reject","run","e","stats","outputFile","hasErrors","webpackErrors","toJson","errors","filter","Boolean","length","Error","toString","then","unlinkSync","catch","stack"],"mappings":";;AACA,MAAMA,OAAO,GAAGC,OAAO,CAAE,SAAF,CAAvB;;AACA,MAAMC,EAAE,GAAGD,OAAO,CAAE,IAAF,CAAlB;;AACA,MAAME,KAAK,GAAGF,OAAO,CAAE,OAAF,CAAP,CAAkB,aAAlB,CAAd;;AAEA,MAAMG,aAAa,GAAGH,OAAO,CAAE,yBAAF,CAA7B;;AACA,MAAM;AAAEI,EAAAA;AAAF,IAAYJ,OAAO,CAAE,UAAF,CAAzB;;AACA,MAAM;AAAEK,EAAAA;AAAF,IAA4BL,OAAO,CAAE,gCAAF,CAAzC;;AACA,MAAMM,eAAe,GAAGN,OAAO,CAAE,8BAAF,CAA/B;;AAEAO,MAAM,CAACC,OAAP,GAAiB,OAAOC,OAAP,EAAqBC,QAArB,KAAuC;AACtD,QAAM;AAAEC,IAAAA;AAAF,MAAgBF,OAAtB;AAEAP,EAAAA,KAAK,CAAE,wBAAF,CAAL,CAHsD,CAItD;;AACA,QAAMU,KAAK,GAAGC,KAAK,CAACC,IAAN,CAAWV,KAAK,CAACW,QAAN,GAAiBH,KAAjB,CAAuBI,MAAvB,EAAX,EAA4CC,IAAI,IAAIA,IAAI,CAACC,IAAzD,CAAd,CALsD,CAOtD;;AACA,QAAMC,cAAc,GAAG,MAAMhB,aAAa,CACxCM,OADwC,EAExCE,SAFwC,EAGvC,YAHuC,EAIxC,IAJwC,CAA1C;AAOA,SAAO,IAAIS,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtCvB,IAAAA,OAAO,CAACoB,cAAD,CAAP,CAAwBI,GAAxB,CAA4B,CAACC,CAAD,EAAIC,KAAJ,KAAc;AACxC,UAAID,CAAJ,EAAO;AACL,eAAOF,MAAM,CAACE,CAAD,CAAb;AACD;;AACD,YAAME,UAAU,GAAI,GAAEf,SAAU,wBAAhC;;AACA,UAAIc,KAAK,CAACE,SAAN,EAAJ,EAAuB;AACrB,YAAIC,aAAa,GAAGH,KAAK,CAACI,MAAN,GAAeC,MAAf,CAAsBC,MAAtB,CAA6BC,OAA7B,CAApB;AACA,eAAOV,MAAM,CACXM,aAAa,CAACK,MAAd,GACI5B,qBAAqB,CAACuB,aAAa,CAAC,CAAD,CAAd,EAAoB,GAAEF,UAAW,MAAjC,CADzB,GAEI,IAAIQ,KAAJ,CACG,8CAAD,GACG,OAAMT,KAAK,CAACU,QAAN,EAAiB,EAF5B,CAHO,CAAb;AAQD;;AAED,aAAO7B,eAAe,CAACoB,UAAD,EAAad,KAAb,EAAoBF,QAApB,CAAf,CACJ0B,IADI,CACC,MAAM;AACV;AACA,YAAI;AACFnC,UAAAA,EAAE,CAACoC,UAAH,CAAcX,UAAd;AACAzB,UAAAA,EAAE,CAACoC,UAAH,CAAe,GAAEX,UAAW,MAA5B;AACD,SAHD,CAGE,OAAOF,CAAP,EAAU,CACV;AACD;;AACD,eAAOH,OAAO,CAAC,IAAD,EAAOI,KAAP,CAAd;AACD,OAVI,EAWJa,KAXI,CAWEd,CAAC,IAAI;AACVF,QAAAA,MAAM,CAACjB,qBAAqB,CAACmB,CAAC,CAACe,KAAH,EAAW,GAAEb,UAAW,MAAxB,CAAtB,CAAN;AACD,OAbI,CAAP;AAcD,KA/BD;AAgCD,GAjCM,CAAP;AAkCD,CAjDD","sourcesContent":["/* @flow */\nconst webpack = require(`webpack`)\nconst fs = require(`fs`)\nconst debug = require(`debug`)(`gatsby:html`)\n\nconst webpackConfig = require(`../utils/webpack.config`)\nconst { store } = require(`../redux`)\nconst { createErrorFromString } = require(`gatsby-cli/lib/reporter/errors`)\nconst renderHTMLQueue = require(`../utils/html-renderer-queue`)\n\nmodule.exports = async (program: any, activity: any) => {\n  const { directory } = program\n\n  debug(`generating static HTML`)\n  // Reduce pages objects to an array of paths.\n  const pages = Array.from(store.getState().pages.values(), page => page.path)\n\n  // Static site generation.\n  const compilerConfig = await webpackConfig(\n    program,\n    directory,\n    `build-html`,\n    null\n  )\n\n  return new Promise((resolve, reject) => {\n    webpack(compilerConfig).run((e, stats) => {\n      if (e) {\n        return reject(e)\n      }\n      const outputFile = `${directory}/public/render-page.js`\n      if (stats.hasErrors()) {\n        let webpackErrors = stats.toJson().errors.filter(Boolean)\n        return reject(\n          webpackErrors.length\n            ? createErrorFromString(webpackErrors[0], `${outputFile}.map`)\n            : new Error(\n                `There was an issue while building the site: ` +\n                  `\\n\\n${stats.toString()}`\n              )\n        )\n      }\n\n      return renderHTMLQueue(outputFile, pages, activity)\n        .then(() => {\n          // Remove the temp JS bundle file built for the static-site-generator-plugin\n          try {\n            fs.unlinkSync(outputFile)\n            fs.unlinkSync(`${outputFile}.map`)\n          } catch (e) {\n            // This function will fail on Windows with no further consequences.\n          }\n          return resolve(null, stats)\n        })\n        .catch(e => {\n          reject(createErrorFromString(e.stack, `${outputFile}.map`))\n        })\n    })\n  })\n}\n"],"file":"build-html.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/commands/build-javascript.js
+++ b/node_modules/gatsby/dist/commands/build-javascript.js
@@ -1,40 +1,30 @@
 "use strict";
 
-var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
-
-var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
-
 const webpack = require(`webpack`);
 
 const webpackConfig = require(`../utils/webpack.config`);
 
-module.exports =
-/*#__PURE__*/
-function () {
-  var _ref = (0, _asyncToGenerator2.default)(function* (program) {
-    const directory = program.directory;
-    const compilerConfig = yield webpackConfig(program, directory, `build-javascript`);
-    return new Promise((resolve, reject) => {
-      webpack(compilerConfig).run((err, stats) => {
-        if (err) {
-          reject(err);
-          return;
-        }
-
-        const jsonStats = stats.toJson();
-
-        if (jsonStats.errors && jsonStats.errors.length > 0) {
-          reject(jsonStats.errors);
-          return;
-        }
-
-        resolve();
-      });
+module.exports = async program => {
+  const {
+    directory
+  } = program;
+  const compilerConfig = await webpackConfig(program, directory, `build-javascript`);
+  return new Promise((resolve, reject) => {
+    webpack(compilerConfig).run((err, stats) => {
+      if (err) {
+        reject(err);
+        return;
+      }
+
+      const jsonStats = stats.toJson();
+
+      if (jsonStats.errors && jsonStats.errors.length > 0) {
+        reject(jsonStats.errors);
+        return;
+      }
+
+      resolve();
     });
   });
-
-  return function (_x) {
-    return _ref.apply(this, arguments);
-  };
-}();
+};
 //# sourceMappingURL=build-javascript.js.map
\ No newline at end of file
--- a/node_modules/gatsby/dist/commands/build-javascript.js.map
+++ b/node_modules/gatsby/dist/commands/build-javascript.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/commands/build-javascript.js"],"names":["webpack","require","webpackConfig","module","exports","program","directory","compilerConfig","Promise","resolve","reject","run","err","stats","jsonStats","toJson","errors","length"],"mappings":";;;;;;AACA,MAAMA,OAAO,GAAGC,OAAO,CAAE,SAAF,CAAvB;;AACA,MAAMC,aAAa,GAAGD,OAAO,CAAE,yBAAF,CAA7B;;AAEAE,MAAM,CAACC,OAAP;AAAA;AAAA;AAAA,6CAAiB,WAAMC,OAAN,EAAiB;AAAA,UACxBC,SADwB,GACVD,OADU,CACxBC,SADwB;AAGhC,UAAMC,cAAc,SAASL,aAAa,CACxCG,OADwC,EAExCC,SAFwC,EAGvC,kBAHuC,CAA1C;AAMA,WAAO,IAAIE,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtCV,MAAAA,OAAO,CAACO,cAAD,CAAP,CAAwBI,GAAxB,CAA4B,CAACC,GAAD,EAAMC,KAAN,KAAgB;AAC1C,YAAID,GAAJ,EAAS;AACPF,UAAAA,MAAM,CAACE,GAAD,CAAN;AACA;AACD;;AAED,cAAME,SAAS,GAAGD,KAAK,CAACE,MAAN,EAAlB;;AACA,YAAID,SAAS,CAACE,MAAV,IAAoBF,SAAS,CAACE,MAAV,CAAiBC,MAAjB,GAA0B,CAAlD,EAAqD;AACnDP,UAAAA,MAAM,CAACI,SAAS,CAACE,MAAX,CAAN;AACA;AACD;;AAEDP,QAAAA,OAAO;AACR,OAbD;AAcD,KAfM,CAAP;AAgBD,GAzBD;;AAAA;AAAA;AAAA;AAAA","sourcesContent":["/* @flow */\nconst webpack = require(`webpack`)\nconst webpackConfig = require(`../utils/webpack.config`)\n\nmodule.exports = async program => {\n  const { directory } = program\n\n  const compilerConfig = await webpackConfig(\n    program,\n    directory,\n    `build-javascript`\n  )\n\n  return new Promise((resolve, reject) => {\n    webpack(compilerConfig).run((err, stats) => {\n      if (err) {\n        reject(err)\n        return\n      }\n\n      const jsonStats = stats.toJson()\n      if (jsonStats.errors && jsonStats.errors.length > 0) {\n        reject(jsonStats.errors)\n        return\n      }\n\n      resolve()\n    })\n  })\n}\n"],"file":"build-javascript.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/commands/build-javascript.js"],"names":["webpack","require","webpackConfig","module","exports","program","directory","compilerConfig","Promise","resolve","reject","run","err","stats","jsonStats","toJson","errors","length"],"mappings":";;AACA,MAAMA,OAAO,GAAGC,OAAO,CAAE,SAAF,CAAvB;;AACA,MAAMC,aAAa,GAAGD,OAAO,CAAE,yBAAF,CAA7B;;AAEAE,MAAM,CAACC,OAAP,GAAiB,MAAMC,OAAN,IAAiB;AAChC,QAAM;AAAEC,IAAAA;AAAF,MAAgBD,OAAtB;AAEA,QAAME,cAAc,GAAG,MAAML,aAAa,CACxCG,OADwC,EAExCC,SAFwC,EAGvC,kBAHuC,CAA1C;AAMA,SAAO,IAAIE,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtCV,IAAAA,OAAO,CAACO,cAAD,CAAP,CAAwBI,GAAxB,CAA4B,CAACC,GAAD,EAAMC,KAAN,KAAgB;AAC1C,UAAID,GAAJ,EAAS;AACPF,QAAAA,MAAM,CAACE,GAAD,CAAN;AACA;AACD;;AAED,YAAME,SAAS,GAAGD,KAAK,CAACE,MAAN,EAAlB;;AACA,UAAID,SAAS,CAACE,MAAV,IAAoBF,SAAS,CAACE,MAAV,CAAiBC,MAAjB,GAA0B,CAAlD,EAAqD;AACnDP,QAAAA,MAAM,CAACI,SAAS,CAACE,MAAX,CAAN;AACA;AACD;;AAEDP,MAAAA,OAAO;AACR,KAbD;AAcD,GAfM,CAAP;AAgBD,CAzBD","sourcesContent":["/* @flow */\nconst webpack = require(`webpack`)\nconst webpackConfig = require(`../utils/webpack.config`)\n\nmodule.exports = async program => {\n  const { directory } = program\n\n  const compilerConfig = await webpackConfig(\n    program,\n    directory,\n    `build-javascript`\n  )\n\n  return new Promise((resolve, reject) => {\n    webpack(compilerConfig).run((err, stats) => {\n      if (err) {\n        reject(err)\n        return\n      }\n\n      const jsonStats = stats.toJson()\n      if (jsonStats.errors && jsonStats.errors.length > 0) {\n        reject(jsonStats.errors)\n        return\n      }\n\n      resolve()\n    })\n  })\n}\n"],"file":"build-javascript.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/commands/build.js
+++ b/node_modules/gatsby/dist/commands/build.js
@@ -1,9 +1,5 @@
 "use strict";
 
-var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
-
-var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
-
 const report = require(`gatsby-cli/lib/reporter`);
 
 const buildHTML = require(`./build-html`);
@@ -16,9 +12,10 @@ const apiRunnerNode = require(`../utils/api-runner-node`);
 
 const copyStaticDirectory = require(`../utils/copy-static-directory`);
 
-const _require = require(`../utils/tracer`),
-      initTracer = _require.initTracer,
-      stopTracer = _require.stopTracer;
+const {
+  initTracer,
+  stopTracer
+} = require(`../utils/tracer`);
 
 const tracer = require(`opentracing`).globalTracer();
 
@@ -27,58 +24,49 @@ function reportFailure(msg, err) {
   report.panic(msg, err);
 }
 
-module.exports =
-/*#__PURE__*/
-function () {
-  var _build = (0, _asyncToGenerator2.default)(function* (program) {
-    initTracer(program.openTracingConfigFile);
-    const buildSpan = tracer.startSpan(`build`);
-    buildSpan.setTag(`directory`, program.directory);
-
-    const _ref = yield bootstrap(Object.assign({}, program, {
-      parentSpan: buildSpan
-    })),
-          graphqlRunner = _ref.graphqlRunner;
-
-    yield apiRunnerNode(`onPreBuild`, {
-      graphql: graphqlRunner,
-      parentSpan: buildSpan
-    }); // Copy files from the static directory to
-    // an equivalent static directory within public.
-
-    copyStaticDirectory();
-    let activity;
-    activity = report.activityTimer(`Building production JavaScript and CSS bundles`, {
-      parentSpan: buildSpan
-    });
-    activity.start();
-    yield buildProductionBundle(program).catch(err => {
-      reportFailure(`Generating JavaScript bundles failed`, err);
-    });
-    activity.end();
-    activity = report.activityTimer(`Building static HTML for pages`, {
-      parentSpan: buildSpan
-    });
-    activity.start();
-    yield buildHTML(program, activity).catch(err => {
-      reportFailure(report.stripIndent`
+module.exports = async function build(program) {
+  initTracer(program.openTracingConfigFile);
+  const buildSpan = tracer.startSpan(`build`);
+  buildSpan.setTag(`directory`, program.directory);
+  const {
+    graphqlRunner
+  } = await bootstrap({ ...program,
+    parentSpan: buildSpan
+  });
+  await apiRunnerNode(`onPreBuild`, {
+    graphql: graphqlRunner,
+    parentSpan: buildSpan
+  }); // Copy files from the static directory to
+  // an equivalent static directory within public.
+
+  copyStaticDirectory();
+  let activity;
+  activity = report.activityTimer(`Building production JavaScript and CSS bundles`, {
+    parentSpan: buildSpan
+  });
+  activity.start();
+  await buildProductionBundle(program).catch(err => {
+    reportFailure(`Generating JavaScript bundles failed`, err);
+  });
+  activity.end();
+  activity = report.activityTimer(`Building static HTML for pages`, {
+    parentSpan: buildSpan
+  });
+  activity.start();
+  await buildHTML(program, activity).catch(err => {
+    reportFailure(report.stripIndent`
         Building static HTML for pages failed
 
         See our docs page on debugging HTML builds for help https://goo.gl/yL9lND
       `, err);
-    });
-    activity.end();
-    yield apiRunnerNode(`onPostBuild`, {
-      graphql: graphqlRunner,
-      parentSpan: buildSpan
-    });
-    report.info(`Done building in ${process.uptime()} sec`);
-    buildSpan.finish();
-    yield stopTracer();
   });
-
-  return function build(_x) {
-    return _build.apply(this, arguments);
-  };
-}();
+  activity.end();
+  await apiRunnerNode(`onPostBuild`, {
+    graphql: graphqlRunner,
+    parentSpan: buildSpan
+  });
+  report.info(`Done building in ${process.uptime()} sec`);
+  buildSpan.finish();
+  await stopTracer();
+};
 //# sourceMappingURL=build.js.map
\ No newline at end of file
--- a/node_modules/gatsby/dist/commands/build.js.map
+++ b/node_modules/gatsby/dist/commands/build.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/commands/build.js"],"names":["report","require","buildHTML","buildProductionBundle","bootstrap","apiRunnerNode","copyStaticDirectory","initTracer","stopTracer","tracer","globalTracer","reportFailure","msg","err","log","panic","module","exports","program","openTracingConfigFile","buildSpan","startSpan","setTag","directory","parentSpan","graphqlRunner","graphql","activity","activityTimer","start","catch","end","stripIndent","info","process","uptime","finish","build"],"mappings":";;;;;;AAEA,MAAMA,MAAM,GAAGC,OAAO,CAAE,yBAAF,CAAtB;;AACA,MAAMC,SAAS,GAAGD,OAAO,CAAE,cAAF,CAAzB;;AACA,MAAME,qBAAqB,GAAGF,OAAO,CAAE,oBAAF,CAArC;;AACA,MAAMG,SAAS,GAAGH,OAAO,CAAE,cAAF,CAAzB;;AACA,MAAMI,aAAa,GAAGJ,OAAO,CAAE,0BAAF,CAA7B;;AACA,MAAMK,mBAAmB,GAAGL,OAAO,CAAE,gCAAF,CAAnC;;iBACmCA,OAAO,CAAE,iBAAF,C;MAAlCM,U,YAAAA,U;MAAYC,U,YAAAA,U;;AACpB,MAAMC,MAAM,GAAGR,OAAO,CAAE,aAAF,CAAP,CAAuBS,YAAvB,EAAf;;AAEA,SAASC,aAAT,CAAuBC,GAAvB,EAA4BC,GAA5B,EAAwC;AACtCb,EAAAA,MAAM,CAACc,GAAP,CAAY,EAAZ;AACAd,EAAAA,MAAM,CAACe,KAAP,CAAaH,GAAb,EAAkBC,GAAlB;AACD;;AAUDG,MAAM,CAACC,OAAP;AAAA;AAAA;AAAA,+CAAiB,WAAqBC,OAArB,EAAyC;AACxDX,IAAAA,UAAU,CAACW,OAAO,CAACC,qBAAT,CAAV;AAEA,UAAMC,SAAS,GAAGX,MAAM,CAACY,SAAP,CAAkB,OAAlB,CAAlB;AACAD,IAAAA,SAAS,CAACE,MAAV,CAAkB,WAAlB,EAA8BJ,OAAO,CAACK,SAAtC;;AAJwD,uBAMxBnB,SAAS,mBACpCc,OADoC;AAEvCM,MAAAA,UAAU,EAAEJ;AAF2B,OANe;AAAA,UAMhDK,aANgD,QAMhDA,aANgD;;AAWxD,UAAMpB,aAAa,CAAE,YAAF,EAAe;AAChCqB,MAAAA,OAAO,EAAED,aADuB;AAEhCD,MAAAA,UAAU,EAAEJ;AAFoB,KAAf,CAAnB,CAXwD,CAgBxD;AACA;;AACAd,IAAAA,mBAAmB;AAEnB,QAAIqB,QAAJ;AACAA,IAAAA,QAAQ,GAAG3B,MAAM,CAAC4B,aAAP,CACR,gDADQ,EAET;AAAEJ,MAAAA,UAAU,EAAEJ;AAAd,KAFS,CAAX;AAIAO,IAAAA,QAAQ,CAACE,KAAT;AACA,UAAM1B,qBAAqB,CAACe,OAAD,CAArB,CAA+BY,KAA/B,CAAqCjB,GAAG,IAAI;AAChDF,MAAAA,aAAa,CAAE,sCAAF,EAAyCE,GAAzC,CAAb;AACD,KAFK,CAAN;AAGAc,IAAAA,QAAQ,CAACI,GAAT;AAEAJ,IAAAA,QAAQ,GAAG3B,MAAM,CAAC4B,aAAP,CAAsB,gCAAtB,EAAuD;AAChEJ,MAAAA,UAAU,EAAEJ;AADoD,KAAvD,CAAX;AAGAO,IAAAA,QAAQ,CAACE,KAAT;AACA,UAAM3B,SAAS,CAACgB,OAAD,EAAUS,QAAV,CAAT,CAA6BG,KAA7B,CAAmCjB,GAAG,IAAI;AAC9CF,MAAAA,aAAa,CACXX,MAAM,CAACgC,WAAY;;;;OADR,EAMXnB,GANW,CAAb;AAQD,KATK,CAAN;AAUAc,IAAAA,QAAQ,CAACI,GAAT;AAEA,UAAM1B,aAAa,CAAE,aAAF,EAAgB;AACjCqB,MAAAA,OAAO,EAAED,aADwB;AAEjCD,MAAAA,UAAU,EAAEJ;AAFqB,KAAhB,CAAnB;AAKApB,IAAAA,MAAM,CAACiC,IAAP,CAAa,oBAAmBC,OAAO,CAACC,MAAR,EAAiB,MAAjD;AAEAf,IAAAA,SAAS,CAACgB,MAAV;AAEA,UAAM5B,UAAU,EAAhB;AACD,GAzDD;;AAAA,kBAAgC6B,KAAhC;AAAA;AAAA;AAAA","sourcesContent":["/* @flow */\n\nconst report = require(`gatsby-cli/lib/reporter`)\nconst buildHTML = require(`./build-html`)\nconst buildProductionBundle = require(`./build-javascript`)\nconst bootstrap = require(`../bootstrap`)\nconst apiRunnerNode = require(`../utils/api-runner-node`)\nconst copyStaticDirectory = require(`../utils/copy-static-directory`)\nconst { initTracer, stopTracer } = require(`../utils/tracer`)\nconst tracer = require(`opentracing`).globalTracer()\n\nfunction reportFailure(msg, err: Error) {\n  report.log(``)\n  report.panic(msg, err)\n}\n\ntype BuildArgs = {\n  directory: string,\n  sitePackageJson: object,\n  prefixPaths: boolean,\n  noUglify: boolean,\n  openTracingConfigFile: string,\n}\n\nmodule.exports = async function build(program: BuildArgs) {\n  initTracer(program.openTracingConfigFile)\n\n  const buildSpan = tracer.startSpan(`build`)\n  buildSpan.setTag(`directory`, program.directory)\n\n  const { graphqlRunner } = await bootstrap({\n    ...program,\n    parentSpan: buildSpan,\n  })\n\n  await apiRunnerNode(`onPreBuild`, {\n    graphql: graphqlRunner,\n    parentSpan: buildSpan,\n  })\n\n  // Copy files from the static directory to\n  // an equivalent static directory within public.\n  copyStaticDirectory()\n\n  let activity\n  activity = report.activityTimer(\n    `Building production JavaScript and CSS bundles`,\n    { parentSpan: buildSpan }\n  )\n  activity.start()\n  await buildProductionBundle(program).catch(err => {\n    reportFailure(`Generating JavaScript bundles failed`, err)\n  })\n  activity.end()\n\n  activity = report.activityTimer(`Building static HTML for pages`, {\n    parentSpan: buildSpan,\n  })\n  activity.start()\n  await buildHTML(program, activity).catch(err => {\n    reportFailure(\n      report.stripIndent`\n        Building static HTML for pages failed\n\n        See our docs page on debugging HTML builds for help https://goo.gl/yL9lND\n      `,\n      err\n    )\n  })\n  activity.end()\n\n  await apiRunnerNode(`onPostBuild`, {\n    graphql: graphqlRunner,\n    parentSpan: buildSpan,\n  })\n\n  report.info(`Done building in ${process.uptime()} sec`)\n\n  buildSpan.finish()\n\n  await stopTracer()\n}\n"],"file":"build.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/commands/build.js"],"names":["report","require","buildHTML","buildProductionBundle","bootstrap","apiRunnerNode","copyStaticDirectory","initTracer","stopTracer","tracer","globalTracer","reportFailure","msg","err","log","panic","module","exports","build","program","openTracingConfigFile","buildSpan","startSpan","setTag","directory","graphqlRunner","parentSpan","graphql","activity","activityTimer","start","catch","end","stripIndent","info","process","uptime","finish"],"mappings":";;AAEA,MAAMA,MAAM,GAAGC,OAAO,CAAE,yBAAF,CAAtB;;AACA,MAAMC,SAAS,GAAGD,OAAO,CAAE,cAAF,CAAzB;;AACA,MAAME,qBAAqB,GAAGF,OAAO,CAAE,oBAAF,CAArC;;AACA,MAAMG,SAAS,GAAGH,OAAO,CAAE,cAAF,CAAzB;;AACA,MAAMI,aAAa,GAAGJ,OAAO,CAAE,0BAAF,CAA7B;;AACA,MAAMK,mBAAmB,GAAGL,OAAO,CAAE,gCAAF,CAAnC;;AACA,MAAM;AAAEM,EAAAA,UAAF;AAAcC,EAAAA;AAAd,IAA6BP,OAAO,CAAE,iBAAF,CAA1C;;AACA,MAAMQ,MAAM,GAAGR,OAAO,CAAE,aAAF,CAAP,CAAuBS,YAAvB,EAAf;;AAEA,SAASC,aAAT,CAAuBC,GAAvB,EAA4BC,GAA5B,EAAwC;AACtCb,EAAAA,MAAM,CAACc,GAAP,CAAY,EAAZ;AACAd,EAAAA,MAAM,CAACe,KAAP,CAAaH,GAAb,EAAkBC,GAAlB;AACD;;AAUDG,MAAM,CAACC,OAAP,GAAiB,eAAeC,KAAf,CAAqBC,OAArB,EAAyC;AACxDZ,EAAAA,UAAU,CAACY,OAAO,CAACC,qBAAT,CAAV;AAEA,QAAMC,SAAS,GAAGZ,MAAM,CAACa,SAAP,CAAkB,OAAlB,CAAlB;AACAD,EAAAA,SAAS,CAACE,MAAV,CAAkB,WAAlB,EAA8BJ,OAAO,CAACK,SAAtC;AAEA,QAAM;AAAEC,IAAAA;AAAF,MAAoB,MAAMrB,SAAS,CAAC,EACxC,GAAGe,OADqC;AAExCO,IAAAA,UAAU,EAAEL;AAF4B,GAAD,CAAzC;AAKA,QAAMhB,aAAa,CAAE,YAAF,EAAe;AAChCsB,IAAAA,OAAO,EAAEF,aADuB;AAEhCC,IAAAA,UAAU,EAAEL;AAFoB,GAAf,CAAnB,CAXwD,CAgBxD;AACA;;AACAf,EAAAA,mBAAmB;AAEnB,MAAIsB,QAAJ;AACAA,EAAAA,QAAQ,GAAG5B,MAAM,CAAC6B,aAAP,CACR,gDADQ,EAET;AAAEH,IAAAA,UAAU,EAAEL;AAAd,GAFS,CAAX;AAIAO,EAAAA,QAAQ,CAACE,KAAT;AACA,QAAM3B,qBAAqB,CAACgB,OAAD,CAArB,CAA+BY,KAA/B,CAAqClB,GAAG,IAAI;AAChDF,IAAAA,aAAa,CAAE,sCAAF,EAAyCE,GAAzC,CAAb;AACD,GAFK,CAAN;AAGAe,EAAAA,QAAQ,CAACI,GAAT;AAEAJ,EAAAA,QAAQ,GAAG5B,MAAM,CAAC6B,aAAP,CAAsB,gCAAtB,EAAuD;AAChEH,IAAAA,UAAU,EAAEL;AADoD,GAAvD,CAAX;AAGAO,EAAAA,QAAQ,CAACE,KAAT;AACA,QAAM5B,SAAS,CAACiB,OAAD,EAAUS,QAAV,CAAT,CAA6BG,KAA7B,CAAmClB,GAAG,IAAI;AAC9CF,IAAAA,aAAa,CACXX,MAAM,CAACiC,WAAY;;;;OADR,EAMXpB,GANW,CAAb;AAQD,GATK,CAAN;AAUAe,EAAAA,QAAQ,CAACI,GAAT;AAEA,QAAM3B,aAAa,CAAE,aAAF,EAAgB;AACjCsB,IAAAA,OAAO,EAAEF,aADwB;AAEjCC,IAAAA,UAAU,EAAEL;AAFqB,GAAhB,CAAnB;AAKArB,EAAAA,MAAM,CAACkC,IAAP,CAAa,oBAAmBC,OAAO,CAACC,MAAR,EAAiB,MAAjD;AAEAf,EAAAA,SAAS,CAACgB,MAAV;AAEA,QAAM7B,UAAU,EAAhB;AACD,CAzDD","sourcesContent":["/* @flow */\n\nconst report = require(`gatsby-cli/lib/reporter`)\nconst buildHTML = require(`./build-html`)\nconst buildProductionBundle = require(`./build-javascript`)\nconst bootstrap = require(`../bootstrap`)\nconst apiRunnerNode = require(`../utils/api-runner-node`)\nconst copyStaticDirectory = require(`../utils/copy-static-directory`)\nconst { initTracer, stopTracer } = require(`../utils/tracer`)\nconst tracer = require(`opentracing`).globalTracer()\n\nfunction reportFailure(msg, err: Error) {\n  report.log(``)\n  report.panic(msg, err)\n}\n\ntype BuildArgs = {\n  directory: string,\n  sitePackageJson: object,\n  prefixPaths: boolean,\n  noUglify: boolean,\n  openTracingConfigFile: string,\n}\n\nmodule.exports = async function build(program: BuildArgs) {\n  initTracer(program.openTracingConfigFile)\n\n  const buildSpan = tracer.startSpan(`build`)\n  buildSpan.setTag(`directory`, program.directory)\n\n  const { graphqlRunner } = await bootstrap({\n    ...program,\n    parentSpan: buildSpan,\n  })\n\n  await apiRunnerNode(`onPreBuild`, {\n    graphql: graphqlRunner,\n    parentSpan: buildSpan,\n  })\n\n  // Copy files from the static directory to\n  // an equivalent static directory within public.\n  copyStaticDirectory()\n\n  let activity\n  activity = report.activityTimer(\n    `Building production JavaScript and CSS bundles`,\n    { parentSpan: buildSpan }\n  )\n  activity.start()\n  await buildProductionBundle(program).catch(err => {\n    reportFailure(`Generating JavaScript bundles failed`, err)\n  })\n  activity.end()\n\n  activity = report.activityTimer(`Building static HTML for pages`, {\n    parentSpan: buildSpan,\n  })\n  activity.start()\n  await buildHTML(program, activity).catch(err => {\n    reportFailure(\n      report.stripIndent`\n        Building static HTML for pages failed\n\n        See our docs page on debugging HTML builds for help https://goo.gl/yL9lND\n      `,\n      err\n    )\n  })\n  activity.end()\n\n  await apiRunnerNode(`onPostBuild`, {\n    graphql: graphqlRunner,\n    parentSpan: buildSpan,\n  })\n\n  report.info(`Done building in ${process.uptime()} sec`)\n\n  buildSpan.finish()\n\n  await stopTracer()\n}\n"],"file":"build.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/commands/data-explorer.js
+++ b/node_modules/gatsby/dist/commands/data-explorer.js
@@ -1,39 +1,30 @@
 "use strict";
 
-var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
-
-var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
-
 const express = require(`express`);
 
 const graphqlHTTP = require(`express-graphql`);
 
-const _require = require(`../redux`),
-      store = _require.store;
+const {
+  store
+} = require(`../redux`);
 
 const bootstrap = require(`../bootstrap`);
 
-module.exports =
-/*#__PURE__*/
-function () {
-  var _ref = (0, _asyncToGenerator2.default)(function* (program) {
-    let port = program.port,
-        host = program.host;
-    port = typeof port === `string` ? parseInt(port, 10) : port; // bootstrap to ensure schema is in the store
-
-    yield bootstrap(program);
-    const schema = store.getState().schema;
-    const app = express();
-    app.use(`/`, graphqlHTTP({
-      schema,
-      graphiql: true
-    }));
-    console.log(`Gatsby data explorer running at`, `http://${host}:${port}`);
-    app.listen(port, host);
-  });
-
-  return function (_x) {
-    return _ref.apply(this, arguments);
-  };
-}();
+module.exports = async program => {
+  let {
+    port,
+    host
+  } = program;
+  port = typeof port === `string` ? parseInt(port, 10) : port; // bootstrap to ensure schema is in the store
+
+  await bootstrap(program);
+  const schema = store.getState().schema;
+  const app = express();
+  app.use(`/`, graphqlHTTP({
+    schema,
+    graphiql: true
+  }));
+  console.log(`Gatsby data explorer running at`, `http://${host}:${port}`);
+  app.listen(port, host);
+};
 //# sourceMappingURL=data-explorer.js.map
\ No newline at end of file
--- a/node_modules/gatsby/dist/commands/data-explorer.js.map
+++ b/node_modules/gatsby/dist/commands/data-explorer.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/commands/data-explorer.js"],"names":["express","require","graphqlHTTP","store","bootstrap","module","exports","program","port","host","parseInt","schema","getState","app","use","graphiql","console","log","listen"],"mappings":";;;;;;AAEA,MAAMA,OAAO,GAAGC,OAAO,CAAE,SAAF,CAAvB;;AACA,MAAMC,WAAW,GAAGD,OAAO,CAAE,iBAAF,CAA3B;;iBACkBA,OAAO,CAAE,UAAF,C;MAAjBE,K,YAAAA,K;;AACR,MAAMC,SAAS,GAAGH,OAAO,CAAE,cAAF,CAAzB;;AAEAI,MAAM,CAACC,OAAP;AAAA;AAAA;AAAA,6CAAiB,WAAOC,OAAP,EAAwB;AAAA,QACjCC,IADiC,GAClBD,OADkB,CACjCC,IADiC;AAAA,QAC3BC,IAD2B,GAClBF,OADkB,CAC3BE,IAD2B;AAEvCD,IAAAA,IAAI,GAAG,OAAOA,IAAP,KAAiB,QAAjB,GAA2BE,QAAQ,CAACF,IAAD,EAAO,EAAP,CAAnC,GAAgDA,IAAvD,CAFuC,CAIvC;;AACA,UAAMJ,SAAS,CAACG,OAAD,CAAf;AAEA,UAAMI,MAAM,GAAGR,KAAK,CAACS,QAAN,GAAiBD,MAAhC;AAEA,UAAME,GAAG,GAAGb,OAAO,EAAnB;AACAa,IAAAA,GAAG,CAACC,GAAJ,CACG,GADH,EAEEZ,WAAW,CAAC;AACVS,MAAAA,MADU;AAEVI,MAAAA,QAAQ,EAAE;AAFA,KAAD,CAFb;AAQAC,IAAAA,OAAO,CAACC,GAAR,CAAa,iCAAb,EAAgD,UAASR,IAAK,IAAGD,IAAK,EAAtE;AACAK,IAAAA,GAAG,CAACK,MAAJ,CAAWV,IAAX,EAAiBC,IAAjB;AACD,GApBD;;AAAA;AAAA;AAAA;AAAA","sourcesContent":["/* @flow */\n\nconst express = require(`express`)\nconst graphqlHTTP = require(`express-graphql`)\nconst { store } = require(`../redux`)\nconst bootstrap = require(`../bootstrap`)\n\nmodule.exports = async (program: any) => {\n  let { port, host } = program\n  port = typeof port === `string` ? parseInt(port, 10) : port\n\n  // bootstrap to ensure schema is in the store\n  await bootstrap(program)\n\n  const schema = store.getState().schema\n\n  const app = express()\n  app.use(\n    `/`,\n    graphqlHTTP({\n      schema,\n      graphiql: true,\n    })\n  )\n\n  console.log(`Gatsby data explorer running at`, `http://${host}:${port}`)\n  app.listen(port, host)\n}\n"],"file":"data-explorer.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/commands/data-explorer.js"],"names":["express","require","graphqlHTTP","store","bootstrap","module","exports","program","port","host","parseInt","schema","getState","app","use","graphiql","console","log","listen"],"mappings":";;AAEA,MAAMA,OAAO,GAAGC,OAAO,CAAE,SAAF,CAAvB;;AACA,MAAMC,WAAW,GAAGD,OAAO,CAAE,iBAAF,CAA3B;;AACA,MAAM;AAAEE,EAAAA;AAAF,IAAYF,OAAO,CAAE,UAAF,CAAzB;;AACA,MAAMG,SAAS,GAAGH,OAAO,CAAE,cAAF,CAAzB;;AAEAI,MAAM,CAACC,OAAP,GAAiB,MAAOC,OAAP,IAAwB;AACvC,MAAI;AAAEC,IAAAA,IAAF;AAAQC,IAAAA;AAAR,MAAiBF,OAArB;AACAC,EAAAA,IAAI,GAAG,OAAOA,IAAP,KAAiB,QAAjB,GAA2BE,QAAQ,CAACF,IAAD,EAAO,EAAP,CAAnC,GAAgDA,IAAvD,CAFuC,CAIvC;;AACA,QAAMJ,SAAS,CAACG,OAAD,CAAf;AAEA,QAAMI,MAAM,GAAGR,KAAK,CAACS,QAAN,GAAiBD,MAAhC;AAEA,QAAME,GAAG,GAAGb,OAAO,EAAnB;AACAa,EAAAA,GAAG,CAACC,GAAJ,CACG,GADH,EAEEZ,WAAW,CAAC;AACVS,IAAAA,MADU;AAEVI,IAAAA,QAAQ,EAAE;AAFA,GAAD,CAFb;AAQAC,EAAAA,OAAO,CAACC,GAAR,CAAa,iCAAb,EAAgD,UAASR,IAAK,IAAGD,IAAK,EAAtE;AACAK,EAAAA,GAAG,CAACK,MAAJ,CAAWV,IAAX,EAAiBC,IAAjB;AACD,CApBD","sourcesContent":["/* @flow */\n\nconst express = require(`express`)\nconst graphqlHTTP = require(`express-graphql`)\nconst { store } = require(`../redux`)\nconst bootstrap = require(`../bootstrap`)\n\nmodule.exports = async (program: any) => {\n  let { port, host } = program\n  port = typeof port === `string` ? parseInt(port, 10) : port\n\n  // bootstrap to ensure schema is in the store\n  await bootstrap(program)\n\n  const schema = store.getState().schema\n\n  const app = express()\n  app.use(\n    `/`,\n    graphqlHTTP({\n      schema,\n      graphiql: true,\n    })\n  )\n\n  console.log(`Gatsby data explorer running at`, `http://${host}:${port}`)\n  app.listen(port, host)\n}\n"],"file":"data-explorer.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/commands/develop-html.js
+++ b/node_modules/gatsby/dist/commands/develop-html.js
@@ -1,15 +1,12 @@
 "use strict";
 
-var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
-
-var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
-
 const fs = require(`fs`);
 
 const webpack = require(`webpack`);
 
-const _require = require(`gatsby-cli/lib/reporter/errors`),
-      createErrorFromString = _require.createErrorFromString;
+const {
+  createErrorFromString
+} = require(`gatsby-cli/lib/reporter/errors`);
 
 const debug = require(`debug`)(`gatsby:html`);
 
@@ -17,43 +14,37 @@ const webpackConfig = require(`../utils/webpack.config`);
 
 const renderHTMLQueue = require(`../utils/html-renderer-queue`);
 
-module.exports =
-/*#__PURE__*/
-function () {
-  var _ref = (0, _asyncToGenerator2.default)(function* (program) {
-    const directory = program.directory;
-    debug(`generating static HTML`); // Static site generation.
-
-    const compilerConfig = yield webpackConfig(program, directory, `develop-html`, null);
-    return new Promise((resolve, reject) => {
-      webpack(compilerConfig).run((e, stats) => {
-        if (e) {
-          return reject(e);
+module.exports = async program => {
+  const {
+    directory
+  } = program;
+  debug(`generating static HTML`); // Static site generation.
+
+  const compilerConfig = await webpackConfig(program, directory, `develop-html`, null);
+  return new Promise((resolve, reject) => {
+    webpack(compilerConfig).run((e, stats) => {
+      if (e) {
+        return reject(e);
+      }
+
+      const outputFile = `${directory}/public/render-page.js`;
+
+      if (stats.hasErrors()) {
+        let webpackErrors = stats.toJson().errors;
+        console.log(`here`, webpackErrors[0]);
+        return reject(createErrorFromString(webpackErrors[0], `${outputFile}.map`));
+      }
+
+      return renderHTMLQueue(outputFile, [`/`]).then(() => {
+        // Remove the temp JS bundle file built for the static-site-generator-plugin
+        try {
+          fs.unlinkSync(outputFile);
+        } catch (e) {// This function will fail on Windows with no further consequences.
         }
 
-        const outputFile = `${directory}/public/render-page.js`;
-
-        if (stats.hasErrors()) {
-          let webpackErrors = stats.toJson().errors;
-          console.log(`here`, webpackErrors[0]);
-          return reject(createErrorFromString(webpackErrors[0], `${outputFile}.map`));
-        }
-
-        return renderHTMLQueue(outputFile, [`/`]).then(() => {
-          // Remove the temp JS bundle file built for the static-site-generator-plugin
-          try {
-            fs.unlinkSync(outputFile);
-          } catch (e) {// This function will fail on Windows with no further consequences.
-          }
-
-          return resolve(null, stats);
-        });
+        return resolve(null, stats);
       });
     });
   });
-
-  return function (_x) {
-    return _ref.apply(this, arguments);
-  };
-}();
+};
 //# sourceMappingURL=develop-html.js.map
\ No newline at end of file
--- a/node_modules/gatsby/dist/commands/develop-html.js.map
+++ b/node_modules/gatsby/dist/commands/develop-html.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/commands/develop-html.js"],"names":["fs","require","webpack","createErrorFromString","debug","webpackConfig","renderHTMLQueue","module","exports","program","directory","compilerConfig","Promise","resolve","reject","run","e","stats","outputFile","hasErrors","webpackErrors","toJson","errors","console","log","then","unlinkSync"],"mappings":";;;;;;AACA,MAAMA,EAAE,GAAGC,OAAO,CAAE,IAAF,CAAlB;;AACA,MAAMC,OAAO,GAAGD,OAAO,CAAE,SAAF,CAAvB;;iBACkCA,OAAO,CAAE,gCAAF,C;MAAjCE,qB,YAAAA,qB;;AACR,MAAMC,KAAK,GAAGH,OAAO,CAAE,OAAF,CAAP,CAAkB,aAAlB,CAAd;;AACA,MAAMI,aAAa,GAAGJ,OAAO,CAAE,yBAAF,CAA7B;;AACA,MAAMK,eAAe,GAAGL,OAAO,CAAE,8BAAF,CAA/B;;AAEAM,MAAM,CAACC,OAAP;AAAA;AAAA;AAAA,6CAAiB,WAAOC,OAAP,EAAwB;AAAA,UAC/BC,SAD+B,GACjBD,OADiB,CAC/BC,SAD+B;AAGvCN,IAAAA,KAAK,CAAE,wBAAF,CAAL,CAHuC,CAKvC;;AACA,UAAMO,cAAc,SAASN,aAAa,CACxCI,OADwC,EAExCC,SAFwC,EAGvC,cAHuC,EAIxC,IAJwC,CAA1C;AAOA,WAAO,IAAIE,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtCZ,MAAAA,OAAO,CAACS,cAAD,CAAP,CAAwBI,GAAxB,CAA4B,CAACC,CAAD,EAAIC,KAAJ,KAAc;AACxC,YAAID,CAAJ,EAAO;AACL,iBAAOF,MAAM,CAACE,CAAD,CAAb;AACD;;AACD,cAAME,UAAU,GAAI,GAAER,SAAU,wBAAhC;;AACA,YAAIO,KAAK,CAACE,SAAN,EAAJ,EAAuB;AACrB,cAAIC,aAAa,GAAGH,KAAK,CAACI,MAAN,GAAeC,MAAnC;AACAC,UAAAA,OAAO,CAACC,GAAR,CAAa,MAAb,EAAoBJ,aAAa,CAAC,CAAD,CAAjC;AACA,iBAAON,MAAM,CACXX,qBAAqB,CAACiB,aAAa,CAAC,CAAD,CAAd,EAAoB,GAAEF,UAAW,MAAjC,CADV,CAAb;AAGD;;AAED,eAAOZ,eAAe,CAACY,UAAD,EAAa,CAAE,GAAF,CAAb,CAAf,CAAmCO,IAAnC,CAAwC,MAAM;AACnD;AACA,cAAI;AACFzB,YAAAA,EAAE,CAAC0B,UAAH,CAAcR,UAAd;AACD,WAFD,CAEE,OAAOF,CAAP,EAAU,CACV;AACD;;AAED,iBAAOH,OAAO,CAAC,IAAD,EAAOI,KAAP,CAAd;AACD,SATM,CAAP;AAUD,OAvBD;AAwBD,KAzBM,CAAP;AA0BD,GAvCD;;AAAA;AAAA;AAAA;AAAA","sourcesContent":["/* @flow */\nconst fs = require(`fs`)\nconst webpack = require(`webpack`)\nconst { createErrorFromString } = require(`gatsby-cli/lib/reporter/errors`)\nconst debug = require(`debug`)(`gatsby:html`)\nconst webpackConfig = require(`../utils/webpack.config`)\nconst renderHTMLQueue = require(`../utils/html-renderer-queue`)\n\nmodule.exports = async (program: any) => {\n  const { directory } = program\n\n  debug(`generating static HTML`)\n\n  // Static site generation.\n  const compilerConfig = await webpackConfig(\n    program,\n    directory,\n    `develop-html`,\n    null\n  )\n\n  return new Promise((resolve, reject) => {\n    webpack(compilerConfig).run((e, stats) => {\n      if (e) {\n        return reject(e)\n      }\n      const outputFile = `${directory}/public/render-page.js`\n      if (stats.hasErrors()) {\n        let webpackErrors = stats.toJson().errors\n        console.log(`here`, webpackErrors[0])\n        return reject(\n          createErrorFromString(webpackErrors[0], `${outputFile}.map`)\n        )\n      }\n\n      return renderHTMLQueue(outputFile, [`/`]).then(() => {\n        // Remove the temp JS bundle file built for the static-site-generator-plugin\n        try {\n          fs.unlinkSync(outputFile)\n        } catch (e) {\n          // This function will fail on Windows with no further consequences.\n        }\n\n        return resolve(null, stats)\n      })\n    })\n  })\n}\n"],"file":"develop-html.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/commands/develop-html.js"],"names":["fs","require","webpack","createErrorFromString","debug","webpackConfig","renderHTMLQueue","module","exports","program","directory","compilerConfig","Promise","resolve","reject","run","e","stats","outputFile","hasErrors","webpackErrors","toJson","errors","console","log","then","unlinkSync"],"mappings":";;AACA,MAAMA,EAAE,GAAGC,OAAO,CAAE,IAAF,CAAlB;;AACA,MAAMC,OAAO,GAAGD,OAAO,CAAE,SAAF,CAAvB;;AACA,MAAM;AAAEE,EAAAA;AAAF,IAA4BF,OAAO,CAAE,gCAAF,CAAzC;;AACA,MAAMG,KAAK,GAAGH,OAAO,CAAE,OAAF,CAAP,CAAkB,aAAlB,CAAd;;AACA,MAAMI,aAAa,GAAGJ,OAAO,CAAE,yBAAF,CAA7B;;AACA,MAAMK,eAAe,GAAGL,OAAO,CAAE,8BAAF,CAA/B;;AAEAM,MAAM,CAACC,OAAP,GAAiB,MAAOC,OAAP,IAAwB;AACvC,QAAM;AAAEC,IAAAA;AAAF,MAAgBD,OAAtB;AAEAL,EAAAA,KAAK,CAAE,wBAAF,CAAL,CAHuC,CAKvC;;AACA,QAAMO,cAAc,GAAG,MAAMN,aAAa,CACxCI,OADwC,EAExCC,SAFwC,EAGvC,cAHuC,EAIxC,IAJwC,CAA1C;AAOA,SAAO,IAAIE,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtCZ,IAAAA,OAAO,CAACS,cAAD,CAAP,CAAwBI,GAAxB,CAA4B,CAACC,CAAD,EAAIC,KAAJ,KAAc;AACxC,UAAID,CAAJ,EAAO;AACL,eAAOF,MAAM,CAACE,CAAD,CAAb;AACD;;AACD,YAAME,UAAU,GAAI,GAAER,SAAU,wBAAhC;;AACA,UAAIO,KAAK,CAACE,SAAN,EAAJ,EAAuB;AACrB,YAAIC,aAAa,GAAGH,KAAK,CAACI,MAAN,GAAeC,MAAnC;AACAC,QAAAA,OAAO,CAACC,GAAR,CAAa,MAAb,EAAoBJ,aAAa,CAAC,CAAD,CAAjC;AACA,eAAON,MAAM,CACXX,qBAAqB,CAACiB,aAAa,CAAC,CAAD,CAAd,EAAoB,GAAEF,UAAW,MAAjC,CADV,CAAb;AAGD;;AAED,aAAOZ,eAAe,CAACY,UAAD,EAAa,CAAE,GAAF,CAAb,CAAf,CAAmCO,IAAnC,CAAwC,MAAM;AACnD;AACA,YAAI;AACFzB,UAAAA,EAAE,CAAC0B,UAAH,CAAcR,UAAd;AACD,SAFD,CAEE,OAAOF,CAAP,EAAU,CACV;AACD;;AAED,eAAOH,OAAO,CAAC,IAAD,EAAOI,KAAP,CAAd;AACD,OATM,CAAP;AAUD,KAvBD;AAwBD,GAzBM,CAAP;AA0BD,CAvCD","sourcesContent":["/* @flow */\nconst fs = require(`fs`)\nconst webpack = require(`webpack`)\nconst { createErrorFromString } = require(`gatsby-cli/lib/reporter/errors`)\nconst debug = require(`debug`)(`gatsby:html`)\nconst webpackConfig = require(`../utils/webpack.config`)\nconst renderHTMLQueue = require(`../utils/html-renderer-queue`)\n\nmodule.exports = async (program: any) => {\n  const { directory } = program\n\n  debug(`generating static HTML`)\n\n  // Static site generation.\n  const compilerConfig = await webpackConfig(\n    program,\n    directory,\n    `develop-html`,\n    null\n  )\n\n  return new Promise((resolve, reject) => {\n    webpack(compilerConfig).run((e, stats) => {\n      if (e) {\n        return reject(e)\n      }\n      const outputFile = `${directory}/public/render-page.js`\n      if (stats.hasErrors()) {\n        let webpackErrors = stats.toJson().errors\n        console.log(`here`, webpackErrors[0])\n        return reject(\n          createErrorFromString(webpackErrors[0], `${outputFile}.map`)\n        )\n      }\n\n      return renderHTMLQueue(outputFile, [`/`]).then(() => {\n        // Remove the temp JS bundle file built for the static-site-generator-plugin\n        try {\n          fs.unlinkSync(outputFile)\n        } catch (e) {\n          // This function will fail on Windows with no further consequences.\n        }\n\n        return resolve(null, stats)\n      })\n    })\n  })\n}\n"],"file":"develop-html.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/commands/develop.js
+++ b/node_modules/gatsby/dist/commands/develop.js
@@ -1,9 +1,5 @@
 "use strict";
 
-var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
-
-var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
-
 const url = require(`url`);
 
 const glob = require(`glob`);
@@ -28,15 +24,17 @@ const webpackConfig = require(`../utils/webpack.config`);
 
 const bootstrap = require(`../bootstrap`);
 
-const _require = require(`../redux`),
-      store = _require.store;
+const {
+  store
+} = require(`../redux`);
 
 const copyStaticDirectory = require(`../utils/copy-static-directory`);
 
 const developHtml = require(`./develop-html`);
 
-const _require2 = require(`../utils/path`),
-      withBasePath = _require2.withBasePath;
+const {
+  withBasePath
+} = require(`../utils/path`);
 
 const report = require(`gatsby-cli/lib/reporter`);
 
@@ -56,8 +54,9 @@ const getSslCert = require(`../utils/get-ssl-cert`);
 
 const slash = require(`slash`);
 
-const _require3 = require(`../utils/tracer`),
-      initTracer = _require3.initTracer;
+const {
+  initTracer
+} = require(`../utils/tracer`);
 
 const apiRunnerNode = require(`../utils/api-runner-node`); // const isInteractive = process.stdout.isTTY
 // Watch the static directory and copy files to public as they're added or
@@ -77,377 +76,366 @@ rlInterface.on(`SIGINT`, () => {
   process.exit();
 });
 
-function startServer(_x) {
-  return _startServer.apply(this, arguments);
-}
+async function startServer(program) {
+  const directory = program.directory;
+  const directoryPath = withBasePath(directory);
 
-function _startServer() {
-  _startServer = (0, _asyncToGenerator2.default)(function* (program) {
-    const directory = program.directory;
-    const directoryPath = withBasePath(directory);
-
-    const createIndexHtml = () => developHtml(program).catch(err => {
-      if (err.name !== `WebpackError`) {
-        report.panic(err);
-        return;
-      }
+  const createIndexHtml = () => developHtml(program).catch(err => {
+    if (err.name !== `WebpackError`) {
+      report.panic(err);
+      return;
+    }
 
-      report.panic(report.stripIndent`
+    report.panic(report.stripIndent`
           There was an error compiling the html.js component for the development server.
 
           See our docs page on debugging HTML builds for help https://goo.gl/yL9lND
         `, err);
-    }); // Start bootstrap process.
-
-
-    yield bootstrap(program);
-    yield createIndexHtml();
-    const devConfig = yield webpackConfig(program, directory, `develop`, program.port);
-    const compiler = webpack(devConfig);
-    /**
-     * Set up the express app.
-     **/
-
-    const app = express();
-    app.use(require(`webpack-hot-middleware`)(compiler, {
-      log: false,
-      path: `/__webpack_hmr`,
-      heartbeat: 10 * 1000
-    }));
-    app.use(`/___graphql`, graphqlHTTP({
-      schema: store.getState().schema,
-      graphiql: true
-    })); // Allow requests from any origin. Avoids CORS issues when using the `--host` flag.
-
-    app.use((req, res, next) => {
-      res.header(`Access-Control-Allow-Origin`, `*`);
-      res.header(`Access-Control-Allow-Headers`, `Origin, X-Requested-With, Content-Type, Accept`);
-      next();
-    });
-    /**
-     * Refresh external data sources.
-     * This behavior is disabled by default, but the ENABLE_REFRESH_ENDPOINT env var enables it
-     * If no GATSBY_REFRESH_TOKEN env var is available, then no Authorization header is required
-     **/
-
-    app.post(`/__refresh`, (req, res) => {
-      const enableRefresh = process.env.ENABLE_GATSBY_REFRESH_ENDPOINT;
-      const refreshToken = process.env.GATSBY_REFRESH_TOKEN;
-      const authorizedRefresh = !refreshToken || req.headers.authorization === refreshToken;
-
-      if (enableRefresh && authorizedRefresh) {
-        console.log(`Refreshing source data`);
-        sourceNodes();
-      }
+  }); // Start bootstrap process.
+
+
+  await bootstrap(program);
+  await createIndexHtml();
+  const devConfig = await webpackConfig(program, directory, `develop`, program.port);
+  const compiler = webpack(devConfig);
+  /**
+   * Set up the express app.
+   **/
+
+  const app = express();
+  app.use(require(`webpack-hot-middleware`)(compiler, {
+    log: false,
+    path: `/__webpack_hmr`,
+    heartbeat: 10 * 1000
+  }));
+  app.use(`/___graphql`, graphqlHTTP({
+    schema: store.getState().schema,
+    graphiql: true
+  })); // Allow requests from any origin. Avoids CORS issues when using the `--host` flag.
+
+  app.use((req, res, next) => {
+    res.header(`Access-Control-Allow-Origin`, `*`);
+    res.header(`Access-Control-Allow-Headers`, `Origin, X-Requested-With, Content-Type, Accept`);
+    next();
+  });
+  /**
+   * Refresh external data sources.
+   * This behavior is disabled by default, but the ENABLE_REFRESH_ENDPOINT env var enables it
+   * If no GATSBY_REFRESH_TOKEN env var is available, then no Authorization header is required
+   **/
+
+  app.post(`/__refresh`, (req, res) => {
+    const enableRefresh = process.env.ENABLE_GATSBY_REFRESH_ENDPOINT;
+    const refreshToken = process.env.GATSBY_REFRESH_TOKEN;
+    const authorizedRefresh = !refreshToken || req.headers.authorization === refreshToken;
+
+    if (enableRefresh && authorizedRefresh) {
+      console.log(`Refreshing source data`);
+      sourceNodes();
+    }
 
-      res.end();
-    });
-    app.get(`/__open-stack-frame-in-editor`, (req, res) => {
-      launchEditor(req.query.fileName, req.query.lineNumber);
-      res.end();
+    res.end();
+  });
+  app.get(`/__open-stack-frame-in-editor`, (req, res) => {
+    launchEditor(req.query.fileName, req.query.lineNumber);
+    res.end();
+  });
+  app.use(express.static(`public`));
+  app.use(require(`webpack-dev-middleware`)(compiler, {
+    logLevel: `trace`,
+    publicPath: devConfig.output.publicPath,
+    stats: `errors-only`
+  })); // Expose access to app for advanced use cases
+
+  const {
+    developMiddleware
+  } = store.getState().config;
+
+  if (developMiddleware) {
+    developMiddleware(app);
+  } // Set up API proxy.
+
+
+  const {
+    proxy
+  } = store.getState().config;
+
+  if (proxy) {
+    const {
+      prefix,
+      url
+    } = proxy;
+    app.use(`${prefix}/*`, (req, res) => {
+      const proxiedUrl = url + req.originalUrl;
+      req.pipe(request(proxiedUrl).on(`error`, err => {
+        const message = `Error when trying to proxy request "${req.originalUrl}" to "${proxiedUrl}"`;
+        report.error(message, err);
+        res.status(500).end();
+      })).pipe(res);
     });
-    app.use(express.static(`public`));
-    app.use(require(`webpack-dev-middleware`)(compiler, {
-      logLevel: `trace`,
-      publicPath: devConfig.output.publicPath,
-      stats: `errors-only`
-    })); // Expose access to app for advanced use cases
-
-    const developMiddleware = store.getState().config.developMiddleware;
-
-    if (developMiddleware) {
-      developMiddleware(app);
-    } // Set up API proxy.
-
-
-    const proxy = store.getState().config.proxy;
-
-    if (proxy) {
-      const prefix = proxy.prefix,
-            url = proxy.url;
-      app.use(`${prefix}/*`, (req, res) => {
-        const proxiedUrl = url + req.originalUrl;
-        req.pipe(request(proxiedUrl).on(`error`, err => {
-          const message = `Error when trying to proxy request "${req.originalUrl}" to "${proxiedUrl}"`;
-          report.error(message, err);
+  }
+
+  await apiRunnerNode(`onCreateDevServer`, {
+    app
+  }); // Render an HTML page and serve it.
+
+  app.use((req, res, next) => {
+    const parsedPath = parsePath(req.path);
+
+    if (parsedPath.extname === `` || parsedPath.extname.startsWith(`.html`) || parsedPath.path.endsWith(`/`)) {
+      res.sendFile(directoryPath(`public/index.html`), err => {
+        if (err) {
           res.status(500).end();
-        })).pipe(res);
+        }
       });
+    } else {
+      next();
     }
+  });
+  /**
+   * Set up the HTTP server and socket.io.
+   **/
 
-    yield apiRunnerNode(`onCreateDevServer`, {
-      app
-    }); // Render an HTML page and serve it.
-
-    app.use((req, res, next) => {
-      const parsedPath = parsePath(req.path);
+  let server = require(`http`).Server(app); // If a SSL cert exists in program, use it with `createServer`.
 
-      if (parsedPath.extname === `` || parsedPath.extname.startsWith(`.html`) || parsedPath.path.endsWith(`/`)) {
-        res.sendFile(directoryPath(`public/index.html`), err => {
-          if (err) {
-            res.status(500).end();
-          }
-        });
-      } else {
-        next();
-      }
-    });
-    /**
-     * Set up the HTTP server and socket.io.
-     **/
 
-    let server = require(`http`).Server(app); // If a SSL cert exists in program, use it with `createServer`.
+  if (program.ssl) {
+    server = require(`https`).createServer(program.ssl, app);
+  }
 
+  websocketManager.init({
+    server,
+    directory: program.directory
+  });
+  const socket = websocketManager.getSocket();
+  const listener = server.listen(program.port, program.host, err => {
+    if (err) {
+      if (err.code === `EADDRINUSE`) {
+        // eslint-disable-next-line max-len
+        report.panic(`Unable to start Gatsby on port ${program.port} as there's already a process listening on that port.`);
+        return;
+      }
 
-    if (program.ssl) {
-      server = require(`https`).createServer(program.ssl, app);
+      report.panic(`There was a problem starting the development server`, err);
     }
+  }); // Register watcher that rebuilds index.html every time html.js changes.
 
-    websocketManager.init({
-      server,
-      directory: program.directory
-    });
-    const socket = websocketManager.getSocket();
-    const listener = server.listen(program.port, program.host, err => {
-      if (err) {
-        if (err.code === `EADDRINUSE`) {
-          // eslint-disable-next-line max-len
-          report.panic(`Unable to start Gatsby on port ${program.port} as there's already a process listening on that port.`);
-          return;
-        }
-
-        report.panic(`There was a problem starting the development server`, err);
-      }
-    }); // Register watcher that rebuilds index.html every time html.js changes.
-
-    const watchGlobs = [`src/html.js`, `plugins/**/gatsby-ssr.js`].map(path => slash(directoryPath(path)));
-    chokidar.watch(watchGlobs).on(`change`,
-    /*#__PURE__*/
-    (0, _asyncToGenerator2.default)(function* () {
-      yield createIndexHtml();
-      socket.to(`clients`).emit(`reload`);
-    }));
-    return [compiler, listener];
+  const watchGlobs = [`src/html.js`, `plugins/**/gatsby-ssr.js`].map(path => slash(directoryPath(path)));
+  chokidar.watch(watchGlobs).on(`change`, async () => {
+    await createIndexHtml();
+    socket.to(`clients`).emit(`reload`);
   });
-  return _startServer.apply(this, arguments);
+  return [compiler, listener];
 }
 
-module.exports =
-/*#__PURE__*/
-function () {
-  var _ref = (0, _asyncToGenerator2.default)(function* (program) {
-    initTracer(program.openTracingConfigFile);
+module.exports = async program => {
+  initTracer(program.openTracingConfigFile);
 
-    const detect = require(`detect-port`);
+  const detect = require(`detect-port`);
 
-    const port = typeof program.port === `string` ? parseInt(program.port, 10) : program.port; // In order to enable custom ssl, --cert-file --key-file and -https flags must all be
-    // used together
+  const port = typeof program.port === `string` ? parseInt(program.port, 10) : program.port; // In order to enable custom ssl, --cert-file --key-file and -https flags must all be
+  // used together
 
-    if ((program[`cert-file`] || program[`key-file`]) && !program.https) {
-      report.panic(`for custom ssl --https, --cert-file, and --key-file must be used together`);
-    } // Check if https is enabled, then create or get SSL cert.
-    // Certs are named after `name` inside the project's package.json.
+  if ((program[`cert-file`] || program[`key-file`]) && !program.https) {
+    report.panic(`for custom ssl --https, --cert-file, and --key-file must be used together`);
+  } // Check if https is enabled, then create or get SSL cert.
+  // Certs are named after `name` inside the project's package.json.
 
 
-    if (program.https) {
-      program.ssl = yield getSslCert({
-        name: program.sitePackageJson.name,
-        certFile: program[`cert-file`],
-        keyFile: program[`key-file`],
-        directory: program.directory
-      });
-    }
+  if (program.https) {
+    program.ssl = await getSslCert({
+      name: program.sitePackageJson.name,
+      certFile: program[`cert-file`],
+      keyFile: program[`key-file`],
+      directory: program.directory
+    });
+  }
 
-    let compiler;
-    yield new Promise(resolve => {
-      detect(port, (err, _port) => {
-        if (err) {
-          report.panic(err);
-        }
+  let compiler;
+  await new Promise(resolve => {
+    detect(port, (err, _port) => {
+      if (err) {
+        report.panic(err);
+      }
+
+      if (port !== _port) {
+        // eslint-disable-next-line max-len
+        const question = `Something is already running at port ${port} \nWould you like to run the app at another port instead? [Y/n] `;
+        rlInterface.question(question, answer => {
+          if (answer.length === 0 || answer.match(/^yes|y$/i)) {
+            program.port = _port; // eslint-disable-line no-param-reassign
+          }
 
-        if (port !== _port) {
-          // eslint-disable-next-line max-len
-          const question = `Something is already running at port ${port} \nWould you like to run the app at another port instead? [Y/n] `;
-          rlInterface.question(question, answer => {
-            if (answer.length === 0 || answer.match(/^yes|y$/i)) {
-              program.port = _port; // eslint-disable-line no-param-reassign
-            }
-
-            startServer(program).then(([c, l]) => {
-              compiler = c;
-              resolve();
-            });
-          });
-        } else {
           startServer(program).then(([c, l]) => {
             compiler = c;
             resolve();
           });
-        }
-      });
+        });
+      } else {
+        startServer(program).then(([c, l]) => {
+          compiler = c;
+          resolve();
+        });
+      }
     });
+  });
 
-    function prepareUrls(protocol, host, port) {
-      const formatUrl = hostname => url.format({
-        protocol,
-        hostname,
-        port,
-        pathname: `/`
-      });
+  function prepareUrls(protocol, host, port) {
+    const formatUrl = hostname => url.format({
+      protocol,
+      hostname,
+      port,
+      pathname: `/`
+    });
 
-      const prettyPrintUrl = hostname => url.format({
-        protocol,
-        hostname,
-        port: chalk.bold(port),
-        pathname: `/`
-      });
+    const prettyPrintUrl = hostname => url.format({
+      protocol,
+      hostname,
+      port: chalk.bold(port),
+      pathname: `/`
+    });
 
-      const isUnspecifiedHost = host === `0.0.0.0` || host === `::`;
-      let lanUrlForConfig, lanUrlForTerminal;
-
-      if (isUnspecifiedHost) {
-        try {
-          // This can only return an IPv4 address
-          lanUrlForConfig = address.ip();
-
-          if (lanUrlForConfig) {
-            // Check if the address is a private ip
-            // https://en.wikipedia.org/wiki/Private_network#Private_IPv4_address_spaces
-            if (/^10[.]|^172[.](1[6-9]|2[0-9]|3[0-1])[.]|^192[.]168[.]/.test(lanUrlForConfig)) {
-              // Address is private, format it for later use
-              lanUrlForTerminal = prettyPrintUrl(lanUrlForConfig);
-            } else {
-              // Address is not private, so we will discard it
-              lanUrlForConfig = undefined;
-            }
+    const isUnspecifiedHost = host === `0.0.0.0` || host === `::`;
+    let lanUrlForConfig, lanUrlForTerminal;
+
+    if (isUnspecifiedHost) {
+      try {
+        // This can only return an IPv4 address
+        lanUrlForConfig = address.ip();
+
+        if (lanUrlForConfig) {
+          // Check if the address is a private ip
+          // https://en.wikipedia.org/wiki/Private_network#Private_IPv4_address_spaces
+          if (/^10[.]|^172[.](1[6-9]|2[0-9]|3[0-1])[.]|^192[.]168[.]/.test(lanUrlForConfig)) {
+            // Address is private, format it for later use
+            lanUrlForTerminal = prettyPrintUrl(lanUrlForConfig);
+          } else {
+            // Address is not private, so we will discard it
+            lanUrlForConfig = undefined;
           }
-        } catch (_e) {// ignored
         }
-      } // TODO collect errors (GraphQL + Webpack) in Redux so we
-      // can clear terminal and print them out on every compile.
-      // Borrow pretty printing code from webpack plugin.
-
-
-      const localUrlForTerminal = prettyPrintUrl(host);
-      const localUrlForBrowser = formatUrl(host);
-      return {
-        lanUrlForConfig,
-        lanUrlForTerminal,
-        localUrlForTerminal,
-        localUrlForBrowser
-      };
-    }
-
-    function printInstructions(appName, urls, useYarn) {
-      console.log();
-      console.log(`You can now view ${chalk.bold(appName)} in the browser.`);
-      console.log();
-
-      if (urls.lanUrlForTerminal) {
-        console.log(`  ${chalk.bold(`Local:`)}            ${urls.localUrlForTerminal}`);
-        console.log(`  ${chalk.bold(`On Your Network:`)}  ${urls.lanUrlForTerminal}`);
-      } else {
-        console.log(`  ${urls.localUrlForTerminal}`);
+      } catch (_e) {// ignored
       }
-
-      console.log();
-      console.log(`View GraphiQL, an in-browser IDE, to explore your site's data and schema`);
-      console.log();
-      console.log(`  ${urls.localUrlForTerminal}___graphql`);
-      console.log();
-      console.log(`Note that the development build is not optimized.`);
-      console.log(`To create a production build, use ` + `${chalk.cyan(`gatsby build`)}`);
-      console.log();
-    }
-
-    function printDeprecationWarnings() {
-      const deprecatedApis = [`boundActionCreators`, `pathContext`];
-      const fixMap = {
-        boundActionCreators: {
-          newName: `actions`,
-          docsLink: `https://gatsby.app/boundActionCreators`
-        },
-        pathContext: {
-          newName: `pageContext`,
-          docsLink: `https://gatsby.app/pathContext`
-        }
-      };
-      const deprecatedLocations = {};
-      deprecatedApis.forEach(api => deprecatedLocations[api] = []);
-      glob.sync(`{,!(node_modules|public)/**/}*.js`, {
-        nodir: true
-      }).forEach(file => {
-        const fileText = fs.readFileSync(file);
-        const matchingApis = deprecatedApis.filter(api => fileText.indexOf(api) !== -1);
-        matchingApis.forEach(api => deprecatedLocations[api].push(file));
-      });
-      deprecatedApis.forEach(api => {
-        if (deprecatedLocations[api].length) {
-          console.log(`%s %s %s %s`, chalk.cyan(api), chalk.yellow(`is deprecated. Please use`), chalk.cyan(fixMap[api].newName), chalk.yellow(`instead. For migration instructions, see ${fixMap[api].docsLink}\nCheck the following files:`));
-          console.log();
-          deprecatedLocations[api].forEach(file => console.log(file));
-          console.log();
-        }
-      });
+    } // TODO collect errors (GraphQL + Webpack) in Redux so we
+    // can clear terminal and print them out on every compile.
+    // Borrow pretty printing code from webpack plugin.
+
+
+    const localUrlForTerminal = prettyPrintUrl(host);
+    const localUrlForBrowser = formatUrl(host);
+    return {
+      lanUrlForConfig,
+      lanUrlForTerminal,
+      localUrlForTerminal,
+      localUrlForBrowser
+    };
+  }
+
+  function printInstructions(appName, urls, useYarn) {
+    console.log();
+    console.log(`You can now view ${chalk.bold(appName)} in the browser.`);
+    console.log();
+
+    if (urls.lanUrlForTerminal) {
+      console.log(`  ${chalk.bold(`Local:`)}            ${urls.localUrlForTerminal}`);
+      console.log(`  ${chalk.bold(`On Your Network:`)}  ${urls.lanUrlForTerminal}`);
+    } else {
+      console.log(`  ${urls.localUrlForTerminal}`);
     }
 
-    let isFirstCompile = true; // "done" event fires when Webpack has finished recompiling the bundle.
-    // Whether or not you have warnings or errors, you will get this event.
-
-    compiler.hooks.done.tapAsync(`print getsby instructions`, (stats, done) => {
-      // We have switched off the default Webpack output in WebpackDevServer
-      // options so we are going to "massage" the warnings and errors and present
-      // them in a readable focused way.
-      const messages = formatWebpackMessages(stats.toJson({}, true));
-      const urls = prepareUrls(program.ssl ? `https` : `http`, program.host, program.port);
-      const isSuccessful = !messages.errors.length; // if (isSuccessful) {
-      // console.log(chalk.green(`Compiled successfully!`))
-      // }
-      // if (isSuccessful && (isInteractive || isFirstCompile)) {
-
-      if (isSuccessful && isFirstCompile) {
-        printInstructions(program.sitePackageJson.name, urls, program.useYarn);
-        printDeprecationWarnings();
-
-        if (program.open) {
-          require(`opn`)(urls.localUrlForBrowser).catch(err => console.log(`${chalk.yellow(`warn`)} Browser not opened because no browser was found`));
-        }
+    console.log();
+    console.log(`View GraphiQL, an in-browser IDE, to explore your site's data and schema`);
+    console.log();
+    console.log(`  ${urls.localUrlForTerminal}___graphql`);
+    console.log();
+    console.log(`Note that the development build is not optimized.`);
+    console.log(`To create a production build, use ` + `${chalk.cyan(`gatsby build`)}`);
+    console.log();
+  }
+
+  function printDeprecationWarnings() {
+    const deprecatedApis = [`boundActionCreators`, `pathContext`];
+    const fixMap = {
+      boundActionCreators: {
+        newName: `actions`,
+        docsLink: `https://gatsby.app/boundActionCreators`
+      },
+      pathContext: {
+        newName: `pageContext`,
+        docsLink: `https://gatsby.app/pathContext`
       }
-
-      isFirstCompile = false; // If errors exist, only show errors.
-      // if (messages.errors.length) {
-      // // Only keep the first error. Others are often indicative
-      // // of the same problem, but confuse the reader with noise.
-      // if (messages.errors.length > 1) {
-      // messages.errors.length = 1
-      // }
-      // console.log(chalk.red("Failed to compile.\n"))
-      // console.log(messages.errors.join("\n\n"))
-      // return
-      // }
-      // Show warnings if no errors were found.
-      // if (messages.warnings.length) {
-      // console.log(chalk.yellow("Compiled with warnings.\n"))
-      // console.log(messages.warnings.join("\n\n"))
-      // // Teach some ESLint tricks.
-      // console.log(
-      // "\nSearch for the " +
-      // chalk.underline(chalk.yellow("keywords")) +
-      // " to learn more about each warning."
-      // )
-      // console.log(
-      // "To ignore, add " +
-      // chalk.cyan("// eslint-disable-next-line") +
-      // " to the line before.\n"
-      // )
-      // }
-
-      done();
+    };
+    const deprecatedLocations = {};
+    deprecatedApis.forEach(api => deprecatedLocations[api] = []);
+    glob.sync(`{,!(node_modules|public)/**/}*.js`, {
+      nodir: true
+    }).forEach(file => {
+      const fileText = fs.readFileSync(file);
+      const matchingApis = deprecatedApis.filter(api => fileText.indexOf(api) !== -1);
+      matchingApis.forEach(api => deprecatedLocations[api].push(file));
     });
-  });
+    deprecatedApis.forEach(api => {
+      if (deprecatedLocations[api].length) {
+        console.log(`%s %s %s %s`, chalk.cyan(api), chalk.yellow(`is deprecated. Please use`), chalk.cyan(fixMap[api].newName), chalk.yellow(`instead. For migration instructions, see ${fixMap[api].docsLink}\nCheck the following files:`));
+        console.log();
+        deprecatedLocations[api].forEach(file => console.log(file));
+        console.log();
+      }
+    });
+  }
+
+  let isFirstCompile = true; // "done" event fires when Webpack has finished recompiling the bundle.
+  // Whether or not you have warnings or errors, you will get this event.
+
+  compiler.hooks.done.tapAsync(`print getsby instructions`, (stats, done) => {
+    // We have switched off the default Webpack output in WebpackDevServer
+    // options so we are going to "massage" the warnings and errors and present
+    // them in a readable focused way.
+    const messages = formatWebpackMessages(stats.toJson({}, true));
+    const urls = prepareUrls(program.ssl ? `https` : `http`, program.host, program.port);
+    const isSuccessful = !messages.errors.length; // if (isSuccessful) {
+    // console.log(chalk.green(`Compiled successfully!`))
+    // }
+    // if (isSuccessful && (isInteractive || isFirstCompile)) {
+
+    if (isSuccessful && isFirstCompile) {
+      printInstructions(program.sitePackageJson.name, urls, program.useYarn);
+      printDeprecationWarnings();
+
+      if (program.open) {
+        require(`opn`)(urls.localUrlForBrowser).catch(err => console.log(`${chalk.yellow(`warn`)} Browser not opened because no browser was found`));
+      }
+    }
 
-  return function (_x2) {
-    return _ref.apply(this, arguments);
-  };
-}();
+    isFirstCompile = false; // If errors exist, only show errors.
+    // if (messages.errors.length) {
+    // // Only keep the first error. Others are often indicative
+    // // of the same problem, but confuse the reader with noise.
+    // if (messages.errors.length > 1) {
+    // messages.errors.length = 1
+    // }
+    // console.log(chalk.red("Failed to compile.\n"))
+    // console.log(messages.errors.join("\n\n"))
+    // return
+    // }
+    // Show warnings if no errors were found.
+    // if (messages.warnings.length) {
+    // console.log(chalk.yellow("Compiled with warnings.\n"))
+    // console.log(messages.warnings.join("\n\n"))
+    // // Teach some ESLint tricks.
+    // console.log(
+    // "\nSearch for the " +
+    // chalk.underline(chalk.yellow("keywords")) +
+    // " to learn more about each warning."
+    // )
+    // console.log(
+    // "To ignore, add " +
+    // chalk.cyan("// eslint-disable-next-line") +
+    // " to the line before.\n"
+    // )
+    // }
+
+    done();
+  });
+};
 //# sourceMappingURL=develop.js.map
\ No newline at end of file
--- a/node_modules/gatsby/dist/commands/develop.js.map
+++ b/node_modules/gatsby/dist/commands/develop.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/commands/develop.js"],"names":["url","require","glob","fs","chokidar","express","graphqlHTTP","parsePath","request","rl","webpack","webpackConfig","bootstrap","store","copyStaticDirectory","developHtml","withBasePath","report","launchEditor","formatWebpackMessages","chalk","address","sourceNodes","websocketManager","getSslCert","slash","initTracer","apiRunnerNode","setTimeout","rlInterface","createInterface","input","process","stdin","output","stdout","on","exit","startServer","program","directory","directoryPath","createIndexHtml","catch","err","name","panic","stripIndent","devConfig","port","compiler","app","use","log","path","heartbeat","schema","getState","graphiql","req","res","next","header","post","enableRefresh","env","ENABLE_GATSBY_REFRESH_ENDPOINT","refreshToken","GATSBY_REFRESH_TOKEN","authorizedRefresh","headers","authorization","console","end","get","query","fileName","lineNumber","static","logLevel","publicPath","stats","developMiddleware","config","proxy","prefix","proxiedUrl","originalUrl","pipe","message","error","status","parsedPath","extname","startsWith","endsWith","sendFile","server","Server","ssl","createServer","init","socket","getSocket","listener","listen","host","code","watchGlobs","map","watch","to","emit","module","exports","openTracingConfigFile","detect","parseInt","https","sitePackageJson","certFile","keyFile","Promise","resolve","_port","question","answer","length","match","then","c","l","prepareUrls","protocol","formatUrl","hostname","format","pathname","prettyPrintUrl","bold","isUnspecifiedHost","lanUrlForConfig","lanUrlForTerminal","ip","test","undefined","_e","localUrlForTerminal","localUrlForBrowser","printInstructions","appName","urls","useYarn","cyan","printDeprecationWarnings","deprecatedApis","fixMap","boundActionCreators","newName","docsLink","pathContext","deprecatedLocations","forEach","api","sync","nodir","file","fileText","readFileSync","matchingApis","filter","indexOf","push","yellow","isFirstCompile","hooks","done","tapAsync","messages","toJson","isSuccessful","errors","open"],"mappings":"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","sourcesContent":["/* @flow */\n\nconst url = require(`url`)\nconst glob = require(`glob`)\nconst fs = require(`fs`)\nconst chokidar = require(`chokidar`)\nconst express = require(`express`)\nconst graphqlHTTP = require(`express-graphql`)\nconst parsePath = require(`parse-filepath`)\nconst request = require(`request`)\nconst rl = require(`readline`)\nconst webpack = require(`webpack`)\nconst webpackConfig = require(`../utils/webpack.config`)\nconst bootstrap = require(`../bootstrap`)\nconst { store } = require(`../redux`)\nconst copyStaticDirectory = require(`../utils/copy-static-directory`)\nconst developHtml = require(`./develop-html`)\nconst { withBasePath } = require(`../utils/path`)\nconst report = require(`gatsby-cli/lib/reporter`)\nconst launchEditor = require(`react-dev-utils/launchEditor`)\nconst formatWebpackMessages = require(`react-dev-utils/formatWebpackMessages`)\nconst chalk = require(`chalk`)\nconst address = require(`address`)\nconst sourceNodes = require(`../utils/source-nodes`)\nconst websocketManager = require(`../utils/websocket-manager`)\nconst getSslCert = require(`../utils/get-ssl-cert`)\nconst slash = require(`slash`)\nconst { initTracer } = require(`../utils/tracer`)\nconst apiRunnerNode = require(`../utils/api-runner-node`)\n\n// const isInteractive = process.stdout.isTTY\n\n// Watch the static directory and copy files to public as they're added or\n// changed. Wait 10 seconds so copying doesn't interfer with the regular\n// bootstrap.\nsetTimeout(() => {\n  copyStaticDirectory()\n}, 10000)\n\nconst rlInterface = rl.createInterface({\n  input: process.stdin,\n  output: process.stdout,\n})\n\n// Quit immediately on hearing ctrl-c\nrlInterface.on(`SIGINT`, () => {\n  process.exit()\n})\n\nasync function startServer(program) {\n  const directory = program.directory\n  const directoryPath = withBasePath(directory)\n  const createIndexHtml = () =>\n    developHtml(program).catch(err => {\n      if (err.name !== `WebpackError`) {\n        report.panic(err)\n        return\n      }\n      report.panic(\n        report.stripIndent`\n          There was an error compiling the html.js component for the development server.\n\n          See our docs page on debugging HTML builds for help https://goo.gl/yL9lND\n        `,\n        err\n      )\n    })\n\n  // Start bootstrap process.\n  await bootstrap(program)\n\n  await createIndexHtml()\n\n  const devConfig = await webpackConfig(\n    program,\n    directory,\n    `develop`,\n    program.port\n  )\n\n  const compiler = webpack(devConfig)\n\n  /**\n   * Set up the express app.\n   **/\n  const app = express()\n  app.use(\n    require(`webpack-hot-middleware`)(compiler, {\n      log: false,\n      path: `/__webpack_hmr`,\n      heartbeat: 10 * 1000,\n    })\n  )\n  app.use(\n    `/___graphql`,\n    graphqlHTTP({\n      schema: store.getState().schema,\n      graphiql: true,\n    })\n  )\n\n  // Allow requests from any origin. Avoids CORS issues when using the `--host` flag.\n  app.use((req, res, next) => {\n    res.header(`Access-Control-Allow-Origin`, `*`)\n    res.header(\n      `Access-Control-Allow-Headers`,\n      `Origin, X-Requested-With, Content-Type, Accept`\n    )\n    next()\n  })\n\n  /**\n   * Refresh external data sources.\n   * This behavior is disabled by default, but the ENABLE_REFRESH_ENDPOINT env var enables it\n   * If no GATSBY_REFRESH_TOKEN env var is available, then no Authorization header is required\n   **/\n  app.post(`/__refresh`, (req, res) => {\n    const enableRefresh = process.env.ENABLE_GATSBY_REFRESH_ENDPOINT\n    const refreshToken = process.env.GATSBY_REFRESH_TOKEN\n    const authorizedRefresh =\n      !refreshToken || req.headers.authorization === refreshToken\n\n    if (enableRefresh && authorizedRefresh) {\n      console.log(`Refreshing source data`)\n      sourceNodes()\n    }\n    res.end()\n  })\n\n  app.get(`/__open-stack-frame-in-editor`, (req, res) => {\n    launchEditor(req.query.fileName, req.query.lineNumber)\n    res.end()\n  })\n\n  app.use(express.static(`public`))\n\n  app.use(\n    require(`webpack-dev-middleware`)(compiler, {\n      logLevel: `trace`,\n      publicPath: devConfig.output.publicPath,\n      stats: `errors-only`,\n    })\n  )\n\n  // Expose access to app for advanced use cases\n  const { developMiddleware } = store.getState().config\n\n  if (developMiddleware) {\n    developMiddleware(app)\n  }\n\n  // Set up API proxy.\n  const { proxy } = store.getState().config\n  if (proxy) {\n    const { prefix, url } = proxy\n    app.use(`${prefix}/*`, (req, res) => {\n      const proxiedUrl = url + req.originalUrl\n      req\n        .pipe(\n          request(proxiedUrl).on(`error`, err => {\n            const message = `Error when trying to proxy request \"${\n              req.originalUrl\n            }\" to \"${proxiedUrl}\"`\n\n            report.error(message, err)\n            res.status(500).end()\n          })\n        )\n        .pipe(res)\n    })\n  }\n\n  await apiRunnerNode(`onCreateDevServer`, { app })\n\n  // Render an HTML page and serve it.\n  app.use((req, res, next) => {\n    const parsedPath = parsePath(req.path)\n    if (\n      parsedPath.extname === `` ||\n      parsedPath.extname.startsWith(`.html`) ||\n      parsedPath.path.endsWith(`/`)\n    ) {\n      res.sendFile(directoryPath(`public/index.html`), err => {\n        if (err) {\n          res.status(500).end()\n        }\n      })\n    } else {\n      next()\n    }\n  })\n\n  /**\n   * Set up the HTTP server and socket.io.\n   **/\n  let server = require(`http`).Server(app)\n\n  // If a SSL cert exists in program, use it with `createServer`.\n  if (program.ssl) {\n    server = require(`https`).createServer(program.ssl, app)\n  }\n  websocketManager.init({ server, directory: program.directory })\n  const socket = websocketManager.getSocket()\n\n  const listener = server.listen(program.port, program.host, err => {\n    if (err) {\n      if (err.code === `EADDRINUSE`) {\n        // eslint-disable-next-line max-len\n        report.panic(\n          `Unable to start Gatsby on port ${\n            program.port\n          } as there's already a process listening on that port.`\n        )\n        return\n      }\n\n      report.panic(`There was a problem starting the development server`, err)\n    }\n  })\n\n  // Register watcher that rebuilds index.html every time html.js changes.\n  const watchGlobs = [`src/html.js`, `plugins/**/gatsby-ssr.js`].map(path =>\n    slash(directoryPath(path))\n  )\n\n  chokidar.watch(watchGlobs).on(`change`, async () => {\n    await createIndexHtml()\n    socket.to(`clients`).emit(`reload`)\n  })\n\n  return [compiler, listener]\n}\n\nmodule.exports = async (program: any) => {\n  initTracer(program.openTracingConfigFile)\n\n  const detect = require(`detect-port`)\n  const port =\n    typeof program.port === `string` ? parseInt(program.port, 10) : program.port\n\n  // In order to enable custom ssl, --cert-file --key-file and -https flags must all be\n  // used together\n  if ((program[`cert-file`] || program[`key-file`]) && !program.https) {\n    report.panic(\n      `for custom ssl --https, --cert-file, and --key-file must be used together`\n    )\n  }\n\n  // Check if https is enabled, then create or get SSL cert.\n  // Certs are named after `name` inside the project's package.json.\n  if (program.https) {\n    program.ssl = await getSslCert({\n      name: program.sitePackageJson.name,\n      certFile: program[`cert-file`],\n      keyFile: program[`key-file`],\n      directory: program.directory,\n    })\n  }\n\n  let compiler\n  await new Promise(resolve => {\n    detect(port, (err, _port) => {\n      if (err) {\n        report.panic(err)\n      }\n\n      if (port !== _port) {\n        // eslint-disable-next-line max-len\n        const question = `Something is already running at port ${port} \\nWould you like to run the app at another port instead? [Y/n] `\n\n        rlInterface.question(question, answer => {\n          if (answer.length === 0 || answer.match(/^yes|y$/i)) {\n            program.port = _port // eslint-disable-line no-param-reassign\n          }\n\n          startServer(program).then(([c, l]) => {\n            compiler = c\n            resolve()\n          })\n        })\n      } else {\n        startServer(program).then(([c, l]) => {\n          compiler = c\n          resolve()\n        })\n      }\n    })\n  })\n\n  function prepareUrls(protocol, host, port) {\n    const formatUrl = hostname =>\n      url.format({\n        protocol,\n        hostname,\n        port,\n        pathname: `/`,\n      })\n    const prettyPrintUrl = hostname =>\n      url.format({\n        protocol,\n        hostname,\n        port: chalk.bold(port),\n        pathname: `/`,\n      })\n\n    const isUnspecifiedHost = host === `0.0.0.0` || host === `::`\n    let lanUrlForConfig, lanUrlForTerminal\n    if (isUnspecifiedHost) {\n      try {\n        // This can only return an IPv4 address\n        lanUrlForConfig = address.ip()\n        if (lanUrlForConfig) {\n          // Check if the address is a private ip\n          // https://en.wikipedia.org/wiki/Private_network#Private_IPv4_address_spaces\n          if (\n            /^10[.]|^172[.](1[6-9]|2[0-9]|3[0-1])[.]|^192[.]168[.]/.test(\n              lanUrlForConfig\n            )\n          ) {\n            // Address is private, format it for later use\n            lanUrlForTerminal = prettyPrintUrl(lanUrlForConfig)\n          } else {\n            // Address is not private, so we will discard it\n            lanUrlForConfig = undefined\n          }\n        }\n      } catch (_e) {\n        // ignored\n      }\n    }\n    // TODO collect errors (GraphQL + Webpack) in Redux so we\n    // can clear terminal and print them out on every compile.\n    // Borrow pretty printing code from webpack plugin.\n    const localUrlForTerminal = prettyPrintUrl(host)\n    const localUrlForBrowser = formatUrl(host)\n    return {\n      lanUrlForConfig,\n      lanUrlForTerminal,\n      localUrlForTerminal,\n      localUrlForBrowser,\n    }\n  }\n\n  function printInstructions(appName, urls, useYarn) {\n    console.log()\n    console.log(`You can now view ${chalk.bold(appName)} in the browser.`)\n    console.log()\n\n    if (urls.lanUrlForTerminal) {\n      console.log(\n        `  ${chalk.bold(`Local:`)}            ${urls.localUrlForTerminal}`\n      )\n      console.log(\n        `  ${chalk.bold(`On Your Network:`)}  ${urls.lanUrlForTerminal}`\n      )\n    } else {\n      console.log(`  ${urls.localUrlForTerminal}`)\n    }\n\n    console.log()\n    console.log(\n      `View GraphiQL, an in-browser IDE, to explore your site's data and schema`\n    )\n    console.log()\n    console.log(`  ${urls.localUrlForTerminal}___graphql`)\n\n    console.log()\n    console.log(`Note that the development build is not optimized.`)\n    console.log(\n      `To create a production build, use ` + `${chalk.cyan(`gatsby build`)}`\n    )\n    console.log()\n  }\n\n  function printDeprecationWarnings() {\n    const deprecatedApis = [`boundActionCreators`, `pathContext`]\n    const fixMap = {\n      boundActionCreators: {\n        newName: `actions`,\n        docsLink: `https://gatsby.app/boundActionCreators`,\n      },\n      pathContext: {\n        newName: `pageContext`,\n        docsLink: `https://gatsby.app/pathContext`,\n      },\n    }\n    const deprecatedLocations = {}\n    deprecatedApis.forEach(api => (deprecatedLocations[api] = []))\n\n    glob\n      .sync(`{,!(node_modules|public)/**/}*.js`, { nodir: true })\n      .forEach(file => {\n        const fileText = fs.readFileSync(file)\n        const matchingApis = deprecatedApis.filter(\n          api => fileText.indexOf(api) !== -1\n        )\n        matchingApis.forEach(api => deprecatedLocations[api].push(file))\n      })\n\n    deprecatedApis.forEach(api => {\n      if (deprecatedLocations[api].length) {\n        console.log(\n          `%s %s %s %s`,\n          chalk.cyan(api),\n          chalk.yellow(`is deprecated. Please use`),\n          chalk.cyan(fixMap[api].newName),\n          chalk.yellow(\n            `instead. For migration instructions, see ${\n              fixMap[api].docsLink\n            }\\nCheck the following files:`\n          )\n        )\n        console.log()\n        deprecatedLocations[api].forEach(file => console.log(file))\n        console.log()\n      }\n    })\n  }\n\n  let isFirstCompile = true\n  // \"done\" event fires when Webpack has finished recompiling the bundle.\n  // Whether or not you have warnings or errors, you will get this event.\n  compiler.hooks.done.tapAsync(`print getsby instructions`, (stats, done) => {\n    // We have switched off the default Webpack output in WebpackDevServer\n    // options so we are going to \"massage\" the warnings and errors and present\n    // them in a readable focused way.\n    const messages = formatWebpackMessages(stats.toJson({}, true))\n    const urls = prepareUrls(\n      program.ssl ? `https` : `http`,\n      program.host,\n      program.port\n    )\n    const isSuccessful = !messages.errors.length\n    // if (isSuccessful) {\n    // console.log(chalk.green(`Compiled successfully!`))\n    // }\n    // if (isSuccessful && (isInteractive || isFirstCompile)) {\n    if (isSuccessful && isFirstCompile) {\n      printInstructions(program.sitePackageJson.name, urls, program.useYarn)\n      printDeprecationWarnings()\n      if (program.open) {\n        require(`opn`)(urls.localUrlForBrowser).catch(err =>\n          console.log(\n            `${chalk.yellow(\n              `warn`\n            )} Browser not opened because no browser was found`\n          )\n        )\n      }\n    }\n\n    isFirstCompile = false\n\n    // If errors exist, only show errors.\n    // if (messages.errors.length) {\n    // // Only keep the first error. Others are often indicative\n    // // of the same problem, but confuse the reader with noise.\n    // if (messages.errors.length > 1) {\n    // messages.errors.length = 1\n    // }\n    // console.log(chalk.red(\"Failed to compile.\\n\"))\n    // console.log(messages.errors.join(\"\\n\\n\"))\n    // return\n    // }\n\n    // Show warnings if no errors were found.\n    // if (messages.warnings.length) {\n    // console.log(chalk.yellow(\"Compiled with warnings.\\n\"))\n    // console.log(messages.warnings.join(\"\\n\\n\"))\n\n    // // Teach some ESLint tricks.\n    // console.log(\n    // \"\\nSearch for the \" +\n    // chalk.underline(chalk.yellow(\"keywords\")) +\n    // \" to learn more about each warning.\"\n    // )\n    // console.log(\n    // \"To ignore, add \" +\n    // chalk.cyan(\"// eslint-disable-next-line\") +\n    // \" to the line before.\\n\"\n    // )\n    // }\n\n    done()\n  })\n}\n"],"file":"develop.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/commands/develop.js"],"names":["url","require","glob","fs","chokidar","express","graphqlHTTP","parsePath","request","rl","webpack","webpackConfig","bootstrap","store","copyStaticDirectory","developHtml","withBasePath","report","launchEditor","formatWebpackMessages","chalk","address","sourceNodes","websocketManager","getSslCert","slash","initTracer","apiRunnerNode","setTimeout","rlInterface","createInterface","input","process","stdin","output","stdout","on","exit","startServer","program","directory","directoryPath","createIndexHtml","catch","err","name","panic","stripIndent","devConfig","port","compiler","app","use","log","path","heartbeat","schema","getState","graphiql","req","res","next","header","post","enableRefresh","env","ENABLE_GATSBY_REFRESH_ENDPOINT","refreshToken","GATSBY_REFRESH_TOKEN","authorizedRefresh","headers","authorization","console","end","get","query","fileName","lineNumber","static","logLevel","publicPath","stats","developMiddleware","config","proxy","prefix","proxiedUrl","originalUrl","pipe","message","error","status","parsedPath","extname","startsWith","endsWith","sendFile","server","Server","ssl","createServer","init","socket","getSocket","listener","listen","host","code","watchGlobs","map","watch","to","emit","module","exports","openTracingConfigFile","detect","parseInt","https","sitePackageJson","certFile","keyFile","Promise","resolve","_port","question","answer","length","match","then","c","l","prepareUrls","protocol","formatUrl","hostname","format","pathname","prettyPrintUrl","bold","isUnspecifiedHost","lanUrlForConfig","lanUrlForTerminal","ip","test","undefined","_e","localUrlForTerminal","localUrlForBrowser","printInstructions","appName","urls","useYarn","cyan","printDeprecationWarnings","deprecatedApis","fixMap","boundActionCreators","newName","docsLink","pathContext","deprecatedLocations","forEach","api","sync","nodir","file","fileText","readFileSync","matchingApis","filter","indexOf","push","yellow","isFirstCompile","hooks","done","tapAsync","messages","toJson","isSuccessful","errors","open"],"mappings":"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","sourcesContent":["/* @flow */\n\nconst url = require(`url`)\nconst glob = require(`glob`)\nconst fs = require(`fs`)\nconst chokidar = require(`chokidar`)\nconst express = require(`express`)\nconst graphqlHTTP = require(`express-graphql`)\nconst parsePath = require(`parse-filepath`)\nconst request = require(`request`)\nconst rl = require(`readline`)\nconst webpack = require(`webpack`)\nconst webpackConfig = require(`../utils/webpack.config`)\nconst bootstrap = require(`../bootstrap`)\nconst { store } = require(`../redux`)\nconst copyStaticDirectory = require(`../utils/copy-static-directory`)\nconst developHtml = require(`./develop-html`)\nconst { withBasePath } = require(`../utils/path`)\nconst report = require(`gatsby-cli/lib/reporter`)\nconst launchEditor = require(`react-dev-utils/launchEditor`)\nconst formatWebpackMessages = require(`react-dev-utils/formatWebpackMessages`)\nconst chalk = require(`chalk`)\nconst address = require(`address`)\nconst sourceNodes = require(`../utils/source-nodes`)\nconst websocketManager = require(`../utils/websocket-manager`)\nconst getSslCert = require(`../utils/get-ssl-cert`)\nconst slash = require(`slash`)\nconst { initTracer } = require(`../utils/tracer`)\nconst apiRunnerNode = require(`../utils/api-runner-node`)\n\n// const isInteractive = process.stdout.isTTY\n\n// Watch the static directory and copy files to public as they're added or\n// changed. Wait 10 seconds so copying doesn't interfer with the regular\n// bootstrap.\nsetTimeout(() => {\n  copyStaticDirectory()\n}, 10000)\n\nconst rlInterface = rl.createInterface({\n  input: process.stdin,\n  output: process.stdout,\n})\n\n// Quit immediately on hearing ctrl-c\nrlInterface.on(`SIGINT`, () => {\n  process.exit()\n})\n\nasync function startServer(program) {\n  const directory = program.directory\n  const directoryPath = withBasePath(directory)\n  const createIndexHtml = () =>\n    developHtml(program).catch(err => {\n      if (err.name !== `WebpackError`) {\n        report.panic(err)\n        return\n      }\n      report.panic(\n        report.stripIndent`\n          There was an error compiling the html.js component for the development server.\n\n          See our docs page on debugging HTML builds for help https://goo.gl/yL9lND\n        `,\n        err\n      )\n    })\n\n  // Start bootstrap process.\n  await bootstrap(program)\n\n  await createIndexHtml()\n\n  const devConfig = await webpackConfig(\n    program,\n    directory,\n    `develop`,\n    program.port\n  )\n\n  const compiler = webpack(devConfig)\n\n  /**\n   * Set up the express app.\n   **/\n  const app = express()\n  app.use(\n    require(`webpack-hot-middleware`)(compiler, {\n      log: false,\n      path: `/__webpack_hmr`,\n      heartbeat: 10 * 1000,\n    })\n  )\n  app.use(\n    `/___graphql`,\n    graphqlHTTP({\n      schema: store.getState().schema,\n      graphiql: true,\n    })\n  )\n\n  // Allow requests from any origin. Avoids CORS issues when using the `--host` flag.\n  app.use((req, res, next) => {\n    res.header(`Access-Control-Allow-Origin`, `*`)\n    res.header(\n      `Access-Control-Allow-Headers`,\n      `Origin, X-Requested-With, Content-Type, Accept`\n    )\n    next()\n  })\n\n  /**\n   * Refresh external data sources.\n   * This behavior is disabled by default, but the ENABLE_REFRESH_ENDPOINT env var enables it\n   * If no GATSBY_REFRESH_TOKEN env var is available, then no Authorization header is required\n   **/\n  app.post(`/__refresh`, (req, res) => {\n    const enableRefresh = process.env.ENABLE_GATSBY_REFRESH_ENDPOINT\n    const refreshToken = process.env.GATSBY_REFRESH_TOKEN\n    const authorizedRefresh =\n      !refreshToken || req.headers.authorization === refreshToken\n\n    if (enableRefresh && authorizedRefresh) {\n      console.log(`Refreshing source data`)\n      sourceNodes()\n    }\n    res.end()\n  })\n\n  app.get(`/__open-stack-frame-in-editor`, (req, res) => {\n    launchEditor(req.query.fileName, req.query.lineNumber)\n    res.end()\n  })\n\n  app.use(express.static(`public`))\n\n  app.use(\n    require(`webpack-dev-middleware`)(compiler, {\n      logLevel: `trace`,\n      publicPath: devConfig.output.publicPath,\n      stats: `errors-only`,\n    })\n  )\n\n  // Expose access to app for advanced use cases\n  const { developMiddleware } = store.getState().config\n\n  if (developMiddleware) {\n    developMiddleware(app)\n  }\n\n  // Set up API proxy.\n  const { proxy } = store.getState().config\n  if (proxy) {\n    const { prefix, url } = proxy\n    app.use(`${prefix}/*`, (req, res) => {\n      const proxiedUrl = url + req.originalUrl\n      req\n        .pipe(\n          request(proxiedUrl).on(`error`, err => {\n            const message = `Error when trying to proxy request \"${\n              req.originalUrl\n            }\" to \"${proxiedUrl}\"`\n\n            report.error(message, err)\n            res.status(500).end()\n          })\n        )\n        .pipe(res)\n    })\n  }\n\n  await apiRunnerNode(`onCreateDevServer`, { app })\n\n  // Render an HTML page and serve it.\n  app.use((req, res, next) => {\n    const parsedPath = parsePath(req.path)\n    if (\n      parsedPath.extname === `` ||\n      parsedPath.extname.startsWith(`.html`) ||\n      parsedPath.path.endsWith(`/`)\n    ) {\n      res.sendFile(directoryPath(`public/index.html`), err => {\n        if (err) {\n          res.status(500).end()\n        }\n      })\n    } else {\n      next()\n    }\n  })\n\n  /**\n   * Set up the HTTP server and socket.io.\n   **/\n  let server = require(`http`).Server(app)\n\n  // If a SSL cert exists in program, use it with `createServer`.\n  if (program.ssl) {\n    server = require(`https`).createServer(program.ssl, app)\n  }\n  websocketManager.init({ server, directory: program.directory })\n  const socket = websocketManager.getSocket()\n\n  const listener = server.listen(program.port, program.host, err => {\n    if (err) {\n      if (err.code === `EADDRINUSE`) {\n        // eslint-disable-next-line max-len\n        report.panic(\n          `Unable to start Gatsby on port ${\n            program.port\n          } as there's already a process listening on that port.`\n        )\n        return\n      }\n\n      report.panic(`There was a problem starting the development server`, err)\n    }\n  })\n\n  // Register watcher that rebuilds index.html every time html.js changes.\n  const watchGlobs = [`src/html.js`, `plugins/**/gatsby-ssr.js`].map(path =>\n    slash(directoryPath(path))\n  )\n\n  chokidar.watch(watchGlobs).on(`change`, async () => {\n    await createIndexHtml()\n    socket.to(`clients`).emit(`reload`)\n  })\n\n  return [compiler, listener]\n}\n\nmodule.exports = async (program: any) => {\n  initTracer(program.openTracingConfigFile)\n\n  const detect = require(`detect-port`)\n  const port =\n    typeof program.port === `string` ? parseInt(program.port, 10) : program.port\n\n  // In order to enable custom ssl, --cert-file --key-file and -https flags must all be\n  // used together\n  if ((program[`cert-file`] || program[`key-file`]) && !program.https) {\n    report.panic(\n      `for custom ssl --https, --cert-file, and --key-file must be used together`\n    )\n  }\n\n  // Check if https is enabled, then create or get SSL cert.\n  // Certs are named after `name` inside the project's package.json.\n  if (program.https) {\n    program.ssl = await getSslCert({\n      name: program.sitePackageJson.name,\n      certFile: program[`cert-file`],\n      keyFile: program[`key-file`],\n      directory: program.directory,\n    })\n  }\n\n  let compiler\n  await new Promise(resolve => {\n    detect(port, (err, _port) => {\n      if (err) {\n        report.panic(err)\n      }\n\n      if (port !== _port) {\n        // eslint-disable-next-line max-len\n        const question = `Something is already running at port ${port} \\nWould you like to run the app at another port instead? [Y/n] `\n\n        rlInterface.question(question, answer => {\n          if (answer.length === 0 || answer.match(/^yes|y$/i)) {\n            program.port = _port // eslint-disable-line no-param-reassign\n          }\n\n          startServer(program).then(([c, l]) => {\n            compiler = c\n            resolve()\n          })\n        })\n      } else {\n        startServer(program).then(([c, l]) => {\n          compiler = c\n          resolve()\n        })\n      }\n    })\n  })\n\n  function prepareUrls(protocol, host, port) {\n    const formatUrl = hostname =>\n      url.format({\n        protocol,\n        hostname,\n        port,\n        pathname: `/`,\n      })\n    const prettyPrintUrl = hostname =>\n      url.format({\n        protocol,\n        hostname,\n        port: chalk.bold(port),\n        pathname: `/`,\n      })\n\n    const isUnspecifiedHost = host === `0.0.0.0` || host === `::`\n    let lanUrlForConfig, lanUrlForTerminal\n    if (isUnspecifiedHost) {\n      try {\n        // This can only return an IPv4 address\n        lanUrlForConfig = address.ip()\n        if (lanUrlForConfig) {\n          // Check if the address is a private ip\n          // https://en.wikipedia.org/wiki/Private_network#Private_IPv4_address_spaces\n          if (\n            /^10[.]|^172[.](1[6-9]|2[0-9]|3[0-1])[.]|^192[.]168[.]/.test(\n              lanUrlForConfig\n            )\n          ) {\n            // Address is private, format it for later use\n            lanUrlForTerminal = prettyPrintUrl(lanUrlForConfig)\n          } else {\n            // Address is not private, so we will discard it\n            lanUrlForConfig = undefined\n          }\n        }\n      } catch (_e) {\n        // ignored\n      }\n    }\n    // TODO collect errors (GraphQL + Webpack) in Redux so we\n    // can clear terminal and print them out on every compile.\n    // Borrow pretty printing code from webpack plugin.\n    const localUrlForTerminal = prettyPrintUrl(host)\n    const localUrlForBrowser = formatUrl(host)\n    return {\n      lanUrlForConfig,\n      lanUrlForTerminal,\n      localUrlForTerminal,\n      localUrlForBrowser,\n    }\n  }\n\n  function printInstructions(appName, urls, useYarn) {\n    console.log()\n    console.log(`You can now view ${chalk.bold(appName)} in the browser.`)\n    console.log()\n\n    if (urls.lanUrlForTerminal) {\n      console.log(\n        `  ${chalk.bold(`Local:`)}            ${urls.localUrlForTerminal}`\n      )\n      console.log(\n        `  ${chalk.bold(`On Your Network:`)}  ${urls.lanUrlForTerminal}`\n      )\n    } else {\n      console.log(`  ${urls.localUrlForTerminal}`)\n    }\n\n    console.log()\n    console.log(\n      `View GraphiQL, an in-browser IDE, to explore your site's data and schema`\n    )\n    console.log()\n    console.log(`  ${urls.localUrlForTerminal}___graphql`)\n\n    console.log()\n    console.log(`Note that the development build is not optimized.`)\n    console.log(\n      `To create a production build, use ` + `${chalk.cyan(`gatsby build`)}`\n    )\n    console.log()\n  }\n\n  function printDeprecationWarnings() {\n    const deprecatedApis = [`boundActionCreators`, `pathContext`]\n    const fixMap = {\n      boundActionCreators: {\n        newName: `actions`,\n        docsLink: `https://gatsby.app/boundActionCreators`,\n      },\n      pathContext: {\n        newName: `pageContext`,\n        docsLink: `https://gatsby.app/pathContext`,\n      },\n    }\n    const deprecatedLocations = {}\n    deprecatedApis.forEach(api => (deprecatedLocations[api] = []))\n\n    glob\n      .sync(`{,!(node_modules|public)/**/}*.js`, { nodir: true })\n      .forEach(file => {\n        const fileText = fs.readFileSync(file)\n        const matchingApis = deprecatedApis.filter(\n          api => fileText.indexOf(api) !== -1\n        )\n        matchingApis.forEach(api => deprecatedLocations[api].push(file))\n      })\n\n    deprecatedApis.forEach(api => {\n      if (deprecatedLocations[api].length) {\n        console.log(\n          `%s %s %s %s`,\n          chalk.cyan(api),\n          chalk.yellow(`is deprecated. Please use`),\n          chalk.cyan(fixMap[api].newName),\n          chalk.yellow(\n            `instead. For migration instructions, see ${\n              fixMap[api].docsLink\n            }\\nCheck the following files:`\n          )\n        )\n        console.log()\n        deprecatedLocations[api].forEach(file => console.log(file))\n        console.log()\n      }\n    })\n  }\n\n  let isFirstCompile = true\n  // \"done\" event fires when Webpack has finished recompiling the bundle.\n  // Whether or not you have warnings or errors, you will get this event.\n  compiler.hooks.done.tapAsync(`print getsby instructions`, (stats, done) => {\n    // We have switched off the default Webpack output in WebpackDevServer\n    // options so we are going to \"massage\" the warnings and errors and present\n    // them in a readable focused way.\n    const messages = formatWebpackMessages(stats.toJson({}, true))\n    const urls = prepareUrls(\n      program.ssl ? `https` : `http`,\n      program.host,\n      program.port\n    )\n    const isSuccessful = !messages.errors.length\n    // if (isSuccessful) {\n    // console.log(chalk.green(`Compiled successfully!`))\n    // }\n    // if (isSuccessful && (isInteractive || isFirstCompile)) {\n    if (isSuccessful && isFirstCompile) {\n      printInstructions(program.sitePackageJson.name, urls, program.useYarn)\n      printDeprecationWarnings()\n      if (program.open) {\n        require(`opn`)(urls.localUrlForBrowser).catch(err =>\n          console.log(\n            `${chalk.yellow(\n              `warn`\n            )} Browser not opened because no browser was found`\n          )\n        )\n      }\n    }\n\n    isFirstCompile = false\n\n    // If errors exist, only show errors.\n    // if (messages.errors.length) {\n    // // Only keep the first error. Others are often indicative\n    // // of the same problem, but confuse the reader with noise.\n    // if (messages.errors.length > 1) {\n    // messages.errors.length = 1\n    // }\n    // console.log(chalk.red(\"Failed to compile.\\n\"))\n    // console.log(messages.errors.join(\"\\n\\n\"))\n    // return\n    // }\n\n    // Show warnings if no errors were found.\n    // if (messages.warnings.length) {\n    // console.log(chalk.yellow(\"Compiled with warnings.\\n\"))\n    // console.log(messages.warnings.join(\"\\n\\n\"))\n\n    // // Teach some ESLint tricks.\n    // console.log(\n    // \"\\nSearch for the \" +\n    // chalk.underline(chalk.yellow(\"keywords\")) +\n    // \" to learn more about each warning.\"\n    // )\n    // console.log(\n    // \"To ignore, add \" +\n    // chalk.cyan(\"// eslint-disable-next-line\") +\n    // \" to the line before.\\n\"\n    // )\n    // }\n\n    done()\n  })\n}\n"],"file":"develop.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/commands/repl.js
+++ b/node_modules/gatsby/dist/commands/repl.js
@@ -1,81 +1,64 @@
 "use strict";
 
-var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
-
-var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
-
 const repl = require(`repl`);
 
-const _require = require(`graphql`),
-      graphql = _require.graphql;
+const {
+  graphql
+} = require(`graphql`);
 
 const bootstrap = require(`../bootstrap`);
 
-const _require2 = require(`../db/nodes`),
-      loadNodeContent = _require2.loadNodeContent,
-      getNodes = _require2.getNodes,
-      getNode = _require2.getNode,
-      getNodesByType = _require2.getNodesByType;
-
-const _require3 = require(`../redux`),
-      store = _require3.store;
-
-module.exports =
-/*#__PURE__*/
-function () {
-  var _ref = (0, _asyncToGenerator2.default)(function* (program) {
-    // run bootstrap
-    yield bootstrap(program); // get all the goodies from the store
-
-    const _store$getState = store.getState(),
-          schema = _store$getState.schema,
-          config = _store$getState.config,
-          babelrc = _store$getState.babelrc,
-          jsonDataPaths = _store$getState.jsonDataPaths,
-          pages = _store$getState.pages,
-          components = _store$getState.components,
-          staticQueryComponents = _store$getState.staticQueryComponents;
-
-    const nodes = getNodes();
-
-    const query =
-    /*#__PURE__*/
-    function () {
-      var _ref2 = (0, _asyncToGenerator2.default)(function* (_query) {
-        const result = yield graphql(schema, _query, {}, {}, {});
-        console.log(`query result: ${JSON.stringify(result)}`);
-      });
-
-      return function query(_x2) {
-        return _ref2.apply(this, arguments);
-      };
-    }(); // init new repl
-
-
-    const _ = repl.start({
-      prompt: `gatsby > `
-    }); // set some globals to make life easier
-
-
-    _.context.babelrc = babelrc;
-    _.context.components = components;
-    _.context.dataPaths = jsonDataPaths;
-    _.context.getNode = getNode;
-    _.context.getNodes = getNodes;
-    _.context.getNodesByType = getNodesByType;
-    _.context.loadNodeContent = loadNodeContent;
-    _.context.nodes = [...nodes.entries()];
-    _.context.pages = [...pages.entries()];
-    _.context.graphql = query;
-    _.context.schema = schema;
-    _.context.siteConfig = config;
-    _.context.staticQueries = staticQueryComponents;
-
-    _.on(`exit`, () => process.exit(0));
-  });
-
-  return function (_x) {
-    return _ref.apply(this, arguments);
-  };
-}();
+const {
+  loadNodeContent,
+  getNodes,
+  getNode,
+  getNodesByType
+} = require(`../db/nodes`);
+
+const {
+  store
+} = require(`../redux`);
+
+module.exports = async program => {
+  // run bootstrap
+  await bootstrap(program); // get all the goodies from the store
+
+  const {
+    schema,
+    config,
+    babelrc,
+    jsonDataPaths,
+    pages,
+    components,
+    staticQueryComponents
+  } = store.getState();
+  const nodes = getNodes();
+
+  const query = async query => {
+    const result = await graphql(schema, query, {}, {}, {});
+    console.log(`query result: ${JSON.stringify(result)}`);
+  }; // init new repl
+
+
+  const _ = repl.start({
+    prompt: `gatsby > `
+  }); // set some globals to make life easier
+
+
+  _.context.babelrc = babelrc;
+  _.context.components = components;
+  _.context.dataPaths = jsonDataPaths;
+  _.context.getNode = getNode;
+  _.context.getNodes = getNodes;
+  _.context.getNodesByType = getNodesByType;
+  _.context.loadNodeContent = loadNodeContent;
+  _.context.nodes = [...nodes.entries()];
+  _.context.pages = [...pages.entries()];
+  _.context.graphql = query;
+  _.context.schema = schema;
+  _.context.siteConfig = config;
+  _.context.staticQueries = staticQueryComponents;
+
+  _.on(`exit`, () => process.exit(0));
+};
 //# sourceMappingURL=repl.js.map
\ No newline at end of file
--- a/node_modules/gatsby/dist/commands/repl.js.map
+++ b/node_modules/gatsby/dist/commands/repl.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/commands/repl.js"],"names":["repl","require","graphql","bootstrap","loadNodeContent","getNodes","getNode","getNodesByType","store","module","exports","program","getState","schema","config","babelrc","jsonDataPaths","pages","components","staticQueryComponents","nodes","query","result","console","log","JSON","stringify","_","start","prompt","context","dataPaths","entries","siteConfig","staticQueries","on","process","exit"],"mappings":";;;;;;AAAA,MAAMA,IAAI,GAAGC,OAAO,CAAE,MAAF,CAApB;;iBACoBA,OAAO,CAAE,SAAF,C;MAAnBC,O,YAAAA,O;;AACR,MAAMC,SAAS,GAAGF,OAAO,CAAE,cAAF,CAAzB;;kBAMIA,OAAO,CAAE,aAAF,C;MAJTG,e,aAAAA,e;MACAC,Q,aAAAA,Q;MACAC,O,aAAAA,O;MACAC,c,aAAAA,c;;kBAEgBN,OAAO,CAAE,UAAF,C;MAAjBO,K,aAAAA,K;;AAERC,MAAM,CAACC,OAAP;AAAA;AAAA;AAAA,6CAAiB,WAAMC,OAAN,EAAiB;AAChC;AACA,UAAMR,SAAS,CAACQ,OAAD,CAAf,CAFgC,CAIhC;;AAJgC,4BAa5BH,KAAK,CAACI,QAAN,EAb4B;AAAA,UAM9BC,MAN8B,mBAM9BA,MAN8B;AAAA,UAO9BC,MAP8B,mBAO9BA,MAP8B;AAAA,UAQ9BC,OAR8B,mBAQ9BA,OAR8B;AAAA,UAS9BC,aAT8B,mBAS9BA,aAT8B;AAAA,UAU9BC,KAV8B,mBAU9BA,KAV8B;AAAA,UAW9BC,UAX8B,mBAW9BA,UAX8B;AAAA,UAY9BC,qBAZ8B,mBAY9BA,qBAZ8B;;AAehC,UAAMC,KAAK,GAAGf,QAAQ,EAAtB;;AAEA,UAAMgB,KAAK;AAAA;AAAA;AAAA,kDAAG,WAAMA,MAAN,EAAe;AAC3B,cAAMC,MAAM,SAASpB,OAAO,CAACW,MAAD,EAASQ,MAAT,EAAgB,EAAhB,EAAoB,EAApB,EAAwB,EAAxB,CAA5B;AACAE,QAAAA,OAAO,CAACC,GAAR,CAAa,iBAAgBC,IAAI,CAACC,SAAL,CAAeJ,MAAf,CAAuB,EAApD;AACD,OAHU;;AAAA;AAAA;AAAA;AAAA,OAAX,CAjBgC,CAsBhC;;;AACA,UAAMK,CAAC,GAAG3B,IAAI,CAAC4B,KAAL,CAAW;AACnBC,MAAAA,MAAM,EAAG;AADU,KAAX,CAAV,CAvBgC,CA2BhC;;;AACAF,IAAAA,CAAC,CAACG,OAAF,CAAUf,OAAV,GAAoBA,OAApB;AACAY,IAAAA,CAAC,CAACG,OAAF,CAAUZ,UAAV,GAAuBA,UAAvB;AACAS,IAAAA,CAAC,CAACG,OAAF,CAAUC,SAAV,GAAsBf,aAAtB;AACAW,IAAAA,CAAC,CAACG,OAAF,CAAUxB,OAAV,GAAoBA,OAApB;AACAqB,IAAAA,CAAC,CAACG,OAAF,CAAUzB,QAAV,GAAqBA,QAArB;AACAsB,IAAAA,CAAC,CAACG,OAAF,CAAUvB,cAAV,GAA2BA,cAA3B;AACAoB,IAAAA,CAAC,CAACG,OAAF,CAAU1B,eAAV,GAA4BA,eAA5B;AACAuB,IAAAA,CAAC,CAACG,OAAF,CAAUV,KAAV,GAAkB,CAAC,GAAGA,KAAK,CAACY,OAAN,EAAJ,CAAlB;AACAL,IAAAA,CAAC,CAACG,OAAF,CAAUb,KAAV,GAAkB,CAAC,GAAGA,KAAK,CAACe,OAAN,EAAJ,CAAlB;AACAL,IAAAA,CAAC,CAACG,OAAF,CAAU5B,OAAV,GAAoBmB,KAApB;AACAM,IAAAA,CAAC,CAACG,OAAF,CAAUjB,MAAV,GAAmBA,MAAnB;AACAc,IAAAA,CAAC,CAACG,OAAF,CAAUG,UAAV,GAAuBnB,MAAvB;AACAa,IAAAA,CAAC,CAACG,OAAF,CAAUI,aAAV,GAA0Bf,qBAA1B;;AAEAQ,IAAAA,CAAC,CAACQ,EAAF,CAAM,MAAN,EAAa,MAAMC,OAAO,CAACC,IAAR,CAAa,CAAb,CAAnB;AACD,GA3CD;;AAAA;AAAA;AAAA;AAAA","sourcesContent":["const repl = require(`repl`)\nconst { graphql } = require(`graphql`)\nconst bootstrap = require(`../bootstrap`)\nconst {\n  loadNodeContent,\n  getNodes,\n  getNode,\n  getNodesByType,\n} = require(`../db/nodes`)\nconst { store } = require(`../redux`)\n\nmodule.exports = async program => {\n  // run bootstrap\n  await bootstrap(program)\n\n  // get all the goodies from the store\n  const {\n    schema,\n    config,\n    babelrc,\n    jsonDataPaths,\n    pages,\n    components,\n    staticQueryComponents,\n  } = store.getState()\n\n  const nodes = getNodes()\n\n  const query = async query => {\n    const result = await graphql(schema, query, {}, {}, {})\n    console.log(`query result: ${JSON.stringify(result)}`)\n  }\n\n  // init new repl\n  const _ = repl.start({\n    prompt: `gatsby > `,\n  })\n\n  // set some globals to make life easier\n  _.context.babelrc = babelrc\n  _.context.components = components\n  _.context.dataPaths = jsonDataPaths\n  _.context.getNode = getNode\n  _.context.getNodes = getNodes\n  _.context.getNodesByType = getNodesByType\n  _.context.loadNodeContent = loadNodeContent\n  _.context.nodes = [...nodes.entries()]\n  _.context.pages = [...pages.entries()]\n  _.context.graphql = query\n  _.context.schema = schema\n  _.context.siteConfig = config\n  _.context.staticQueries = staticQueryComponents\n\n  _.on(`exit`, () => process.exit(0))\n}\n"],"file":"repl.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/commands/repl.js"],"names":["repl","require","graphql","bootstrap","loadNodeContent","getNodes","getNode","getNodesByType","store","module","exports","program","schema","config","babelrc","jsonDataPaths","pages","components","staticQueryComponents","getState","nodes","query","result","console","log","JSON","stringify","_","start","prompt","context","dataPaths","entries","siteConfig","staticQueries","on","process","exit"],"mappings":";;AAAA,MAAMA,IAAI,GAAGC,OAAO,CAAE,MAAF,CAApB;;AACA,MAAM;AAAEC,EAAAA;AAAF,IAAcD,OAAO,CAAE,SAAF,CAA3B;;AACA,MAAME,SAAS,GAAGF,OAAO,CAAE,cAAF,CAAzB;;AACA,MAAM;AACJG,EAAAA,eADI;AAEJC,EAAAA,QAFI;AAGJC,EAAAA,OAHI;AAIJC,EAAAA;AAJI,IAKFN,OAAO,CAAE,aAAF,CALX;;AAMA,MAAM;AAAEO,EAAAA;AAAF,IAAYP,OAAO,CAAE,UAAF,CAAzB;;AAEAQ,MAAM,CAACC,OAAP,GAAiB,MAAMC,OAAN,IAAiB;AAChC;AACA,QAAMR,SAAS,CAACQ,OAAD,CAAf,CAFgC,CAIhC;;AACA,QAAM;AACJC,IAAAA,MADI;AAEJC,IAAAA,MAFI;AAGJC,IAAAA,OAHI;AAIJC,IAAAA,aAJI;AAKJC,IAAAA,KALI;AAMJC,IAAAA,UANI;AAOJC,IAAAA;AAPI,MAQFV,KAAK,CAACW,QAAN,EARJ;AAUA,QAAMC,KAAK,GAAGf,QAAQ,EAAtB;;AAEA,QAAMgB,KAAK,GAAG,MAAMA,KAAN,IAAe;AAC3B,UAAMC,MAAM,GAAG,MAAMpB,OAAO,CAACU,MAAD,EAASS,KAAT,EAAgB,EAAhB,EAAoB,EAApB,EAAwB,EAAxB,CAA5B;AACAE,IAAAA,OAAO,CAACC,GAAR,CAAa,iBAAgBC,IAAI,CAACC,SAAL,CAAeJ,MAAf,CAAuB,EAApD;AACD,GAHD,CAjBgC,CAsBhC;;;AACA,QAAMK,CAAC,GAAG3B,IAAI,CAAC4B,KAAL,CAAW;AACnBC,IAAAA,MAAM,EAAG;AADU,GAAX,CAAV,CAvBgC,CA2BhC;;;AACAF,EAAAA,CAAC,CAACG,OAAF,CAAUhB,OAAV,GAAoBA,OAApB;AACAa,EAAAA,CAAC,CAACG,OAAF,CAAUb,UAAV,GAAuBA,UAAvB;AACAU,EAAAA,CAAC,CAACG,OAAF,CAAUC,SAAV,GAAsBhB,aAAtB;AACAY,EAAAA,CAAC,CAACG,OAAF,CAAUxB,OAAV,GAAoBA,OAApB;AACAqB,EAAAA,CAAC,CAACG,OAAF,CAAUzB,QAAV,GAAqBA,QAArB;AACAsB,EAAAA,CAAC,CAACG,OAAF,CAAUvB,cAAV,GAA2BA,cAA3B;AACAoB,EAAAA,CAAC,CAACG,OAAF,CAAU1B,eAAV,GAA4BA,eAA5B;AACAuB,EAAAA,CAAC,CAACG,OAAF,CAAUV,KAAV,GAAkB,CAAC,GAAGA,KAAK,CAACY,OAAN,EAAJ,CAAlB;AACAL,EAAAA,CAAC,CAACG,OAAF,CAAUd,KAAV,GAAkB,CAAC,GAAGA,KAAK,CAACgB,OAAN,EAAJ,CAAlB;AACAL,EAAAA,CAAC,CAACG,OAAF,CAAU5B,OAAV,GAAoBmB,KAApB;AACAM,EAAAA,CAAC,CAACG,OAAF,CAAUlB,MAAV,GAAmBA,MAAnB;AACAe,EAAAA,CAAC,CAACG,OAAF,CAAUG,UAAV,GAAuBpB,MAAvB;AACAc,EAAAA,CAAC,CAACG,OAAF,CAAUI,aAAV,GAA0BhB,qBAA1B;;AAEAS,EAAAA,CAAC,CAACQ,EAAF,CAAM,MAAN,EAAa,MAAMC,OAAO,CAACC,IAAR,CAAa,CAAb,CAAnB;AACD,CA3CD","sourcesContent":["const repl = require(`repl`)\nconst { graphql } = require(`graphql`)\nconst bootstrap = require(`../bootstrap`)\nconst {\n  loadNodeContent,\n  getNodes,\n  getNode,\n  getNodesByType,\n} = require(`../db/nodes`)\nconst { store } = require(`../redux`)\n\nmodule.exports = async program => {\n  // run bootstrap\n  await bootstrap(program)\n\n  // get all the goodies from the store\n  const {\n    schema,\n    config,\n    babelrc,\n    jsonDataPaths,\n    pages,\n    components,\n    staticQueryComponents,\n  } = store.getState()\n\n  const nodes = getNodes()\n\n  const query = async query => {\n    const result = await graphql(schema, query, {}, {}, {})\n    console.log(`query result: ${JSON.stringify(result)}`)\n  }\n\n  // init new repl\n  const _ = repl.start({\n    prompt: `gatsby > `,\n  })\n\n  // set some globals to make life easier\n  _.context.babelrc = babelrc\n  _.context.components = components\n  _.context.dataPaths = jsonDataPaths\n  _.context.getNode = getNode\n  _.context.getNodes = getNodes\n  _.context.getNodesByType = getNodesByType\n  _.context.loadNodeContent = loadNodeContent\n  _.context.nodes = [...nodes.entries()]\n  _.context.pages = [...pages.entries()]\n  _.context.graphql = query\n  _.context.schema = schema\n  _.context.siteConfig = config\n  _.context.staticQueries = staticQueryComponents\n\n  _.on(`exit`, () => process.exit(0))\n}\n"],"file":"repl.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/commands/serve.js
+++ b/node_modules/gatsby/dist/commands/serve.js
@@ -1,9 +1,5 @@
 "use strict";
 
-var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
-
-var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
-
 /*  weak */
 const openurl = require(`opn`);
 
@@ -19,47 +15,41 @@ const preferDefault = require(`../bootstrap/prefer-default`);
 
 const chalk = require(`chalk`);
 
-module.exports =
-/*#__PURE__*/
-function () {
-  var _ref = (0, _asyncToGenerator2.default)(function* (program) {
-    let prefixPaths = program.prefixPaths,
-        port = program.port,
-        open = program.open;
-    port = typeof port === `string` ? parseInt(port, 10) : port;
-    const config = yield preferDefault(getConfigFile(program.directory, `gatsby-config`));
-    let pathPrefix = config && config.pathPrefix;
-    pathPrefix = prefixPaths && pathPrefix ? pathPrefix : `/`;
-    const app = express();
-    const router = express.Router();
-    router.use(compression());
-    router.use(express.static(`public`));
-    router.use((req, res, next) => {
-      if (req.accepts(`html`)) {
-        res.status(404).sendFile(`404.html`, {
-          root: `public`
-        });
-      } else {
-        next();
-      }
-    });
-    app.use(pathPrefix, router);
-    const server = app.listen(port, () => {
-      let openUrlString = `http://localhost:${port}${pathPrefix}`;
-      console.log(`${chalk.blue(`info`)} gatsby serve running at: ${chalk.bold(openUrlString)}`);
-
-      if (open) {
-        console.log(`${chalk.blue(`info`)} Opening browser...`);
-        openurl(openUrlString).catch(err => console.log(`${chalk.yellow(`warn`)} Browser not opened because no browser was found`));
-      }
-    });
-    signalExit((code, signal) => {
-      server.close();
-    });
+module.exports = async program => {
+  let {
+    prefixPaths,
+    port,
+    open
+  } = program;
+  port = typeof port === `string` ? parseInt(port, 10) : port;
+  const config = await preferDefault(getConfigFile(program.directory, `gatsby-config`));
+  let pathPrefix = config && config.pathPrefix;
+  pathPrefix = prefixPaths && pathPrefix ? pathPrefix : `/`;
+  const app = express();
+  const router = express.Router();
+  router.use(compression());
+  router.use(express.static(`public`));
+  router.use((req, res, next) => {
+    if (req.accepts(`html`)) {
+      res.status(404).sendFile(`404.html`, {
+        root: `public`
+      });
+    } else {
+      next();
+    }
   });
-
-  return function (_x) {
-    return _ref.apply(this, arguments);
-  };
-}();
+  app.use(pathPrefix, router);
+  const server = app.listen(port, () => {
+    let openUrlString = `http://localhost:${port}${pathPrefix}`;
+    console.log(`${chalk.blue(`info`)} gatsby serve running at: ${chalk.bold(openUrlString)}`);
+
+    if (open) {
+      console.log(`${chalk.blue(`info`)} Opening browser...`);
+      openurl(openUrlString).catch(err => console.log(`${chalk.yellow(`warn`)} Browser not opened because no browser was found`));
+    }
+  });
+  signalExit((code, signal) => {
+    server.close();
+  });
+};
 //# sourceMappingURL=serve.js.map
\ No newline at end of file
--- a/node_modules/gatsby/dist/commands/serve.js.map
+++ b/node_modules/gatsby/dist/commands/serve.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/commands/serve.js"],"names":["openurl","require","signalExit","compression","express","getConfigFile","preferDefault","chalk","module","exports","program","prefixPaths","port","open","parseInt","config","directory","pathPrefix","app","router","Router","use","static","req","res","next","accepts","status","sendFile","root","server","listen","openUrlString","console","log","blue","bold","catch","err","yellow","code","signal","close"],"mappings":";;;;;;AAAA;AACA,MAAMA,OAAO,GAAGC,OAAO,CAAE,KAAF,CAAvB;;AACA,MAAMC,UAAU,GAAGD,OAAO,CAAE,aAAF,CAA1B;;AACA,MAAME,WAAW,GAAGF,OAAO,CAAE,aAAF,CAA3B;;AACA,MAAMG,OAAO,GAAGH,OAAO,CAAE,SAAF,CAAvB;;AACA,MAAMI,aAAa,GAAGJ,OAAO,CAAE,8BAAF,CAA7B;;AACA,MAAMK,aAAa,GAAGL,OAAO,CAAE,6BAAF,CAA7B;;AACA,MAAMM,KAAK,GAAGN,OAAO,CAAE,OAAF,CAArB;;AAEAO,MAAM,CAACC,OAAP;AAAA;AAAA;AAAA,6CAAiB,WAAMC,OAAN,EAAiB;AAAA,QAC1BC,WAD0B,GACED,OADF,CAC1BC,WAD0B;AAAA,QACbC,IADa,GACEF,OADF,CACbE,IADa;AAAA,QACPC,IADO,GACEH,OADF,CACPG,IADO;AAEhCD,IAAAA,IAAI,GAAG,OAAOA,IAAP,KAAiB,QAAjB,GAA2BE,QAAQ,CAACF,IAAD,EAAO,EAAP,CAAnC,GAAgDA,IAAvD;AAEA,UAAMG,MAAM,SAAST,aAAa,CAChCD,aAAa,CAACK,OAAO,CAACM,SAAT,EAAqB,eAArB,CADmB,CAAlC;AAIA,QAAIC,UAAU,GAAGF,MAAM,IAAIA,MAAM,CAACE,UAAlC;AACAA,IAAAA,UAAU,GAAGN,WAAW,IAAIM,UAAf,GAA4BA,UAA5B,GAA0C,GAAvD;AAEA,UAAMC,GAAG,GAAGd,OAAO,EAAnB;AACA,UAAMe,MAAM,GAAGf,OAAO,CAACgB,MAAR,EAAf;AACAD,IAAAA,MAAM,CAACE,GAAP,CAAWlB,WAAW,EAAtB;AACAgB,IAAAA,MAAM,CAACE,GAAP,CAAWjB,OAAO,CAACkB,MAAR,CAAgB,QAAhB,CAAX;AACAH,IAAAA,MAAM,CAACE,GAAP,CAAW,CAACE,GAAD,EAAMC,GAAN,EAAWC,IAAX,KAAoB;AAC7B,UAAIF,GAAG,CAACG,OAAJ,CAAa,MAAb,CAAJ,EAAyB;AACvBF,QAAAA,GAAG,CAACG,MAAJ,CAAW,GAAX,EAAgBC,QAAhB,CAA0B,UAA1B,EAAqC;AAAEC,UAAAA,IAAI,EAAG;AAAT,SAArC;AACD,OAFD,MAEO;AACLJ,QAAAA,IAAI;AACL;AACF,KAND;AAOAP,IAAAA,GAAG,CAACG,GAAJ,CAAQJ,UAAR,EAAoBE,MAApB;AAEA,UAAMW,MAAM,GAAGZ,GAAG,CAACa,MAAJ,CAAWnB,IAAX,EAAiB,MAAM;AACpC,UAAIoB,aAAa,GAAI,oBAAmBpB,IAAK,GAAEK,UAAW,EAA1D;AACAgB,MAAAA,OAAO,CAACC,GAAR,CACG,GAAE3B,KAAK,CAAC4B,IAAN,CAAY,MAAZ,CAAmB,6BAA4B5B,KAAK,CAAC6B,IAAN,CAChDJ,aADgD,CAEhD,EAHJ;;AAKA,UAAInB,IAAJ,EAAU;AACRoB,QAAAA,OAAO,CAACC,GAAR,CAAa,GAAE3B,KAAK,CAAC4B,IAAN,CAAY,MAAZ,CAAmB,qBAAlC;AACAnC,QAAAA,OAAO,CAACgC,aAAD,CAAP,CAAuBK,KAAvB,CAA6BC,GAAG,IAC9BL,OAAO,CAACC,GAAR,CACG,GAAE3B,KAAK,CAACgC,MAAN,CACA,MADA,CAED,kDAHJ,CADF;AAOD;AACF,KAjBc,CAAf;AAmBArC,IAAAA,UAAU,CAAC,CAACsC,IAAD,EAAOC,MAAP,KAAkB;AAC3BX,MAAAA,MAAM,CAACY,KAAP;AACD,KAFS,CAAV;AAGD,GA9CD;;AAAA;AAAA;AAAA;AAAA","sourcesContent":["/* @flow weak */\nconst openurl = require(`opn`)\nconst signalExit = require(`signal-exit`)\nconst compression = require(`compression`)\nconst express = require(`express`)\nconst getConfigFile = require(`../bootstrap/get-config-file`)\nconst preferDefault = require(`../bootstrap/prefer-default`)\nconst chalk = require(`chalk`)\n\nmodule.exports = async program => {\n  let { prefixPaths, port, open } = program\n  port = typeof port === `string` ? parseInt(port, 10) : port\n\n  const config = await preferDefault(\n    getConfigFile(program.directory, `gatsby-config`)\n  )\n\n  let pathPrefix = config && config.pathPrefix\n  pathPrefix = prefixPaths && pathPrefix ? pathPrefix : `/`\n\n  const app = express()\n  const router = express.Router()\n  router.use(compression())\n  router.use(express.static(`public`))\n  router.use((req, res, next) => {\n    if (req.accepts(`html`)) {\n      res.status(404).sendFile(`404.html`, { root: `public` })\n    } else {\n      next()\n    }\n  })\n  app.use(pathPrefix, router)\n\n  const server = app.listen(port, () => {\n    let openUrlString = `http://localhost:${port}${pathPrefix}`\n    console.log(\n      `${chalk.blue(`info`)} gatsby serve running at: ${chalk.bold(\n        openUrlString\n      )}`\n    )\n    if (open) {\n      console.log(`${chalk.blue(`info`)} Opening browser...`)\n      openurl(openUrlString).catch(err =>\n        console.log(\n          `${chalk.yellow(\n            `warn`\n          )} Browser not opened because no browser was found`\n        )\n      )\n    }\n  })\n\n  signalExit((code, signal) => {\n    server.close()\n  })\n}\n"],"file":"serve.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/commands/serve.js"],"names":["openurl","require","signalExit","compression","express","getConfigFile","preferDefault","chalk","module","exports","program","prefixPaths","port","open","parseInt","config","directory","pathPrefix","app","router","Router","use","static","req","res","next","accepts","status","sendFile","root","server","listen","openUrlString","console","log","blue","bold","catch","err","yellow","code","signal","close"],"mappings":";;AAAA;AACA,MAAMA,OAAO,GAAGC,OAAO,CAAE,KAAF,CAAvB;;AACA,MAAMC,UAAU,GAAGD,OAAO,CAAE,aAAF,CAA1B;;AACA,MAAME,WAAW,GAAGF,OAAO,CAAE,aAAF,CAA3B;;AACA,MAAMG,OAAO,GAAGH,OAAO,CAAE,SAAF,CAAvB;;AACA,MAAMI,aAAa,GAAGJ,OAAO,CAAE,8BAAF,CAA7B;;AACA,MAAMK,aAAa,GAAGL,OAAO,CAAE,6BAAF,CAA7B;;AACA,MAAMM,KAAK,GAAGN,OAAO,CAAE,OAAF,CAArB;;AAEAO,MAAM,CAACC,OAAP,GAAiB,MAAMC,OAAN,IAAiB;AAChC,MAAI;AAAEC,IAAAA,WAAF;AAAeC,IAAAA,IAAf;AAAqBC,IAAAA;AAArB,MAA8BH,OAAlC;AACAE,EAAAA,IAAI,GAAG,OAAOA,IAAP,KAAiB,QAAjB,GAA2BE,QAAQ,CAACF,IAAD,EAAO,EAAP,CAAnC,GAAgDA,IAAvD;AAEA,QAAMG,MAAM,GAAG,MAAMT,aAAa,CAChCD,aAAa,CAACK,OAAO,CAACM,SAAT,EAAqB,eAArB,CADmB,CAAlC;AAIA,MAAIC,UAAU,GAAGF,MAAM,IAAIA,MAAM,CAACE,UAAlC;AACAA,EAAAA,UAAU,GAAGN,WAAW,IAAIM,UAAf,GAA4BA,UAA5B,GAA0C,GAAvD;AAEA,QAAMC,GAAG,GAAGd,OAAO,EAAnB;AACA,QAAMe,MAAM,GAAGf,OAAO,CAACgB,MAAR,EAAf;AACAD,EAAAA,MAAM,CAACE,GAAP,CAAWlB,WAAW,EAAtB;AACAgB,EAAAA,MAAM,CAACE,GAAP,CAAWjB,OAAO,CAACkB,MAAR,CAAgB,QAAhB,CAAX;AACAH,EAAAA,MAAM,CAACE,GAAP,CAAW,CAACE,GAAD,EAAMC,GAAN,EAAWC,IAAX,KAAoB;AAC7B,QAAIF,GAAG,CAACG,OAAJ,CAAa,MAAb,CAAJ,EAAyB;AACvBF,MAAAA,GAAG,CAACG,MAAJ,CAAW,GAAX,EAAgBC,QAAhB,CAA0B,UAA1B,EAAqC;AAAEC,QAAAA,IAAI,EAAG;AAAT,OAArC;AACD,KAFD,MAEO;AACLJ,MAAAA,IAAI;AACL;AACF,GAND;AAOAP,EAAAA,GAAG,CAACG,GAAJ,CAAQJ,UAAR,EAAoBE,MAApB;AAEA,QAAMW,MAAM,GAAGZ,GAAG,CAACa,MAAJ,CAAWnB,IAAX,EAAiB,MAAM;AACpC,QAAIoB,aAAa,GAAI,oBAAmBpB,IAAK,GAAEK,UAAW,EAA1D;AACAgB,IAAAA,OAAO,CAACC,GAAR,CACG,GAAE3B,KAAK,CAAC4B,IAAN,CAAY,MAAZ,CAAmB,6BAA4B5B,KAAK,CAAC6B,IAAN,CAChDJ,aADgD,CAEhD,EAHJ;;AAKA,QAAInB,IAAJ,EAAU;AACRoB,MAAAA,OAAO,CAACC,GAAR,CAAa,GAAE3B,KAAK,CAAC4B,IAAN,CAAY,MAAZ,CAAmB,qBAAlC;AACAnC,MAAAA,OAAO,CAACgC,aAAD,CAAP,CAAuBK,KAAvB,CAA6BC,GAAG,IAC9BL,OAAO,CAACC,GAAR,CACG,GAAE3B,KAAK,CAACgC,MAAN,CACA,MADA,CAED,kDAHJ,CADF;AAOD;AACF,GAjBc,CAAf;AAmBArC,EAAAA,UAAU,CAAC,CAACsC,IAAD,EAAOC,MAAP,KAAkB;AAC3BX,IAAAA,MAAM,CAACY,KAAP;AACD,GAFS,CAAV;AAGD,CA9CD","sourcesContent":["/* @flow weak */\nconst openurl = require(`opn`)\nconst signalExit = require(`signal-exit`)\nconst compression = require(`compression`)\nconst express = require(`express`)\nconst getConfigFile = require(`../bootstrap/get-config-file`)\nconst preferDefault = require(`../bootstrap/prefer-default`)\nconst chalk = require(`chalk`)\n\nmodule.exports = async program => {\n  let { prefixPaths, port, open } = program\n  port = typeof port === `string` ? parseInt(port, 10) : port\n\n  const config = await preferDefault(\n    getConfigFile(program.directory, `gatsby-config`)\n  )\n\n  let pathPrefix = config && config.pathPrefix\n  pathPrefix = prefixPaths && pathPrefix ? pathPrefix : `/`\n\n  const app = express()\n  const router = express.Router()\n  router.use(compression())\n  router.use(express.static(`public`))\n  router.use((req, res, next) => {\n    if (req.accepts(`html`)) {\n      res.status(404).sendFile(`404.html`, { root: `public` })\n    } else {\n      next()\n    }\n  })\n  app.use(pathPrefix, router)\n\n  const server = app.listen(port, () => {\n    let openUrlString = `http://localhost:${port}${pathPrefix}`\n    console.log(\n      `${chalk.blue(`info`)} gatsby serve running at: ${chalk.bold(\n        openUrlString\n      )}`\n    )\n    if (open) {\n      console.log(`${chalk.blue(`info`)} Opening browser...`)\n      openurl(openUrlString).catch(err =>\n        console.log(\n          `${chalk.yellow(\n            `warn`\n          )} Browser not opened because no browser was found`\n        )\n      )\n    }\n  })\n\n  signalExit((code, signal) => {\n    server.close()\n  })\n}\n"],"file":"serve.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/db/node-tracking.js
+++ b/node_modules/gatsby/dist/db/node-tracking.js
@@ -2,9 +2,10 @@
 
 const _ = require(`lodash`);
 
-const _require = require(`../db/nodes`),
-      getNode = _require.getNode,
-      getNodes = _require.getNodes;
+const {
+  getNode,
+  getNodes
+} = require(`../db/nodes`);
 /**
  * Map containing links between inline objects or arrays
  * and Node that contains them
--- a/node_modules/gatsby/dist/db/node-tracking.js.map
+++ b/node_modules/gatsby/dist/db/node-tracking.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/db/node-tracking.js"],"names":["_","require","getNode","getNodes","rootNodeMap","WeakMap","getRootNodeId","node","get","addRootNodeToInlineObject","data","nodeId","isPlainObject","isArray","each","o","set","trackInlineObjectsInRootNode","v","k","id","exports","findRootNodeAncestor","obj","predicate","rootNode","whileCount","rootNodeId","parent","undefined","console","log"],"mappings":";;AAAA,MAAMA,CAAC,GAAGC,OAAO,CAAE,QAAF,CAAjB;;iBAC8BA,OAAO,CAAE,aAAF,C;MAA7BC,O,YAAAA,O;MAASC,Q,YAAAA,Q;AAEjB;;;;;;;AAKA,MAAMC,WAAW,GAAG,IAAIC,OAAJ,EAApB;;AAEA,MAAMC,aAAa,GAAGC,IAAI,IAAIH,WAAW,CAACI,GAAZ,CAAgBD,IAAhB,CAA9B;AAEA;;;;;;;;;AAOA,MAAME,yBAAyB,GAAG,CAACC,IAAD,EAAOC,MAAP,KAAkB;AAClD,MAAIX,CAAC,CAACY,aAAF,CAAgBF,IAAhB,KAAyBV,CAAC,CAACa,OAAF,CAAUH,IAAV,CAA7B,EAA8C;AAC5CV,IAAAA,CAAC,CAACc,IAAF,CAAOJ,IAAP,EAAaK,CAAC,IAAIN,yBAAyB,CAACM,CAAD,EAAIJ,MAAJ,CAA3C;;AACAP,IAAAA,WAAW,CAACY,GAAZ,CAAgBN,IAAhB,EAAsBC,MAAtB;AACD;AACF,CALD;AAOA;;;;;;;AAKA,MAAMM,4BAA4B,GAAGV,IAAI,IAAI;AAC3CP,EAAAA,CAAC,CAACc,IAAF,CAAOP,IAAP,EAAa,CAACW,CAAD,EAAIC,CAAJ,KAAU;AACrB;AACA,QAAIA,CAAC,KAAM,UAAX,EAAsB;AACpB;AACD;;AACDV,IAAAA,yBAAyB,CAACS,CAAD,EAAIX,IAAI,CAACa,EAAT,CAAzB;AACD,GAND;;AAQA,SAAOb,IAAP;AACD,CAVD;;AAWAc,OAAO,CAACJ,4BAAR,GAAuCA,4BAAvC;AAEA;;;;;;;;AAOA,MAAMK,oBAAoB,GAAG,CAACC,GAAD,EAAMC,SAAS,GAAG,IAAlB,KAA2B;AACtD;AACA,MAAIC,QAAQ,GAAGF,GAAf;AACA,MAAIG,UAAU,GAAG,CAAjB;AACA,MAAIC,UAAJ;;AACA,SACE,CAAC,CAACH,SAAD,IAAc,CAACA,SAAS,CAACC,QAAD,CAAzB,MACCE,UAAU,GAAGrB,aAAa,CAACmB,QAAD,CAAb,IAA2BA,QAAQ,CAACG,MADlD,MAEC1B,OAAO,CAACuB,QAAQ,CAACG,MAAV,CAAP,KAA6BC,SAA7B,IAA0C3B,OAAO,CAACyB,UAAD,CAFlD,KAGAD,UAAU,GAAG,GAJf,EAKE;AACA,QAAIC,UAAJ,EAAgB;AACdF,MAAAA,QAAQ,GAAGvB,OAAO,CAACyB,UAAD,CAAlB;AACD,KAFD,MAEO;AACLF,MAAAA,QAAQ,GAAGvB,OAAO,CAACuB,QAAQ,CAACG,MAAV,CAAlB;AACD;;AACDF,IAAAA,UAAU,IAAI,CAAd;;AACA,QAAIA,UAAU,GAAG,GAAjB,EAAsB;AACpBI,MAAAA,OAAO,CAACC,GAAR,CACG,+DADH,EAEEN,QAFF;AAID;AACF;;AAED,SAAO,CAACD,SAAD,IAAcA,SAAS,CAACC,QAAD,CAAvB,GAAoCA,QAApC,GAA+C,IAAtD;AACD,CA1BD;AA4BA;;;;;;AAKAJ,OAAO,CAACC,oBAAR,GAA+BA,oBAA/B,C,CAEA;;AACAtB,CAAC,CAACc,IAAF,CAAOX,QAAQ,EAAf,EAAmBI,IAAI,IAAI;AACzBU,EAAAA,4BAA4B,CAACV,IAAD,CAA5B;AACD,CAFD","sourcesContent":["const _ = require(`lodash`)\nconst { getNode, getNodes } = require(`../db/nodes`)\n\n/**\n * Map containing links between inline objects or arrays\n * and Node that contains them\n * @type {Object.<(Object|Array),string>}\n */\nconst rootNodeMap = new WeakMap()\n\nconst getRootNodeId = node => rootNodeMap.get(node)\n\n/**\n * Add link between passed data and Node. This function shouldn't be used\n * directly. Use higher level `trackInlineObjectsInRootNode`\n * @see trackInlineObjectsInRootNode\n * @param {(Object|Array)} data Inline object or array\n * @param {string} nodeId Id of node that contains data passed in first parameter\n */\nconst addRootNodeToInlineObject = (data, nodeId) => {\n  if (_.isPlainObject(data) || _.isArray(data)) {\n    _.each(data, o => addRootNodeToInlineObject(o, nodeId))\n    rootNodeMap.set(data, nodeId)\n  }\n}\n\n/**\n * Adds link between inline objects/arrays contained in Node object\n * and that Node object.\n * @param {Node} node Root Node\n */\nconst trackInlineObjectsInRootNode = node => {\n  _.each(node, (v, k) => {\n    // Ignore the node internal object.\n    if (k === `internal`) {\n      return\n    }\n    addRootNodeToInlineObject(v, node.id)\n  })\n\n  return node\n}\nexports.trackInlineObjectsInRootNode = trackInlineObjectsInRootNode\n\n/**\n * Finds top most ancestor of node that contains passed Object or Array\n * @param {(Object|Array)} obj Object/Array belonging to Node object or Node object\n * @param {nodePredicate} [predicate] Optional callback to check if ancestor meets defined conditions\n * @returns {Node} Top most ancestor if predicate is not specified\n * or first node that meet predicate conditions if predicate is specified\n */\nconst findRootNodeAncestor = (obj, predicate = null) => {\n  // Find the root node.\n  let rootNode = obj\n  let whileCount = 0\n  let rootNodeId\n  while (\n    (!predicate || !predicate(rootNode)) &&\n    (rootNodeId = getRootNodeId(rootNode) || rootNode.parent) &&\n    (getNode(rootNode.parent) !== undefined || getNode(rootNodeId)) &&\n    whileCount < 101\n  ) {\n    if (rootNodeId) {\n      rootNode = getNode(rootNodeId)\n    } else {\n      rootNode = getNode(rootNode.parent)\n    }\n    whileCount += 1\n    if (whileCount > 100) {\n      console.log(\n        `It looks like you have a node that's set its parent as itself`,\n        rootNode\n      )\n    }\n  }\n\n  return !predicate || predicate(rootNode) ? rootNode : null\n}\n\n/**\n * @callback nodePredicate\n * @param {Node} node Node that is examined\n */\n\nexports.findRootNodeAncestor = findRootNodeAncestor\n\n// Track nodes that are already in store\n_.each(getNodes(), node => {\n  trackInlineObjectsInRootNode(node)\n})\n"],"file":"node-tracking.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/db/node-tracking.js"],"names":["_","require","getNode","getNodes","rootNodeMap","WeakMap","getRootNodeId","node","get","addRootNodeToInlineObject","data","nodeId","isPlainObject","isArray","each","o","set","trackInlineObjectsInRootNode","v","k","id","exports","findRootNodeAncestor","obj","predicate","rootNode","whileCount","rootNodeId","parent","undefined","console","log"],"mappings":";;AAAA,MAAMA,CAAC,GAAGC,OAAO,CAAE,QAAF,CAAjB;;AACA,MAAM;AAAEC,EAAAA,OAAF;AAAWC,EAAAA;AAAX,IAAwBF,OAAO,CAAE,aAAF,CAArC;AAEA;;;;;;;AAKA,MAAMG,WAAW,GAAG,IAAIC,OAAJ,EAApB;;AAEA,MAAMC,aAAa,GAAGC,IAAI,IAAIH,WAAW,CAACI,GAAZ,CAAgBD,IAAhB,CAA9B;AAEA;;;;;;;;;AAOA,MAAME,yBAAyB,GAAG,CAACC,IAAD,EAAOC,MAAP,KAAkB;AAClD,MAAIX,CAAC,CAACY,aAAF,CAAgBF,IAAhB,KAAyBV,CAAC,CAACa,OAAF,CAAUH,IAAV,CAA7B,EAA8C;AAC5CV,IAAAA,CAAC,CAACc,IAAF,CAAOJ,IAAP,EAAaK,CAAC,IAAIN,yBAAyB,CAACM,CAAD,EAAIJ,MAAJ,CAA3C;;AACAP,IAAAA,WAAW,CAACY,GAAZ,CAAgBN,IAAhB,EAAsBC,MAAtB;AACD;AACF,CALD;AAOA;;;;;;;AAKA,MAAMM,4BAA4B,GAAGV,IAAI,IAAI;AAC3CP,EAAAA,CAAC,CAACc,IAAF,CAAOP,IAAP,EAAa,CAACW,CAAD,EAAIC,CAAJ,KAAU;AACrB;AACA,QAAIA,CAAC,KAAM,UAAX,EAAsB;AACpB;AACD;;AACDV,IAAAA,yBAAyB,CAACS,CAAD,EAAIX,IAAI,CAACa,EAAT,CAAzB;AACD,GAND;;AAQA,SAAOb,IAAP;AACD,CAVD;;AAWAc,OAAO,CAACJ,4BAAR,GAAuCA,4BAAvC;AAEA;;;;;;;;AAOA,MAAMK,oBAAoB,GAAG,CAACC,GAAD,EAAMC,SAAS,GAAG,IAAlB,KAA2B;AACtD;AACA,MAAIC,QAAQ,GAAGF,GAAf;AACA,MAAIG,UAAU,GAAG,CAAjB;AACA,MAAIC,UAAJ;;AACA,SACE,CAAC,CAACH,SAAD,IAAc,CAACA,SAAS,CAACC,QAAD,CAAzB,MACCE,UAAU,GAAGrB,aAAa,CAACmB,QAAD,CAAb,IAA2BA,QAAQ,CAACG,MADlD,MAEC1B,OAAO,CAACuB,QAAQ,CAACG,MAAV,CAAP,KAA6BC,SAA7B,IAA0C3B,OAAO,CAACyB,UAAD,CAFlD,KAGAD,UAAU,GAAG,GAJf,EAKE;AACA,QAAIC,UAAJ,EAAgB;AACdF,MAAAA,QAAQ,GAAGvB,OAAO,CAACyB,UAAD,CAAlB;AACD,KAFD,MAEO;AACLF,MAAAA,QAAQ,GAAGvB,OAAO,CAACuB,QAAQ,CAACG,MAAV,CAAlB;AACD;;AACDF,IAAAA,UAAU,IAAI,CAAd;;AACA,QAAIA,UAAU,GAAG,GAAjB,EAAsB;AACpBI,MAAAA,OAAO,CAACC,GAAR,CACG,+DADH,EAEEN,QAFF;AAID;AACF;;AAED,SAAO,CAACD,SAAD,IAAcA,SAAS,CAACC,QAAD,CAAvB,GAAoCA,QAApC,GAA+C,IAAtD;AACD,CA1BD;AA4BA;;;;;;AAKAJ,OAAO,CAACC,oBAAR,GAA+BA,oBAA/B,C,CAEA;;AACAtB,CAAC,CAACc,IAAF,CAAOX,QAAQ,EAAf,EAAmBI,IAAI,IAAI;AACzBU,EAAAA,4BAA4B,CAACV,IAAD,CAA5B;AACD,CAFD","sourcesContent":["const _ = require(`lodash`)\nconst { getNode, getNodes } = require(`../db/nodes`)\n\n/**\n * Map containing links between inline objects or arrays\n * and Node that contains them\n * @type {Object.<(Object|Array),string>}\n */\nconst rootNodeMap = new WeakMap()\n\nconst getRootNodeId = node => rootNodeMap.get(node)\n\n/**\n * Add link between passed data and Node. This function shouldn't be used\n * directly. Use higher level `trackInlineObjectsInRootNode`\n * @see trackInlineObjectsInRootNode\n * @param {(Object|Array)} data Inline object or array\n * @param {string} nodeId Id of node that contains data passed in first parameter\n */\nconst addRootNodeToInlineObject = (data, nodeId) => {\n  if (_.isPlainObject(data) || _.isArray(data)) {\n    _.each(data, o => addRootNodeToInlineObject(o, nodeId))\n    rootNodeMap.set(data, nodeId)\n  }\n}\n\n/**\n * Adds link between inline objects/arrays contained in Node object\n * and that Node object.\n * @param {Node} node Root Node\n */\nconst trackInlineObjectsInRootNode = node => {\n  _.each(node, (v, k) => {\n    // Ignore the node internal object.\n    if (k === `internal`) {\n      return\n    }\n    addRootNodeToInlineObject(v, node.id)\n  })\n\n  return node\n}\nexports.trackInlineObjectsInRootNode = trackInlineObjectsInRootNode\n\n/**\n * Finds top most ancestor of node that contains passed Object or Array\n * @param {(Object|Array)} obj Object/Array belonging to Node object or Node object\n * @param {nodePredicate} [predicate] Optional callback to check if ancestor meets defined conditions\n * @returns {Node} Top most ancestor if predicate is not specified\n * or first node that meet predicate conditions if predicate is specified\n */\nconst findRootNodeAncestor = (obj, predicate = null) => {\n  // Find the root node.\n  let rootNode = obj\n  let whileCount = 0\n  let rootNodeId\n  while (\n    (!predicate || !predicate(rootNode)) &&\n    (rootNodeId = getRootNodeId(rootNode) || rootNode.parent) &&\n    (getNode(rootNode.parent) !== undefined || getNode(rootNodeId)) &&\n    whileCount < 101\n  ) {\n    if (rootNodeId) {\n      rootNode = getNode(rootNodeId)\n    } else {\n      rootNode = getNode(rootNode.parent)\n    }\n    whileCount += 1\n    if (whileCount > 100) {\n      console.log(\n        `It looks like you have a node that's set its parent as itself`,\n        rootNode\n      )\n    }\n  }\n\n  return !predicate || predicate(rootNode) ? rootNode : null\n}\n\n/**\n * @callback nodePredicate\n * @param {Node} node Node that is examined\n */\n\nexports.findRootNodeAncestor = findRootNodeAncestor\n\n// Track nodes that are already in store\n_.each(getNodes(), node => {\n  trackInlineObjectsInRootNode(node)\n})\n"],"file":"node-tracking.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/internal-plugins/dev-404-page/gatsby-node.js
+++ b/node_modules/gatsby/dist/internal-plugins/dev-404-page/gatsby-node.js
@@ -1,45 +1,35 @@
 "use strict";
 
-var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
-
-var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
-
 const path = require(`path`);
 
 const fs = require(`fs-extra`);
 
 const chokidar = require(`chokidar`);
 
-exports.createPagesStatefully =
-/*#__PURE__*/
-function () {
-  var _ref = (0, _asyncToGenerator2.default)(function* ({
-    store,
-    actions
-  }, options, done) {
-    if (process.env.NODE_ENV !== `production`) {
-      const _store$getState = store.getState(),
-            program = _store$getState.program;
-
-      const createPage = actions.createPage;
-      const source = path.join(__dirname, `./raw_dev-404-page.js`);
-      const destination = path.join(program.directory, `.cache`, `dev-404-page.js`);
-
-      const copy = () => fs.copy(source, destination);
-
-      yield copy();
-      createPage({
-        component: destination,
-        path: `/dev-404-page/`
-      });
-      chokidar.watch(source).on(`change`, () => copy()).on(`ready`, () => done());
-    } else {
-      done();
-    }
-  });
-
-  return function (_x, _x2, _x3) {
-    return _ref.apply(this, arguments);
-  };
-}();
+exports.createPagesStatefully = async ({
+  store,
+  actions
+}, options, done) => {
+  if (process.env.NODE_ENV !== `production`) {
+    const {
+      program
+    } = store.getState();
+    const {
+      createPage
+    } = actions;
+    const source = path.join(__dirname, `./raw_dev-404-page.js`);
+    const destination = path.join(program.directory, `.cache`, `dev-404-page.js`);
+
+    const copy = () => fs.copy(source, destination);
+
+    await copy();
+    createPage({
+      component: destination,
+      path: `/dev-404-page/`
+    });
+    chokidar.watch(source).on(`change`, () => copy()).on(`ready`, () => done());
+  } else {
+    done();
+  }
+};
 //# sourceMappingURL=gatsby-node.js.map
\ No newline at end of file
--- a/node_modules/gatsby/dist/internal-plugins/dev-404-page/gatsby-node.js.map
+++ b/node_modules/gatsby/dist/internal-plugins/dev-404-page/gatsby-node.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../../src/internal-plugins/dev-404-page/gatsby-node.js"],"names":["path","require","fs","chokidar","exports","createPagesStatefully","store","actions","options","done","process","env","NODE_ENV","getState","program","createPage","source","join","__dirname","destination","directory","copy","component","watch","on"],"mappings":";;;;;;AAAA,MAAMA,IAAI,GAAGC,OAAO,CAAE,MAAF,CAApB;;AACA,MAAMC,EAAE,GAAGD,OAAO,CAAE,UAAF,CAAlB;;AACA,MAAME,QAAQ,GAAGF,OAAO,CAAE,UAAF,CAAxB;;AAEAG,OAAO,CAACC,qBAAR;AAAA;AAAA;AAAA,6CAAgC,WAAO;AAAEC,IAAAA,KAAF;AAASC,IAAAA;AAAT,GAAP,EAA2BC,OAA3B,EAAoCC,IAApC,EAA6C;AAC3E,QAAIC,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAA0B,YAA9B,EAA2C;AAAA,8BACrBN,KAAK,CAACO,QAAN,EADqB;AAAA,YACjCC,OADiC,mBACjCA,OADiC;;AAAA,YAEjCC,UAFiC,GAElBR,OAFkB,CAEjCQ,UAFiC;AAGzC,YAAMC,MAAM,GAAGhB,IAAI,CAACiB,IAAL,CAAUC,SAAV,EAAsB,uBAAtB,CAAf;AACA,YAAMC,WAAW,GAAGnB,IAAI,CAACiB,IAAL,CAClBH,OAAO,CAACM,SADU,EAEjB,QAFiB,EAGjB,iBAHiB,CAApB;;AAKA,YAAMC,IAAI,GAAG,MAAMnB,EAAE,CAACmB,IAAH,CAAQL,MAAR,EAAgBG,WAAhB,CAAnB;;AACA,YAAME,IAAI,EAAV;AACAN,MAAAA,UAAU,CAAC;AACTO,QAAAA,SAAS,EAAEH,WADF;AAETnB,QAAAA,IAAI,EAAG;AAFE,OAAD,CAAV;AAIAG,MAAAA,QAAQ,CACLoB,KADH,CACSP,MADT,EAEGQ,EAFH,CAEO,QAFP,EAEgB,MAAMH,IAAI,EAF1B,EAGGG,EAHH,CAGO,OAHP,EAGe,MAAMf,IAAI,EAHzB;AAID,KAnBD,MAmBO;AACLA,MAAAA,IAAI;AACL;AACF,GAvBD;;AAAA;AAAA;AAAA;AAAA","sourcesContent":["const path = require(`path`)\nconst fs = require(`fs-extra`)\nconst chokidar = require(`chokidar`)\n\nexports.createPagesStatefully = async ({ store, actions }, options, done) => {\n  if (process.env.NODE_ENV !== `production`) {\n    const { program } = store.getState()\n    const { createPage } = actions\n    const source = path.join(__dirname, `./raw_dev-404-page.js`)\n    const destination = path.join(\n      program.directory,\n      `.cache`,\n      `dev-404-page.js`\n    )\n    const copy = () => fs.copy(source, destination)\n    await copy()\n    createPage({\n      component: destination,\n      path: `/dev-404-page/`,\n    })\n    chokidar\n      .watch(source)\n      .on(`change`, () => copy())\n      .on(`ready`, () => done())\n  } else {\n    done()\n  }\n}\n"],"file":"gatsby-node.js"}
\ No newline at end of file
+{"version":3,"sources":["../../../src/internal-plugins/dev-404-page/gatsby-node.js"],"names":["path","require","fs","chokidar","exports","createPagesStatefully","store","actions","options","done","process","env","NODE_ENV","program","getState","createPage","source","join","__dirname","destination","directory","copy","component","watch","on"],"mappings":";;AAAA,MAAMA,IAAI,GAAGC,OAAO,CAAE,MAAF,CAApB;;AACA,MAAMC,EAAE,GAAGD,OAAO,CAAE,UAAF,CAAlB;;AACA,MAAME,QAAQ,GAAGF,OAAO,CAAE,UAAF,CAAxB;;AAEAG,OAAO,CAACC,qBAAR,GAAgC,OAAO;AAAEC,EAAAA,KAAF;AAASC,EAAAA;AAAT,CAAP,EAA2BC,OAA3B,EAAoCC,IAApC,KAA6C;AAC3E,MAAIC,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAA0B,YAA9B,EAA2C;AACzC,UAAM;AAAEC,MAAAA;AAAF,QAAcP,KAAK,CAACQ,QAAN,EAApB;AACA,UAAM;AAAEC,MAAAA;AAAF,QAAiBR,OAAvB;AACA,UAAMS,MAAM,GAAGhB,IAAI,CAACiB,IAAL,CAAUC,SAAV,EAAsB,uBAAtB,CAAf;AACA,UAAMC,WAAW,GAAGnB,IAAI,CAACiB,IAAL,CAClBJ,OAAO,CAACO,SADU,EAEjB,QAFiB,EAGjB,iBAHiB,CAApB;;AAKA,UAAMC,IAAI,GAAG,MAAMnB,EAAE,CAACmB,IAAH,CAAQL,MAAR,EAAgBG,WAAhB,CAAnB;;AACA,UAAME,IAAI,EAAV;AACAN,IAAAA,UAAU,CAAC;AACTO,MAAAA,SAAS,EAAEH,WADF;AAETnB,MAAAA,IAAI,EAAG;AAFE,KAAD,CAAV;AAIAG,IAAAA,QAAQ,CACLoB,KADH,CACSP,MADT,EAEGQ,EAFH,CAEO,QAFP,EAEgB,MAAMH,IAAI,EAF1B,EAGGG,EAHH,CAGO,OAHP,EAGe,MAAMf,IAAI,EAHzB;AAID,GAnBD,MAmBO;AACLA,IAAAA,IAAI;AACL;AACF,CAvBD","sourcesContent":["const path = require(`path`)\nconst fs = require(`fs-extra`)\nconst chokidar = require(`chokidar`)\n\nexports.createPagesStatefully = async ({ store, actions }, options, done) => {\n  if (process.env.NODE_ENV !== `production`) {\n    const { program } = store.getState()\n    const { createPage } = actions\n    const source = path.join(__dirname, `./raw_dev-404-page.js`)\n    const destination = path.join(\n      program.directory,\n      `.cache`,\n      `dev-404-page.js`\n    )\n    const copy = () => fs.copy(source, destination)\n    await copy()\n    createPage({\n      component: destination,\n      path: `/dev-404-page/`,\n    })\n    chokidar\n      .watch(source)\n      .on(`change`, () => copy())\n      .on(`ready`, () => done())\n  } else {\n    done()\n  }\n}\n"],"file":"gatsby-node.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/internal-plugins/dev-404-page/raw_dev-404-page.js.map
+++ b/node_modules/gatsby/dist/internal-plugins/dev-404-page/raw_dev-404-page.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../../src/internal-plugins/dev-404-page/raw_dev-404-page.js"],"names":["Dev404Page","React","Component","constructor","props","state","showCustom404","bind","setState","render","pathname","location","pages","filter","p","test","path","newFilePath","slice","custom404","length","map","page","PropTypes","arrayOf","object","element"],"mappings":";;;;;;;;;AAAA;;AACA;;AACA;;AAEA,MAAMA,UAAN,SAAyBC,eAAMC,SAA/B,CAAyC;AAOvCC,EAAAA,WAAW,CAACC,KAAD,EAAQ;AACjB,UAAMA,KAAN;AACA,SAAKC,KAAL,GAAa;AAAEC,MAAAA,aAAa,EAAE;AAAjB,KAAb;AACA,SAAKA,aAAL,GAAqB,KAAKA,aAAL,CAAmBC,IAAnB,CAAwB,IAAxB,CAArB;AACD;;AAEDD,EAAAA,aAAa,GAAG;AACd,SAAKE,QAAL,CAAc;AAAEF,MAAAA,aAAa,EAAE;AAAjB,KAAd;AACD;;AAEDG,EAAAA,MAAM,GAAG;AAAA,UACCC,QADD,GACc,KAAKN,KAAL,CAAWO,QADzB,CACCD,QADD;AAEP,UAAME,KAAK,GAAG,KAAKR,KAAL,CAAWQ,KAAX,CAAiBC,MAAjB,CACZC,CAAC,IAAI,CAAC,qBAAqBC,IAArB,CAA0BD,CAAC,CAACE,IAA5B,CADM,CAAd;AAGA,QAAIC,WAAJ;;AACA,QAAIP,QAAQ,KAAM,GAAlB,EAAsB;AACpBO,MAAAA,WAAW,GAAI,oBAAf;AACD,KAFD,MAEO,IAAIP,QAAQ,CAACQ,KAAT,CAAe,CAAC,CAAhB,MAAwB,GAA5B,EAAgC;AACrCD,MAAAA,WAAW,GAAI,YAAWP,QAAQ,CAACQ,KAAT,CAAe,CAAf,EAAkB,CAAC,CAAnB,CAAsB,KAAhD;AACD,KAFM,MAEA;AACLD,MAAAA,WAAW,GAAI,YAAWP,QAAS,KAAnC;AACD;;AAED,WAAO,KAAKL,KAAL,CAAWC,aAAX,GACL,KAAKF,KAAL,CAAWe,SADN,GAGL,0CACE,0EADF,EAEE,wCACI,4BADJ,EAEE,2CAAOT,QAAP,CAFF,CAFF,EAMG,KAAKN,KAAL,CAAWe,SAAX,GACC,wCACE;AAAQ,MAAA,OAAO,EAAE,KAAKb;AAAtB,iCADF,CADD,GAOC,wCACI,iHADJ,EAEE,8DAFF,MAbJ,EAkBE,iGAEI,GAFJ,EAGE,2CAAOW,WAAP,CAHF,EAII,GAJJ,yFAlBF,EA0BGL,KAAK,CAACQ,MAAN,GAAe,CAAf,IACC,0CACE,mHADF,EAKE,oDAAYR,KAAK,CAACQ,MAAlB,MALF,EAME,yCACGR,KAAK,CAACS,GAAN,CAAUC,IAAI,IACb;AAAI,MAAA,GAAG,EAAEA,IAAI,CAACN;AAAd,OACE,6BAAC,YAAD;AAAM,MAAA,EAAE,EAAEM,IAAI,CAACN;AAAf,OAAsBM,IAAI,CAACN,IAA3B,CADF,CADD,CADH,CANF,CA3BJ,CAHF;AA+CD;;AA9EsC;;8BAAnChB,U,eACe;AACjBY,EAAAA,KAAK,EAAEW,mBAAUC,OAAV,CAAkBD,mBAAUE,MAA5B,CADU;AAEjBN,EAAAA,SAAS,EAAEI,mBAAUG,OAFJ;AAGjBf,EAAAA,QAAQ,EAAEY,mBAAUE;AAHH,C;eAgFNzB,U","sourcesContent":["import React from \"react\"\nimport PropTypes from \"prop-types\"\nimport { Link } from \"gatsby\"\n\nclass Dev404Page extends React.Component {\n  static propTypes = {\n    pages: PropTypes.arrayOf(PropTypes.object),\n    custom404: PropTypes.element,\n    location: PropTypes.object,\n  }\n\n  constructor(props) {\n    super(props)\n    this.state = { showCustom404: false }\n    this.showCustom404 = this.showCustom404.bind(this)\n  }\n\n  showCustom404() {\n    this.setState({ showCustom404: true })\n  }\n\n  render() {\n    const { pathname } = this.props.location\n    const pages = this.props.pages.filter(\n      p => !/^\\/dev-404-page\\/$/.test(p.path)\n    )\n    let newFilePath\n    if (pathname === `/`) {\n      newFilePath = `src/pages/index.js`\n    } else if (pathname.slice(-1) === `/`) {\n      newFilePath = `src/pages${pathname.slice(0, -1)}.js`\n    } else {\n      newFilePath = `src/pages${pathname}.js`\n    }\n\n    return this.state.showCustom404 ? (\n      this.props.custom404\n    ) : (\n      <div>\n        <h1>Gatsby.js development 404 page</h1>\n        <p>\n          {`There's not a page yet at `}\n          <code>{pathname}</code>\n        </p>\n        {this.props.custom404 ? (\n          <p>\n            <button onClick={this.showCustom404}>\n              Preview custom 404 page\n            </button>\n          </p>\n        ) : (\n          <p>\n            {`A custom 404 page wasn't detected - if you would like to add one, create a component in your site directory at `}\n            <code>src/pages/404.js</code>.\n          </p>\n        )}\n        <p>\n          Create a React.js component in your site directory at\n          {` `}\n          <code>{newFilePath}</code>\n          {` `}\n          and this page will automatically refresh to show the new page\n          component you created.\n        </p>\n        {pages.length > 0 && (\n          <div>\n            <p>\n              If you were trying to reach another page, perhaps you can find it\n              below.\n            </p>\n            <h2>Pages ({pages.length})</h2>\n            <ul>\n              {pages.map(page => (\n                <li key={page.path}>\n                  <Link to={page.path}>{page.path}</Link>\n                </li>\n              ))}\n            </ul>\n          </div>\n        )}\n      </div>\n    )\n  }\n}\n\nexport default Dev404Page\n"],"file":"raw_dev-404-page.js"}
\ No newline at end of file
+{"version":3,"sources":["../../../src/internal-plugins/dev-404-page/raw_dev-404-page.js"],"names":["Dev404Page","React","Component","constructor","props","state","showCustom404","bind","setState","render","pathname","location","pages","filter","p","test","path","newFilePath","slice","custom404","length","map","page","PropTypes","arrayOf","object","element"],"mappings":"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","sourcesContent":["import React from \"react\"\nimport PropTypes from \"prop-types\"\nimport { Link } from \"gatsby\"\n\nclass Dev404Page extends React.Component {\n  static propTypes = {\n    pages: PropTypes.arrayOf(PropTypes.object),\n    custom404: PropTypes.element,\n    location: PropTypes.object,\n  }\n\n  constructor(props) {\n    super(props)\n    this.state = { showCustom404: false }\n    this.showCustom404 = this.showCustom404.bind(this)\n  }\n\n  showCustom404() {\n    this.setState({ showCustom404: true })\n  }\n\n  render() {\n    const { pathname } = this.props.location\n    const pages = this.props.pages.filter(\n      p => !/^\\/dev-404-page\\/$/.test(p.path)\n    )\n    let newFilePath\n    if (pathname === `/`) {\n      newFilePath = `src/pages/index.js`\n    } else if (pathname.slice(-1) === `/`) {\n      newFilePath = `src/pages${pathname.slice(0, -1)}.js`\n    } else {\n      newFilePath = `src/pages${pathname}.js`\n    }\n\n    return this.state.showCustom404 ? (\n      this.props.custom404\n    ) : (\n      <div>\n        <h1>Gatsby.js development 404 page</h1>\n        <p>\n          {`There's not a page yet at `}\n          <code>{pathname}</code>\n        </p>\n        {this.props.custom404 ? (\n          <p>\n            <button onClick={this.showCustom404}>\n              Preview custom 404 page\n            </button>\n          </p>\n        ) : (\n          <p>\n            {`A custom 404 page wasn't detected - if you would like to add one, create a component in your site directory at `}\n            <code>src/pages/404.js</code>.\n          </p>\n        )}\n        <p>\n          Create a React.js component in your site directory at\n          {` `}\n          <code>{newFilePath}</code>\n          {` `}\n          and this page will automatically refresh to show the new page\n          component you created.\n        </p>\n        {pages.length > 0 && (\n          <div>\n            <p>\n              If you were trying to reach another page, perhaps you can find it\n              below.\n            </p>\n            <h2>Pages ({pages.length})</h2>\n            <ul>\n              {pages.map(page => (\n                <li key={page.path}>\n                  <Link to={page.path}>{page.path}</Link>\n                </li>\n              ))}\n            </ul>\n          </div>\n        )}\n      </div>\n    )\n  }\n}\n\nexport default Dev404Page\n"],"file":"raw_dev-404-page.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/internal-plugins/internal-data-bridge/gatsby-node.js
+++ b/node_modules/gatsby/dist/internal-plugins/internal-data-bridge/gatsby-node.js
@@ -1,9 +1,5 @@
 "use strict";
 
-var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
-
-var _objectWithoutPropertiesLoose2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutPropertiesLoose"));
-
 const crypto = require(`crypto`);
 
 const moment = require(`moment`);
@@ -14,14 +10,17 @@ const systemPath = require(`path`);
 
 const _ = require(`lodash`);
 
-const _require = require(`../../redux`),
-      emitter = _require.emitter;
+const {
+  emitter
+} = require(`../../redux`);
 
-const _require2 = require(`../../redux/actions`),
-      boundActionCreators = _require2.boundActionCreators;
+const {
+  boundActionCreators
+} = require(`../../redux/actions`);
 
-const _require3 = require(`../../db/nodes`),
-      getNode = _require3.getNode;
+const {
+  getNode
+} = require(`../../db/nodes`);
 
 function transformPackageJson(json) {
   const transformDeps = deps => _.entries(deps).map(([name, version]) => {
@@ -46,16 +45,22 @@ exports.sourceNodes = ({
   actions,
   store
 }) => {
-  const createNode = actions.createNode;
+  const {
+    createNode
+  } = actions;
   const state = store.getState();
-  const program = state.program;
-  const flattenedPlugins = state.flattenedPlugins; // Add our default development page since we know it's going to
+  const {
+    program
+  } = state;
+  const {
+    flattenedPlugins
+  } = state; // Add our default development page since we know it's going to
   // exist and we need a node to exist so its query works :-)
 
   const page = {
     path: `/dev-404-page/`
   };
-  createNode(Object.assign({}, page, {
+  createNode({ ...page,
     id: createPageId(page.path),
     parent: `SOURCE`,
     children: [],
@@ -63,10 +68,10 @@ exports.sourceNodes = ({
       type: `SitePage`,
       contentDigest: crypto.createHash(`md5`).update(JSON.stringify(page)).digest(`hex`)
     }
-  }));
+  });
   flattenedPlugins.forEach(plugin => {
     plugin.pluginFilepath = plugin.resolve;
-    createNode(Object.assign({}, plugin, {
+    createNode({ ...plugin,
       packageJson: transformPackageJson(require(`${plugin.resolve}/package.json`)),
       parent: `SOURCE`,
       children: [],
@@ -74,23 +79,25 @@ exports.sourceNodes = ({
         contentDigest: crypto.createHash(`md5`).update(JSON.stringify(plugin)).digest(`hex`),
         type: `SitePlugin`
       }
-    }));
+    });
   }); // Add site node.
 
   const buildTime = moment().subtract(process.uptime(), `seconds`).toJSON();
 
   const createGatsbyConfigNode = (config = {}) => {
     // Delete plugins from the config as we add plugins above.
-    const configCopy = Object.assign({}, config);
+    const configCopy = { ...config
+    };
     delete configCopy.plugins;
-    const node = Object.assign({
-      siteMetadata: Object.assign({}, configCopy.siteMetadata),
+    const node = {
+      siteMetadata: { ...configCopy.siteMetadata
+      },
       port: state.program.port,
-      host: state.program.host
-    }, configCopy, {
+      host: state.program.host,
+      ...configCopy,
       buildTime
-    });
-    createNode(Object.assign({}, node, {
+    };
+    createNode({ ...node,
       id: `Site`,
       parent: `SOURCE`,
       children: [],
@@ -98,7 +105,7 @@ exports.sourceNodes = ({
         contentDigest: crypto.createHash(`md5`).update(JSON.stringify(node)).digest(`hex`),
         type: `Site`
       }
-    }));
+    });
   };
 
   createGatsbyConfigNode(state.config);
@@ -126,12 +133,16 @@ exports.onCreatePage = ({
   page,
   actions
 }) => {
-  const createNode = actions.createNode; // eslint-disable-next-line
+  const {
+    createNode
+  } = actions; // eslint-disable-next-line
 
-  const updatedAt = page.updatedAt,
-        pageWithoutUpdated = (0, _objectWithoutPropertiesLoose2.default)(page, ["updatedAt"]); // Add page.
+  const {
+    updatedAt,
+    ...pageWithoutUpdated
+  } = page; // Add page.
 
-  createNode(Object.assign({}, pageWithoutUpdated, {
+  createNode({ ...pageWithoutUpdated,
     id: createPageId(page.path),
     parent: `SOURCE`,
     children: [],
@@ -140,7 +151,7 @@ exports.onCreatePage = ({
       contentDigest: crypto.createHash(`md5`).update(JSON.stringify(pageWithoutUpdated)).digest(`hex`),
       description: page.pluginCreatorId === `Plugin default-site-plugin` ? `Your site's "gatsby-node.js"` : page.pluginCreatorId
     }
-  }));
+  });
 }; // Listen for DELETE_PAGE and delete page nodes.
 
 
--- a/node_modules/gatsby/dist/internal-plugins/internal-data-bridge/gatsby-node.js.map
+++ b/node_modules/gatsby/dist/internal-plugins/internal-data-bridge/gatsby-node.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../../src/internal-plugins/internal-data-bridge/gatsby-node.js"],"names":["crypto","require","moment","chokidar","systemPath","_","emitter","boundActionCreators","getNode","transformPackageJson","json","transformDeps","deps","entries","map","name","version","pick","dependencies","devDependencies","peerDependencies","optionalDependecies","bundledDependecies","createPageId","path","exports","sourceNodes","actions","store","createNode","state","getState","program","flattenedPlugins","page","id","parent","children","internal","type","contentDigest","createHash","update","JSON","stringify","digest","forEach","plugin","pluginFilepath","resolve","packageJson","buildTime","subtract","process","uptime","toJSON","createGatsbyConfigNode","config","configCopy","plugins","node","siteMetadata","port","host","pathToGatsbyConfig","join","directory","watch","on","oldCache","cache","e","undefined","onCreatePage","updatedAt","pageWithoutUpdated","description","pluginCreatorId","action","nodeId","payload","deleteNode"],"mappings":"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","sourcesContent":["const crypto = require(`crypto`)\nconst moment = require(`moment`)\nconst chokidar = require(`chokidar`)\nconst systemPath = require(`path`)\nconst _ = require(`lodash`)\n\nconst { emitter } = require(`../../redux`)\nconst { boundActionCreators } = require(`../../redux/actions`)\nconst { getNode } = require(`../../db/nodes`)\n\nfunction transformPackageJson(json) {\n  const transformDeps = deps =>\n    _.entries(deps).map(([name, version]) => {\n      return {\n        name,\n        version,\n      }\n    })\n\n  json = _.pick(json, [\n    `name`,\n    `description`,\n    `version`,\n    `main`,\n    `keywords`,\n    `author`,\n    `license`,\n    `dependencies`,\n    `devDependencies`,\n    `peerDependencies`,\n    `optionalDependecies`,\n    `bundledDependecies`,\n  ])\n  json.dependencies = transformDeps(json.dependencies)\n  json.devDependencies = transformDeps(json.devDependencies)\n  json.peerDependencies = transformDeps(json.peerDependencies)\n  json.optionalDependecies = transformDeps(json.optionalDependecies)\n  json.bundledDependecies = transformDeps(json.bundledDependecies)\n\n  return json\n}\n\nconst createPageId = path => `SitePage ${path}`\n\nexports.sourceNodes = ({ actions, store }) => {\n  const { createNode } = actions\n  const state = store.getState()\n  const { program } = state\n  const { flattenedPlugins } = state\n\n  // Add our default development page since we know it's going to\n  // exist and we need a node to exist so its query works :-)\n  const page = { path: `/dev-404-page/` }\n  createNode({\n    ...page,\n    id: createPageId(page.path),\n    parent: `SOURCE`,\n    children: [],\n    internal: {\n      type: `SitePage`,\n      contentDigest: crypto\n        .createHash(`md5`)\n        .update(JSON.stringify(page))\n        .digest(`hex`),\n    },\n  })\n\n  flattenedPlugins.forEach(plugin => {\n    plugin.pluginFilepath = plugin.resolve\n    createNode({\n      ...plugin,\n      packageJson: transformPackageJson(\n        require(`${plugin.resolve}/package.json`)\n      ),\n      parent: `SOURCE`,\n      children: [],\n      internal: {\n        contentDigest: crypto\n          .createHash(`md5`)\n          .update(JSON.stringify(plugin))\n          .digest(`hex`),\n        type: `SitePlugin`,\n      },\n    })\n  })\n\n  // Add site node.\n  const buildTime = moment()\n    .subtract(process.uptime(), `seconds`)\n    .toJSON()\n\n  const createGatsbyConfigNode = (config = {}) => {\n    // Delete plugins from the config as we add plugins above.\n    const configCopy = { ...config }\n    delete configCopy.plugins\n    const node = {\n      siteMetadata: {\n        ...configCopy.siteMetadata,\n      },\n      port: state.program.port,\n      host: state.program.host,\n      ...configCopy,\n      buildTime,\n    }\n    createNode({\n      ...node,\n      id: `Site`,\n      parent: `SOURCE`,\n      children: [],\n      internal: {\n        contentDigest: crypto\n          .createHash(`md5`)\n          .update(JSON.stringify(node))\n          .digest(`hex`),\n        type: `Site`,\n      },\n    })\n  }\n\n  createGatsbyConfigNode(state.config)\n\n  const pathToGatsbyConfig = systemPath.join(\n    program.directory,\n    `gatsby-config.js`\n  )\n  chokidar.watch(pathToGatsbyConfig).on(`change`, () => {\n    const oldCache = require.cache[require.resolve(pathToGatsbyConfig)]\n    try {\n      // Delete require cache so we can reload the module.\n      delete require.cache[require.resolve(pathToGatsbyConfig)]\n      const config = require(pathToGatsbyConfig)\n      createGatsbyConfigNode(config)\n    } catch (e) {\n      // Restore the old cache since requiring the new gatsby-config.js failed.\n      if (oldCache !== undefined) {\n        require.cache[require.resolve(pathToGatsbyConfig)] = oldCache\n      }\n    }\n  })\n}\n\nexports.onCreatePage = ({ page, actions }) => {\n  const { createNode } = actions\n  // eslint-disable-next-line\n  const { updatedAt, ...pageWithoutUpdated } = page\n\n  // Add page.\n  createNode({\n    ...pageWithoutUpdated,\n    id: createPageId(page.path),\n    parent: `SOURCE`,\n    children: [],\n    internal: {\n      type: `SitePage`,\n      contentDigest: crypto\n        .createHash(`md5`)\n        .update(JSON.stringify(pageWithoutUpdated))\n        .digest(`hex`),\n      description:\n        page.pluginCreatorId === `Plugin default-site-plugin`\n          ? `Your site's \"gatsby-node.js\"`\n          : page.pluginCreatorId,\n    },\n  })\n}\n\n// Listen for DELETE_PAGE and delete page nodes.\nemitter.on(`DELETE_PAGE`, action => {\n  const nodeId = createPageId(action.payload.path)\n  const node = getNode(nodeId)\n  boundActionCreators.deleteNode({ node })\n})\n"],"file":"gatsby-node.js"}
\ No newline at end of file
+{"version":3,"sources":["../../../src/internal-plugins/internal-data-bridge/gatsby-node.js"],"names":["crypto","require","moment","chokidar","systemPath","_","emitter","boundActionCreators","getNode","transformPackageJson","json","transformDeps","deps","entries","map","name","version","pick","dependencies","devDependencies","peerDependencies","optionalDependecies","bundledDependecies","createPageId","path","exports","sourceNodes","actions","store","createNode","state","getState","program","flattenedPlugins","page","id","parent","children","internal","type","contentDigest","createHash","update","JSON","stringify","digest","forEach","plugin","pluginFilepath","resolve","packageJson","buildTime","subtract","process","uptime","toJSON","createGatsbyConfigNode","config","configCopy","plugins","node","siteMetadata","port","host","pathToGatsbyConfig","join","directory","watch","on","oldCache","cache","e","undefined","onCreatePage","updatedAt","pageWithoutUpdated","description","pluginCreatorId","action","nodeId","payload","deleteNode"],"mappings":"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","sourcesContent":["const crypto = require(`crypto`)\nconst moment = require(`moment`)\nconst chokidar = require(`chokidar`)\nconst systemPath = require(`path`)\nconst _ = require(`lodash`)\n\nconst { emitter } = require(`../../redux`)\nconst { boundActionCreators } = require(`../../redux/actions`)\nconst { getNode } = require(`../../db/nodes`)\n\nfunction transformPackageJson(json) {\n  const transformDeps = deps =>\n    _.entries(deps).map(([name, version]) => {\n      return {\n        name,\n        version,\n      }\n    })\n\n  json = _.pick(json, [\n    `name`,\n    `description`,\n    `version`,\n    `main`,\n    `keywords`,\n    `author`,\n    `license`,\n    `dependencies`,\n    `devDependencies`,\n    `peerDependencies`,\n    `optionalDependecies`,\n    `bundledDependecies`,\n  ])\n  json.dependencies = transformDeps(json.dependencies)\n  json.devDependencies = transformDeps(json.devDependencies)\n  json.peerDependencies = transformDeps(json.peerDependencies)\n  json.optionalDependecies = transformDeps(json.optionalDependecies)\n  json.bundledDependecies = transformDeps(json.bundledDependecies)\n\n  return json\n}\n\nconst createPageId = path => `SitePage ${path}`\n\nexports.sourceNodes = ({ actions, store }) => {\n  const { createNode } = actions\n  const state = store.getState()\n  const { program } = state\n  const { flattenedPlugins } = state\n\n  // Add our default development page since we know it's going to\n  // exist and we need a node to exist so its query works :-)\n  const page = { path: `/dev-404-page/` }\n  createNode({\n    ...page,\n    id: createPageId(page.path),\n    parent: `SOURCE`,\n    children: [],\n    internal: {\n      type: `SitePage`,\n      contentDigest: crypto\n        .createHash(`md5`)\n        .update(JSON.stringify(page))\n        .digest(`hex`),\n    },\n  })\n\n  flattenedPlugins.forEach(plugin => {\n    plugin.pluginFilepath = plugin.resolve\n    createNode({\n      ...plugin,\n      packageJson: transformPackageJson(\n        require(`${plugin.resolve}/package.json`)\n      ),\n      parent: `SOURCE`,\n      children: [],\n      internal: {\n        contentDigest: crypto\n          .createHash(`md5`)\n          .update(JSON.stringify(plugin))\n          .digest(`hex`),\n        type: `SitePlugin`,\n      },\n    })\n  })\n\n  // Add site node.\n  const buildTime = moment()\n    .subtract(process.uptime(), `seconds`)\n    .toJSON()\n\n  const createGatsbyConfigNode = (config = {}) => {\n    // Delete plugins from the config as we add plugins above.\n    const configCopy = { ...config }\n    delete configCopy.plugins\n    const node = {\n      siteMetadata: {\n        ...configCopy.siteMetadata,\n      },\n      port: state.program.port,\n      host: state.program.host,\n      ...configCopy,\n      buildTime,\n    }\n    createNode({\n      ...node,\n      id: `Site`,\n      parent: `SOURCE`,\n      children: [],\n      internal: {\n        contentDigest: crypto\n          .createHash(`md5`)\n          .update(JSON.stringify(node))\n          .digest(`hex`),\n        type: `Site`,\n      },\n    })\n  }\n\n  createGatsbyConfigNode(state.config)\n\n  const pathToGatsbyConfig = systemPath.join(\n    program.directory,\n    `gatsby-config.js`\n  )\n  chokidar.watch(pathToGatsbyConfig).on(`change`, () => {\n    const oldCache = require.cache[require.resolve(pathToGatsbyConfig)]\n    try {\n      // Delete require cache so we can reload the module.\n      delete require.cache[require.resolve(pathToGatsbyConfig)]\n      const config = require(pathToGatsbyConfig)\n      createGatsbyConfigNode(config)\n    } catch (e) {\n      // Restore the old cache since requiring the new gatsby-config.js failed.\n      if (oldCache !== undefined) {\n        require.cache[require.resolve(pathToGatsbyConfig)] = oldCache\n      }\n    }\n  })\n}\n\nexports.onCreatePage = ({ page, actions }) => {\n  const { createNode } = actions\n  // eslint-disable-next-line\n  const { updatedAt, ...pageWithoutUpdated } = page\n\n  // Add page.\n  createNode({\n    ...pageWithoutUpdated,\n    id: createPageId(page.path),\n    parent: `SOURCE`,\n    children: [],\n    internal: {\n      type: `SitePage`,\n      contentDigest: crypto\n        .createHash(`md5`)\n        .update(JSON.stringify(pageWithoutUpdated))\n        .digest(`hex`),\n      description:\n        page.pluginCreatorId === `Plugin default-site-plugin`\n          ? `Your site's \"gatsby-node.js\"`\n          : page.pluginCreatorId,\n    },\n  })\n}\n\n// Listen for DELETE_PAGE and delete page nodes.\nemitter.on(`DELETE_PAGE`, action => {\n  const nodeId = createPageId(action.payload.path)\n  const node = getNode(nodeId)\n  boundActionCreators.deleteNode({ node })\n})\n"],"file":"gatsby-node.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/internal-plugins/load-babel-config/gatsby-node.js
+++ b/node_modules/gatsby/dist/internal-plugins/load-babel-config/gatsby-node.js
@@ -1,46 +1,36 @@
 "use strict";
 
-var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
-
-var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
-
 const fs = require(`fs-extra`);
 
 const apiRunnerNode = require(`../../utils/api-runner-node`);
 
-const _require = require(`../../utils/path`),
-      withBasePath = _require.withBasePath;
+const {
+  withBasePath
+} = require(`../../utils/path`);
 
-exports.onPreBootstrap =
-/*#__PURE__*/
-function () {
-  var _ref = (0, _asyncToGenerator2.default)(function* ({
-    store
-  }) {
-    const _store$getState$progr = store.getState().program,
-          directory = _store$getState$progr.directory,
-          browserslist = _store$getState$progr.browserslist;
-    const directoryPath = withBasePath(directory);
-    yield apiRunnerNode(`onCreateBabelConfig`, {
-      stage: `develop`
-    });
-    yield apiRunnerNode(`onCreateBabelConfig`, {
-      stage: `develop-html`
-    });
-    yield apiRunnerNode(`onCreateBabelConfig`, {
-      stage: `build-javascript`
-    });
-    yield apiRunnerNode(`onCreateBabelConfig`, {
-      stage: `build-html`
-    });
-    const babelState = JSON.stringify(Object.assign({}, store.getState().babelrc, {
-      browserslist
-    }), null, 2);
-    yield fs.writeFile(directoryPath(`.cache/babelState.json`), babelState);
+exports.onPreBootstrap = async ({
+  store
+}) => {
+  const {
+    directory,
+    browserslist
+  } = store.getState().program;
+  const directoryPath = withBasePath(directory);
+  await apiRunnerNode(`onCreateBabelConfig`, {
+    stage: `develop`
   });
-
-  return function (_x) {
-    return _ref.apply(this, arguments);
-  };
-}();
+  await apiRunnerNode(`onCreateBabelConfig`, {
+    stage: `develop-html`
+  });
+  await apiRunnerNode(`onCreateBabelConfig`, {
+    stage: `build-javascript`
+  });
+  await apiRunnerNode(`onCreateBabelConfig`, {
+    stage: `build-html`
+  });
+  const babelState = JSON.stringify({ ...store.getState().babelrc,
+    browserslist
+  }, null, 2);
+  await fs.writeFile(directoryPath(`.cache/babelState.json`), babelState);
+};
 //# sourceMappingURL=gatsby-node.js.map
\ No newline at end of file
--- a/node_modules/gatsby/dist/internal-plugins/load-babel-config/gatsby-node.js.map
+++ b/node_modules/gatsby/dist/internal-plugins/load-babel-config/gatsby-node.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../../src/internal-plugins/load-babel-config/gatsby-node.js"],"names":["fs","require","apiRunnerNode","withBasePath","exports","onPreBootstrap","store","getState","program","directory","browserslist","directoryPath","stage","babelState","JSON","stringify","babelrc","writeFile"],"mappings":";;;;;;AAEA,MAAMA,EAAE,GAAGC,OAAO,CAAE,UAAF,CAAlB;;AAEA,MAAMC,aAAa,GAAGD,OAAO,CAAE,6BAAF,CAA7B;;iBACyBA,OAAO,CAAE,kBAAF,C;MAAxBE,Y,YAAAA,Y;;AAERC,OAAO,CAACC,cAAR;AAAA;AAAA;AAAA,6CAAyB,WAAO;AAAEC,IAAAA;AAAF,GAAP,EAAqB;AAAA,kCACRA,KAAK,CAACC,QAAN,GAAiBC,OADT;AAAA,UACpCC,SADoC,yBACpCA,SADoC;AAAA,UACzBC,YADyB,yBACzBA,YADyB;AAE5C,UAAMC,aAAa,GAAGR,YAAY,CAACM,SAAD,CAAlC;AAEA,UAAMP,aAAa,CAAE,qBAAF,EAAwB;AACzCU,MAAAA,KAAK,EAAG;AADiC,KAAxB,CAAnB;AAGA,UAAMV,aAAa,CAAE,qBAAF,EAAwB;AACzCU,MAAAA,KAAK,EAAG;AADiC,KAAxB,CAAnB;AAGA,UAAMV,aAAa,CAAE,qBAAF,EAAwB;AACzCU,MAAAA,KAAK,EAAG;AADiC,KAAxB,CAAnB;AAGA,UAAMV,aAAa,CAAE,qBAAF,EAAwB;AACzCU,MAAAA,KAAK,EAAG;AADiC,KAAxB,CAAnB;AAIA,UAAMC,UAAU,GAAGC,IAAI,CAACC,SAAL,mBAEZT,KAAK,CAACC,QAAN,GAAiBS,OAFL;AAGfN,MAAAA;AAHe,QAKjB,IALiB,EAMjB,CANiB,CAAnB;AASA,UAAMV,EAAE,CAACiB,SAAH,CAAaN,aAAa,CAAE,wBAAF,CAA1B,EAAsDE,UAAtD,CAAN;AACD,GA3BD;;AAAA;AAAA;AAAA;AAAA","sourcesContent":["/* @flow */\n\nconst fs = require(`fs-extra`)\n\nconst apiRunnerNode = require(`../../utils/api-runner-node`)\nconst { withBasePath } = require(`../../utils/path`)\n\nexports.onPreBootstrap = async ({ store }) => {\n  const { directory, browserslist } = store.getState().program\n  const directoryPath = withBasePath(directory)\n\n  await apiRunnerNode(`onCreateBabelConfig`, {\n    stage: `develop`,\n  })\n  await apiRunnerNode(`onCreateBabelConfig`, {\n    stage: `develop-html`,\n  })\n  await apiRunnerNode(`onCreateBabelConfig`, {\n    stage: `build-javascript`,\n  })\n  await apiRunnerNode(`onCreateBabelConfig`, {\n    stage: `build-html`,\n  })\n\n  const babelState = JSON.stringify(\n    {\n      ...store.getState().babelrc,\n      browserslist,\n    },\n    null,\n    2\n  )\n\n  await fs.writeFile(directoryPath(`.cache/babelState.json`), babelState)\n}\n"],"file":"gatsby-node.js"}
\ No newline at end of file
+{"version":3,"sources":["../../../src/internal-plugins/load-babel-config/gatsby-node.js"],"names":["fs","require","apiRunnerNode","withBasePath","exports","onPreBootstrap","store","directory","browserslist","getState","program","directoryPath","stage","babelState","JSON","stringify","babelrc","writeFile"],"mappings":";;AAEA,MAAMA,EAAE,GAAGC,OAAO,CAAE,UAAF,CAAlB;;AAEA,MAAMC,aAAa,GAAGD,OAAO,CAAE,6BAAF,CAA7B;;AACA,MAAM;AAAEE,EAAAA;AAAF,IAAmBF,OAAO,CAAE,kBAAF,CAAhC;;AAEAG,OAAO,CAACC,cAAR,GAAyB,OAAO;AAAEC,EAAAA;AAAF,CAAP,KAAqB;AAC5C,QAAM;AAAEC,IAAAA,SAAF;AAAaC,IAAAA;AAAb,MAA8BF,KAAK,CAACG,QAAN,GAAiBC,OAArD;AACA,QAAMC,aAAa,GAAGR,YAAY,CAACI,SAAD,CAAlC;AAEA,QAAML,aAAa,CAAE,qBAAF,EAAwB;AACzCU,IAAAA,KAAK,EAAG;AADiC,GAAxB,CAAnB;AAGA,QAAMV,aAAa,CAAE,qBAAF,EAAwB;AACzCU,IAAAA,KAAK,EAAG;AADiC,GAAxB,CAAnB;AAGA,QAAMV,aAAa,CAAE,qBAAF,EAAwB;AACzCU,IAAAA,KAAK,EAAG;AADiC,GAAxB,CAAnB;AAGA,QAAMV,aAAa,CAAE,qBAAF,EAAwB;AACzCU,IAAAA,KAAK,EAAG;AADiC,GAAxB,CAAnB;AAIA,QAAMC,UAAU,GAAGC,IAAI,CAACC,SAAL,CACjB,EACE,GAAGT,KAAK,CAACG,QAAN,GAAiBO,OADtB;AAEER,IAAAA;AAFF,GADiB,EAKjB,IALiB,EAMjB,CANiB,CAAnB;AASA,QAAMR,EAAE,CAACiB,SAAH,CAAaN,aAAa,CAAE,wBAAF,CAA1B,EAAsDE,UAAtD,CAAN;AACD,CA3BD","sourcesContent":["/* @flow */\n\nconst fs = require(`fs-extra`)\n\nconst apiRunnerNode = require(`../../utils/api-runner-node`)\nconst { withBasePath } = require(`../../utils/path`)\n\nexports.onPreBootstrap = async ({ store }) => {\n  const { directory, browserslist } = store.getState().program\n  const directoryPath = withBasePath(directory)\n\n  await apiRunnerNode(`onCreateBabelConfig`, {\n    stage: `develop`,\n  })\n  await apiRunnerNode(`onCreateBabelConfig`, {\n    stage: `develop-html`,\n  })\n  await apiRunnerNode(`onCreateBabelConfig`, {\n    stage: `build-javascript`,\n  })\n  await apiRunnerNode(`onCreateBabelConfig`, {\n    stage: `build-html`,\n  })\n\n  const babelState = JSON.stringify(\n    {\n      ...store.getState().babelrc,\n      browserslist,\n    },\n    null,\n    2\n  )\n\n  await fs.writeFile(directoryPath(`.cache/babelState.json`), babelState)\n}\n"],"file":"gatsby-node.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/internal-plugins/prod-404/gatsby-node.js
+++ b/node_modules/gatsby/dist/internal-plugins/prod-404/gatsby-node.js
@@ -11,9 +11,9 @@ exports.onCreatePage = ({
   // site 404 pages to be named this.
   // https://www.gatsbyjs.org/docs/add-404-page/
   if (!created404 && page.path === `/404/`) {
-    actions.createPage(Object.assign({}, page, {
+    actions.createPage({ ...page,
       path: `/404.html`
-    }));
+    });
     created404 = true;
   }
 };
--- a/node_modules/gatsby/dist/internal-plugins/prod-404/gatsby-node.js.map
+++ b/node_modules/gatsby/dist/internal-plugins/prod-404/gatsby-node.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../../src/internal-plugins/prod-404/gatsby-node.js"],"names":["created404","exports","onCreatePage","page","store","actions","path","createPage"],"mappings":";;AAAA,IAAIA,UAAU,GAAG,KAAjB;;AACAC,OAAO,CAACC,YAAR,GAAuB,CAAC;AAAEC,EAAAA,IAAF;AAAQC,EAAAA,KAAR;AAAeC,EAAAA;AAAf,CAAD,KAA8B;AACnD;AACA;AACA;AACA,MAAI,CAACL,UAAD,IAAeG,IAAI,CAACG,IAAL,KAAe,OAAlC,EAA0C;AACxCD,IAAAA,OAAO,CAACE,UAAR,mBACKJ,IADL;AAEEG,MAAAA,IAAI,EAAG;AAFT;AAIAN,IAAAA,UAAU,GAAG,IAAb;AACD;AACF,CAXD","sourcesContent":["let created404 = false\nexports.onCreatePage = ({ page, store, actions }) => {\n  // Copy /404/ to /404.html as many static site hosts expect\n  // site 404 pages to be named this.\n  // https://www.gatsbyjs.org/docs/add-404-page/\n  if (!created404 && page.path === `/404/`) {\n    actions.createPage({\n      ...page,\n      path: `/404.html`,\n    })\n    created404 = true\n  }\n}\n"],"file":"gatsby-node.js"}
\ No newline at end of file
+{"version":3,"sources":["../../../src/internal-plugins/prod-404/gatsby-node.js"],"names":["created404","exports","onCreatePage","page","store","actions","path","createPage"],"mappings":";;AAAA,IAAIA,UAAU,GAAG,KAAjB;;AACAC,OAAO,CAACC,YAAR,GAAuB,CAAC;AAAEC,EAAAA,IAAF;AAAQC,EAAAA,KAAR;AAAeC,EAAAA;AAAf,CAAD,KAA8B;AACnD;AACA;AACA;AACA,MAAI,CAACL,UAAD,IAAeG,IAAI,CAACG,IAAL,KAAe,OAAlC,EAA0C;AACxCD,IAAAA,OAAO,CAACE,UAAR,CAAmB,EACjB,GAAGJ,IADc;AAEjBG,MAAAA,IAAI,EAAG;AAFU,KAAnB;AAIAN,IAAAA,UAAU,GAAG,IAAb;AACD;AACF,CAXD","sourcesContent":["let created404 = false\nexports.onCreatePage = ({ page, store, actions }) => {\n  // Copy /404/ to /404.html as many static site hosts expect\n  // site 404 pages to be named this.\n  // https://www.gatsbyjs.org/docs/add-404-page/\n  if (!created404 && page.path === `/404/`) {\n    actions.createPage({\n      ...page,\n      path: `/404.html`,\n    })\n    created404 = true\n  }\n}\n"],"file":"gatsby-node.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/internal-plugins/query-runner/file-parser.js
+++ b/node_modules/gatsby/dist/internal-plugins/query-runner/file-parser.js
@@ -5,8 +5,6 @@ var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefau
 exports.__esModule = true;
 exports.default = void 0;
 
-var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
-
 var _babelTraverse = _interopRequireDefault(require("babel-traverse"));
 
 var _babelParseToAst = require("../../utils/babel-parse-to-ast");
@@ -43,254 +41,221 @@ const generateQueryName = ({
   return def;
 };
 
-function parseToAst(_x, _x2) {
-  return _parseToAst.apply(this, arguments);
-}
-
-function _parseToAst() {
-  _parseToAst = (0, _asyncToGenerator2.default)(function* (filePath, fileStr) {
-    let ast; // Preprocess and attempt to parse source; return an AST if we can, log an
-    // error if we can't.
-
-    const transpiled = yield apiRunnerNode(`preprocessSource`, {
-      filename: filePath,
-      contents: fileStr
-    });
-
-    if (transpiled && transpiled.length) {
-      for (var _iterator = transpiled, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {
-        var _ref;
-
-        if (_isArray) {
-          if (_i >= _iterator.length) break;
-          _ref = _iterator[_i++];
-        } else {
-          _i = _iterator.next();
-          if (_i.done) break;
-          _ref = _i.value;
-        }
-
-        const item = _ref;
+async function parseToAst(filePath, fileStr) {
+  let ast; // Preprocess and attempt to parse source; return an AST if we can, log an
+  // error if we can't.
 
-        try {
-          const tmp = (0, _babelParseToAst.babelParseToAst)(item, filePath);
-          ast = tmp;
-          break;
-        } catch (error) {
-          report.error(error);
-          continue;
-        }
-      }
+  const transpiled = await apiRunnerNode(`preprocessSource`, {
+    filename: filePath,
+    contents: fileStr
+  });
 
-      if (ast === undefined) {
-        report.error(`Failed to parse preprocessed file ${filePath}`);
-      }
-    } else {
+  if (transpiled && transpiled.length) {
+    for (const item of transpiled) {
       try {
-        ast = (0, _babelParseToAst.babelParseToAst)(fileStr, filePath);
+        const tmp = (0, _babelParseToAst.babelParseToAst)(item, filePath);
+        ast = tmp;
+        break;
       } catch (error) {
-        report.error(`There was a problem parsing "${filePath}"; any GraphQL ` + `fragments or queries in this file were not processed. \n` + `This may indicate a syntax error in the code, or it may be a file type ` + `that Gatsby does not know how to parse.`);
+        report.error(error);
+        continue;
       }
     }
 
-    return ast;
-  });
-  return _parseToAst.apply(this, arguments);
+    if (ast === undefined) {
+      report.error(`Failed to parse preprocessed file ${filePath}`);
+    }
+  } else {
+    try {
+      ast = (0, _babelParseToAst.babelParseToAst)(fileStr, filePath);
+    } catch (error) {
+      report.error(`There was a problem parsing "${filePath}"; any GraphQL ` + `fragments or queries in this file were not processed. \n` + `This may indicate a syntax error in the code, or it may be a file type ` + `that Gatsby does not know how to parse.`);
+    }
+  }
+
+  return ast;
 }
 
 const warnForGlobalTag = file => report.warn(`Using the global \`graphql\` tag is deprecated, and will not be supported in v3.\n` + `Import it instead like:  import { graphql } from 'gatsby' in file:\n` + file);
 
-function findGraphQLTags(_x3, _x4) {
-  return _findGraphQLTags.apply(this, arguments);
-}
-
-function _findGraphQLTags() {
-  _findGraphQLTags = (0, _asyncToGenerator2.default)(function* (file, text) {
-    return new Promise((resolve, reject) => {
-      parseToAst(file, text).then(ast => {
-        let queries = [];
+async function findGraphQLTags(file, text) {
+  return new Promise((resolve, reject) => {
+    parseToAst(file, text).then(ast => {
+      let queries = [];
 
-        if (!ast) {
-          resolve(queries);
-          return;
-        }
-        /**
-         * A map of graphql documents to unique locations.
-         *
-         * A graphql document's unique location is made of:
-         *
-         *  - the location of the graphql template literal that contains the document, and
-         *  - the document's location within the graphql template literal
-         *
-         * This is used to prevent returning duplicated documents.
-         */
-
-
-        const documentLocations = new WeakMap();
-
-        const extractStaticQuery = taggedTemplateExpressPath => {
-          const _getGraphQLTag = getGraphQLTag(taggedTemplateExpressPath),
-                gqlAst = _getGraphQLTag.ast,
-                text = _getGraphQLTag.text,
-                hash = _getGraphQLTag.hash,
-                isGlobal = _getGraphQLTag.isGlobal;
-
-          if (!gqlAst) return;
-          if (isGlobal) warnForGlobalTag(file);
-          gqlAst.definitions.forEach(def => {
-            documentLocations.set(def, `${taggedTemplateExpressPath.node.start}-${def.loc.start}`);
-            generateQueryName({
-              def,
-              hash,
-              file
-            });
-          });
-          const definitions = [...gqlAst.definitions].map(d => {
-            d.isStaticQuery = true;
-            d.text = text;
-            d.hash = hash;
-            return d;
+      if (!ast) {
+        resolve(queries);
+        return;
+      }
+      /**
+       * A map of graphql documents to unique locations.
+       *
+       * A graphql document's unique location is made of:
+       *
+       *  - the location of the graphql template literal that contains the document, and
+       *  - the document's location within the graphql template literal
+       *
+       * This is used to prevent returning duplicated documents.
+       */
+
+
+      const documentLocations = new WeakMap();
+
+      const extractStaticQuery = taggedTemplateExpressPath => {
+        const {
+          ast: gqlAst,
+          text,
+          hash,
+          isGlobal
+        } = getGraphQLTag(taggedTemplateExpressPath);
+        if (!gqlAst) return;
+        if (isGlobal) warnForGlobalTag(file);
+        gqlAst.definitions.forEach(def => {
+          documentLocations.set(def, `${taggedTemplateExpressPath.node.start}-${def.loc.start}`);
+          generateQueryName({
+            def,
+            hash,
+            file
           });
-          queries.push(...definitions);
-        }; // Look for queries in <StaticQuery /> elements.
-
-
-        (0, _babelTraverse.default)(ast, {
-          JSXElement(path) {
-            if (path.node.openingElement.name.name !== `StaticQuery`) {
-              return;
-            } // astexplorer.com link I (@kyleamathews) used when prototyping this algorithm
-            // https://astexplorer.net/#/gist/ab5d71c0f08f287fbb840bf1dd8b85ff/2f188345d8e5a4152fe7c96f0d52dbcc6e9da466
+        });
+        const definitions = [...gqlAst.definitions].map(d => {
+          d.isStaticQuery = true;
+          d.text = text;
+          d.hash = hash;
+          return d;
+        });
+        queries.push(...definitions);
+      }; // Look for queries in <StaticQuery /> elements.
+
+
+      (0, _babelTraverse.default)(ast, {
+        JSXElement(path) {
+          if (path.node.openingElement.name.name !== `StaticQuery`) {
+            return;
+          } // astexplorer.com link I (@kyleamathews) used when prototyping this algorithm
+          // https://astexplorer.net/#/gist/ab5d71c0f08f287fbb840bf1dd8b85ff/2f188345d8e5a4152fe7c96f0d52dbcc6e9da466
 
 
-            path.traverse({
-              JSXAttribute(jsxPath) {
-                if (jsxPath.node.name.name !== `query`) {
-                  return;
-                }
+          path.traverse({
+            JSXAttribute(jsxPath) {
+              if (jsxPath.node.name.name !== `query`) {
+                return;
+              }
 
-                jsxPath.traverse({
-                  // Assume the query is inline in the component and extract that.
-                  TaggedTemplateExpression(templatePath) {
-                    extractStaticQuery(templatePath);
-                  },
-
-                  // Also see if it's a variable that's passed in as a prop
-                  // and if it is, go find it.
-                  Identifier(identifierPath) {
-                    if (identifierPath.node.name !== `graphql`) {
-                      const varName = identifierPath.node.name;
-                      let found = false;
-                      (0, _babelTraverse.default)(ast, {
-                        VariableDeclarator(varPath) {
-                          if (varPath.node.id.name === varName && varPath.node.init.type === `TaggedTemplateExpression`) {
-                            varPath.traverse({
-                              TaggedTemplateExpression(templatePath) {
-                                found = true;
-                                extractStaticQuery(templatePath);
-                              }
-
-                            });
-                          }
+              jsxPath.traverse({
+                // Assume the query is inline in the component and extract that.
+                TaggedTemplateExpression(templatePath) {
+                  extractStaticQuery(templatePath);
+                },
+
+                // Also see if it's a variable that's passed in as a prop
+                // and if it is, go find it.
+                Identifier(identifierPath) {
+                  if (identifierPath.node.name !== `graphql`) {
+                    const varName = identifierPath.node.name;
+                    let found = false;
+                    (0, _babelTraverse.default)(ast, {
+                      VariableDeclarator(varPath) {
+                        if (varPath.node.id.name === varName && varPath.node.init.type === `TaggedTemplateExpression`) {
+                          varPath.traverse({
+                            TaggedTemplateExpression(templatePath) {
+                              found = true;
+                              extractStaticQuery(templatePath);
+                            }
+
+                          });
                         }
+                      }
 
-                      });
+                    });
 
-                      if (!found) {
-                        report.warn(`\nWe were unable to find the declaration of variable "${varName}", which you passed as the "query" prop into the <StaticQuery> declaration in "${file}".
+                    if (!found) {
+                      report.warn(`\nWe were unable to find the declaration of variable "${varName}", which you passed as the "query" prop into the <StaticQuery> declaration in "${file}".
 
 Perhaps the variable name has a typo?
 
 Also note that we are currently unable to use queries defined in files other than the file where the <StaticQuery> is defined. If you're attempting to import the query, please move it into "${file}". If being able to import queries from another file is an important capability for you, we invite your help fixing it.\n`);
-                      }
                     }
                   }
+                }
 
-                });
-              }
+              });
+            }
 
-            });
-            return;
-          }
-
-        }); // Look for exported page queries
-
-        (0, _babelTraverse.default)(ast, {
-          ExportNamedDeclaration(path, state) {
-            path.traverse({
-              TaggedTemplateExpression(innerPath) {
-                const _getGraphQLTag2 = getGraphQLTag(innerPath),
-                      gqlAst = _getGraphQLTag2.ast,
-                      isGlobal = _getGraphQLTag2.isGlobal,
-                      hash = _getGraphQLTag2.hash;
-
-                if (!gqlAst) return;
-                if (isGlobal) warnForGlobalTag(file);
-                gqlAst.definitions.forEach(def => {
-                  documentLocations.set(def, `${innerPath.node.start}-${def.loc.start}`);
-                  generateQueryName({
-                    def,
-                    hash,
-                    file
-                  });
+          });
+          return;
+        }
+
+      }); // Look for exported page queries
+
+      (0, _babelTraverse.default)(ast, {
+        ExportNamedDeclaration(path, state) {
+          path.traverse({
+            TaggedTemplateExpression(innerPath) {
+              const {
+                ast: gqlAst,
+                isGlobal,
+                hash
+              } = getGraphQLTag(innerPath);
+              if (!gqlAst) return;
+              if (isGlobal) warnForGlobalTag(file);
+              gqlAst.definitions.forEach(def => {
+                documentLocations.set(def, `${innerPath.node.start}-${def.loc.start}`);
+                generateQueryName({
+                  def,
+                  hash,
+                  file
                 });
-                queries.push(...gqlAst.definitions);
-              }
+              });
+              queries.push(...gqlAst.definitions);
+            }
 
-            });
-          }
+          });
+        }
 
-        }); // Remove duplicate queries
+      }); // Remove duplicate queries
 
-        const uniqueQueries = _.uniqBy(queries, q => documentLocations.get(q));
+      const uniqueQueries = _.uniqBy(queries, q => documentLocations.get(q));
 
-        resolve(uniqueQueries);
-      }).catch(reject);
-    });
+      resolve(uniqueQueries);
+    }).catch(reject);
   });
-  return _findGraphQLTags.apply(this, arguments);
 }
 
 const cache = {};
 
 class FileParser {
-  parseFile(file) {
-    return (0, _asyncToGenerator2.default)(function* () {
-      let text;
-
-      try {
-        text = yield fs.readFile(file, `utf8`);
-      } catch (err) {
-        report.error(`There was a problem reading the file: ${file}`, err);
-        return null;
-      }
-
-      if (text.indexOf(`graphql`) === -1) return null;
-      const hash = crypto.createHash(`md5`).update(file).update(text).digest(`hex`);
+  async parseFile(file) {
+    let text;
+
+    try {
+      text = await fs.readFile(file, `utf8`);
+    } catch (err) {
+      report.error(`There was a problem reading the file: ${file}`, err);
+      return null;
+    }
 
-      try {
-        let astDefinitions = cache[hash] || (cache[hash] = yield findGraphQLTags(file, text));
-        return astDefinitions.length ? {
-          kind: `Document`,
-          definitions: astDefinitions
-        } : null;
-      } catch (err) {
-        report.error(`There was a problem parsing the GraphQL query in file: ${file}`, err);
-        return null;
-      }
-    })();
+    if (text.indexOf(`graphql`) === -1) return null;
+    const hash = crypto.createHash(`md5`).update(file).update(text).digest(`hex`);
+
+    try {
+      let astDefinitions = cache[hash] || (cache[hash] = await findGraphQLTags(file, text));
+      return astDefinitions.length ? {
+        kind: `Document`,
+        definitions: astDefinitions
+      } : null;
+    } catch (err) {
+      report.error(`There was a problem parsing the GraphQL query in file: ${file}`, err);
+      return null;
+    }
   }
 
-  parseFiles(files) {
-    var _this = this;
-
-    return (0, _asyncToGenerator2.default)(function* () {
-      const documents = new Map();
-      return Promise.all(files.map(file => _this.parseFile(file).then(doc => {
-        if (!doc) return;
-        documents.set(file, doc);
-      }))).then(() => documents);
-    })();
+  async parseFiles(files) {
+    const documents = new Map();
+    return Promise.all(files.map(file => this.parseFile(file).then(doc => {
+      if (!doc) return;
+      documents.set(file, doc);
+    }))).then(() => documents);
   }
 
 }
--- a/node_modules/gatsby/dist/internal-plugins/query-runner/file-parser.js.map
+++ b/node_modules/gatsby/dist/internal-plugins/query-runner/file-parser.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../../src/internal-plugins/query-runner/file-parser.js"],"names":["fs","require","crypto","_","getGraphQLTag","report","apiRunnerNode","generateQueryName","def","hash","file","name","value","camelCase","kind","parseToAst","filePath","fileStr","ast","transpiled","filename","contents","length","item","tmp","error","undefined","warnForGlobalTag","warn","findGraphQLTags","text","Promise","resolve","reject","then","queries","documentLocations","WeakMap","extractStaticQuery","taggedTemplateExpressPath","gqlAst","isGlobal","definitions","forEach","set","node","start","loc","map","d","isStaticQuery","push","JSXElement","path","openingElement","traverse","JSXAttribute","jsxPath","TaggedTemplateExpression","templatePath","Identifier","identifierPath","varName","found","VariableDeclarator","varPath","id","init","type","ExportNamedDeclaration","state","innerPath","uniqueQueries","uniqBy","q","get","catch","cache","FileParser","parseFile","readFile","err","indexOf","createHash","update","digest","astDefinitions","parseFiles","files","documents","Map","all","doc"],"mappings":"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","sourcesContent":["// @flow\nconst fs = require(`fs-extra`)\nconst crypto = require(`crypto`)\nconst _ = require(`lodash`)\n\n// Traverse is a es6 module...\nimport traverse from \"babel-traverse\"\nconst getGraphQLTag = require(`babel-plugin-remove-graphql-queries`)\n  .getGraphQLTag\nconst report = require(`gatsby-cli/lib/reporter`)\n\nimport type { DocumentNode, DefinitionNode } from \"graphql\"\nimport { babelParseToAst } from \"../../utils/babel-parse-to-ast\"\n\nconst apiRunnerNode = require(`../../utils/api-runner-node`)\n\n/**\n * Add autogenerated query name if it wasn't defined by user.\n */\nconst generateQueryName = ({ def, hash, file }) => {\n  if (!def.name || !def.name.value) {\n    def.name = {\n      value: `${_.camelCase(file)}${hash}`,\n      kind: `Name`,\n    }\n  }\n  return def\n}\n\nasync function parseToAst(filePath, fileStr) {\n  let ast\n\n  // Preprocess and attempt to parse source; return an AST if we can, log an\n  // error if we can't.\n  const transpiled = await apiRunnerNode(`preprocessSource`, {\n    filename: filePath,\n    contents: fileStr,\n  })\n  if (transpiled && transpiled.length) {\n    for (const item of transpiled) {\n      try {\n        const tmp = babelParseToAst(item, filePath)\n        ast = tmp\n        break\n      } catch (error) {\n        report.error(error)\n        continue\n      }\n    }\n    if (ast === undefined) {\n      report.error(`Failed to parse preprocessed file ${filePath}`)\n    }\n  } else {\n    try {\n      ast = babelParseToAst(fileStr, filePath)\n    } catch (error) {\n      report.error(\n        `There was a problem parsing \"${filePath}\"; any GraphQL ` +\n          `fragments or queries in this file were not processed. \\n` +\n          `This may indicate a syntax error in the code, or it may be a file type ` +\n          `that Gatsby does not know how to parse.`\n      )\n    }\n  }\n\n  return ast\n}\n\nconst warnForGlobalTag = file =>\n  report.warn(\n    `Using the global \\`graphql\\` tag is deprecated, and will not be supported in v3.\\n` +\n      `Import it instead like:  import { graphql } from 'gatsby' in file:\\n` +\n      file\n  )\n\nasync function findGraphQLTags(file, text): Promise<Array<DefinitionNode>> {\n  return new Promise((resolve, reject) => {\n    parseToAst(file, text)\n      .then(ast => {\n        let queries = []\n        if (!ast) {\n          resolve(queries)\n          return\n        }\n\n        /**\n         * A map of graphql documents to unique locations.\n         *\n         * A graphql document's unique location is made of:\n         *\n         *  - the location of the graphql template literal that contains the document, and\n         *  - the document's location within the graphql template literal\n         *\n         * This is used to prevent returning duplicated documents.\n         */\n        const documentLocations = new WeakMap()\n\n        const extractStaticQuery = taggedTemplateExpressPath => {\n          const { ast: gqlAst, text, hash, isGlobal } = getGraphQLTag(\n            taggedTemplateExpressPath\n          )\n          if (!gqlAst) return\n\n          if (isGlobal) warnForGlobalTag(file)\n\n          gqlAst.definitions.forEach(def => {\n            documentLocations.set(\n              def,\n              `${taggedTemplateExpressPath.node.start}-${def.loc.start}`\n            )\n            generateQueryName({\n              def,\n              hash,\n              file,\n            })\n          })\n\n          const definitions = [...gqlAst.definitions].map(d => {\n            d.isStaticQuery = true\n            d.text = text\n            d.hash = hash\n            return d\n          })\n\n          queries.push(...definitions)\n        }\n\n        // Look for queries in <StaticQuery /> elements.\n        traverse(ast, {\n          JSXElement(path) {\n            if (path.node.openingElement.name.name !== `StaticQuery`) {\n              return\n            }\n\n            // astexplorer.com link I (@kyleamathews) used when prototyping this algorithm\n            // https://astexplorer.net/#/gist/ab5d71c0f08f287fbb840bf1dd8b85ff/2f188345d8e5a4152fe7c96f0d52dbcc6e9da466\n            path.traverse({\n              JSXAttribute(jsxPath) {\n                if (jsxPath.node.name.name !== `query`) {\n                  return\n                }\n                jsxPath.traverse({\n                  // Assume the query is inline in the component and extract that.\n                  TaggedTemplateExpression(templatePath) {\n                    extractStaticQuery(templatePath)\n                  },\n                  // Also see if it's a variable that's passed in as a prop\n                  // and if it is, go find it.\n                  Identifier(identifierPath) {\n                    if (identifierPath.node.name !== `graphql`) {\n                      const varName = identifierPath.node.name\n                      let found = false\n                      traverse(ast, {\n                        VariableDeclarator(varPath) {\n                          if (\n                            varPath.node.id.name === varName &&\n                            varPath.node.init.type ===\n                              `TaggedTemplateExpression`\n                          ) {\n                            varPath.traverse({\n                              TaggedTemplateExpression(templatePath) {\n                                found = true\n                                extractStaticQuery(templatePath)\n                              },\n                            })\n                          }\n                        },\n                      })\n                      if (!found) {\n                        report.warn(\n                          `\\nWe were unable to find the declaration of variable \"${varName}\", which you passed as the \"query\" prop into the <StaticQuery> declaration in \"${file}\".\n\nPerhaps the variable name has a typo?\n\nAlso note that we are currently unable to use queries defined in files other than the file where the <StaticQuery> is defined. If you're attempting to import the query, please move it into \"${file}\". If being able to import queries from another file is an important capability for you, we invite your help fixing it.\\n`\n                        )\n                      }\n                    }\n                  },\n                })\n              },\n            })\n            return\n          },\n        })\n\n        // Look for exported page queries\n        traverse(ast, {\n          ExportNamedDeclaration(path, state) {\n            path.traverse({\n              TaggedTemplateExpression(innerPath) {\n                const { ast: gqlAst, isGlobal, hash } = getGraphQLTag(innerPath)\n                if (!gqlAst) return\n\n                if (isGlobal) warnForGlobalTag(file)\n\n                gqlAst.definitions.forEach(def => {\n                  documentLocations.set(\n                    def,\n                    `${innerPath.node.start}-${def.loc.start}`\n                  )\n                  generateQueryName({\n                    def,\n                    hash,\n                    file,\n                  })\n                })\n\n                queries.push(...gqlAst.definitions)\n              },\n            })\n          },\n        })\n\n        // Remove duplicate queries\n        const uniqueQueries = _.uniqBy(queries, q => documentLocations.get(q))\n\n        resolve(uniqueQueries)\n      })\n      .catch(reject)\n  })\n}\n\nconst cache = {}\n\nexport default class FileParser {\n  async parseFile(file: string): Promise<?DocumentNode> {\n    let text\n    try {\n      text = await fs.readFile(file, `utf8`)\n    } catch (err) {\n      report.error(`There was a problem reading the file: ${file}`, err)\n      return null\n    }\n\n    if (text.indexOf(`graphql`) === -1) return null\n    const hash = crypto\n      .createHash(`md5`)\n      .update(file)\n      .update(text)\n      .digest(`hex`)\n\n    try {\n      let astDefinitions =\n        cache[hash] || (cache[hash] = await findGraphQLTags(file, text))\n\n      return astDefinitions.length\n        ? {\n            kind: `Document`,\n            definitions: astDefinitions,\n          }\n        : null\n    } catch (err) {\n      report.error(\n        `There was a problem parsing the GraphQL query in file: ${file}`,\n        err\n      )\n      return null\n    }\n  }\n\n  async parseFiles(files: Array<string>): Promise<Map<string, DocumentNode>> {\n    const documents = new Map()\n\n    return Promise.all(\n      files.map(file =>\n        this.parseFile(file).then(doc => {\n          if (!doc) return\n          documents.set(file, doc)\n        })\n      )\n    ).then(() => documents)\n  }\n}\n"],"file":"file-parser.js"}
\ No newline at end of file
+{"version":3,"sources":["../../../src/internal-plugins/query-runner/file-parser.js"],"names":["fs","require","crypto","_","getGraphQLTag","report","apiRunnerNode","generateQueryName","def","hash","file","name","value","camelCase","kind","parseToAst","filePath","fileStr","ast","transpiled","filename","contents","length","item","tmp","error","undefined","warnForGlobalTag","warn","findGraphQLTags","text","Promise","resolve","reject","then","queries","documentLocations","WeakMap","extractStaticQuery","taggedTemplateExpressPath","gqlAst","isGlobal","definitions","forEach","set","node","start","loc","map","d","isStaticQuery","push","JSXElement","path","openingElement","traverse","JSXAttribute","jsxPath","TaggedTemplateExpression","templatePath","Identifier","identifierPath","varName","found","VariableDeclarator","varPath","id","init","type","ExportNamedDeclaration","state","innerPath","uniqueQueries","uniqBy","q","get","catch","cache","FileParser","parseFile","readFile","err","indexOf","createHash","update","digest","astDefinitions","parseFiles","files","documents","Map","all","doc"],"mappings":"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","sourcesContent":["// @flow\nconst fs = require(`fs-extra`)\nconst crypto = require(`crypto`)\nconst _ = require(`lodash`)\n\n// Traverse is a es6 module...\nimport traverse from \"babel-traverse\"\nconst getGraphQLTag = require(`babel-plugin-remove-graphql-queries`)\n  .getGraphQLTag\nconst report = require(`gatsby-cli/lib/reporter`)\n\nimport type { DocumentNode, DefinitionNode } from \"graphql\"\nimport { babelParseToAst } from \"../../utils/babel-parse-to-ast\"\n\nconst apiRunnerNode = require(`../../utils/api-runner-node`)\n\n/**\n * Add autogenerated query name if it wasn't defined by user.\n */\nconst generateQueryName = ({ def, hash, file }) => {\n  if (!def.name || !def.name.value) {\n    def.name = {\n      value: `${_.camelCase(file)}${hash}`,\n      kind: `Name`,\n    }\n  }\n  return def\n}\n\nasync function parseToAst(filePath, fileStr) {\n  let ast\n\n  // Preprocess and attempt to parse source; return an AST if we can, log an\n  // error if we can't.\n  const transpiled = await apiRunnerNode(`preprocessSource`, {\n    filename: filePath,\n    contents: fileStr,\n  })\n  if (transpiled && transpiled.length) {\n    for (const item of transpiled) {\n      try {\n        const tmp = babelParseToAst(item, filePath)\n        ast = tmp\n        break\n      } catch (error) {\n        report.error(error)\n        continue\n      }\n    }\n    if (ast === undefined) {\n      report.error(`Failed to parse preprocessed file ${filePath}`)\n    }\n  } else {\n    try {\n      ast = babelParseToAst(fileStr, filePath)\n    } catch (error) {\n      report.error(\n        `There was a problem parsing \"${filePath}\"; any GraphQL ` +\n          `fragments or queries in this file were not processed. \\n` +\n          `This may indicate a syntax error in the code, or it may be a file type ` +\n          `that Gatsby does not know how to parse.`\n      )\n    }\n  }\n\n  return ast\n}\n\nconst warnForGlobalTag = file =>\n  report.warn(\n    `Using the global \\`graphql\\` tag is deprecated, and will not be supported in v3.\\n` +\n      `Import it instead like:  import { graphql } from 'gatsby' in file:\\n` +\n      file\n  )\n\nasync function findGraphQLTags(file, text): Promise<Array<DefinitionNode>> {\n  return new Promise((resolve, reject) => {\n    parseToAst(file, text)\n      .then(ast => {\n        let queries = []\n        if (!ast) {\n          resolve(queries)\n          return\n        }\n\n        /**\n         * A map of graphql documents to unique locations.\n         *\n         * A graphql document's unique location is made of:\n         *\n         *  - the location of the graphql template literal that contains the document, and\n         *  - the document's location within the graphql template literal\n         *\n         * This is used to prevent returning duplicated documents.\n         */\n        const documentLocations = new WeakMap()\n\n        const extractStaticQuery = taggedTemplateExpressPath => {\n          const { ast: gqlAst, text, hash, isGlobal } = getGraphQLTag(\n            taggedTemplateExpressPath\n          )\n          if (!gqlAst) return\n\n          if (isGlobal) warnForGlobalTag(file)\n\n          gqlAst.definitions.forEach(def => {\n            documentLocations.set(\n              def,\n              `${taggedTemplateExpressPath.node.start}-${def.loc.start}`\n            )\n            generateQueryName({\n              def,\n              hash,\n              file,\n            })\n          })\n\n          const definitions = [...gqlAst.definitions].map(d => {\n            d.isStaticQuery = true\n            d.text = text\n            d.hash = hash\n            return d\n          })\n\n          queries.push(...definitions)\n        }\n\n        // Look for queries in <StaticQuery /> elements.\n        traverse(ast, {\n          JSXElement(path) {\n            if (path.node.openingElement.name.name !== `StaticQuery`) {\n              return\n            }\n\n            // astexplorer.com link I (@kyleamathews) used when prototyping this algorithm\n            // https://astexplorer.net/#/gist/ab5d71c0f08f287fbb840bf1dd8b85ff/2f188345d8e5a4152fe7c96f0d52dbcc6e9da466\n            path.traverse({\n              JSXAttribute(jsxPath) {\n                if (jsxPath.node.name.name !== `query`) {\n                  return\n                }\n                jsxPath.traverse({\n                  // Assume the query is inline in the component and extract that.\n                  TaggedTemplateExpression(templatePath) {\n                    extractStaticQuery(templatePath)\n                  },\n                  // Also see if it's a variable that's passed in as a prop\n                  // and if it is, go find it.\n                  Identifier(identifierPath) {\n                    if (identifierPath.node.name !== `graphql`) {\n                      const varName = identifierPath.node.name\n                      let found = false\n                      traverse(ast, {\n                        VariableDeclarator(varPath) {\n                          if (\n                            varPath.node.id.name === varName &&\n                            varPath.node.init.type ===\n                              `TaggedTemplateExpression`\n                          ) {\n                            varPath.traverse({\n                              TaggedTemplateExpression(templatePath) {\n                                found = true\n                                extractStaticQuery(templatePath)\n                              },\n                            })\n                          }\n                        },\n                      })\n                      if (!found) {\n                        report.warn(\n                          `\\nWe were unable to find the declaration of variable \"${varName}\", which you passed as the \"query\" prop into the <StaticQuery> declaration in \"${file}\".\n\nPerhaps the variable name has a typo?\n\nAlso note that we are currently unable to use queries defined in files other than the file where the <StaticQuery> is defined. If you're attempting to import the query, please move it into \"${file}\". If being able to import queries from another file is an important capability for you, we invite your help fixing it.\\n`\n                        )\n                      }\n                    }\n                  },\n                })\n              },\n            })\n            return\n          },\n        })\n\n        // Look for exported page queries\n        traverse(ast, {\n          ExportNamedDeclaration(path, state) {\n            path.traverse({\n              TaggedTemplateExpression(innerPath) {\n                const { ast: gqlAst, isGlobal, hash } = getGraphQLTag(innerPath)\n                if (!gqlAst) return\n\n                if (isGlobal) warnForGlobalTag(file)\n\n                gqlAst.definitions.forEach(def => {\n                  documentLocations.set(\n                    def,\n                    `${innerPath.node.start}-${def.loc.start}`\n                  )\n                  generateQueryName({\n                    def,\n                    hash,\n                    file,\n                  })\n                })\n\n                queries.push(...gqlAst.definitions)\n              },\n            })\n          },\n        })\n\n        // Remove duplicate queries\n        const uniqueQueries = _.uniqBy(queries, q => documentLocations.get(q))\n\n        resolve(uniqueQueries)\n      })\n      .catch(reject)\n  })\n}\n\nconst cache = {}\n\nexport default class FileParser {\n  async parseFile(file: string): Promise<?DocumentNode> {\n    let text\n    try {\n      text = await fs.readFile(file, `utf8`)\n    } catch (err) {\n      report.error(`There was a problem reading the file: ${file}`, err)\n      return null\n    }\n\n    if (text.indexOf(`graphql`) === -1) return null\n    const hash = crypto\n      .createHash(`md5`)\n      .update(file)\n      .update(text)\n      .digest(`hex`)\n\n    try {\n      let astDefinitions =\n        cache[hash] || (cache[hash] = await findGraphQLTags(file, text))\n\n      return astDefinitions.length\n        ? {\n            kind: `Document`,\n            definitions: astDefinitions,\n          }\n        : null\n    } catch (err) {\n      report.error(\n        `There was a problem parsing the GraphQL query in file: ${file}`,\n        err\n      )\n      return null\n    }\n  }\n\n  async parseFiles(files: Array<string>): Promise<Map<string, DocumentNode>> {\n    const documents = new Map()\n\n    return Promise.all(\n      files.map(file =>\n        this.parseFile(file).then(doc => {\n          if (!doc) return\n          documents.set(file, doc)\n        })\n      )\n    ).then(() => documents)\n  }\n}\n"],"file":"file-parser.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/internal-plugins/query-runner/gatsby-node.js
+++ b/node_modules/gatsby/dist/internal-plugins/query-runner/gatsby-node.js
@@ -1,7 +1,8 @@
 "use strict";
 
-const _require = require(`./query-watcher`),
-      watchComponent = _require.watchComponent;
+const {
+  watchComponent
+} = require(`./query-watcher`);
 
 let components = {};
 
--- a/node_modules/gatsby/dist/internal-plugins/query-runner/gatsby-node.js.map
+++ b/node_modules/gatsby/dist/internal-plugins/query-runner/gatsby-node.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../../src/internal-plugins/query-runner/gatsby-node.js"],"names":["require","watchComponent","components","exports","onCreatePage","page","store","process","env","NODE_ENV","component","getState","get","componentPath","exit"],"mappings":";;iBAA2BA,OAAO,CAAE,iBAAF,C;MAA1BC,c,YAAAA,c;;AAER,IAAIC,UAAU,GAAG,EAAjB;;AAEAC,OAAO,CAACC,YAAR,GAAuB,CAAC;AAAEC,EAAAA,IAAF;AAAQC,EAAAA;AAAR,CAAD,KAAqB;AAC1C;AACA,MAAIC,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAA0B,YAA9B,EAA2C;AACzC,UAAMC,SAAS,GAAGJ,KAAK,CAACK,QAAN,GAAiBT,UAAjB,CAA4BU,GAA5B,CAAgCP,IAAI,CAACQ,aAArC,CAAlB;;AAEA,QAAI,CAACH,SAAL,EAAgB;AACdH,MAAAA,OAAO,CAACO,IAAR;AACD;;AAED,QAAIZ,UAAU,CAACQ,SAAS,CAACG,aAAX,CAAd,EAAyC;AACvC;AACD;;AAEDZ,IAAAA,cAAc,CAACS,SAAS,CAACG,aAAX,CAAd;AACD;AACF,CAfD","sourcesContent":["const { watchComponent } = require(`./query-watcher`)\n\nlet components = {}\n\nexports.onCreatePage = ({ page, store }) => {\n  // In development, watch the component to detect query changes.\n  if (process.env.NODE_ENV !== `production`) {\n    const component = store.getState().components.get(page.componentPath)\n\n    if (!component) {\n      process.exit()\n    }\n\n    if (components[component.componentPath]) {\n      return\n    }\n\n    watchComponent(component.componentPath)\n  }\n}\n"],"file":"gatsby-node.js"}
\ No newline at end of file
+{"version":3,"sources":["../../../src/internal-plugins/query-runner/gatsby-node.js"],"names":["watchComponent","require","components","exports","onCreatePage","page","store","process","env","NODE_ENV","component","getState","get","componentPath","exit"],"mappings":";;AAAA,MAAM;AAAEA,EAAAA;AAAF,IAAqBC,OAAO,CAAE,iBAAF,CAAlC;;AAEA,IAAIC,UAAU,GAAG,EAAjB;;AAEAC,OAAO,CAACC,YAAR,GAAuB,CAAC;AAAEC,EAAAA,IAAF;AAAQC,EAAAA;AAAR,CAAD,KAAqB;AAC1C;AACA,MAAIC,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAA0B,YAA9B,EAA2C;AACzC,UAAMC,SAAS,GAAGJ,KAAK,CAACK,QAAN,GAAiBT,UAAjB,CAA4BU,GAA5B,CAAgCP,IAAI,CAACQ,aAArC,CAAlB;;AAEA,QAAI,CAACH,SAAL,EAAgB;AACdH,MAAAA,OAAO,CAACO,IAAR;AACD;;AAED,QAAIZ,UAAU,CAACQ,SAAS,CAACG,aAAX,CAAd,EAAyC;AACvC;AACD;;AAEDb,IAAAA,cAAc,CAACU,SAAS,CAACG,aAAX,CAAd;AACD;AACF,CAfD","sourcesContent":["const { watchComponent } = require(`./query-watcher`)\n\nlet components = {}\n\nexports.onCreatePage = ({ page, store }) => {\n  // In development, watch the component to detect query changes.\n  if (process.env.NODE_ENV !== `production`) {\n    const component = store.getState().components.get(page.componentPath)\n\n    if (!component) {\n      process.exit()\n    }\n\n    if (components[component.componentPath]) {\n      return\n    }\n\n    watchComponent(component.componentPath)\n  }\n}\n"],"file":"gatsby-node.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/internal-plugins/query-runner/graphql-errors.js
+++ b/node_modules/gatsby/dist/internal-plugins/query-runner/graphql-errors.js
@@ -59,9 +59,7 @@ function extractError(error) {
   while ((matches = docRegex.exec(error.toString())) !== null) {
     // This is necessary to avoid infinite loops with zero-width matches
     if (matches.index === docRegex.lastIndex) docRegex.lastIndex++;
-    var _matches = matches;
-    message = _matches[2];
-    docName = _matches[3];
+    [,, message, docName] = matches;
   }
 
   if (!message) {
@@ -80,10 +78,7 @@ function findLocation(extractedMessage, def) {
     enter(node) {
       if (location) return;
 
-      for (var _i = 0; _i < handlers.length; _i++) {
-        let _handlers$_i = handlers[_i],
-            regex = _handlers$_i[0],
-            handler = _handlers$_i[1];
+      for (let [regex, handler] of handlers) {
         let match = extractedMessage.match(regex);
         if (!match) continue;
         if (location = handler(match.slice(1), node)) break;
@@ -102,17 +97,17 @@ function getCodeFrame(query, lineNumber, column) {
 }
 
 function getCodeFrameFromRelayError(def, extractedMessage, error) {
-  let _ref = findLocation(extractedMessage, def) || {},
-      start = _ref.start,
-      source = _ref.source;
-
+  let {
+    start,
+    source
+  } = findLocation(extractedMessage, def) || {};
   let query = source ? source.body : (0, _graphql.print)(def); // we can't reliably get a location without the location source, since
   // the printed query may differ from the original.
 
-  let _ref2 = source && (0, _graphql.getLocation)(source, start) || {},
-      line = _ref2.line,
-      column = _ref2.column;
-
+  let {
+    line,
+    column
+  } = source && (0, _graphql.getLocation)(source, start) || {};
   return getCodeFrame(query, line, column);
 }
 
@@ -147,21 +142,22 @@ function multipleRootQueriesError(filePath, def, otherDef) {
 function graphqlValidationError(errors, filePath, doc) {
   if (!errors || !errors.length) return ``;
   let error = errors[0];
-  let source = error.source,
-      _error$locations = error.locations;
-  _error$locations = _error$locations === void 0 ? [{}] : _error$locations;
-  let _error$locations$ = _error$locations[0],
-      line = _error$locations$.line,
-      column = _error$locations$.column;
+  let {
+    source,
+    locations: [{
+      line,
+      column
+    }] = [{}]
+  } = error;
   let query = source ? source.body : (0, _graphql.print)(doc);
   return formatError(error.message, filePath, getCodeFrame(query, line, column));
 }
 
 function graphqlError(namePathMap, nameDefMap, error) {
-  let _extractError = extractError(error),
-      message = _extractError.message,
-      docName = _extractError.docName;
-
+  let {
+    message,
+    docName
+  } = extractError(error);
   let filePath = namePathMap.get(docName);
 
   if (filePath && docName) {
--- a/node_modules/gatsby/dist/internal-plugins/query-runner/graphql-errors.js.map
+++ b/node_modules/gatsby/dist/internal-plugins/query-runner/graphql-errors.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../../src/internal-plugins/query-runner/graphql-errors.js"],"names":["handlers","name","node","kind","value","loc","formatFilePath","filePath","report","format","bold","blue","formatError","message","codeFrame","stripIndent","extractError","error","docRegex","matches","docName","exec","toString","index","lastIndex","findLocation","extractedMessage","def","location","enter","regex","handler","match","slice","getCodeFrame","query","lineNumber","column","linesAbove","linesBelow","getCodeFrameFromRelayError","start","source","body","line","multipleRootQueriesError","otherDef","otherName","unifiedName","_","camelCase","upperFirst","yellow","green","graphqlValidationError","errors","doc","length","locations","graphqlError","namePathMap","nameDefMap","get","reportedMessage"],"mappings":"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","sourcesContent":["// @flow\n\nimport { print, visit, GraphQLError, getLocation } from \"graphql\"\nimport babelCodeFrame from \"@babel/code-frame\"\nimport _ from \"lodash\"\nimport report from \"gatsby-cli/lib/reporter\"\n\ntype RelayGraphQLError = Error & { validationErrors?: Object }\n\n// These handle specific errors throw by RelayParser. If an error matches\n// you get a pointer to the location in the query that is broken, otherwise\n// we show the error and the query.\nconst handlers = [\n  [\n    /Unknown field `(.+)` on type `(.+)`/i,\n    ([name], node) => {\n      if (node.kind === `Field` && node.name.value === name) {\n        return node.name.loc\n      }\n      return null\n    },\n  ],\n  [\n    /Unknown argument `(.+)`/i,\n    ([name], node) => {\n      if (node.kind === `Argument` && node.name.value === name) {\n        return node.name.loc\n      }\n      return null\n    },\n  ],\n  [\n    /Unknown directive `@(.+)`/i,\n    ([name], node) => {\n      if (node.kind === `Directive` && node.name.value === name) {\n        return node.name.loc\n      }\n      return null\n    },\n  ],\n]\n\nfunction formatFilePath(filePath: string) {\n  return `${report.format.bold(`file:`)} ${report.format.blue(filePath)}`\n}\n\nfunction formatError(message: string, filePath: string, codeFrame: string) {\n  return (\n    report.stripIndent`\n    ${message}\n\n      ${formatFilePath(filePath)}\n  ` + `\\n\\n${codeFrame}\\n`\n  )\n}\n\nfunction extractError(error: Error): { message: string, docName: string } {\n  const docRegex = /Invariant Violation: (RelayParser|GraphQLParser): (.*). Source: document `(.*)` file:/g\n  let matches\n  let message = ``,\n    docName = ``\n  while ((matches = docRegex.exec(error.toString())) !== null) {\n    // This is necessary to avoid infinite loops with zero-width matches\n    if (matches.index === docRegex.lastIndex) docRegex.lastIndex++\n    ;[, , message, docName] = matches\n  }\n\n  if (!message) {\n    message = error.toString()\n  }\n\n  return { message, docName }\n}\n\nfunction findLocation(extractedMessage, def) {\n  let location = null\n  visit(def, {\n    enter(node) {\n      if (location) return\n      for (let [regex, handler] of handlers) {\n        let match = extractedMessage.match(regex)\n        if (!match) continue\n        if ((location = handler(match.slice(1), node))) break\n      }\n    },\n  })\n  return location\n}\n\nfunction getCodeFrame(query: string, lineNumber?: number, column?: number) {\n  return babelCodeFrame(query, lineNumber, column, {\n    linesAbove: 10,\n    linesBelow: 10,\n  })\n}\n\nfunction getCodeFrameFromRelayError(\n  def: any,\n  extractedMessage: string,\n  error: Error\n) {\n  let { start, source } = findLocation(extractedMessage, def) || {}\n  let query = source ? source.body : print(def)\n\n  // we can't reliably get a location without the location source, since\n  // the printed query may differ from the original.\n  let { line, column } = (source && getLocation(source, start)) || {}\n  return getCodeFrame(query, line, column)\n}\n\nexport function multipleRootQueriesError(\n  filePath: string,\n  def: any,\n  otherDef: any\n) {\n  let name = def.name.value\n  let otherName = otherDef.name.value\n  let unifiedName = `${_.camelCase(name)}And${_.upperFirst(\n    _.camelCase(otherName)\n  )}`\n\n  return formatError(\n    `Multiple \"root\" queries found in file: \"${name}\" and \"${otherName}\". ` +\n      `Only the first (\"${otherName}\") will be registered.`,\n    filePath,\n    `  ${report.format.yellow(`Instead of:`)} \\n\\n` +\n      babelCodeFrame(report.stripIndent`\n      query ${otherName} {\n        bar {\n          #...\n        }\n      }\n\n      query ${name} {\n        foo {\n          #...\n        }\n      }\n    `) +\n      `\\n\\n  ${report.format.green(`Do:`)} \\n\\n` +\n      babelCodeFrame(report.stripIndent`\n      query ${unifiedName} {\n        bar {\n          #...\n        }\n        foo {\n          #...\n        }\n      }\n    `)\n  )\n}\n\nexport function graphqlValidationError(\n  errors: Array<GraphQLError>,\n  filePath: string,\n  doc: any\n): string {\n  if (!errors || !errors.length) return ``\n  let error = errors[0]\n  let { source, locations: [{ line, column }] = [{}] } = error\n  let query = source ? source.body : print(doc)\n\n  return formatError(error.message, filePath, getCodeFrame(query, line, column))\n}\n\nexport function graphqlError(\n  namePathMap: Map<string, string>,\n  nameDefMap: Map<string, any>,\n  error: Error | RelayGraphQLError\n) {\n  let { message, docName } = extractError(error)\n  let filePath = namePathMap.get(docName)\n\n  if (filePath && docName) {\n    return formatError(\n      message,\n      filePath,\n      getCodeFrameFromRelayError(nameDefMap.get(docName), message, error)\n    )\n  }\n\n  let reportedMessage = `There was an error while compiling your site's GraphQL queries.\n  ${message || error.message}\n    `\n\n  if (error.message.match(/must be an instance of/)) {\n    reportedMessage +=\n      `This usually means that more than one instance of 'graphql' is installed ` +\n      `in your node_modules. Remove all but the top level one or run \\`npm dedupe\\` to fix it.`\n  }\n\n  if (error.message.match(/Duplicate document/)) {\n    reportedMessage += `${error.message.slice(21)}\\n`\n  }\n\n  return reportedMessage\n}\n"],"file":"graphql-errors.js"}
\ No newline at end of file
+{"version":3,"sources":["../../../src/internal-plugins/query-runner/graphql-errors.js"],"names":["handlers","name","node","kind","value","loc","formatFilePath","filePath","report","format","bold","blue","formatError","message","codeFrame","stripIndent","extractError","error","docRegex","matches","docName","exec","toString","index","lastIndex","findLocation","extractedMessage","def","location","enter","regex","handler","match","slice","getCodeFrame","query","lineNumber","column","linesAbove","linesBelow","getCodeFrameFromRelayError","start","source","body","line","multipleRootQueriesError","otherDef","otherName","unifiedName","_","camelCase","upperFirst","yellow","green","graphqlValidationError","errors","doc","length","locations","graphqlError","namePathMap","nameDefMap","get","reportedMessage"],"mappings":"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","sourcesContent":["// @flow\n\nimport { print, visit, GraphQLError, getLocation } from \"graphql\"\nimport babelCodeFrame from \"@babel/code-frame\"\nimport _ from \"lodash\"\nimport report from \"gatsby-cli/lib/reporter\"\n\ntype RelayGraphQLError = Error & { validationErrors?: Object }\n\n// These handle specific errors throw by RelayParser. If an error matches\n// you get a pointer to the location in the query that is broken, otherwise\n// we show the error and the query.\nconst handlers = [\n  [\n    /Unknown field `(.+)` on type `(.+)`/i,\n    ([name], node) => {\n      if (node.kind === `Field` && node.name.value === name) {\n        return node.name.loc\n      }\n      return null\n    },\n  ],\n  [\n    /Unknown argument `(.+)`/i,\n    ([name], node) => {\n      if (node.kind === `Argument` && node.name.value === name) {\n        return node.name.loc\n      }\n      return null\n    },\n  ],\n  [\n    /Unknown directive `@(.+)`/i,\n    ([name], node) => {\n      if (node.kind === `Directive` && node.name.value === name) {\n        return node.name.loc\n      }\n      return null\n    },\n  ],\n]\n\nfunction formatFilePath(filePath: string) {\n  return `${report.format.bold(`file:`)} ${report.format.blue(filePath)}`\n}\n\nfunction formatError(message: string, filePath: string, codeFrame: string) {\n  return (\n    report.stripIndent`\n    ${message}\n\n      ${formatFilePath(filePath)}\n  ` + `\\n\\n${codeFrame}\\n`\n  )\n}\n\nfunction extractError(error: Error): { message: string, docName: string } {\n  const docRegex = /Invariant Violation: (RelayParser|GraphQLParser): (.*). Source: document `(.*)` file:/g\n  let matches\n  let message = ``,\n    docName = ``\n  while ((matches = docRegex.exec(error.toString())) !== null) {\n    // This is necessary to avoid infinite loops with zero-width matches\n    if (matches.index === docRegex.lastIndex) docRegex.lastIndex++\n    ;[, , message, docName] = matches\n  }\n\n  if (!message) {\n    message = error.toString()\n  }\n\n  return { message, docName }\n}\n\nfunction findLocation(extractedMessage, def) {\n  let location = null\n  visit(def, {\n    enter(node) {\n      if (location) return\n      for (let [regex, handler] of handlers) {\n        let match = extractedMessage.match(regex)\n        if (!match) continue\n        if ((location = handler(match.slice(1), node))) break\n      }\n    },\n  })\n  return location\n}\n\nfunction getCodeFrame(query: string, lineNumber?: number, column?: number) {\n  return babelCodeFrame(query, lineNumber, column, {\n    linesAbove: 10,\n    linesBelow: 10,\n  })\n}\n\nfunction getCodeFrameFromRelayError(\n  def: any,\n  extractedMessage: string,\n  error: Error\n) {\n  let { start, source } = findLocation(extractedMessage, def) || {}\n  let query = source ? source.body : print(def)\n\n  // we can't reliably get a location without the location source, since\n  // the printed query may differ from the original.\n  let { line, column } = (source && getLocation(source, start)) || {}\n  return getCodeFrame(query, line, column)\n}\n\nexport function multipleRootQueriesError(\n  filePath: string,\n  def: any,\n  otherDef: any\n) {\n  let name = def.name.value\n  let otherName = otherDef.name.value\n  let unifiedName = `${_.camelCase(name)}And${_.upperFirst(\n    _.camelCase(otherName)\n  )}`\n\n  return formatError(\n    `Multiple \"root\" queries found in file: \"${name}\" and \"${otherName}\". ` +\n      `Only the first (\"${otherName}\") will be registered.`,\n    filePath,\n    `  ${report.format.yellow(`Instead of:`)} \\n\\n` +\n      babelCodeFrame(report.stripIndent`\n      query ${otherName} {\n        bar {\n          #...\n        }\n      }\n\n      query ${name} {\n        foo {\n          #...\n        }\n      }\n    `) +\n      `\\n\\n  ${report.format.green(`Do:`)} \\n\\n` +\n      babelCodeFrame(report.stripIndent`\n      query ${unifiedName} {\n        bar {\n          #...\n        }\n        foo {\n          #...\n        }\n      }\n    `)\n  )\n}\n\nexport function graphqlValidationError(\n  errors: Array<GraphQLError>,\n  filePath: string,\n  doc: any\n): string {\n  if (!errors || !errors.length) return ``\n  let error = errors[0]\n  let { source, locations: [{ line, column }] = [{}] } = error\n  let query = source ? source.body : print(doc)\n\n  return formatError(error.message, filePath, getCodeFrame(query, line, column))\n}\n\nexport function graphqlError(\n  namePathMap: Map<string, string>,\n  nameDefMap: Map<string, any>,\n  error: Error | RelayGraphQLError\n) {\n  let { message, docName } = extractError(error)\n  let filePath = namePathMap.get(docName)\n\n  if (filePath && docName) {\n    return formatError(\n      message,\n      filePath,\n      getCodeFrameFromRelayError(nameDefMap.get(docName), message, error)\n    )\n  }\n\n  let reportedMessage = `There was an error while compiling your site's GraphQL queries.\n  ${message || error.message}\n    `\n\n  if (error.message.match(/must be an instance of/)) {\n    reportedMessage +=\n      `This usually means that more than one instance of 'graphql' is installed ` +\n      `in your node_modules. Remove all but the top level one or run \\`npm dedupe\\` to fix it.`\n  }\n\n  if (error.message.match(/Duplicate document/)) {\n    reportedMessage += `${error.message.slice(21)}\\n`\n  }\n\n  return reportedMessage\n}\n"],"file":"graphql-errors.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/internal-plugins/query-runner/page-query-runner.js
+++ b/node_modules/gatsby/dist/internal-plugins/query-runner/page-query-runner.js
@@ -1,9 +1,5 @@
 "use strict";
 
-var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
-
-var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
-
 /**
  * Jobs of this module
  * - Ensure on bootstrap that all invalid page queries are run and report
@@ -14,9 +10,10 @@ const _ = require(`lodash`);
 
 const queue = require(`./query-queue`);
 
-const _require = require(`../../redux`),
-      store = _require.store,
-      emitter = _require.emitter;
+const {
+  store,
+  emitter
+} = require(`../../redux`);
 
 let queuedDirtyActions = [];
 let active = false;
@@ -30,38 +27,28 @@ exports.queueQueryForPathname = pathname => {
 // for dirty nodes before running queries.
 
 
-exports.runInitialQueries =
-/*#__PURE__*/
-(0, _asyncToGenerator2.default)(function* () {
-  yield runQueries();
+exports.runInitialQueries = async () => {
+  await runQueries();
   active = true;
   return;
-});
-
-const runQueries =
-/*#__PURE__*/
-function () {
-  var _ref2 = (0, _asyncToGenerator2.default)(function* () {
-    // Find paths dependent on dirty nodes
-    queuedDirtyActions = _.uniq(queuedDirtyActions, a => a.payload.id);
-    const dirtyIds = findDirtyIds(queuedDirtyActions);
-    queuedDirtyActions = []; // Find ids without data dependencies (i.e. no queries have been run for
-    // them before) and run them.
+};
 
-    const cleanIds = findIdsWithoutDataDependencies(); // Construct paths for all queries to run
+const runQueries = async () => {
+  // Find paths dependent on dirty nodes
+  queuedDirtyActions = _.uniq(queuedDirtyActions, a => a.payload.id);
+  const dirtyIds = findDirtyIds(queuedDirtyActions);
+  queuedDirtyActions = []; // Find ids without data dependencies (i.e. no queries have been run for
+  // them before) and run them.
 
-    const pathnamesToRun = _.uniq([...runQueriesForPathnamesQueue, ...dirtyIds, ...cleanIds]);
+  const cleanIds = findIdsWithoutDataDependencies(); // Construct paths for all queries to run
 
-    runQueriesForPathnamesQueue.clear(); // Run these paths
+  const pathnamesToRun = _.uniq([...runQueriesForPathnamesQueue, ...dirtyIds, ...cleanIds]);
 
-    yield runQueriesForPathnames(pathnamesToRun);
-    return;
-  });
+  runQueriesForPathnamesQueue.clear(); // Run these paths
 
-  return function runQueries() {
-    return _ref2.apply(this, arguments);
-  };
-}();
+  await runQueriesForPathnames(pathnamesToRun);
+  return;
+};
 
 emitter.on(`CREATE_NODE`, action => {
   queuedDirtyActions.push(action);
@@ -72,28 +59,20 @@ emitter.on(`DELETE_NODE`, action => {
   });
 });
 
-const runQueuedActions =
-/*#__PURE__*/
-function () {
-  var _ref3 = (0, _asyncToGenerator2.default)(function* () {
-    if (active && !running) {
-      try {
-        running = true;
-        yield runQueries();
-      } finally {
-        running = false;
-
-        if (queuedDirtyActions.length > 0) {
-          runQueuedActions();
-        }
+const runQueuedActions = async () => {
+  if (active && !running) {
+    try {
+      running = true;
+      await runQueries();
+    } finally {
+      running = false;
+
+      if (queuedDirtyActions.length > 0) {
+        runQueuedActions();
       }
     }
-  });
-
-  return function runQueuedActions() {
-    return _ref3.apply(this, arguments);
-  };
-}();
+  }
+};
 
 exports.runQueuedActions = runQueuedActions; // Wait until all plugins have finished running (e.g. various
 // transformer plugins) before running queries so we don't
@@ -148,7 +127,9 @@ const runQueriesForPathnames = pathnames => {
         query: store.getState().components.get(page.componentPath).query,
         isPage: true,
         componentPath: page.componentPath,
-        context: Object.assign({}, page, page.context)
+        context: { ...page,
+          ...page.context
+        }
       });
     }
   });
--- a/node_modules/gatsby/dist/internal-plugins/query-runner/page-query-runner.js.map
+++ b/node_modules/gatsby/dist/internal-plugins/query-runner/page-query-runner.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../../src/internal-plugins/query-runner/page-query-runner.js"],"names":["_","require","queue","store","emitter","queuedDirtyActions","active","running","runQueriesForPathnamesQueue","Set","exports","queueQueryForPathname","pathname","add","runInitialQueries","runQueries","uniq","a","payload","id","dirtyIds","findDirtyIds","cleanIds","findIdsWithoutDataDependencies","pathnamesToRun","clear","runQueriesForPathnames","on","action","push","runQueuedActions","length","seenIdsWithoutDataDependencies","state","getState","allTrackedIds","flatten","concat","values","componentDataDependencies","nodes","connections","notTrackedIds","difference","Array","from","pages","p","path","staticQueryComponents","map","c","jsonName","pathnames","staticQueries","filter","slice","pageQueries","forEach","staticQueryComponent","get","queryJob","hash","query","componentPath","context","didNotQueueItems","page","components","isPage","Promise","resolve","actions","uniqDirties","reduce","node","internal","type","compact"],"mappings":"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","sourcesContent":["// @flow\n\nimport type { QueryJob } from \"../query-runner\"\n\n/**\n * Jobs of this module\n * - Ensure on bootstrap that all invalid page queries are run and report\n *   when this is done\n * - Watch for when a page's query is invalidated and re-run it.\n */\n\nconst _ = require(`lodash`)\n\nconst queue = require(`./query-queue`)\nconst { store, emitter } = require(`../../redux`)\n\nlet queuedDirtyActions = []\nlet active = false\nlet running = false\n\nconst runQueriesForPathnamesQueue = new Set()\nexports.queueQueryForPathname = pathname => {\n  runQueriesForPathnamesQueue.add(pathname)\n}\n\n// Do initial run of graphql queries during bootstrap.\n// Afterwards we listen \"API_RUNNING_QUEUE_EMPTY\" and check\n// for dirty nodes before running queries.\nexports.runInitialQueries = async () => {\n  await runQueries()\n\n  active = true\n  return\n}\n\nconst runQueries = async () => {\n  // Find paths dependent on dirty nodes\n  queuedDirtyActions = _.uniq(queuedDirtyActions, a => a.payload.id)\n  const dirtyIds = findDirtyIds(queuedDirtyActions)\n  queuedDirtyActions = []\n\n  // Find ids without data dependencies (i.e. no queries have been run for\n  // them before) and run them.\n  const cleanIds = findIdsWithoutDataDependencies()\n\n  // Construct paths for all queries to run\n  const pathnamesToRun = _.uniq([\n    ...runQueriesForPathnamesQueue,\n    ...dirtyIds,\n    ...cleanIds,\n  ])\n\n  runQueriesForPathnamesQueue.clear()\n\n  // Run these paths\n  await runQueriesForPathnames(pathnamesToRun)\n  return\n}\n\nemitter.on(`CREATE_NODE`, action => {\n  queuedDirtyActions.push(action)\n})\n\nemitter.on(`DELETE_NODE`, action => {\n  queuedDirtyActions.push({ payload: action.payload })\n})\n\nconst runQueuedActions = async () => {\n  if (active && !running) {\n    try {\n      running = true\n      await runQueries()\n    } finally {\n      running = false\n      if (queuedDirtyActions.length > 0) {\n        runQueuedActions()\n      }\n    }\n  }\n}\nexports.runQueuedActions = runQueuedActions\n\n// Wait until all plugins have finished running (e.g. various\n// transformer plugins) before running queries so we don't\n// query things in a 1/2 finished state.\nemitter.on(`API_RUNNING_QUEUE_EMPTY`, runQueuedActions)\n\nlet seenIdsWithoutDataDependencies = []\nconst findIdsWithoutDataDependencies = () => {\n  const state = store.getState()\n  const allTrackedIds = _.uniq(\n    _.flatten(\n      _.concat(\n        _.values(state.componentDataDependencies.nodes),\n        _.values(state.componentDataDependencies.connections)\n      )\n    )\n  )\n\n  // Get list of paths not already tracked and run the queries for these\n  // paths.\n  const notTrackedIds = _.difference(\n    [\n      ...Array.from(state.pages.values(), p => p.path),\n      ...[...state.staticQueryComponents.values()].map(c => c.jsonName),\n    ],\n    [...allTrackedIds, ...seenIdsWithoutDataDependencies]\n  )\n\n  // Add new IDs to our seen array so we don't keep trying to run queries for them.\n  // Pages without queries can't be tracked.\n  seenIdsWithoutDataDependencies = _.uniq([\n    ...notTrackedIds,\n    ...seenIdsWithoutDataDependencies,\n  ])\n\n  return notTrackedIds\n}\n\nconst runQueriesForPathnames = pathnames => {\n  const staticQueries = pathnames.filter(p => p.slice(0, 4) === `sq--`)\n  const pageQueries = pathnames.filter(p => p.slice(0, 4) !== `sq--`)\n  const state = store.getState()\n\n  staticQueries.forEach(id => {\n    const staticQueryComponent = store.getState().staticQueryComponents.get(id)\n    const queryJob: QueryJob = {\n      id: staticQueryComponent.hash,\n      hash: staticQueryComponent.hash,\n      jsonName: staticQueryComponent.jsonName,\n      query: staticQueryComponent.query,\n      componentPath: staticQueryComponent.componentPath,\n      context: { path: staticQueryComponent.jsonName },\n    }\n    queue.push(queryJob)\n  })\n\n  const pages = state.pages\n  let didNotQueueItems = true\n  pageQueries.forEach(id => {\n    const page = pages.get(id)\n    if (page) {\n      didNotQueueItems = false\n      queue.push(\n        ({\n          id: page.path,\n          jsonName: page.jsonName,\n          query: store.getState().components.get(page.componentPath).query,\n          isPage: true,\n          componentPath: page.componentPath,\n          context: {\n            ...page,\n            ...page.context,\n          },\n        }: QueryJob)\n      )\n    }\n  })\n\n  if (didNotQueueItems || !pathnames || pathnames.length === 0) {\n    return Promise.resolve()\n  }\n\n  return new Promise(resolve => {\n    queue.on(`drain`, () => {\n      resolve()\n    })\n  })\n}\n\nconst findDirtyIds = actions => {\n  const state = store.getState()\n  const uniqDirties = _.uniq(\n    actions.reduce((dirtyIds, action) => {\n      const node = action.payload\n\n      if (!node || !node.id || !node.internal.type) return dirtyIds\n\n      // Find components that depend on this node so are now dirty.\n      dirtyIds = dirtyIds.concat(state.componentDataDependencies.nodes[node.id])\n\n      // Find connections that depend on this node so are now invalid.\n      dirtyIds = dirtyIds.concat(\n        state.componentDataDependencies.connections[node.internal.type]\n      )\n\n      return _.compact(dirtyIds)\n    }, [])\n  )\n  return uniqDirties\n}\n"],"file":"page-query-runner.js"}
\ No newline at end of file
+{"version":3,"sources":["../../../src/internal-plugins/query-runner/page-query-runner.js"],"names":["_","require","queue","store","emitter","queuedDirtyActions","active","running","runQueriesForPathnamesQueue","Set","exports","queueQueryForPathname","pathname","add","runInitialQueries","runQueries","uniq","a","payload","id","dirtyIds","findDirtyIds","cleanIds","findIdsWithoutDataDependencies","pathnamesToRun","clear","runQueriesForPathnames","on","action","push","runQueuedActions","length","seenIdsWithoutDataDependencies","state","getState","allTrackedIds","flatten","concat","values","componentDataDependencies","nodes","connections","notTrackedIds","difference","Array","from","pages","p","path","staticQueryComponents","map","c","jsonName","pathnames","staticQueries","filter","slice","pageQueries","forEach","staticQueryComponent","get","queryJob","hash","query","componentPath","context","didNotQueueItems","page","components","isPage","Promise","resolve","actions","uniqDirties","reduce","node","internal","type","compact"],"mappings":"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","sourcesContent":["// @flow\n\nimport type { QueryJob } from \"../query-runner\"\n\n/**\n * Jobs of this module\n * - Ensure on bootstrap that all invalid page queries are run and report\n *   when this is done\n * - Watch for when a page's query is invalidated and re-run it.\n */\n\nconst _ = require(`lodash`)\n\nconst queue = require(`./query-queue`)\nconst { store, emitter } = require(`../../redux`)\n\nlet queuedDirtyActions = []\nlet active = false\nlet running = false\n\nconst runQueriesForPathnamesQueue = new Set()\nexports.queueQueryForPathname = pathname => {\n  runQueriesForPathnamesQueue.add(pathname)\n}\n\n// Do initial run of graphql queries during bootstrap.\n// Afterwards we listen \"API_RUNNING_QUEUE_EMPTY\" and check\n// for dirty nodes before running queries.\nexports.runInitialQueries = async () => {\n  await runQueries()\n\n  active = true\n  return\n}\n\nconst runQueries = async () => {\n  // Find paths dependent on dirty nodes\n  queuedDirtyActions = _.uniq(queuedDirtyActions, a => a.payload.id)\n  const dirtyIds = findDirtyIds(queuedDirtyActions)\n  queuedDirtyActions = []\n\n  // Find ids without data dependencies (i.e. no queries have been run for\n  // them before) and run them.\n  const cleanIds = findIdsWithoutDataDependencies()\n\n  // Construct paths for all queries to run\n  const pathnamesToRun = _.uniq([\n    ...runQueriesForPathnamesQueue,\n    ...dirtyIds,\n    ...cleanIds,\n  ])\n\n  runQueriesForPathnamesQueue.clear()\n\n  // Run these paths\n  await runQueriesForPathnames(pathnamesToRun)\n  return\n}\n\nemitter.on(`CREATE_NODE`, action => {\n  queuedDirtyActions.push(action)\n})\n\nemitter.on(`DELETE_NODE`, action => {\n  queuedDirtyActions.push({ payload: action.payload })\n})\n\nconst runQueuedActions = async () => {\n  if (active && !running) {\n    try {\n      running = true\n      await runQueries()\n    } finally {\n      running = false\n      if (queuedDirtyActions.length > 0) {\n        runQueuedActions()\n      }\n    }\n  }\n}\nexports.runQueuedActions = runQueuedActions\n\n// Wait until all plugins have finished running (e.g. various\n// transformer plugins) before running queries so we don't\n// query things in a 1/2 finished state.\nemitter.on(`API_RUNNING_QUEUE_EMPTY`, runQueuedActions)\n\nlet seenIdsWithoutDataDependencies = []\nconst findIdsWithoutDataDependencies = () => {\n  const state = store.getState()\n  const allTrackedIds = _.uniq(\n    _.flatten(\n      _.concat(\n        _.values(state.componentDataDependencies.nodes),\n        _.values(state.componentDataDependencies.connections)\n      )\n    )\n  )\n\n  // Get list of paths not already tracked and run the queries for these\n  // paths.\n  const notTrackedIds = _.difference(\n    [\n      ...Array.from(state.pages.values(), p => p.path),\n      ...[...state.staticQueryComponents.values()].map(c => c.jsonName),\n    ],\n    [...allTrackedIds, ...seenIdsWithoutDataDependencies]\n  )\n\n  // Add new IDs to our seen array so we don't keep trying to run queries for them.\n  // Pages without queries can't be tracked.\n  seenIdsWithoutDataDependencies = _.uniq([\n    ...notTrackedIds,\n    ...seenIdsWithoutDataDependencies,\n  ])\n\n  return notTrackedIds\n}\n\nconst runQueriesForPathnames = pathnames => {\n  const staticQueries = pathnames.filter(p => p.slice(0, 4) === `sq--`)\n  const pageQueries = pathnames.filter(p => p.slice(0, 4) !== `sq--`)\n  const state = store.getState()\n\n  staticQueries.forEach(id => {\n    const staticQueryComponent = store.getState().staticQueryComponents.get(id)\n    const queryJob: QueryJob = {\n      id: staticQueryComponent.hash,\n      hash: staticQueryComponent.hash,\n      jsonName: staticQueryComponent.jsonName,\n      query: staticQueryComponent.query,\n      componentPath: staticQueryComponent.componentPath,\n      context: { path: staticQueryComponent.jsonName },\n    }\n    queue.push(queryJob)\n  })\n\n  const pages = state.pages\n  let didNotQueueItems = true\n  pageQueries.forEach(id => {\n    const page = pages.get(id)\n    if (page) {\n      didNotQueueItems = false\n      queue.push(\n        ({\n          id: page.path,\n          jsonName: page.jsonName,\n          query: store.getState().components.get(page.componentPath).query,\n          isPage: true,\n          componentPath: page.componentPath,\n          context: {\n            ...page,\n            ...page.context,\n          },\n        }: QueryJob)\n      )\n    }\n  })\n\n  if (didNotQueueItems || !pathnames || pathnames.length === 0) {\n    return Promise.resolve()\n  }\n\n  return new Promise(resolve => {\n    queue.on(`drain`, () => {\n      resolve()\n    })\n  })\n}\n\nconst findDirtyIds = actions => {\n  const state = store.getState()\n  const uniqDirties = _.uniq(\n    actions.reduce((dirtyIds, action) => {\n      const node = action.payload\n\n      if (!node || !node.id || !node.internal.type) return dirtyIds\n\n      // Find components that depend on this node so are now dirty.\n      dirtyIds = dirtyIds.concat(state.componentDataDependencies.nodes[node.id])\n\n      // Find connections that depend on this node so are now invalid.\n      dirtyIds = dirtyIds.concat(\n        state.componentDataDependencies.connections[node.internal.type]\n      )\n\n      return _.compact(dirtyIds)\n    }, [])\n  )\n  return uniqDirties\n}\n"],"file":"page-query-runner.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/internal-plugins/query-runner/pages-writer.js
+++ b/node_modules/gatsby/dist/internal-plugins/query-runner/pages-writer.js
@@ -1,9 +1,5 @@
 "use strict";
 
-var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
-
-var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
-
 var _path = require("../../utils/path");
 
 const _ = require(`lodash`);
@@ -12,105 +8,97 @@ const fs = require(`fs-extra`);
 
 const crypto = require(`crypto`);
 
-const _require = require(`../../redux/`),
-      store = _require.store,
-      emitter = _require.emitter;
+const {
+  store,
+  emitter
+} = require(`../../redux/`);
 
 let lastHash = null; // Write out pages information.
 
-const writePages =
-/*#__PURE__*/
-function () {
-  var _ref = (0, _asyncToGenerator2.default)(function* () {
-    bootstrapFinished = true;
-
-    let _store$getState = store.getState(),
-        program = _store$getState.program,
-        jsonDataPaths = _store$getState.jsonDataPaths,
-        pages = _store$getState.pages;
+const writePages = async () => {
+  bootstrapFinished = true;
+  let {
+    program,
+    jsonDataPaths,
+    pages
+  } = store.getState();
+  pages = [...pages.values()];
+  const pagesComponentDependencies = {}; // Write out pages.json
+
+  let pagesData = [];
+  pages.forEach(({
+    path,
+    matchPath,
+    componentChunkName,
+    jsonName
+  }) => {
+    const pageComponentsChunkNames = {
+      componentChunkName
+    };
 
-    pages = [...pages.values()];
-    const pagesComponentDependencies = {}; // Write out pages.json
+    if (program._[0] === `develop`) {
+      pagesComponentDependencies[path] = pageComponentsChunkNames;
+    }
 
-    let pagesData = [];
-    pages.forEach(({
+    pagesData.push({ ...pageComponentsChunkNames,
+      jsonName,
       path,
-      matchPath,
-      componentChunkName,
-      jsonName
-    }) => {
-      const pageComponentsChunkNames = {
-        componentChunkName
-      };
-
-      if (program._[0] === `develop`) {
-        pagesComponentDependencies[path] = pageComponentsChunkNames;
-      }
-
-      pagesData.push(Object.assign({}, pageComponentsChunkNames, {
-        jsonName,
-        path,
-        matchPath
-      }));
+      matchPath
     });
-    pagesData = _(pagesData) // Ensure pages keep the same sorting through builds.
-    // Pages without matchPath come first, then pages with matchPath,
-    // where more specific patterns come before less specific patterns.
-    // This ensures explicit routes will match before general.
-    // Specificity is inferred from number of path segments.
-    .sortBy(p => `${p.matchPath ? 9999 - p.matchPath.split(`/`).length : `0000`}${p.path}`).value();
-    const newHash = crypto.createHash(`md5`).update(JSON.stringify(pagesComponentDependencies)).digest(`hex`);
-
-    if (newHash === lastHash) {
-      // components didn't change - no need to rewrite pages.json
-      return Promise.resolve();
-    }
+  });
+  pagesData = _(pagesData) // Ensure pages keep the same sorting through builds.
+  // Pages without matchPath come first, then pages with matchPath,
+  // where more specific patterns come before less specific patterns.
+  // This ensures explicit routes will match before general.
+  // Specificity is inferred from number of path segments.
+  .sortBy(p => `${p.matchPath ? 9999 - p.matchPath.split(`/`).length : `0000`}${p.path}`).value();
+  const newHash = crypto.createHash(`md5`).update(JSON.stringify(pagesComponentDependencies)).digest(`hex`);
+
+  if (newHash === lastHash) {
+    // components didn't change - no need to rewrite pages.json
+    return Promise.resolve();
+  }
 
-    lastHash = newHash; // Get list of components, and json files.
+  lastHash = newHash; // Get list of components, and json files.
 
-    let components = [];
-    pages.forEach(p => {
-      components.push({
-        componentChunkName: p.componentChunkName,
-        component: p.component
-      });
+  let components = [];
+  pages.forEach(p => {
+    components.push({
+      componentChunkName: p.componentChunkName,
+      component: p.component
     });
-    components = _.uniqBy(components, c => c.componentChunkName); // Create file with sync requires of components/json files.
+  });
+  components = _.uniqBy(components, c => c.componentChunkName); // Create file with sync requires of components/json files.
 
-    let syncRequires = `// prefer default export if available
+  let syncRequires = `// prefer default export if available
 const preferDefault = m => m && m.default || m
 \n\n`;
-    syncRequires += `exports.components = {\n${components.map(c => `  "${c.componentChunkName}": preferDefault(require("${(0, _path.joinPath)(c.component)}"))`).join(`,\n`)}
+  syncRequires += `exports.components = {\n${components.map(c => `  "${c.componentChunkName}": preferDefault(require("${(0, _path.joinPath)(c.component)}"))`).join(`,\n`)}
 }\n\n`; // Create file with async requires of components/json files.
 
-    let asyncRequires = `// prefer default export if available
+  let asyncRequires = `// prefer default export if available
 const preferDefault = m => m && m.default || m
 \n`;
-    asyncRequires += `exports.components = {\n${components.map(c => `  "${c.componentChunkName}": () => import("${(0, _path.joinPath)(c.component)}" /* webpackChunkName: "${c.componentChunkName}" */)`).join(`,\n`)}
+  asyncRequires += `exports.components = {\n${components.map(c => `  "${c.componentChunkName}": () => import("${(0, _path.joinPath)(c.component)}" /* webpackChunkName: "${c.componentChunkName}" */)`).join(`,\n`)}
 }\n\n`;
-    asyncRequires += `exports.data = () => import("${(0, _path.joinPath)(program.directory, `.cache`, `data.json`)}")\n\n`;
-
-    const writeAndMove = (file, data) => {
-      const destination = (0, _path.joinPath)(program.directory, `.cache`, file);
-      const tmp = `${destination}.${Date.now()}`;
-      return fs.writeFile(tmp, data).then(() => fs.move(tmp, destination, {
-        overwrite: true
-      }));
-    };
-
-    const result = yield Promise.all([writeAndMove(`pages.json`, JSON.stringify(pagesData, null, 4)), writeAndMove(`sync-requires.js`, syncRequires), writeAndMove(`async-requires.js`, asyncRequires), writeAndMove(`data.json`, JSON.stringify({
-      pages: pagesData,
-      // Sort dataPaths by keys to ensure keeping the same
-      // sorting through builds
-      dataPaths: _(jsonDataPaths).toPairs().sortBy(0).fromPairs().value()
-    }))]);
-    return result;
-  });
-
-  return function writePages() {
-    return _ref.apply(this, arguments);
+  asyncRequires += `exports.data = () => import("${(0, _path.joinPath)(program.directory, `.cache`, `data.json`)}")\n\n`;
+
+  const writeAndMove = (file, data) => {
+    const destination = (0, _path.joinPath)(program.directory, `.cache`, file);
+    const tmp = `${destination}.${Date.now()}`;
+    return fs.writeFile(tmp, data).then(() => fs.move(tmp, destination, {
+      overwrite: true
+    }));
   };
-}();
+
+  const result = await Promise.all([writeAndMove(`pages.json`, JSON.stringify(pagesData, null, 4)), writeAndMove(`sync-requires.js`, syncRequires), writeAndMove(`async-requires.js`, asyncRequires), writeAndMove(`data.json`, JSON.stringify({
+    pages: pagesData,
+    // Sort dataPaths by keys to ensure keeping the same
+    // sorting through builds
+    dataPaths: _(jsonDataPaths).toPairs().sortBy(0).fromPairs().value()
+  }))]);
+  return result;
+};
 
 exports.writePages = writePages;
 
--- a/node_modules/gatsby/dist/internal-plugins/query-runner/pages-writer.js.map
+++ b/node_modules/gatsby/dist/internal-plugins/query-runner/pages-writer.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../../src/internal-plugins/query-runner/pages-writer.js"],"names":["_","require","fs","crypto","store","emitter","lastHash","writePages","bootstrapFinished","getState","program","jsonDataPaths","pages","values","pagesComponentDependencies","pagesData","forEach","path","matchPath","componentChunkName","jsonName","pageComponentsChunkNames","push","sortBy","p","split","length","value","newHash","createHash","update","JSON","stringify","digest","Promise","resolve","components","component","uniqBy","c","syncRequires","map","join","asyncRequires","directory","writeAndMove","file","data","destination","tmp","Date","now","writeFile","then","move","overwrite","result","all","dataPaths","toPairs","fromPairs","exports","resetLastHash","debouncedWritePages","debounce","leading","on"],"mappings":"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","sourcesContent":["const _ = require(`lodash`)\nconst fs = require(`fs-extra`)\nconst crypto = require(`crypto`)\n\nconst { store, emitter } = require(`../../redux/`)\n\nimport { joinPath } from \"../../utils/path\"\n\nlet lastHash = null\n\n// Write out pages information.\nconst writePages = async () => {\n  bootstrapFinished = true\n  let { program, jsonDataPaths, pages } = store.getState()\n  pages = [...pages.values()]\n\n  const pagesComponentDependencies = {}\n\n  // Write out pages.json\n  let pagesData = []\n  pages.forEach(({ path, matchPath, componentChunkName, jsonName }) => {\n    const pageComponentsChunkNames = {\n      componentChunkName,\n    }\n\n    if (program._[0] === `develop`) {\n      pagesComponentDependencies[path] = pageComponentsChunkNames\n    }\n\n    pagesData.push({\n      ...pageComponentsChunkNames,\n      jsonName,\n      path,\n      matchPath,\n    })\n  })\n\n  pagesData = _(pagesData)\n    // Ensure pages keep the same sorting through builds.\n    // Pages without matchPath come first, then pages with matchPath,\n    // where more specific patterns come before less specific patterns.\n    // This ensures explicit routes will match before general.\n    // Specificity is inferred from number of path segments.\n    .sortBy(\n      p =>\n        `${p.matchPath ? 9999 - p.matchPath.split(`/`).length : `0000`}${\n          p.path\n        }`\n    )\n    .value()\n  const newHash = crypto\n    .createHash(`md5`)\n    .update(JSON.stringify(pagesComponentDependencies))\n    .digest(`hex`)\n\n  if (newHash === lastHash) {\n    // components didn't change - no need to rewrite pages.json\n    return Promise.resolve()\n  }\n\n  lastHash = newHash\n\n  // Get list of components, and json files.\n  let components = []\n  pages.forEach(p => {\n    components.push({\n      componentChunkName: p.componentChunkName,\n      component: p.component,\n    })\n  })\n\n  components = _.uniqBy(components, c => c.componentChunkName)\n\n  // Create file with sync requires of components/json files.\n  let syncRequires = `// prefer default export if available\nconst preferDefault = m => m && m.default || m\n\\n\\n`\n  syncRequires += `exports.components = {\\n${components\n    .map(\n      c =>\n        `  \"${c.componentChunkName}\": preferDefault(require(\"${joinPath(\n          c.component\n        )}\"))`\n    )\n    .join(`,\\n`)}\n}\\n\\n`\n\n  // Create file with async requires of components/json files.\n  let asyncRequires = `// prefer default export if available\nconst preferDefault = m => m && m.default || m\n\\n`\n  asyncRequires += `exports.components = {\\n${components\n    .map(\n      c =>\n        `  \"${c.componentChunkName}\": () => import(\"${joinPath(\n          c.component\n        )}\" /* webpackChunkName: \"${c.componentChunkName}\" */)`\n    )\n    .join(`,\\n`)}\n}\\n\\n`\n\n  asyncRequires += `exports.data = () => import(\"${joinPath(\n    program.directory,\n    `.cache`,\n    `data.json`\n  )}\")\\n\\n`\n\n  const writeAndMove = (file, data) => {\n    const destination = joinPath(program.directory, `.cache`, file)\n    const tmp = `${destination}.${Date.now()}`\n    return fs\n      .writeFile(tmp, data)\n      .then(() => fs.move(tmp, destination, { overwrite: true }))\n  }\n\n  const result = await Promise.all([\n    writeAndMove(`pages.json`, JSON.stringify(pagesData, null, 4)),\n    writeAndMove(`sync-requires.js`, syncRequires),\n    writeAndMove(`async-requires.js`, asyncRequires),\n    writeAndMove(\n      `data.json`,\n      JSON.stringify({\n        pages: pagesData,\n        // Sort dataPaths by keys to ensure keeping the same\n        // sorting through builds\n        dataPaths: _(jsonDataPaths)\n          .toPairs()\n          .sortBy(0)\n          .fromPairs()\n          .value(),\n      })\n    ),\n  ])\n\n  return result\n}\n\nexports.writePages = writePages\n\nconst resetLastHash = () => {\n  lastHash = null\n}\n\nexports.resetLastHash = resetLastHash\n\nlet bootstrapFinished = false\nconst debouncedWritePages = _.debounce(\n  () => {\n    // Don't write pages again until bootstrap has finished.\n    if (bootstrapFinished) {\n      writePages()\n    }\n  },\n  500,\n  { leading: true }\n)\nemitter.on(`CREATE_PAGE`, () => {\n  // Ignore CREATE_PAGE until bootstrap is finished\n  // as this is called many many times during bootstrap and\n  // we can ignore them until CREATE_PAGE_END is called.\n  //\n  // After bootstrap, we need to listen for this as stateful page\n  // creators e.g. the plugin \"gatsby-plugin-page-creator\"\n  // calls createPage directly so CREATE_PAGE_END won't get fired.\n  if (bootstrapFinished) {\n    debouncedWritePages()\n  }\n})\n\nemitter.on(`CREATE_PAGE_END`, () => {\n  debouncedWritePages()\n})\nemitter.on(`DELETE_PAGE`, () => {\n  debouncedWritePages()\n})\nemitter.on(`DELETE_PAGE_BY_PATH`, () => {\n  debouncedWritePages()\n})\n"],"file":"pages-writer.js"}
\ No newline at end of file
+{"version":3,"sources":["../../../src/internal-plugins/query-runner/pages-writer.js"],"names":["_","require","fs","crypto","store","emitter","lastHash","writePages","bootstrapFinished","program","jsonDataPaths","pages","getState","values","pagesComponentDependencies","pagesData","forEach","path","matchPath","componentChunkName","jsonName","pageComponentsChunkNames","push","sortBy","p","split","length","value","newHash","createHash","update","JSON","stringify","digest","Promise","resolve","components","component","uniqBy","c","syncRequires","map","join","asyncRequires","directory","writeAndMove","file","data","destination","tmp","Date","now","writeFile","then","move","overwrite","result","all","dataPaths","toPairs","fromPairs","exports","resetLastHash","debouncedWritePages","debounce","leading","on"],"mappings":"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","sourcesContent":["const _ = require(`lodash`)\nconst fs = require(`fs-extra`)\nconst crypto = require(`crypto`)\n\nconst { store, emitter } = require(`../../redux/`)\n\nimport { joinPath } from \"../../utils/path\"\n\nlet lastHash = null\n\n// Write out pages information.\nconst writePages = async () => {\n  bootstrapFinished = true\n  let { program, jsonDataPaths, pages } = store.getState()\n  pages = [...pages.values()]\n\n  const pagesComponentDependencies = {}\n\n  // Write out pages.json\n  let pagesData = []\n  pages.forEach(({ path, matchPath, componentChunkName, jsonName }) => {\n    const pageComponentsChunkNames = {\n      componentChunkName,\n    }\n\n    if (program._[0] === `develop`) {\n      pagesComponentDependencies[path] = pageComponentsChunkNames\n    }\n\n    pagesData.push({\n      ...pageComponentsChunkNames,\n      jsonName,\n      path,\n      matchPath,\n    })\n  })\n\n  pagesData = _(pagesData)\n    // Ensure pages keep the same sorting through builds.\n    // Pages without matchPath come first, then pages with matchPath,\n    // where more specific patterns come before less specific patterns.\n    // This ensures explicit routes will match before general.\n    // Specificity is inferred from number of path segments.\n    .sortBy(\n      p =>\n        `${p.matchPath ? 9999 - p.matchPath.split(`/`).length : `0000`}${\n          p.path\n        }`\n    )\n    .value()\n  const newHash = crypto\n    .createHash(`md5`)\n    .update(JSON.stringify(pagesComponentDependencies))\n    .digest(`hex`)\n\n  if (newHash === lastHash) {\n    // components didn't change - no need to rewrite pages.json\n    return Promise.resolve()\n  }\n\n  lastHash = newHash\n\n  // Get list of components, and json files.\n  let components = []\n  pages.forEach(p => {\n    components.push({\n      componentChunkName: p.componentChunkName,\n      component: p.component,\n    })\n  })\n\n  components = _.uniqBy(components, c => c.componentChunkName)\n\n  // Create file with sync requires of components/json files.\n  let syncRequires = `// prefer default export if available\nconst preferDefault = m => m && m.default || m\n\\n\\n`\n  syncRequires += `exports.components = {\\n${components\n    .map(\n      c =>\n        `  \"${c.componentChunkName}\": preferDefault(require(\"${joinPath(\n          c.component\n        )}\"))`\n    )\n    .join(`,\\n`)}\n}\\n\\n`\n\n  // Create file with async requires of components/json files.\n  let asyncRequires = `// prefer default export if available\nconst preferDefault = m => m && m.default || m\n\\n`\n  asyncRequires += `exports.components = {\\n${components\n    .map(\n      c =>\n        `  \"${c.componentChunkName}\": () => import(\"${joinPath(\n          c.component\n        )}\" /* webpackChunkName: \"${c.componentChunkName}\" */)`\n    )\n    .join(`,\\n`)}\n}\\n\\n`\n\n  asyncRequires += `exports.data = () => import(\"${joinPath(\n    program.directory,\n    `.cache`,\n    `data.json`\n  )}\")\\n\\n`\n\n  const writeAndMove = (file, data) => {\n    const destination = joinPath(program.directory, `.cache`, file)\n    const tmp = `${destination}.${Date.now()}`\n    return fs\n      .writeFile(tmp, data)\n      .then(() => fs.move(tmp, destination, { overwrite: true }))\n  }\n\n  const result = await Promise.all([\n    writeAndMove(`pages.json`, JSON.stringify(pagesData, null, 4)),\n    writeAndMove(`sync-requires.js`, syncRequires),\n    writeAndMove(`async-requires.js`, asyncRequires),\n    writeAndMove(\n      `data.json`,\n      JSON.stringify({\n        pages: pagesData,\n        // Sort dataPaths by keys to ensure keeping the same\n        // sorting through builds\n        dataPaths: _(jsonDataPaths)\n          .toPairs()\n          .sortBy(0)\n          .fromPairs()\n          .value(),\n      })\n    ),\n  ])\n\n  return result\n}\n\nexports.writePages = writePages\n\nconst resetLastHash = () => {\n  lastHash = null\n}\n\nexports.resetLastHash = resetLastHash\n\nlet bootstrapFinished = false\nconst debouncedWritePages = _.debounce(\n  () => {\n    // Don't write pages again until bootstrap has finished.\n    if (bootstrapFinished) {\n      writePages()\n    }\n  },\n  500,\n  { leading: true }\n)\nemitter.on(`CREATE_PAGE`, () => {\n  // Ignore CREATE_PAGE until bootstrap is finished\n  // as this is called many many times during bootstrap and\n  // we can ignore them until CREATE_PAGE_END is called.\n  //\n  // After bootstrap, we need to listen for this as stateful page\n  // creators e.g. the plugin \"gatsby-plugin-page-creator\"\n  // calls createPage directly so CREATE_PAGE_END won't get fired.\n  if (bootstrapFinished) {\n    debouncedWritePages()\n  }\n})\n\nemitter.on(`CREATE_PAGE_END`, () => {\n  debouncedWritePages()\n})\nemitter.on(`DELETE_PAGE`, () => {\n  debouncedWritePages()\n})\nemitter.on(`DELETE_PAGE_BY_PATH`, () => {\n  debouncedWritePages()\n})\n"],"file":"pages-writer.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/internal-plugins/query-runner/query-compiler.js
+++ b/node_modules/gatsby/dist/internal-plugins/query-runner/query-compiler.js
@@ -6,8 +6,6 @@ exports.__esModule = true;
 exports.default = compile;
 exports.Runner = void 0;
 
-var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
-
 var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));
 
 var _path = _interopRequireDefault(require("path"));
@@ -42,18 +40,21 @@ const _ = require(`lodash`);
 
 const websocketManager = require(`../../utils/websocket-manager`);
 
-const printTransforms = _relayCompiler.IRTransforms.printTransforms;
-
-const _require = require(`graphql`),
-      ValuesOfCorrectTypeRule = _require.ValuesOfCorrectTypeRule,
-      VariablesDefaultValueAllowedRule = _require.VariablesDefaultValueAllowedRule,
-      FragmentsOnCompositeTypesRule = _require.FragmentsOnCompositeTypesRule,
-      KnownTypeNamesRule = _require.KnownTypeNamesRule,
-      LoneAnonymousOperationRule = _require.LoneAnonymousOperationRule,
-      PossibleFragmentSpreadsRule = _require.PossibleFragmentSpreadsRule,
-      ScalarLeafsRule = _require.ScalarLeafsRule,
-      VariablesAreInputTypesRule = _require.VariablesAreInputTypesRule,
-      VariablesInAllowedPositionRule = _require.VariablesInAllowedPositionRule;
+const {
+  printTransforms
+} = _relayCompiler.IRTransforms;
+
+const {
+  ValuesOfCorrectTypeRule,
+  VariablesDefaultValueAllowedRule,
+  FragmentsOnCompositeTypesRule,
+  KnownTypeNamesRule,
+  LoneAnonymousOperationRule,
+  PossibleFragmentSpreadsRule,
+  ScalarLeafsRule,
+  VariablesAreInputTypesRule,
+  VariablesInAllowedPositionRule
+} = require(`graphql`);
 
 const validationRules = [ValuesOfCorrectTypeRule, VariablesDefaultValueAllowedRule, FragmentsOnCompositeTypesRule, KnownTypeNamesRule, LoneAnonymousOperationRule, PossibleFragmentSpreadsRule, ScalarLeafsRule, VariablesAreInputTypesRule, VariablesInAllowedPositionRule];
 let lastRunHadErrors = null;
@@ -81,156 +82,122 @@ class Runner {
     }
   }
 
-  compileAll() {
-    var _this = this;
+  async compileAll() {
+    let nodes = await this.parseEverything();
+    return await this.write(nodes);
+  }
 
-    return (0, _asyncToGenerator2.default)(function* () {
-      let nodes = yield _this.parseEverything();
-      return yield _this.write(nodes);
-    })();
+  async parseEverything() {
+    // FIXME: this should all use gatsby's configuration to determine parsable
+    // files (and how to parse them)
+    let files = _glob.default.sync(`${this.fragmentsDir}/**/*.+(t|j)s?(x)`, {
+      nodir: true
+    });
+
+    files = files.concat(_glob.default.sync(`${this.baseDir}/**/*.+(t|j)s?(x)`, {
+      nodir: true
+    }));
+    files = files.filter(d => !d.match(/\.d\.ts$/));
+    files = files.map(normalize); // Ensure all page components added as they're not necessarily in the
+    // pages directory e.g. a plugin could add a page component.  Plugins
+    // *should* copy their components (if they add a query) to .cache so that
+    // our babel plugin to remove the query on building is active (we don't
+    // run babel on code in node_modules). Otherwise the component will throw
+    // an error in the browser of "graphql is not defined".
+
+    files = files.concat(Array.from(_redux.store.getState().components.keys(), c => normalize(c)));
+    files = _.uniq(files);
+    let parser = new _fileParser.default();
+    return await parser.parseFiles(files);
   }
 
-  parseEverything() {
-    var _this2 = this;
+  async write(nodes) {
+    const compiledNodes = new Map();
+    const namePathMap = new Map();
+    const nameDefMap = new Map();
+    const documents = [];
 
-    return (0, _asyncToGenerator2.default)(function* () {
-      // FIXME: this should all use gatsby's configuration to determine parsable
-      // files (and how to parse them)
-      let files = _glob.default.sync(`${_this2.fragmentsDir}/**/*.+(t|j)s?(x)`, {
-        nodir: true
-      });
+    for (let [filePath, doc] of nodes.entries()) {
+      let errors = (0, _graphql.validate)(this.schema, doc, validationRules);
 
-      files = files.concat(_glob.default.sync(`${_this2.baseDir}/**/*.+(t|j)s?(x)`, {
-        nodir: true
-      }));
-      files = files.filter(d => !d.match(/\.d\.ts$/));
-      files = files.map(normalize); // Ensure all page components added as they're not necessarily in the
-      // pages directory e.g. a plugin could add a page component.  Plugins
-      // *should* copy their components (if they add a query) to .cache so that
-      // our babel plugin to remove the query on building is active (we don't
-      // run babel on code in node_modules). Otherwise the component will throw
-      // an error in the browser of "graphql is not defined".
-
-      files = files.concat(Array.from(_redux.store.getState().components.keys(), c => normalize(c)));
-      files = _.uniq(files);
-      let parser = new _fileParser.default();
-      return yield parser.parseFiles(files);
-    })();
-  }
-
-  write(nodes) {
-    var _this3 = this;
-
-    return (0, _asyncToGenerator2.default)(function* () {
-      const compiledNodes = new Map();
-      const namePathMap = new Map();
-      const nameDefMap = new Map();
-      const documents = [];
-
-      for (var _iterator = nodes.entries(), _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {
-        var _ref;
-
-        if (_isArray) {
-          if (_i >= _iterator.length) break;
-          _ref = _iterator[_i++];
-        } else {
-          _i = _iterator.next();
-          if (_i.done) break;
-          _ref = _i.value;
-        }
-
-        let _ref2 = _ref,
-            filePath = _ref2[0],
-            doc = _ref2[1];
-        let errors = (0, _graphql.validate)(_this3.schema, doc, validationRules);
-
-        if (errors && errors.length) {
-          _this3.reportError((0, _graphqlErrors.graphqlValidationError)(errors, filePath));
-
-          return compiledNodes;
-        }
-
-        documents.push(doc);
-        doc.definitions.forEach(def => {
-          const name = def.name.value;
-          namePathMap.set(name, filePath);
-          nameDefMap.set(name, def);
-        });
+      if (errors && errors.length) {
+        this.reportError((0, _graphqlErrors.graphqlValidationError)(errors, filePath));
+        return compiledNodes;
       }
 
-      let compilerContext = new _GraphQLCompilerContext.default(_this3.schema);
+      documents.push(doc);
+      doc.definitions.forEach(def => {
+        const name = def.name.value;
+        namePathMap.set(name, filePath);
+        nameDefMap.set(name, def);
+      });
+    }
 
-      try {
-        compilerContext = compilerContext.addAll(_ASTConvert.default.convertASTDocuments(_this3.schema, documents, validationRules, _RelayParser.default.transform.bind(_RelayParser.default)));
-      } catch (error) {
-        _this3.reportError((0, _graphqlErrors.graphqlError)(namePathMap, nameDefMap, error));
+    let compilerContext = new _GraphQLCompilerContext.default(this.schema);
 
-        return compiledNodes;
-      } // relay-compiler v1.5.0 added "StripUnusedVariablesTransform" to
-      // printTransforms. Unfortunately it currently doesn't detect variables
-      // in input objects widely used in gatsby, and therefore removing
-      // variable declaration from queries.
-      // As a temporary workaround remove that transform by slicing printTransforms.
-
-
-      const printContext = printTransforms.slice(0, -1).reduce((ctx, transform) => transform(ctx, _this3.schema), compilerContext);
-      compilerContext.documents().forEach(node => {
-        if (node.kind !== `Root`) return;
-        const name = node.name;
-        let filePath = namePathMap.get(name) || ``;
-
-        if (compiledNodes.has(filePath)) {
-          let otherNode = compiledNodes.get(filePath);
-
-          _this3.reportError((0, _graphqlErrors.multipleRootQueriesError)(filePath, nameDefMap.get(name), otherNode && nameDefMap.get(otherNode.name)));
-
-          return;
-        }
-
-        let text = (0, _filterContextForNode.default)(printContext.getRoot(name), printContext).documents().map(_GraphQLIRPrinter.default.print).join(`\n`);
-        const query = {
-          name,
-          text,
-          originalText: nameDefMap.get(name).text,
-          path: filePath,
-          isStaticQuery: nameDefMap.get(name).isStaticQuery,
-          hash: nameDefMap.get(name).hash
-        };
-
-        if (query.isStaticQuery) {
-          query.jsonName = `sq--` + _.kebabCase(`${_path.default.relative(_redux.store.getState().program.directory, filePath)}`);
-        }
-
-        compiledNodes.set(filePath, query);
-      });
+    try {
+      compilerContext = compilerContext.addAll(_ASTConvert.default.convertASTDocuments(this.schema, documents, validationRules, _RelayParser.default.transform.bind(_RelayParser.default)));
+    } catch (error) {
+      this.reportError((0, _graphqlErrors.graphqlError)(namePathMap, nameDefMap, error));
+      return compiledNodes;
+    } // relay-compiler v1.5.0 added "StripUnusedVariablesTransform" to
+    // printTransforms. Unfortunately it currently doesn't detect variables
+    // in input objects widely used in gatsby, and therefore removing
+    // variable declaration from queries.
+    // As a temporary workaround remove that transform by slicing printTransforms.
+
+
+    const printContext = printTransforms.slice(0, -1).reduce((ctx, transform) => transform(ctx, this.schema), compilerContext);
+    compilerContext.documents().forEach(node => {
+      if (node.kind !== `Root`) return;
+      const {
+        name
+      } = node;
+      let filePath = namePathMap.get(name) || ``;
+
+      if (compiledNodes.has(filePath)) {
+        let otherNode = compiledNodes.get(filePath);
+        this.reportError((0, _graphqlErrors.multipleRootQueriesError)(filePath, nameDefMap.get(name), otherNode && nameDefMap.get(otherNode.name)));
+        return;
+      }
 
-      if (process.env.gatsby_executing_command === `develop` && lastRunHadErrors) {
-        websocketManager.emitError(overlayErrorID, null);
-        lastRunHadErrors = false;
+      let text = (0, _filterContextForNode.default)(printContext.getRoot(name), printContext).documents().map(_GraphQLIRPrinter.default.print).join(`\n`);
+      const query = {
+        name,
+        text,
+        originalText: nameDefMap.get(name).text,
+        path: filePath,
+        isStaticQuery: nameDefMap.get(name).isStaticQuery,
+        hash: nameDefMap.get(name).hash
+      };
+
+      if (query.isStaticQuery) {
+        query.jsonName = `sq--` + _.kebabCase(`${_path.default.relative(_redux.store.getState().program.directory, filePath)}`);
       }
 
-      return compiledNodes;
-    })();
+      compiledNodes.set(filePath, query);
+    });
+
+    if (process.env.gatsby_executing_command === `develop` && lastRunHadErrors) {
+      websocketManager.emitError(overlayErrorID, null);
+      lastRunHadErrors = false;
+    }
+
+    return compiledNodes;
   }
 
 }
 
 exports.Runner = Runner;
 
-function compile() {
-  return _compile.apply(this, arguments);
-}
+async function compile() {
+  const {
+    program,
+    schema
+  } = _redux.store.getState();
 
-function _compile() {
-  _compile = (0, _asyncToGenerator2.default)(function* () {
-    const _store$getState = _redux.store.getState(),
-          program = _store$getState.program,
-          schema = _store$getState.schema;
-
-    const runner = new Runner(`${program.directory}/src`, `${program.directory}/.cache/fragments`, schema);
-    const queries = yield runner.compileAll();
-    return queries;
-  });
-  return _compile.apply(this, arguments);
+  const runner = new Runner(`${program.directory}/src`, `${program.directory}/.cache/fragments`, schema);
+  const queries = await runner.compileAll();
+  return queries;
 }
 //# sourceMappingURL=query-compiler.js.map
\ No newline at end of file
--- a/node_modules/gatsby/dist/internal-plugins/query-runner/query-compiler.js.map
+++ b/node_modules/gatsby/dist/internal-plugins/query-runner/query-compiler.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../../src/internal-plugins/query-runner/query-compiler.js"],"names":["normalize","require","_","websocketManager","printTransforms","IRTransforms","ValuesOfCorrectTypeRule","VariablesDefaultValueAllowedRule","FragmentsOnCompositeTypesRule","KnownTypeNamesRule","LoneAnonymousOperationRule","PossibleFragmentSpreadsRule","ScalarLeafsRule","VariablesAreInputTypesRule","VariablesInAllowedPositionRule","validationRules","lastRunHadErrors","overlayErrorID","Runner","constructor","baseDir","fragmentsDir","schema","reportError","message","queryErrorMessage","report","format","red","panicOnBuild","process","env","gatsby_executing_command","emitError","compileAll","nodes","parseEverything","write","files","glob","sync","nodir","concat","filter","d","match","map","Array","from","store","getState","components","keys","c","uniq","parser","FileParser","parseFiles","compiledNodes","Map","namePathMap","nameDefMap","documents","entries","filePath","doc","errors","length","push","definitions","forEach","def","name","value","set","compilerContext","GraphQLCompilerContext","addAll","ASTConvert","convertASTDocuments","RelayParser","transform","bind","error","printContext","slice","reduce","ctx","node","kind","get","has","otherNode","text","getRoot","GraphQLIRPrinter","print","join","query","originalText","path","isStaticQuery","hash","jsonName","kebabCase","relative","program","directory","compile","runner","queries"],"mappings":"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","sourcesContent":["// @flow\nimport path from \"path\"\nconst normalize = require(`normalize-path`)\nimport glob from \"glob\"\n\nimport { validate } from \"graphql\"\nimport { IRTransforms } from \"relay-compiler\"\nimport RelayParser from \"relay-compiler/lib/RelayParser\"\nimport ASTConvert from \"relay-compiler/lib/ASTConvert\"\nimport GraphQLCompilerContext from \"relay-compiler/lib/GraphQLCompilerContext\"\nimport filterContextForNode from \"relay-compiler/lib/filterContextForNode\"\nconst _ = require(`lodash`)\n\nimport { store } from \"../../redux\"\nimport FileParser from \"./file-parser\"\nimport GraphQLIRPrinter from \"relay-compiler/lib/GraphQLIRPrinter\"\nimport {\n  graphqlError,\n  graphqlValidationError,\n  multipleRootQueriesError,\n} from \"./graphql-errors\"\nimport report from \"gatsby-cli/lib/reporter\"\nconst websocketManager = require(`../../utils/websocket-manager`)\n\nimport type { DocumentNode, GraphQLSchema } from \"graphql\"\n\nconst { printTransforms } = IRTransforms\n\nconst {\n  ValuesOfCorrectTypeRule,\n  VariablesDefaultValueAllowedRule,\n  FragmentsOnCompositeTypesRule,\n  KnownTypeNamesRule,\n  LoneAnonymousOperationRule,\n  PossibleFragmentSpreadsRule,\n  ScalarLeafsRule,\n  VariablesAreInputTypesRule,\n  VariablesInAllowedPositionRule,\n} = require(`graphql`)\n\ntype RootQuery = {\n  name: string,\n  path: string,\n  text: string,\n  originalText: string,\n  isStaticQuery: boolean,\n  hash: string,\n}\n\ntype Queries = Map<string, RootQuery>\n\nconst validationRules = [\n  ValuesOfCorrectTypeRule,\n  VariablesDefaultValueAllowedRule,\n  FragmentsOnCompositeTypesRule,\n  KnownTypeNamesRule,\n  LoneAnonymousOperationRule,\n  PossibleFragmentSpreadsRule,\n  ScalarLeafsRule,\n  VariablesAreInputTypesRule,\n  VariablesInAllowedPositionRule,\n]\n\nlet lastRunHadErrors = null\nconst overlayErrorID = `graphql-compiler`\n\nclass Runner {\n  baseDir: string\n  schema: GraphQLSchema\n  errors: string[]\n  fragmentsDir: string\n\n  constructor(baseDir: string, fragmentsDir: string, schema: GraphQLSchema) {\n    this.baseDir = baseDir\n    this.fragmentsDir = fragmentsDir\n    this.schema = schema\n  }\n\n  reportError(message) {\n    const queryErrorMessage = `${report.format.red(`GraphQL Error`)} ${message}`\n    report.panicOnBuild(queryErrorMessage)\n    if (process.env.gatsby_executing_command === `develop`) {\n      websocketManager.emitError(overlayErrorID, queryErrorMessage)\n      lastRunHadErrors = true\n    }\n  }\n\n  async compileAll() {\n    let nodes = await this.parseEverything()\n    return await this.write(nodes)\n  }\n\n  async parseEverything() {\n    // FIXME: this should all use gatsby's configuration to determine parsable\n    // files (and how to parse them)\n    let files = glob.sync(`${this.fragmentsDir}/**/*.+(t|j)s?(x)`, {\n      nodir: true,\n    })\n    files = files.concat(\n      glob.sync(`${this.baseDir}/**/*.+(t|j)s?(x)`, { nodir: true })\n    )\n    files = files.filter(d => !d.match(/\\.d\\.ts$/))\n    files = files.map(normalize)\n\n    // Ensure all page components added as they're not necessarily in the\n    // pages directory e.g. a plugin could add a page component.  Plugins\n    // *should* copy their components (if they add a query) to .cache so that\n    // our babel plugin to remove the query on building is active (we don't\n    // run babel on code in node_modules). Otherwise the component will throw\n    // an error in the browser of \"graphql is not defined\".\n    files = files.concat(\n      Array.from(store.getState().components.keys(), c => normalize(c))\n    )\n    files = _.uniq(files)\n\n    let parser = new FileParser()\n\n    return await parser.parseFiles(files)\n  }\n\n  async write(nodes: Map<string, DocumentNode>): Promise<Queries> {\n    const compiledNodes: Queries = new Map()\n    const namePathMap = new Map()\n    const nameDefMap = new Map()\n    const documents = []\n\n    for (let [filePath, doc] of nodes.entries()) {\n      let errors = validate(this.schema, doc, validationRules)\n\n      if (errors && errors.length) {\n        this.reportError(graphqlValidationError(errors, filePath))\n        return compiledNodes\n      }\n\n      documents.push(doc)\n      doc.definitions.forEach((def: any) => {\n        const name: string = def.name.value\n        namePathMap.set(name, filePath)\n        nameDefMap.set(name, def)\n      })\n    }\n\n    let compilerContext = new GraphQLCompilerContext(this.schema)\n    try {\n      compilerContext = compilerContext.addAll(\n        ASTConvert.convertASTDocuments(\n          this.schema,\n          documents,\n          validationRules,\n          RelayParser.transform.bind(RelayParser)\n        )\n      )\n    } catch (error) {\n      this.reportError(graphqlError(namePathMap, nameDefMap, error))\n      return compiledNodes\n    }\n\n    // relay-compiler v1.5.0 added \"StripUnusedVariablesTransform\" to\n    // printTransforms. Unfortunately it currently doesn't detect variables\n    // in input objects widely used in gatsby, and therefore removing\n    // variable declaration from queries.\n    // As a temporary workaround remove that transform by slicing printTransforms.\n    const printContext = printTransforms\n      .slice(0, -1)\n      .reduce((ctx, transform) => transform(ctx, this.schema), compilerContext)\n\n    compilerContext.documents().forEach((node: { name: string }) => {\n      if (node.kind !== `Root`) return\n\n      const { name } = node\n      let filePath = namePathMap.get(name) || ``\n\n      if (compiledNodes.has(filePath)) {\n        let otherNode = compiledNodes.get(filePath)\n        this.reportError(\n          multipleRootQueriesError(\n            filePath,\n            nameDefMap.get(name),\n            otherNode && nameDefMap.get(otherNode.name)\n          )\n        )\n        return\n      }\n\n      let text = filterContextForNode(printContext.getRoot(name), printContext)\n        .documents()\n        .map(GraphQLIRPrinter.print)\n        .join(`\\n`)\n\n      const query = {\n        name,\n        text,\n        originalText: nameDefMap.get(name).text,\n        path: filePath,\n        isStaticQuery: nameDefMap.get(name).isStaticQuery,\n        hash: nameDefMap.get(name).hash,\n      }\n\n      if (query.isStaticQuery) {\n        query.jsonName =\n          `sq--` +\n          _.kebabCase(\n            `${path.relative(store.getState().program.directory, filePath)}`\n          )\n      }\n      compiledNodes.set(filePath, query)\n    })\n\n    if (\n      process.env.gatsby_executing_command === `develop` &&\n      lastRunHadErrors\n    ) {\n      websocketManager.emitError(overlayErrorID, null)\n      lastRunHadErrors = false\n    }\n\n    return compiledNodes\n  }\n}\nexport { Runner }\n\nexport default async function compile(): Promise<Map<string, RootQuery>> {\n  const { program, schema } = store.getState()\n\n  const runner = new Runner(\n    `${program.directory}/src`,\n    `${program.directory}/.cache/fragments`,\n    schema\n  )\n\n  const queries = await runner.compileAll()\n\n  return queries\n}\n"],"file":"query-compiler.js"}
\ No newline at end of file
+{"version":3,"sources":["../../../src/internal-plugins/query-runner/query-compiler.js"],"names":["normalize","require","_","websocketManager","printTransforms","IRTransforms","ValuesOfCorrectTypeRule","VariablesDefaultValueAllowedRule","FragmentsOnCompositeTypesRule","KnownTypeNamesRule","LoneAnonymousOperationRule","PossibleFragmentSpreadsRule","ScalarLeafsRule","VariablesAreInputTypesRule","VariablesInAllowedPositionRule","validationRules","lastRunHadErrors","overlayErrorID","Runner","constructor","baseDir","fragmentsDir","schema","reportError","message","queryErrorMessage","report","format","red","panicOnBuild","process","env","gatsby_executing_command","emitError","compileAll","nodes","parseEverything","write","files","glob","sync","nodir","concat","filter","d","match","map","Array","from","store","getState","components","keys","c","uniq","parser","FileParser","parseFiles","compiledNodes","Map","namePathMap","nameDefMap","documents","filePath","doc","entries","errors","length","push","definitions","forEach","def","name","value","set","compilerContext","GraphQLCompilerContext","addAll","ASTConvert","convertASTDocuments","RelayParser","transform","bind","error","printContext","slice","reduce","ctx","node","kind","get","has","otherNode","text","getRoot","GraphQLIRPrinter","print","join","query","originalText","path","isStaticQuery","hash","jsonName","kebabCase","relative","program","directory","compile","runner","queries"],"mappings":"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","sourcesContent":["// @flow\nimport path from \"path\"\nconst normalize = require(`normalize-path`)\nimport glob from \"glob\"\n\nimport { validate } from \"graphql\"\nimport { IRTransforms } from \"relay-compiler\"\nimport RelayParser from \"relay-compiler/lib/RelayParser\"\nimport ASTConvert from \"relay-compiler/lib/ASTConvert\"\nimport GraphQLCompilerContext from \"relay-compiler/lib/GraphQLCompilerContext\"\nimport filterContextForNode from \"relay-compiler/lib/filterContextForNode\"\nconst _ = require(`lodash`)\n\nimport { store } from \"../../redux\"\nimport FileParser from \"./file-parser\"\nimport GraphQLIRPrinter from \"relay-compiler/lib/GraphQLIRPrinter\"\nimport {\n  graphqlError,\n  graphqlValidationError,\n  multipleRootQueriesError,\n} from \"./graphql-errors\"\nimport report from \"gatsby-cli/lib/reporter\"\nconst websocketManager = require(`../../utils/websocket-manager`)\n\nimport type { DocumentNode, GraphQLSchema } from \"graphql\"\n\nconst { printTransforms } = IRTransforms\n\nconst {\n  ValuesOfCorrectTypeRule,\n  VariablesDefaultValueAllowedRule,\n  FragmentsOnCompositeTypesRule,\n  KnownTypeNamesRule,\n  LoneAnonymousOperationRule,\n  PossibleFragmentSpreadsRule,\n  ScalarLeafsRule,\n  VariablesAreInputTypesRule,\n  VariablesInAllowedPositionRule,\n} = require(`graphql`)\n\ntype RootQuery = {\n  name: string,\n  path: string,\n  text: string,\n  originalText: string,\n  isStaticQuery: boolean,\n  hash: string,\n}\n\ntype Queries = Map<string, RootQuery>\n\nconst validationRules = [\n  ValuesOfCorrectTypeRule,\n  VariablesDefaultValueAllowedRule,\n  FragmentsOnCompositeTypesRule,\n  KnownTypeNamesRule,\n  LoneAnonymousOperationRule,\n  PossibleFragmentSpreadsRule,\n  ScalarLeafsRule,\n  VariablesAreInputTypesRule,\n  VariablesInAllowedPositionRule,\n]\n\nlet lastRunHadErrors = null\nconst overlayErrorID = `graphql-compiler`\n\nclass Runner {\n  baseDir: string\n  schema: GraphQLSchema\n  errors: string[]\n  fragmentsDir: string\n\n  constructor(baseDir: string, fragmentsDir: string, schema: GraphQLSchema) {\n    this.baseDir = baseDir\n    this.fragmentsDir = fragmentsDir\n    this.schema = schema\n  }\n\n  reportError(message) {\n    const queryErrorMessage = `${report.format.red(`GraphQL Error`)} ${message}`\n    report.panicOnBuild(queryErrorMessage)\n    if (process.env.gatsby_executing_command === `develop`) {\n      websocketManager.emitError(overlayErrorID, queryErrorMessage)\n      lastRunHadErrors = true\n    }\n  }\n\n  async compileAll() {\n    let nodes = await this.parseEverything()\n    return await this.write(nodes)\n  }\n\n  async parseEverything() {\n    // FIXME: this should all use gatsby's configuration to determine parsable\n    // files (and how to parse them)\n    let files = glob.sync(`${this.fragmentsDir}/**/*.+(t|j)s?(x)`, {\n      nodir: true,\n    })\n    files = files.concat(\n      glob.sync(`${this.baseDir}/**/*.+(t|j)s?(x)`, { nodir: true })\n    )\n    files = files.filter(d => !d.match(/\\.d\\.ts$/))\n    files = files.map(normalize)\n\n    // Ensure all page components added as they're not necessarily in the\n    // pages directory e.g. a plugin could add a page component.  Plugins\n    // *should* copy their components (if they add a query) to .cache so that\n    // our babel plugin to remove the query on building is active (we don't\n    // run babel on code in node_modules). Otherwise the component will throw\n    // an error in the browser of \"graphql is not defined\".\n    files = files.concat(\n      Array.from(store.getState().components.keys(), c => normalize(c))\n    )\n    files = _.uniq(files)\n\n    let parser = new FileParser()\n\n    return await parser.parseFiles(files)\n  }\n\n  async write(nodes: Map<string, DocumentNode>): Promise<Queries> {\n    const compiledNodes: Queries = new Map()\n    const namePathMap = new Map()\n    const nameDefMap = new Map()\n    const documents = []\n\n    for (let [filePath, doc] of nodes.entries()) {\n      let errors = validate(this.schema, doc, validationRules)\n\n      if (errors && errors.length) {\n        this.reportError(graphqlValidationError(errors, filePath))\n        return compiledNodes\n      }\n\n      documents.push(doc)\n      doc.definitions.forEach((def: any) => {\n        const name: string = def.name.value\n        namePathMap.set(name, filePath)\n        nameDefMap.set(name, def)\n      })\n    }\n\n    let compilerContext = new GraphQLCompilerContext(this.schema)\n    try {\n      compilerContext = compilerContext.addAll(\n        ASTConvert.convertASTDocuments(\n          this.schema,\n          documents,\n          validationRules,\n          RelayParser.transform.bind(RelayParser)\n        )\n      )\n    } catch (error) {\n      this.reportError(graphqlError(namePathMap, nameDefMap, error))\n      return compiledNodes\n    }\n\n    // relay-compiler v1.5.0 added \"StripUnusedVariablesTransform\" to\n    // printTransforms. Unfortunately it currently doesn't detect variables\n    // in input objects widely used in gatsby, and therefore removing\n    // variable declaration from queries.\n    // As a temporary workaround remove that transform by slicing printTransforms.\n    const printContext = printTransforms\n      .slice(0, -1)\n      .reduce((ctx, transform) => transform(ctx, this.schema), compilerContext)\n\n    compilerContext.documents().forEach((node: { name: string }) => {\n      if (node.kind !== `Root`) return\n\n      const { name } = node\n      let filePath = namePathMap.get(name) || ``\n\n      if (compiledNodes.has(filePath)) {\n        let otherNode = compiledNodes.get(filePath)\n        this.reportError(\n          multipleRootQueriesError(\n            filePath,\n            nameDefMap.get(name),\n            otherNode && nameDefMap.get(otherNode.name)\n          )\n        )\n        return\n      }\n\n      let text = filterContextForNode(printContext.getRoot(name), printContext)\n        .documents()\n        .map(GraphQLIRPrinter.print)\n        .join(`\\n`)\n\n      const query = {\n        name,\n        text,\n        originalText: nameDefMap.get(name).text,\n        path: filePath,\n        isStaticQuery: nameDefMap.get(name).isStaticQuery,\n        hash: nameDefMap.get(name).hash,\n      }\n\n      if (query.isStaticQuery) {\n        query.jsonName =\n          `sq--` +\n          _.kebabCase(\n            `${path.relative(store.getState().program.directory, filePath)}`\n          )\n      }\n      compiledNodes.set(filePath, query)\n    })\n\n    if (\n      process.env.gatsby_executing_command === `develop` &&\n      lastRunHadErrors\n    ) {\n      websocketManager.emitError(overlayErrorID, null)\n      lastRunHadErrors = false\n    }\n\n    return compiledNodes\n  }\n}\nexport { Runner }\n\nexport default async function compile(): Promise<Map<string, RootQuery>> {\n  const { program, schema } = store.getState()\n\n  const runner = new Runner(\n    `${program.directory}/src`,\n    `${program.directory}/.cache/fragments`,\n    schema\n  )\n\n  const queries = await runner.compileAll()\n\n  return queries\n}\n"],"file":"query-compiler.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/internal-plugins/query-runner/query-queue.js
+++ b/node_modules/gatsby/dist/internal-plugins/query-runner/query-queue.js
@@ -4,9 +4,10 @@ const Queue = require(`better-queue`);
 
 const queryRunner = require(`./query-runner`);
 
-const _require = require(`../../redux`),
-      store = _require.store,
-      emitter = _require.emitter;
+const {
+  store,
+  emitter
+} = require(`../../redux`);
 
 const websocketManager = require(`../../utils/websocket-manager`);
 
--- a/node_modules/gatsby/dist/internal-plugins/query-runner/query-queue.js.map
+++ b/node_modules/gatsby/dist/internal-plugins/query-runner/query-queue.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../../src/internal-plugins/query-runner/query-queue.js"],"names":["Queue","require","queryRunner","store","emitter","websocketManager","processing","Set","waiting","Map","queueOptions","concurrent","merge","oldTask","newTask","cb","priority","job","activePaths","Array","from","values","id","includes","filter","has","set","process","env","gatsby_executing_command","queue","plObj","callback","state","getState","add","components","component","catch","e","console","log","then","result","delete","push","get","error","on","pause","resume","emit","module","exports"],"mappings":"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","sourcesContent":["const Queue = require(`better-queue`)\n\nconst queryRunner = require(`./query-runner`)\nconst { store, emitter } = require(`../../redux`)\nconst websocketManager = require(`../../utils/websocket-manager`)\n\nconst processing = new Set()\nconst waiting = new Map()\n\nconst queueOptions = {\n  concurrent: 4,\n  // Merge duplicate jobs.\n  merge: (oldTask, newTask, cb) => {\n    cb(null, newTask)\n  },\n  priority: (job, cb) => {\n    const activePaths = Array.from(websocketManager.activePaths.values())\n    if (job.id && activePaths.includes(job.id)) {\n      cb(null, 10)\n    } else {\n      cb(null, 1)\n    }\n  },\n  // Filter out new query jobs if that query is already running.  When the\n  // query finshes, it checks the waiting map and pushes another job to\n  // make sure all the user changes are captured.\n  filter: (job, cb) => {\n    if (processing.has(job.id)) {\n      waiting.set(job.id, job)\n      cb(`already running`)\n    } else {\n      cb(null, job)\n    }\n  },\n}\n\n// During builds we don't need all the filtering, etc. so we\n// remove them to speed up queries\nif (process.env.gatsby_executing_command === `build`) {\n  delete queueOptions.filter\n  delete queueOptions.priority\n  delete queueOptions.merge\n}\n\nconst queue = new Queue((plObj, callback) => {\n  const state = store.getState()\n  processing.add(plObj.id)\n\n  return queryRunner(plObj, state.components[plObj.component])\n    .catch(e => console.log(`Error running queryRunner`, e))\n    .then(\n      result => {\n        processing.delete(plObj.id)\n        if (waiting.has(plObj.id)) {\n          queue.push(waiting.get(plObj.id))\n          waiting.delete(plObj.id)\n        }\n        return callback(null, result)\n      },\n      error => callback(error)\n    )\n}, queueOptions)\n\n// Pause running queries when new nodes are added (processing starts).\nemitter.on(`CREATE_NODE`, () => {\n  queue.pause()\n})\n\n// Resume running queries as soon as the api queue is empty.\nemitter.on(`API_RUNNING_QUEUE_EMPTY`, () => {\n  queue.resume()\n})\n\nqueue.on(`drain`, () => {\n  emitter.emit(`QUERY_QUEUE_DRAINED`)\n})\n\nqueue.on(`task_queued`, () => {\n  emitter.emit(`QUERY_ENQUEUED`)\n})\n\nmodule.exports = queue\n"],"file":"query-queue.js"}
\ No newline at end of file
+{"version":3,"sources":["../../../src/internal-plugins/query-runner/query-queue.js"],"names":["Queue","require","queryRunner","store","emitter","websocketManager","processing","Set","waiting","Map","queueOptions","concurrent","merge","oldTask","newTask","cb","priority","job","activePaths","Array","from","values","id","includes","filter","has","set","process","env","gatsby_executing_command","queue","plObj","callback","state","getState","add","components","component","catch","e","console","log","then","result","delete","push","get","error","on","pause","resume","emit","module","exports"],"mappings":"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","sourcesContent":["const Queue = require(`better-queue`)\n\nconst queryRunner = require(`./query-runner`)\nconst { store, emitter } = require(`../../redux`)\nconst websocketManager = require(`../../utils/websocket-manager`)\n\nconst processing = new Set()\nconst waiting = new Map()\n\nconst queueOptions = {\n  concurrent: 4,\n  // Merge duplicate jobs.\n  merge: (oldTask, newTask, cb) => {\n    cb(null, newTask)\n  },\n  priority: (job, cb) => {\n    const activePaths = Array.from(websocketManager.activePaths.values())\n    if (job.id && activePaths.includes(job.id)) {\n      cb(null, 10)\n    } else {\n      cb(null, 1)\n    }\n  },\n  // Filter out new query jobs if that query is already running.  When the\n  // query finshes, it checks the waiting map and pushes another job to\n  // make sure all the user changes are captured.\n  filter: (job, cb) => {\n    if (processing.has(job.id)) {\n      waiting.set(job.id, job)\n      cb(`already running`)\n    } else {\n      cb(null, job)\n    }\n  },\n}\n\n// During builds we don't need all the filtering, etc. so we\n// remove them to speed up queries\nif (process.env.gatsby_executing_command === `build`) {\n  delete queueOptions.filter\n  delete queueOptions.priority\n  delete queueOptions.merge\n}\n\nconst queue = new Queue((plObj, callback) => {\n  const state = store.getState()\n  processing.add(plObj.id)\n\n  return queryRunner(plObj, state.components[plObj.component])\n    .catch(e => console.log(`Error running queryRunner`, e))\n    .then(\n      result => {\n        processing.delete(plObj.id)\n        if (waiting.has(plObj.id)) {\n          queue.push(waiting.get(plObj.id))\n          waiting.delete(plObj.id)\n        }\n        return callback(null, result)\n      },\n      error => callback(error)\n    )\n}, queueOptions)\n\n// Pause running queries when new nodes are added (processing starts).\nemitter.on(`CREATE_NODE`, () => {\n  queue.pause()\n})\n\n// Resume running queries as soon as the api queue is empty.\nemitter.on(`API_RUNNING_QUEUE_EMPTY`, () => {\n  queue.resume()\n})\n\nqueue.on(`drain`, () => {\n  emitter.emit(`QUERY_QUEUE_DRAINED`)\n})\n\nqueue.on(`task_queued`, () => {\n  emitter.emit(`QUERY_ENQUEUED`)\n})\n\nmodule.exports = queue\n"],"file":"query-queue.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/internal-plugins/query-runner/query-runner.js
+++ b/node_modules/gatsby/dist/internal-plugins/query-runner/query-runner.js
@@ -1,9 +1,5 @@
 "use strict";
 
-var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
-
-var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
-
 var _graphql = require("graphql");
 
 const fs = require(`fs-extra`);
@@ -14,139 +10,135 @@ const websocketManager = require(`../../utils/websocket-manager`);
 
 const path = require(`path`);
 
-const _require = require(`../../redux`),
-      store = _require.store;
+const {
+  store
+} = require(`../../redux`);
 
-const _require2 = require(`../../utils/js-chunk-names`),
-      generatePathChunkName = _require2.generatePathChunkName;
+const {
+  generatePathChunkName
+} = require(`../../utils/js-chunk-names`);
 
-const _require3 = require(`./utils`),
-      formatErrorDetails = _require3.formatErrorDetails;
+const {
+  formatErrorDetails
+} = require(`./utils`);
 
 const mod = require(`hash-mod`)(999);
 
 const resultHashes = {};
 
 // Run query
-module.exports =
-/*#__PURE__*/
-function () {
-  var _ref = (0, _asyncToGenerator2.default)(function* (queryJob, component) {
-    const _store$getState = store.getState(),
-          schema = _store$getState.schema,
-          program = _store$getState.program;
+module.exports = async (queryJob, component) => {
+  const {
+    schema,
+    program
+  } = store.getState();
 
-    const graphql = (query, context) => (0, _graphql.graphql)(schema, query, context, context, context); // Run query
+  const graphql = (query, context) => (0, _graphql.graphql)(schema, query, context, context, context); // Run query
 
 
-    let result; // Nothing to do if the query doesn't exist.
+  let result; // Nothing to do if the query doesn't exist.
 
-    if (!queryJob.query || queryJob.query === ``) {
-      result = {};
-    } else {
-      result = yield graphql(queryJob.query, queryJob.context);
-    } // If there's a graphql error then log the error. If we're building, also
-    // quit.
+  if (!queryJob.query || queryJob.query === ``) {
+    result = {};
+  } else {
+    result = await graphql(queryJob.query, queryJob.context);
+  } // If there's a graphql error then log the error. If we're building, also
+  // quit.
 
 
-    if (result && result.errors) {
-      const errorDetails = new Map();
-      errorDetails.set(`Errors`, result.errors || []);
+  if (result && result.errors) {
+    const errorDetails = new Map();
+    errorDetails.set(`Errors`, result.errors || []);
 
-      if (queryJob.isPage) {
-        errorDetails.set(`URL path`, queryJob.context.path);
-        errorDetails.set(`Context`, JSON.stringify(queryJob.context.context, null, 2));
-      }
+    if (queryJob.isPage) {
+      errorDetails.set(`URL path`, queryJob.context.path);
+      errorDetails.set(`Context`, JSON.stringify(queryJob.context.context, null, 2));
+    }
 
-      errorDetails.set(`Plugin`, queryJob.pluginCreatorId || `none`);
-      errorDetails.set(`Query`, queryJob.query);
-      report.panicOnBuild(`
+    errorDetails.set(`Plugin`, queryJob.pluginCreatorId || `none`);
+    errorDetails.set(`Query`, queryJob.query);
+    report.panicOnBuild(`
 The GraphQL query from ${queryJob.componentPath} failed.
 
 ${formatErrorDetails(errorDetails)}`);
-    } // Add the page context onto the results.
+  } // Add the page context onto the results.
 
 
-    if (queryJob && queryJob.isPage) {
-      result[`pageContext`] = Object.assign({}, queryJob.context);
-    } // Delete internal data from pageContext
+  if (queryJob && queryJob.isPage) {
+    result[`pageContext`] = Object.assign({}, queryJob.context);
+  } // Delete internal data from pageContext
 
 
-    if (result.pageContext) {
-      delete result.pageContext.jsonName;
-      delete result.pageContext.path;
-      delete result.pageContext.internalComponentName;
-      delete result.pageContext.component;
-      delete result.pageContext.componentChunkName;
-      delete result.pageContext.updatedAt;
-      delete result.pageContext.pluginCreator___NODE;
-      delete result.pageContext.pluginCreatorId;
-      delete result.pageContext.componentPath;
-      delete result.pageContext.context;
-    }
+  if (result.pageContext) {
+    delete result.pageContext.jsonName;
+    delete result.pageContext.path;
+    delete result.pageContext.internalComponentName;
+    delete result.pageContext.component;
+    delete result.pageContext.componentChunkName;
+    delete result.pageContext.updatedAt;
+    delete result.pageContext.pluginCreator___NODE;
+    delete result.pageContext.pluginCreatorId;
+    delete result.pageContext.componentPath;
+    delete result.pageContext.context;
+  }
+
+  const resultJSON = JSON.stringify(result);
 
-    const resultJSON = JSON.stringify(result);
+  const resultHash = require(`crypto`).createHash(`sha1`).update(resultJSON).digest(`base64`) // Remove potentially unsafe characters. This increases chances of collisions
+  // slightly but it should still be very safe + we get a shorter
+  // url vs hex.
+  .replace(/[^a-zA-Z0-9-_]/g, ``);
 
-    const resultHash = require(`crypto`).createHash(`sha1`).update(resultJSON).digest(`base64`) // Remove potentially unsafe characters. This increases chances of collisions
-    // slightly but it should still be very safe + we get a shorter
-    // url vs hex.
-    .replace(/[^a-zA-Z0-9-_]/g, ``);
+  let dataPath;
 
-    let dataPath;
+  if (queryJob.isPage) {
+    dataPath = `${generatePathChunkName(queryJob.jsonName)}-${resultHash}`;
+  } else {
+    dataPath = queryJob.hash;
+  }
 
+  if (process.env.gatsby_executing_command === `develop`) {
     if (queryJob.isPage) {
-      dataPath = `${generatePathChunkName(queryJob.jsonName)}-${resultHash}`;
+      websocketManager.emitPageData({
+        result,
+        id: queryJob.id
+      });
     } else {
-      dataPath = queryJob.hash;
-    }
-
-    if (process.env.gatsby_executing_command === `develop`) {
-      if (queryJob.isPage) {
-        websocketManager.emitPageData({
-          result,
-          id: queryJob.id
-        });
-      } else {
-        websocketManager.emitStaticQueryData({
-          result,
-          id: queryJob.id
-        });
-      }
+      websocketManager.emitStaticQueryData({
+        result,
+        id: queryJob.id
+      });
     }
+  }
 
-    if (resultHashes[queryJob.id] !== resultHash) {
-      resultHashes[queryJob.id] = resultHash;
-      let modInt = ``; // We leave StaticQuery results at public/static/d
-      // as the babel plugin has that path hard-coded
-      // for importing static query results.
+  if (resultHashes[queryJob.id] !== resultHash) {
+    resultHashes[queryJob.id] = resultHash;
+    let modInt = ``; // We leave StaticQuery results at public/static/d
+    // as the babel plugin has that path hard-coded
+    // for importing static query results.
 
-      if (queryJob.isPage) {
-        modInt = mod(dataPath).toString();
-      } // Always write file to public/static/d/ folder.
+    if (queryJob.isPage) {
+      modInt = mod(dataPath).toString();
+    } // Always write file to public/static/d/ folder.
 
 
-      const resultPath = path.join(program.directory, `public`, `static`, `d`, modInt, `${dataPath}.json`);
+    const resultPath = path.join(program.directory, `public`, `static`, `d`, modInt, `${dataPath}.json`);
 
-      if (queryJob.isPage) {
-        dataPath = `${modInt}/${dataPath}`;
-      }
-
-      yield fs.outputFile(resultPath, resultJSON);
-      store.dispatch({
-        type: `SET_JSON_DATA_PATH`,
-        payload: {
-          key: queryJob.jsonName,
-          value: dataPath
-        }
-      });
-      return result;
+    if (queryJob.isPage) {
+      dataPath = `${modInt}/${dataPath}`;
     }
 
+    await fs.outputFile(resultPath, resultJSON);
+    store.dispatch({
+      type: `SET_JSON_DATA_PATH`,
+      payload: {
+        key: queryJob.jsonName,
+        value: dataPath
+      }
+    });
     return result;
-  });
+  }
 
-  return function (_x, _x2) {
-    return _ref.apply(this, arguments);
-  };
-}();
+  return result;
+};
 //# sourceMappingURL=query-runner.js.map
\ No newline at end of file
--- a/node_modules/gatsby/dist/internal-plugins/query-runner/query-runner.js.map
+++ b/node_modules/gatsby/dist/internal-plugins/query-runner/query-runner.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../../src/internal-plugins/query-runner/query-runner.js"],"names":["fs","require","report","websocketManager","path","store","generatePathChunkName","formatErrorDetails","mod","resultHashes","module","exports","queryJob","component","getState","schema","program","graphql","query","context","result","errors","errorDetails","Map","set","isPage","JSON","stringify","pluginCreatorId","panicOnBuild","componentPath","Object","assign","pageContext","jsonName","internalComponentName","componentChunkName","updatedAt","pluginCreator___NODE","resultJSON","resultHash","createHash","update","digest","replace","dataPath","hash","process","env","gatsby_executing_command","emitPageData","id","emitStaticQueryData","modInt","toString","resultPath","join","directory","outputFile","dispatch","type","payload","key","value"],"mappings":"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","sourcesContent":["// @flow\n\nimport { graphql as graphqlFunction } from \"graphql\"\nconst fs = require(`fs-extra`)\nconst report = require(`gatsby-cli/lib/reporter`)\nconst websocketManager = require(`../../utils/websocket-manager`)\n\nconst path = require(`path`)\nconst { store } = require(`../../redux`)\nconst { generatePathChunkName } = require(`../../utils/js-chunk-names`)\nconst { formatErrorDetails } = require(`./utils`)\nconst mod = require(`hash-mod`)(999)\n\nconst resultHashes = {}\n\ntype QueryJob = {\n  id: string,\n  hash?: string,\n  jsonName: string,\n  query: string,\n  componentPath: string,\n  context: Object,\n  isPage: Boolean,\n}\n\n// Run query\nmodule.exports = async (queryJob: QueryJob, component: Any) => {\n  const { schema, program } = store.getState()\n\n  const graphql = (query, context) =>\n    graphqlFunction(schema, query, context, context, context)\n\n  // Run query\n  let result\n  // Nothing to do if the query doesn't exist.\n  if (!queryJob.query || queryJob.query === ``) {\n    result = {}\n  } else {\n    result = await graphql(queryJob.query, queryJob.context)\n  }\n\n  // If there's a graphql error then log the error. If we're building, also\n  // quit.\n  if (result && result.errors) {\n    const errorDetails = new Map()\n    errorDetails.set(`Errors`, result.errors || [])\n    if (queryJob.isPage) {\n      errorDetails.set(`URL path`, queryJob.context.path)\n      errorDetails.set(\n        `Context`,\n        JSON.stringify(queryJob.context.context, null, 2)\n      )\n    }\n    errorDetails.set(`Plugin`, queryJob.pluginCreatorId || `none`)\n    errorDetails.set(`Query`, queryJob.query)\n\n    report.panicOnBuild(`\nThe GraphQL query from ${queryJob.componentPath} failed.\n\n${formatErrorDetails(errorDetails)}`)\n  }\n\n  // Add the page context onto the results.\n  if (queryJob && queryJob.isPage) {\n    result[`pageContext`] = Object.assign({}, queryJob.context)\n  }\n\n  // Delete internal data from pageContext\n  if (result.pageContext) {\n    delete result.pageContext.jsonName\n    delete result.pageContext.path\n    delete result.pageContext.internalComponentName\n    delete result.pageContext.component\n    delete result.pageContext.componentChunkName\n    delete result.pageContext.updatedAt\n    delete result.pageContext.pluginCreator___NODE\n    delete result.pageContext.pluginCreatorId\n    delete result.pageContext.componentPath\n    delete result.pageContext.context\n  }\n\n  const resultJSON = JSON.stringify(result)\n  const resultHash = require(`crypto`)\n    .createHash(`sha1`)\n    .update(resultJSON)\n    .digest(`base64`)\n    // Remove potentially unsafe characters. This increases chances of collisions\n    // slightly but it should still be very safe + we get a shorter\n    // url vs hex.\n    .replace(/[^a-zA-Z0-9-_]/g, ``)\n\n  let dataPath\n  if (queryJob.isPage) {\n    dataPath = `${generatePathChunkName(queryJob.jsonName)}-${resultHash}`\n  } else {\n    dataPath = queryJob.hash\n  }\n\n  if (process.env.gatsby_executing_command === `develop`) {\n    if (queryJob.isPage) {\n      websocketManager.emitPageData({\n        result,\n        id: queryJob.id,\n      })\n    } else {\n      websocketManager.emitStaticQueryData({\n        result,\n        id: queryJob.id,\n      })\n    }\n  }\n\n  if (resultHashes[queryJob.id] !== resultHash) {\n    resultHashes[queryJob.id] = resultHash\n    let modInt = ``\n    // We leave StaticQuery results at public/static/d\n    // as the babel plugin has that path hard-coded\n    // for importing static query results.\n    if (queryJob.isPage) {\n      modInt = mod(dataPath).toString()\n    }\n\n    // Always write file to public/static/d/ folder.\n    const resultPath = path.join(\n      program.directory,\n      `public`,\n      `static`,\n      `d`,\n      modInt,\n      `${dataPath}.json`\n    )\n\n    if (queryJob.isPage) {\n      dataPath = `${modInt}/${dataPath}`\n    }\n\n    await fs.outputFile(resultPath, resultJSON)\n\n    store.dispatch({\n      type: `SET_JSON_DATA_PATH`,\n      payload: {\n        key: queryJob.jsonName,\n        value: dataPath,\n      },\n    })\n\n    return result\n  }\n\n  return result\n}\n"],"file":"query-runner.js"}
\ No newline at end of file
+{"version":3,"sources":["../../../src/internal-plugins/query-runner/query-runner.js"],"names":["fs","require","report","websocketManager","path","store","generatePathChunkName","formatErrorDetails","mod","resultHashes","module","exports","queryJob","component","schema","program","getState","graphql","query","context","result","errors","errorDetails","Map","set","isPage","JSON","stringify","pluginCreatorId","panicOnBuild","componentPath","Object","assign","pageContext","jsonName","internalComponentName","componentChunkName","updatedAt","pluginCreator___NODE","resultJSON","resultHash","createHash","update","digest","replace","dataPath","hash","process","env","gatsby_executing_command","emitPageData","id","emitStaticQueryData","modInt","toString","resultPath","join","directory","outputFile","dispatch","type","payload","key","value"],"mappings":"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","sourcesContent":["// @flow\n\nimport { graphql as graphqlFunction } from \"graphql\"\nconst fs = require(`fs-extra`)\nconst report = require(`gatsby-cli/lib/reporter`)\nconst websocketManager = require(`../../utils/websocket-manager`)\n\nconst path = require(`path`)\nconst { store } = require(`../../redux`)\nconst { generatePathChunkName } = require(`../../utils/js-chunk-names`)\nconst { formatErrorDetails } = require(`./utils`)\nconst mod = require(`hash-mod`)(999)\n\nconst resultHashes = {}\n\ntype QueryJob = {\n  id: string,\n  hash?: string,\n  jsonName: string,\n  query: string,\n  componentPath: string,\n  context: Object,\n  isPage: Boolean,\n}\n\n// Run query\nmodule.exports = async (queryJob: QueryJob, component: Any) => {\n  const { schema, program } = store.getState()\n\n  const graphql = (query, context) =>\n    graphqlFunction(schema, query, context, context, context)\n\n  // Run query\n  let result\n  // Nothing to do if the query doesn't exist.\n  if (!queryJob.query || queryJob.query === ``) {\n    result = {}\n  } else {\n    result = await graphql(queryJob.query, queryJob.context)\n  }\n\n  // If there's a graphql error then log the error. If we're building, also\n  // quit.\n  if (result && result.errors) {\n    const errorDetails = new Map()\n    errorDetails.set(`Errors`, result.errors || [])\n    if (queryJob.isPage) {\n      errorDetails.set(`URL path`, queryJob.context.path)\n      errorDetails.set(\n        `Context`,\n        JSON.stringify(queryJob.context.context, null, 2)\n      )\n    }\n    errorDetails.set(`Plugin`, queryJob.pluginCreatorId || `none`)\n    errorDetails.set(`Query`, queryJob.query)\n\n    report.panicOnBuild(`\nThe GraphQL query from ${queryJob.componentPath} failed.\n\n${formatErrorDetails(errorDetails)}`)\n  }\n\n  // Add the page context onto the results.\n  if (queryJob && queryJob.isPage) {\n    result[`pageContext`] = Object.assign({}, queryJob.context)\n  }\n\n  // Delete internal data from pageContext\n  if (result.pageContext) {\n    delete result.pageContext.jsonName\n    delete result.pageContext.path\n    delete result.pageContext.internalComponentName\n    delete result.pageContext.component\n    delete result.pageContext.componentChunkName\n    delete result.pageContext.updatedAt\n    delete result.pageContext.pluginCreator___NODE\n    delete result.pageContext.pluginCreatorId\n    delete result.pageContext.componentPath\n    delete result.pageContext.context\n  }\n\n  const resultJSON = JSON.stringify(result)\n  const resultHash = require(`crypto`)\n    .createHash(`sha1`)\n    .update(resultJSON)\n    .digest(`base64`)\n    // Remove potentially unsafe characters. This increases chances of collisions\n    // slightly but it should still be very safe + we get a shorter\n    // url vs hex.\n    .replace(/[^a-zA-Z0-9-_]/g, ``)\n\n  let dataPath\n  if (queryJob.isPage) {\n    dataPath = `${generatePathChunkName(queryJob.jsonName)}-${resultHash}`\n  } else {\n    dataPath = queryJob.hash\n  }\n\n  if (process.env.gatsby_executing_command === `develop`) {\n    if (queryJob.isPage) {\n      websocketManager.emitPageData({\n        result,\n        id: queryJob.id,\n      })\n    } else {\n      websocketManager.emitStaticQueryData({\n        result,\n        id: queryJob.id,\n      })\n    }\n  }\n\n  if (resultHashes[queryJob.id] !== resultHash) {\n    resultHashes[queryJob.id] = resultHash\n    let modInt = ``\n    // We leave StaticQuery results at public/static/d\n    // as the babel plugin has that path hard-coded\n    // for importing static query results.\n    if (queryJob.isPage) {\n      modInt = mod(dataPath).toString()\n    }\n\n    // Always write file to public/static/d/ folder.\n    const resultPath = path.join(\n      program.directory,\n      `public`,\n      `static`,\n      `d`,\n      modInt,\n      `${dataPath}.json`\n    )\n\n    if (queryJob.isPage) {\n      dataPath = `${modInt}/${dataPath}`\n    }\n\n    await fs.outputFile(resultPath, resultJSON)\n\n    store.dispatch({\n      type: `SET_JSON_DATA_PATH`,\n      payload: {\n        key: queryJob.jsonName,\n        value: dataPath,\n      },\n    })\n\n    return result\n  }\n\n  return result\n}\n"],"file":"query-runner.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/internal-plugins/query-runner/query-watcher.js
+++ b/node_modules/gatsby/dist/internal-plugins/query-runner/query-watcher.js
@@ -17,20 +17,23 @@ const path = require(`path`);
 
 const slash = require(`slash`);
 
-const _require = require(`../../redux/`),
-      store = _require.store,
-      emitter = _require.emitter;
+const {
+  store,
+  emitter
+} = require(`../../redux/`);
 
-const _require2 = require(`../../redux/actions`),
-      boundActionCreators = _require2.boundActionCreators;
+const {
+  boundActionCreators
+} = require(`../../redux/actions`);
 
 const queryCompiler = require(`./query-compiler`).default;
 
 const report = require(`gatsby-cli/lib/reporter`);
 
-const _require3 = require(`./page-query-runner`),
-      queueQueryForPathname = _require3.queueQueryForPathname,
-      runQueuedQueries = _require3.runQueuedActions;
+const {
+  queueQueryForPathname,
+  runQueuedActions: runQueuedQueries
+} = require(`./page-query-runner`);
 
 const debug = require(`debug`)(`gatsby:query-watcher`);
 
@@ -155,10 +158,10 @@ const updateStateAndRunQueries = isFirstRun => {
 
 
 const clearInactiveComponents = () => {
-  const _store$getState = store.getState(),
-        components = _store$getState.components,
-        pages = _store$getState.pages;
-
+  const {
+    components,
+    pages
+  } = store.getState();
   const activeTemplates = new Set();
   pages.forEach(page => {
     // Set will guarantee uniqeness of entires
@@ -244,26 +247,12 @@ if (process.env.gatsby_executing_command === `develop`) {
   emitter.on(`DELETE_PAGE`, action => {
     if (bootstrapFinished) {
       const componentPath = slash(action.payload.component);
-
-      const _store$getState2 = store.getState(),
-            pages = _store$getState2.pages;
-
+      const {
+        pages
+      } = store.getState();
       let otherPageWithTemplateExists = false;
 
-      for (var _iterator = pages.values(), _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {
-        var _ref;
-
-        if (_isArray) {
-          if (_i >= _iterator.length) break;
-          _ref = _iterator[_i++];
-        } else {
-          _i = _iterator.next();
-          if (_i.done) break;
-          _ref = _i.value;
-        }
-
-        let page = _ref;
-
+      for (let page of pages.values()) {
         if (slash(page.component) === componentPath) {
           otherPageWithTemplateExists = true;
           break;
--- a/node_modules/gatsby/dist/internal-plugins/query-runner/query-watcher.js.map
+++ b/node_modules/gatsby/dist/internal-plugins/query-runner/query-watcher.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../../src/internal-plugins/query-runner/query-watcher.js"],"names":["_","require","chokidar","path","slash","store","emitter","boundActionCreators","queryCompiler","default","report","queueQueryForPathname","runQueuedQueries","runQueuedActions","debug","getQueriesSnapshot","state","getState","snapshot","components","Map","staticQueryComponents","handleComponentsWithRemovedQueries","queries","forEach","c","query","has","componentPath","replaceComponentQuery","queueQueriesForPageComponent","dispatch","type","payload","jsonName","deleteComponentsDependencies","handleQuery","component","isStaticQuery","oldQuery","get","isNewQuery","hash","text","replaceStaticQuery","name","id","length","updateStateAndRunQueries","isFirstRun","then","queriesWillNotRun","queryWillRun","watchComponent","warn","log","stripIndent","clearInactiveComponents","pages","activeTemplates","Set","page","add","exports","extractQueries","process","env","NODE_ENV","watch","program","directory","getPagesForComponent","map","p","values","filter","filesToWatch","watcher","rootDir","debounceCompile","debounce","join","on","filePath","gatsby_executing_command","bootstrapFinished","action","otherPageWithTemplateExists"],"mappings":"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","sourcesContent":["/** *\n * Jobs of this module\n * - Maintain the list of components in the Redux store. So monitor new components\n *   and add/remove components.\n * - Watch components for query changes and extract these and update the store.\n * - Ensure all page queries are run as part of bootstrap and report back when\n *   this is done\n * - Whenever a query changes, re-run all pages that rely on this query.\n ***/\n\nconst _ = require(`lodash`)\nconst chokidar = require(`chokidar`)\nconst path = require(`path`)\nconst slash = require(`slash`)\n\nconst { store, emitter } = require(`../../redux/`)\nconst { boundActionCreators } = require(`../../redux/actions`)\nconst queryCompiler = require(`./query-compiler`).default\nconst report = require(`gatsby-cli/lib/reporter`)\nconst {\n  queueQueryForPathname,\n  runQueuedActions: runQueuedQueries,\n} = require(`./page-query-runner`)\nconst debug = require(`debug`)(`gatsby:query-watcher`)\n\nconst getQueriesSnapshot = () => {\n  const state = store.getState()\n\n  const snapshot = {\n    components: new Map(state.components),\n    staticQueryComponents: new Map(state.staticQueryComponents),\n  }\n\n  return snapshot\n}\n\nconst handleComponentsWithRemovedQueries = (\n  { components, staticQueryComponents },\n  queries\n) => {\n  // If a component previously with a query now doesn't  update the\n  // store.\n  components.forEach(c => {\n    if (c.query !== `` && !queries.has(c.componentPath)) {\n      debug(`Page query was removed from ${c.componentPath}`)\n      boundActionCreators.replaceComponentQuery({\n        query: ``,\n        componentPath: c.componentPath,\n      })\n      queueQueriesForPageComponent(c.componentPath)\n    }\n  })\n\n  // If a component had static query and it doesn't have it\n  // anymore - update the store\n  staticQueryComponents.forEach(c => {\n    if (c.query !== `` && !queries.has(c.componentPath)) {\n      debug(`Static query was removed from ${c.componentPath}`)\n      store.dispatch({\n        type: `REMOVE_STATIC_QUERY`,\n        payload: c.jsonName,\n      })\n      boundActionCreators.deleteComponentsDependencies([c.jsonName])\n    }\n  })\n}\n\nconst handleQuery = (\n  { components, staticQueryComponents },\n  query,\n  component\n) => {\n  // If this is a static query\n  // Add action / reducer + watch staticquery files\n  if (query.isStaticQuery) {\n    const oldQuery = staticQueryComponents.get(query.jsonName)\n    const isNewQuery = !oldQuery\n\n    // Compare query text because text is compiled query with any attached\n    // fragments and we want to rerun queries if fragments are edited.\n    // Compare hash because hash is used for identyfing query and\n    // passing data to component in development. Hash can change if user will\n    // format query text, but it doesn't mean that compiled text will change.\n    if (\n      isNewQuery ||\n      oldQuery.hash !== query.hash ||\n      oldQuery.text !== query.text\n    ) {\n      boundActionCreators.replaceStaticQuery({\n        name: query.name,\n        componentPath: query.path,\n        id: query.jsonName,\n        jsonName: query.jsonName,\n        query: query.text,\n        hash: query.hash,\n      })\n\n      debug(\n        `Static query in ${component} ${\n          isNewQuery ? `was added` : `has changed`\n        }.`\n      )\n\n      boundActionCreators.deleteComponentsDependencies([query.jsonName])\n      queueQueryForPathname(query.jsonName)\n    }\n    return true\n\n    // If this is page query\n  } else if (components.has(component)) {\n    if (components.get(component).query !== query.text) {\n      boundActionCreators.replaceComponentQuery({\n        query: query.text,\n        componentPath: component,\n      })\n\n      debug(\n        `Page query in ${component} ${\n          components.get(component).query.length === 0\n            ? `was added`\n            : `has changed`\n        }.`\n      )\n      queueQueriesForPageComponent(component)\n    }\n    return true\n  }\n\n  return false\n}\n\nconst updateStateAndRunQueries = isFirstRun => {\n  const snapshot = getQueriesSnapshot()\n  return queryCompiler().then(queries => {\n    handleComponentsWithRemovedQueries(snapshot, queries)\n\n    let queriesWillNotRun = false\n    queries.forEach((query, component) => {\n      const queryWillRun = handleQuery(snapshot, query, component)\n\n      if (queryWillRun) {\n        watchComponent(component)\n      } else if (isFirstRun) {\n        report.warn(\n          `The GraphQL query in the non-page component \"${component}\" will not be run.`\n        )\n        queriesWillNotRun = true\n      }\n    })\n\n    if (queriesWillNotRun) {\n      report.log(report.stripIndent`\n        Exported queries are only executed for Page components. Instead of an exported\n        query, either co-locate a GraphQL fragment and compose that fragment into the\n        query (or other fragment) of the top-level page that renders this component, or\n        use a <StaticQuery> in this component. For more info on fragments and\n        composition, see http://graphql.org/learn/queries/#fragments and for more\n        information on <StaticQuery>, see https://gatsbyjs.org/docs/static-query\n      `)\n    }\n    runQueuedQueries()\n\n    return null\n  })\n}\n\n/**\n * Removes components templates that aren't used by any page from redux store.\n */\nconst clearInactiveComponents = () => {\n  const { components, pages } = store.getState()\n\n  const activeTemplates = new Set()\n  pages.forEach(page => {\n    // Set will guarantee uniqeness of entires\n    activeTemplates.add(slash(page.component))\n  })\n\n  components.forEach(component => {\n    if (!activeTemplates.has(component.componentPath)) {\n      debug(\n        `${\n          component.componentPath\n        } component was removed because it isn't used by any page`\n      )\n      store.dispatch({\n        type: `REMOVE_TEMPLATE_COMPONENT`,\n        payload: component,\n      })\n    }\n  })\n}\n\nexports.extractQueries = () => {\n  // Remove template components that point to not existing page templates.\n  // We need to do this, because components data is cached and there might\n  // be changes applied when development server isn't running. This is needed\n  // only in initial run, because during development state will be adjusted.\n  clearInactiveComponents()\n\n  return updateStateAndRunQueries(true).then(() => {\n    // During development start watching files to recompile & run\n    // queries on the fly.\n    if (process.env.NODE_ENV !== `production`) {\n      watch(store.getState().program.directory)\n    }\n  })\n}\n\nconst queueQueriesForPageComponent = componentPath => {\n  const pages = getPagesForComponent(componentPath)\n  // Remove page data dependencies before re-running queries because\n  // the changing of the query could have changed the data dependencies.\n  // Re-running the queries will add back data dependencies.\n  boundActionCreators.deleteComponentsDependencies(\n    pages.map(p => p.path || p.id)\n  )\n  pages.forEach(page => queueQueryForPathname(page.path))\n}\n\nconst getPagesForComponent = componentPath => {\n  const state = store.getState()\n  return [...state.pages.values()].filter(\n    p => p.componentPath === componentPath\n  )\n}\n\nconst filesToWatch = new Set()\nlet watcher\nconst watchComponent = componentPath => {\n  // We don't start watching until mid-way through the bootstrap so ignore\n  // new components being added until then. This doesn't affect anything as\n  // when extractQueries is called from bootstrap, we make sure that all\n  // components are being watched.\n  if (\n    process.env.NODE_ENV !== `production` &&\n    !filesToWatch.has(componentPath)\n  ) {\n    filesToWatch.add(componentPath)\n    if (watcher) {\n      watcher.add(componentPath)\n    }\n  }\n}\n\nexports.watchComponent = watchComponent\n\nconst watch = rootDir => {\n  if (watcher) return\n  const debounceCompile = _.debounce(() => {\n    updateStateAndRunQueries()\n  }, 100)\n\n  watcher = chokidar\n    .watch(slash(path.join(rootDir, `/src/**/*.{js,jsx,ts,tsx}`)))\n    .on(`change`, path => {\n      debounceCompile()\n    })\n  filesToWatch.forEach(filePath => watcher.add(filePath))\n}\n\nif (process.env.gatsby_executing_command === `develop`) {\n  let bootstrapFinished = false\n  emitter.on(`BOOTSTRAP_FINISHED`, () => {\n    bootstrapFinished = true\n  })\n  emitter.on(`DELETE_PAGE`, action => {\n    if (bootstrapFinished) {\n      const componentPath = slash(action.payload.component)\n      const { pages } = store.getState()\n      let otherPageWithTemplateExists = false\n      for (let page of pages.values()) {\n        if (slash(page.component) === componentPath) {\n          otherPageWithTemplateExists = true\n          break\n        }\n      }\n      if (!otherPageWithTemplateExists) {\n        store.dispatch({\n          type: `REMOVE_TEMPLATE_COMPONENT`,\n          payload: {\n            componentPath,\n          },\n        })\n      }\n    }\n  })\n}\n"],"file":"query-watcher.js"}
\ No newline at end of file
+{"version":3,"sources":["../../../src/internal-plugins/query-runner/query-watcher.js"],"names":["_","require","chokidar","path","slash","store","emitter","boundActionCreators","queryCompiler","default","report","queueQueryForPathname","runQueuedActions","runQueuedQueries","debug","getQueriesSnapshot","state","getState","snapshot","components","Map","staticQueryComponents","handleComponentsWithRemovedQueries","queries","forEach","c","query","has","componentPath","replaceComponentQuery","queueQueriesForPageComponent","dispatch","type","payload","jsonName","deleteComponentsDependencies","handleQuery","component","isStaticQuery","oldQuery","get","isNewQuery","hash","text","replaceStaticQuery","name","id","length","updateStateAndRunQueries","isFirstRun","then","queriesWillNotRun","queryWillRun","watchComponent","warn","log","stripIndent","clearInactiveComponents","pages","activeTemplates","Set","page","add","exports","extractQueries","process","env","NODE_ENV","watch","program","directory","getPagesForComponent","map","p","values","filter","filesToWatch","watcher","rootDir","debounceCompile","debounce","join","on","filePath","gatsby_executing_command","bootstrapFinished","action","otherPageWithTemplateExists"],"mappings":"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","sourcesContent":["/** *\n * Jobs of this module\n * - Maintain the list of components in the Redux store. So monitor new components\n *   and add/remove components.\n * - Watch components for query changes and extract these and update the store.\n * - Ensure all page queries are run as part of bootstrap and report back when\n *   this is done\n * - Whenever a query changes, re-run all pages that rely on this query.\n ***/\n\nconst _ = require(`lodash`)\nconst chokidar = require(`chokidar`)\nconst path = require(`path`)\nconst slash = require(`slash`)\n\nconst { store, emitter } = require(`../../redux/`)\nconst { boundActionCreators } = require(`../../redux/actions`)\nconst queryCompiler = require(`./query-compiler`).default\nconst report = require(`gatsby-cli/lib/reporter`)\nconst {\n  queueQueryForPathname,\n  runQueuedActions: runQueuedQueries,\n} = require(`./page-query-runner`)\nconst debug = require(`debug`)(`gatsby:query-watcher`)\n\nconst getQueriesSnapshot = () => {\n  const state = store.getState()\n\n  const snapshot = {\n    components: new Map(state.components),\n    staticQueryComponents: new Map(state.staticQueryComponents),\n  }\n\n  return snapshot\n}\n\nconst handleComponentsWithRemovedQueries = (\n  { components, staticQueryComponents },\n  queries\n) => {\n  // If a component previously with a query now doesn't  update the\n  // store.\n  components.forEach(c => {\n    if (c.query !== `` && !queries.has(c.componentPath)) {\n      debug(`Page query was removed from ${c.componentPath}`)\n      boundActionCreators.replaceComponentQuery({\n        query: ``,\n        componentPath: c.componentPath,\n      })\n      queueQueriesForPageComponent(c.componentPath)\n    }\n  })\n\n  // If a component had static query and it doesn't have it\n  // anymore - update the store\n  staticQueryComponents.forEach(c => {\n    if (c.query !== `` && !queries.has(c.componentPath)) {\n      debug(`Static query was removed from ${c.componentPath}`)\n      store.dispatch({\n        type: `REMOVE_STATIC_QUERY`,\n        payload: c.jsonName,\n      })\n      boundActionCreators.deleteComponentsDependencies([c.jsonName])\n    }\n  })\n}\n\nconst handleQuery = (\n  { components, staticQueryComponents },\n  query,\n  component\n) => {\n  // If this is a static query\n  // Add action / reducer + watch staticquery files\n  if (query.isStaticQuery) {\n    const oldQuery = staticQueryComponents.get(query.jsonName)\n    const isNewQuery = !oldQuery\n\n    // Compare query text because text is compiled query with any attached\n    // fragments and we want to rerun queries if fragments are edited.\n    // Compare hash because hash is used for identyfing query and\n    // passing data to component in development. Hash can change if user will\n    // format query text, but it doesn't mean that compiled text will change.\n    if (\n      isNewQuery ||\n      oldQuery.hash !== query.hash ||\n      oldQuery.text !== query.text\n    ) {\n      boundActionCreators.replaceStaticQuery({\n        name: query.name,\n        componentPath: query.path,\n        id: query.jsonName,\n        jsonName: query.jsonName,\n        query: query.text,\n        hash: query.hash,\n      })\n\n      debug(\n        `Static query in ${component} ${\n          isNewQuery ? `was added` : `has changed`\n        }.`\n      )\n\n      boundActionCreators.deleteComponentsDependencies([query.jsonName])\n      queueQueryForPathname(query.jsonName)\n    }\n    return true\n\n    // If this is page query\n  } else if (components.has(component)) {\n    if (components.get(component).query !== query.text) {\n      boundActionCreators.replaceComponentQuery({\n        query: query.text,\n        componentPath: component,\n      })\n\n      debug(\n        `Page query in ${component} ${\n          components.get(component).query.length === 0\n            ? `was added`\n            : `has changed`\n        }.`\n      )\n      queueQueriesForPageComponent(component)\n    }\n    return true\n  }\n\n  return false\n}\n\nconst updateStateAndRunQueries = isFirstRun => {\n  const snapshot = getQueriesSnapshot()\n  return queryCompiler().then(queries => {\n    handleComponentsWithRemovedQueries(snapshot, queries)\n\n    let queriesWillNotRun = false\n    queries.forEach((query, component) => {\n      const queryWillRun = handleQuery(snapshot, query, component)\n\n      if (queryWillRun) {\n        watchComponent(component)\n      } else if (isFirstRun) {\n        report.warn(\n          `The GraphQL query in the non-page component \"${component}\" will not be run.`\n        )\n        queriesWillNotRun = true\n      }\n    })\n\n    if (queriesWillNotRun) {\n      report.log(report.stripIndent`\n        Exported queries are only executed for Page components. Instead of an exported\n        query, either co-locate a GraphQL fragment and compose that fragment into the\n        query (or other fragment) of the top-level page that renders this component, or\n        use a <StaticQuery> in this component. For more info on fragments and\n        composition, see http://graphql.org/learn/queries/#fragments and for more\n        information on <StaticQuery>, see https://gatsbyjs.org/docs/static-query\n      `)\n    }\n    runQueuedQueries()\n\n    return null\n  })\n}\n\n/**\n * Removes components templates that aren't used by any page from redux store.\n */\nconst clearInactiveComponents = () => {\n  const { components, pages } = store.getState()\n\n  const activeTemplates = new Set()\n  pages.forEach(page => {\n    // Set will guarantee uniqeness of entires\n    activeTemplates.add(slash(page.component))\n  })\n\n  components.forEach(component => {\n    if (!activeTemplates.has(component.componentPath)) {\n      debug(\n        `${\n          component.componentPath\n        } component was removed because it isn't used by any page`\n      )\n      store.dispatch({\n        type: `REMOVE_TEMPLATE_COMPONENT`,\n        payload: component,\n      })\n    }\n  })\n}\n\nexports.extractQueries = () => {\n  // Remove template components that point to not existing page templates.\n  // We need to do this, because components data is cached and there might\n  // be changes applied when development server isn't running. This is needed\n  // only in initial run, because during development state will be adjusted.\n  clearInactiveComponents()\n\n  return updateStateAndRunQueries(true).then(() => {\n    // During development start watching files to recompile & run\n    // queries on the fly.\n    if (process.env.NODE_ENV !== `production`) {\n      watch(store.getState().program.directory)\n    }\n  })\n}\n\nconst queueQueriesForPageComponent = componentPath => {\n  const pages = getPagesForComponent(componentPath)\n  // Remove page data dependencies before re-running queries because\n  // the changing of the query could have changed the data dependencies.\n  // Re-running the queries will add back data dependencies.\n  boundActionCreators.deleteComponentsDependencies(\n    pages.map(p => p.path || p.id)\n  )\n  pages.forEach(page => queueQueryForPathname(page.path))\n}\n\nconst getPagesForComponent = componentPath => {\n  const state = store.getState()\n  return [...state.pages.values()].filter(\n    p => p.componentPath === componentPath\n  )\n}\n\nconst filesToWatch = new Set()\nlet watcher\nconst watchComponent = componentPath => {\n  // We don't start watching until mid-way through the bootstrap so ignore\n  // new components being added until then. This doesn't affect anything as\n  // when extractQueries is called from bootstrap, we make sure that all\n  // components are being watched.\n  if (\n    process.env.NODE_ENV !== `production` &&\n    !filesToWatch.has(componentPath)\n  ) {\n    filesToWatch.add(componentPath)\n    if (watcher) {\n      watcher.add(componentPath)\n    }\n  }\n}\n\nexports.watchComponent = watchComponent\n\nconst watch = rootDir => {\n  if (watcher) return\n  const debounceCompile = _.debounce(() => {\n    updateStateAndRunQueries()\n  }, 100)\n\n  watcher = chokidar\n    .watch(slash(path.join(rootDir, `/src/**/*.{js,jsx,ts,tsx}`)))\n    .on(`change`, path => {\n      debounceCompile()\n    })\n  filesToWatch.forEach(filePath => watcher.add(filePath))\n}\n\nif (process.env.gatsby_executing_command === `develop`) {\n  let bootstrapFinished = false\n  emitter.on(`BOOTSTRAP_FINISHED`, () => {\n    bootstrapFinished = true\n  })\n  emitter.on(`DELETE_PAGE`, action => {\n    if (bootstrapFinished) {\n      const componentPath = slash(action.payload.component)\n      const { pages } = store.getState()\n      let otherPageWithTemplateExists = false\n      for (let page of pages.values()) {\n        if (slash(page.component) === componentPath) {\n          otherPageWithTemplateExists = true\n          break\n        }\n      }\n      if (!otherPageWithTemplateExists) {\n        store.dispatch({\n          type: `REMOVE_TEMPLATE_COMPONENT`,\n          payload: {\n            componentPath,\n          },\n        })\n      }\n    }\n  })\n}\n"],"file":"query-watcher.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/internal-plugins/query-runner/redirects-writer.js
+++ b/node_modules/gatsby/dist/internal-plugins/query-runner/redirects-writer.js
@@ -2,8 +2,6 @@
 
 var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
 
-var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
-
 var _lodash = _interopRequireDefault(require("lodash"));
 
 var _crypto = _interopRequireDefault(require("crypto"));
@@ -16,33 +14,26 @@ var _path = require("../../utils/path");
 
 let lastHash = null;
 
-const writeRedirects =
-/*#__PURE__*/
-function () {
-  var _ref = (0, _asyncToGenerator2.default)(function* () {
-    bootstrapFinished = true;
-
-    let _store$getState = _redux.store.getState(),
-        program = _store$getState.program,
-        redirects = _store$getState.redirects; // Filter for redirects that are meant for the browser.
+const writeRedirects = async () => {
+  bootstrapFinished = true;
 
+  let {
+    program,
+    redirects
+  } = _redux.store.getState(); // Filter for redirects that are meant for the browser.
 
-    const browserRedirects = redirects.filter(r => r.redirectInBrowser);
 
-    const newHash = _crypto.default.createHash(`md5`).update(JSON.stringify(browserRedirects)).digest(`hex`);
+  const browserRedirects = redirects.filter(r => r.redirectInBrowser);
 
-    if (newHash === lastHash) {
-      return Promise.resolve();
-    }
+  const newHash = _crypto.default.createHash(`md5`).update(JSON.stringify(browserRedirects)).digest(`hex`);
 
-    lastHash = newHash;
-    return yield _fsExtra.default.writeFile((0, _path.joinPath)(program.directory, `.cache/redirects.json`), JSON.stringify(browserRedirects, null, 2));
-  });
+  if (newHash === lastHash) {
+    return Promise.resolve();
+  }
 
-  return function writeRedirects() {
-    return _ref.apply(this, arguments);
-  };
-}();
+  lastHash = newHash;
+  return await _fsExtra.default.writeFile((0, _path.joinPath)(program.directory, `.cache/redirects.json`), JSON.stringify(browserRedirects, null, 2));
+};
 
 exports.writeRedirects = writeRedirects;
 let bootstrapFinished = false;
--- a/node_modules/gatsby/dist/internal-plugins/query-runner/redirects-writer.js.map
+++ b/node_modules/gatsby/dist/internal-plugins/query-runner/redirects-writer.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../../src/internal-plugins/query-runner/redirects-writer.js"],"names":["lastHash","writeRedirects","bootstrapFinished","store","getState","program","redirects","browserRedirects","filter","r","redirectInBrowser","newHash","crypto","createHash","update","JSON","stringify","digest","Promise","resolve","fs","writeFile","directory","exports","oldRedirects","debouncedWriteRedirects","_","debounce","isEqual","Redirects","emitter","on"],"mappings":";;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AAEA,IAAIA,QAAQ,GAAG,IAAf;;AAEA,MAAMC,cAAc;AAAA;AAAA;AAAA,6CAAG,aAAY;AACjCC,IAAAA,iBAAiB,GAAG,IAApB;;AADiC,0BAGJC,aAAMC,QAAN,EAHI;AAAA,QAG3BC,OAH2B,mBAG3BA,OAH2B;AAAA,QAGlBC,SAHkB,mBAGlBA,SAHkB,EAKjC;;;AACA,UAAMC,gBAAgB,GAAGD,SAAS,CAACE,MAAV,CAAiBC,CAAC,IAAIA,CAAC,CAACC,iBAAxB,CAAzB;;AAEA,UAAMC,OAAO,GAAGC,gBACbC,UADa,CACD,KADC,EAEbC,MAFa,CAENC,IAAI,CAACC,SAAL,CAAeT,gBAAf,CAFM,EAGbU,MAHa,CAGL,KAHK,CAAhB;;AAKA,QAAIN,OAAO,KAAKX,QAAhB,EAA0B;AACxB,aAAOkB,OAAO,CAACC,OAAR,EAAP;AACD;;AAEDnB,IAAAA,QAAQ,GAAGW,OAAX;AAEA,iBAAaS,iBAAGC,SAAH,CACX,oBAAShB,OAAO,CAACiB,SAAjB,EAA6B,uBAA7B,CADW,EAEXP,IAAI,CAACC,SAAL,CAAeT,gBAAf,EAAiC,IAAjC,EAAuC,CAAvC,CAFW,CAAb;AAID,GAvBmB;;AAAA,kBAAdN,cAAc;AAAA;AAAA;AAAA,GAApB;;AAyBAsB,OAAO,CAACtB,cAAR,GAAyBA,cAAzB;AAEA,IAAIC,iBAAiB,GAAG,KAAxB;AACA,IAAIsB,YAAJ;;AACA,MAAMC,uBAAuB,GAAGC,gBAAEC,QAAF,CAAW,MAAM;AAC/C;AACA,MACEzB,iBAAiB,IACjB,CAACwB,gBAAEE,OAAF,CAAUJ,YAAV,EAAwBrB,aAAMC,QAAN,GAAiBE,SAAzC,CAFH,EAGE;AACAL,IAAAA,cAAc;AACduB,IAAAA,YAAY,GAAGrB,aAAMC,QAAN,GAAiByB,SAAhC;AACD;AACF,CAT+B,EAS7B,GAT6B,CAAhC;;AAWAC,eAAQC,EAAR,CAAY,iBAAZ,EAA8B,MAAM;AAClCN,EAAAA,uBAAuB;AACxB,CAFD","sourcesContent":["import _ from \"lodash\"\nimport crypto from \"crypto\"\nimport fs from \"fs-extra\"\nimport { store, emitter } from \"../../redux/\"\nimport { joinPath } from \"../../utils/path\"\n\nlet lastHash = null\n\nconst writeRedirects = async () => {\n  bootstrapFinished = true\n\n  let { program, redirects } = store.getState()\n\n  // Filter for redirects that are meant for the browser.\n  const browserRedirects = redirects.filter(r => r.redirectInBrowser)\n\n  const newHash = crypto\n    .createHash(`md5`)\n    .update(JSON.stringify(browserRedirects))\n    .digest(`hex`)\n\n  if (newHash === lastHash) {\n    return Promise.resolve()\n  }\n\n  lastHash = newHash\n\n  return await fs.writeFile(\n    joinPath(program.directory, `.cache/redirects.json`),\n    JSON.stringify(browserRedirects, null, 2)\n  )\n}\n\nexports.writeRedirects = writeRedirects\n\nlet bootstrapFinished = false\nlet oldRedirects\nconst debouncedWriteRedirects = _.debounce(() => {\n  // Don't write redirects again until bootstrap has finished.\n  if (\n    bootstrapFinished &&\n    !_.isEqual(oldRedirects, store.getState().redirects)\n  ) {\n    writeRedirects()\n    oldRedirects = store.getState().Redirects\n  }\n}, 250)\n\nemitter.on(`CREATE_REDIRECT`, () => {\n  debouncedWriteRedirects()\n})\n"],"file":"redirects-writer.js"}
\ No newline at end of file
+{"version":3,"sources":["../../../src/internal-plugins/query-runner/redirects-writer.js"],"names":["lastHash","writeRedirects","bootstrapFinished","program","redirects","store","getState","browserRedirects","filter","r","redirectInBrowser","newHash","crypto","createHash","update","JSON","stringify","digest","Promise","resolve","fs","writeFile","directory","exports","oldRedirects","debouncedWriteRedirects","_","debounce","isEqual","Redirects","emitter","on"],"mappings":";;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AAEA,IAAIA,QAAQ,GAAG,IAAf;;AAEA,MAAMC,cAAc,GAAG,YAAY;AACjCC,EAAAA,iBAAiB,GAAG,IAApB;;AAEA,MAAI;AAAEC,IAAAA,OAAF;AAAWC,IAAAA;AAAX,MAAyBC,aAAMC,QAAN,EAA7B,CAHiC,CAKjC;;;AACA,QAAMC,gBAAgB,GAAGH,SAAS,CAACI,MAAV,CAAiBC,CAAC,IAAIA,CAAC,CAACC,iBAAxB,CAAzB;;AAEA,QAAMC,OAAO,GAAGC,gBACbC,UADa,CACD,KADC,EAEbC,MAFa,CAENC,IAAI,CAACC,SAAL,CAAeT,gBAAf,CAFM,EAGbU,MAHa,CAGL,KAHK,CAAhB;;AAKA,MAAIN,OAAO,KAAKX,QAAhB,EAA0B;AACxB,WAAOkB,OAAO,CAACC,OAAR,EAAP;AACD;;AAEDnB,EAAAA,QAAQ,GAAGW,OAAX;AAEA,SAAO,MAAMS,iBAAGC,SAAH,CACX,oBAASlB,OAAO,CAACmB,SAAjB,EAA6B,uBAA7B,CADW,EAEXP,IAAI,CAACC,SAAL,CAAeT,gBAAf,EAAiC,IAAjC,EAAuC,CAAvC,CAFW,CAAb;AAID,CAvBD;;AAyBAgB,OAAO,CAACtB,cAAR,GAAyBA,cAAzB;AAEA,IAAIC,iBAAiB,GAAG,KAAxB;AACA,IAAIsB,YAAJ;;AACA,MAAMC,uBAAuB,GAAGC,gBAAEC,QAAF,CAAW,MAAM;AAC/C;AACA,MACEzB,iBAAiB,IACjB,CAACwB,gBAAEE,OAAF,CAAUJ,YAAV,EAAwBnB,aAAMC,QAAN,GAAiBF,SAAzC,CAFH,EAGE;AACAH,IAAAA,cAAc;AACduB,IAAAA,YAAY,GAAGnB,aAAMC,QAAN,GAAiBuB,SAAhC;AACD;AACF,CAT+B,EAS7B,GAT6B,CAAhC;;AAWAC,eAAQC,EAAR,CAAY,iBAAZ,EAA8B,MAAM;AAClCN,EAAAA,uBAAuB;AACxB,CAFD","sourcesContent":["import _ from \"lodash\"\nimport crypto from \"crypto\"\nimport fs from \"fs-extra\"\nimport { store, emitter } from \"../../redux/\"\nimport { joinPath } from \"../../utils/path\"\n\nlet lastHash = null\n\nconst writeRedirects = async () => {\n  bootstrapFinished = true\n\n  let { program, redirects } = store.getState()\n\n  // Filter for redirects that are meant for the browser.\n  const browserRedirects = redirects.filter(r => r.redirectInBrowser)\n\n  const newHash = crypto\n    .createHash(`md5`)\n    .update(JSON.stringify(browserRedirects))\n    .digest(`hex`)\n\n  if (newHash === lastHash) {\n    return Promise.resolve()\n  }\n\n  lastHash = newHash\n\n  return await fs.writeFile(\n    joinPath(program.directory, `.cache/redirects.json`),\n    JSON.stringify(browserRedirects, null, 2)\n  )\n}\n\nexports.writeRedirects = writeRedirects\n\nlet bootstrapFinished = false\nlet oldRedirects\nconst debouncedWriteRedirects = _.debounce(() => {\n  // Don't write redirects again until bootstrap has finished.\n  if (\n    bootstrapFinished &&\n    !_.isEqual(oldRedirects, store.getState().redirects)\n  ) {\n    writeRedirects()\n    oldRedirects = store.getState().Redirects\n  }\n}, 250)\n\nemitter.on(`CREATE_REDIRECT`, () => {\n  debouncedWriteRedirects()\n})\n"],"file":"redirects-writer.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/redux/actions.js
+++ b/node_modules/gatsby/dist/redux/actions.js
@@ -1,20 +1,18 @@
 "use strict";
 
-var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
-
-var _objectWithoutPropertiesLoose2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutPropertiesLoose"));
-
 const Joi = require(`joi`);
 
 const chalk = require(`chalk`);
 
 const _ = require(`lodash`);
 
-const _require = require(`redux`),
-      bindActionCreators = _require.bindActionCreators;
+const {
+  bindActionCreators
+} = require(`redux`);
 
-const _require2 = require(`common-tags`),
-      stripIndent = _require2.stripIndent;
+const {
+  stripIndent
+} = require(`common-tags`);
 
 const report = require(`gatsby-cli/lib/reporter`);
 
@@ -26,22 +24,26 @@ const url = require(`url`);
 
 const kebabHash = require(`kebab-hash`);
 
-const _require3 = require(`../db/nodes`),
-      hasNodeChanged = _require3.hasNodeChanged,
-      getNode = _require3.getNode;
+const {
+  hasNodeChanged,
+  getNode
+} = require(`../db/nodes`);
 
-const _require4 = require(`../db/node-tracking`),
-      trackInlineObjectsInRootNode = _require4.trackInlineObjectsInRootNode;
+const {
+  trackInlineObjectsInRootNode
+} = require(`../db/node-tracking`);
 
-const _require5 = require(`./index`),
-      store = _require5.store;
+const {
+  store
+} = require(`./index`);
 
 const fileExistsSync = require(`fs-exists-cached`).sync;
 
 const joiSchemas = require(`../joi-schemas/joi`);
 
-const _require6 = require(`../utils/js-chunk-names`),
-      generateComponentChunkName = _require6.generateComponentChunkName;
+const {
+  generateComponentChunkName
+} = require(`../utils/js-chunk-names`);
 
 const actions = {};
 
@@ -262,11 +264,11 @@ ${reservedFields.map(f => `  * "${f}"`).join(`\n`)}
     fileOkCache[internalPage.component] = true;
   }
 
-  return Object.assign({}, actionOptions, {
+  return { ...actionOptions,
     type: `CREATE_PAGE`,
     plugin,
     payload: internalPage
-  });
+  };
 };
 /**
  * Delete a node
@@ -527,12 +529,12 @@ actions.createNode = (node, plugin, actionOptions = {}) => {
   let updateNodeAction; // Check if the node has already been processed.
 
   if (oldNode && !hasNodeChanged(node.id, node.internal.contentDigest)) {
-    updateNodeAction = Object.assign({
+    updateNodeAction = {
       type: `TOUCH_NODE`,
-      plugin
-    }, actionOptions, {
+      plugin,
+      ...actionOptions,
       payload: node.id
-    });
+    };
   } else {
     // Remove any previously created descendant nodes as they're all due
     // to be recreated.
@@ -546,12 +548,12 @@ actions.createNode = (node, plugin, actionOptions = {}) => {
       }
     }
 
-    updateNodeAction = Object.assign({
+    updateNodeAction = {
       type: `CREATE_NODE`,
-      plugin
-    }, actionOptions, {
+      plugin,
+      ...actionOptions,
       payload: node
-    });
+    };
   }
 
   if (deleteAction) {
@@ -670,12 +672,12 @@ actions.createNodeField = ({
 
   node.fields[name] = value;
   node.internal.fieldOwners[schemaFieldName] = plugin.name;
-  return Object.assign({
+  return {
     type: `ADD_FIELD_TO_NODE`,
-    plugin
-  }, actionOptions, {
+    plugin,
+    ...actionOptions,
     payload: node
-  });
+  };
 };
 /**
  * Creates a link between a parent and child node. This is used when you
@@ -1035,14 +1037,13 @@ actions.setPluginStatus = (status, plugin) => {
  */
 
 
-actions.createRedirect = (_ref) => {
-  let fromPath = _ref.fromPath,
-      _ref$isPermanent = _ref.isPermanent,
-      isPermanent = _ref$isPermanent === void 0 ? false : _ref$isPermanent,
-      _ref$redirectInBrowse = _ref.redirectInBrowser,
-      redirectInBrowser = _ref$redirectInBrowse === void 0 ? false : _ref$redirectInBrowse,
-      toPath = _ref.toPath,
-      rest = (0, _objectWithoutPropertiesLoose2.default)(_ref, ["fromPath", "isPermanent", "redirectInBrowser", "toPath"]);
+actions.createRedirect = ({
+  fromPath,
+  isPermanent = false,
+  redirectInBrowser = false,
+  toPath,
+  ...rest
+}) => {
   let pathPrefix = ``;
 
   if (store.getState().program.prefixPaths) {
@@ -1056,12 +1057,13 @@ actions.createRedirect = (_ref) => {
   const toPathPrefix = parsed.protocol != null || isRelativeProtocol ? `` : pathPrefix;
   return {
     type: `CREATE_REDIRECT`,
-    payload: Object.assign({
+    payload: {
       fromPath: `${pathPrefix}${fromPath}`,
       isPermanent,
       redirectInBrowser,
-      toPath: `${toPathPrefix}${toPath}`
-    }, rest)
+      toPath: `${toPathPrefix}${toPath}`,
+      ...rest
+    }
   };
 };
 /**
--- a/node_modules/gatsby/dist/redux/actions.js.map
+++ b/node_modules/gatsby/dist/redux/actions.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/redux/actions.js"],"names":["Joi","require","chalk","_","bindActionCreators","stripIndent","report","path","fs","url","kebabHash","hasNodeChanged","getNode","trackInlineObjectsInRootNode","store","fileExistsSync","sync","joiSchemas","generateComponentChunkName","actions","findChildrenRecursively","children","concat","map","child","newChildren","isArray","length","deletePage","page","type","payload","pascalCase","flow","camelCase","upperFirst","hasWarnedForPageComponent","Set","fileOkCache","createPage","plugin","actionOptions","noPageOrComponent","name","message","process","env","NODE_ENV","console","log","bold","red","isObject","context","reservedFields","invalidFields","Object","keys","pick","singularMessage","pluralMessage","error","f","join","JSON","stringify","some","panic","has","component","warn","add","isAbsolute","jsonName","internalComponentName","internalPage","matchPath","componentChunkName","updatedAt","Date","now","includes","fileName","fileContent","readFileSync","notEmpty","includesDefaultExport","test","extname","relativePath","relative","getState","program","directory","panicOnBuild","deleteNode","options","args","node","get","deleteDescendantsActions","descendantNodes","n","deleteAction","deleteNodes","nodes","flatten","deleteNodesAction","typeOwners","createNode","internal","array","parent","owner","result","validate","nodeSchema","fields","Error","oldNode","id","pluginName","parentSpan","setTag","updateNodeAction","contentDigest","touchNode","nodeId","createNodeField","value","fieldName","fieldValue","fieldOwners","schemaFieldName","split","fieldOwner","createParentChildLink","push","uniq","createPageDependency","connection","deleteComponentsDependencies","paths","replaceComponentQuery","query","componentPath","replaceStaticQuery","setWebpackConfig","config","replaceWebpackConfig","setBabelOptions","exit","setBabelPlugin","setBabelPreset","createJob","job","setJob","endJob","setPluginStatus","status","createRedirect","fromPath","isPermanent","redirectInBrowser","toPath","rest","pathPrefix","prefixPaths","parsed","parse","isRelativeProtocol","startsWith","toPathPrefix","protocol","addThirdPartySchema","schema","traceId","exports","boundActionCreators","dispatch"],"mappings":"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","sourcesContent":["// @flow\nconst Joi = require(`joi`)\nconst chalk = require(`chalk`)\nconst _ = require(`lodash`)\nconst { bindActionCreators } = require(`redux`)\nconst { stripIndent } = require(`common-tags`)\nconst report = require(`gatsby-cli/lib/reporter`)\nconst path = require(`path`)\nconst fs = require(`fs`)\nconst url = require(`url`)\nconst kebabHash = require(`kebab-hash`)\nconst { hasNodeChanged, getNode } = require(`../db/nodes`)\nconst { trackInlineObjectsInRootNode } = require(`../db/node-tracking`)\nconst { store } = require(`./index`)\nconst fileExistsSync = require(`fs-exists-cached`).sync\nconst joiSchemas = require(`../joi-schemas/joi`)\nconst { generateComponentChunkName } = require(`../utils/js-chunk-names`)\n\nconst actions = {}\n\nconst findChildrenRecursively = (children = []) => {\n  children = children.concat(\n    ...children.map(child => {\n      const newChildren = getNode(child).children\n      if (_.isArray(newChildren) && newChildren.length > 0) {\n        return findChildrenRecursively(newChildren)\n      } else {\n        return []\n      }\n    })\n  )\n\n  return children\n}\n\ntype Job = {\n  id: string,\n}\ntype PageInput = {\n  path: string,\n  component: string,\n  context?: Object,\n}\n\ntype Page = {\n  path: string,\n  matchPath: ?string,\n  component: string,\n  context: Object,\n  internalComponentName: string,\n  jsonName: string,\n  componentChunkName: string,\n  updatedAt: number,\n}\n\ntype Plugin = {\n  name: string,\n}\n\ntype ActionOptions = {\n  traceId: ?string,\n  parentSpan: ?Object,\n  followsSpan: ?Object,\n}\n\n/**\n * Delete a page\n * @param {Object} page a page object\n * @param {string} page.path The path of the page\n * @param {string} page.component The absolute path to the page component\n * @example\n * deletePage(page)\n */\nactions.deletePage = (page: PageInput) => {\n  return {\n    type: `DELETE_PAGE`,\n    payload: page,\n  }\n}\n\nconst pascalCase = _.flow(\n  _.camelCase,\n  _.upperFirst\n)\nconst hasWarnedForPageComponent = new Set()\nconst fileOkCache = {}\n\n/**\n * Create a page. See [the guide on creating and modifying pages](/docs/creating-and-modifying-pages/)\n * for detailed documentation about creating pages.\n * @param {Object} page a page object\n * @param {string} page.path Any valid URL. Must start with a forward slash\n * @param {string} page.component The absolute path to the component for this page\n * @param {Object} page.context Context data for this page. Passed as props\n * to the component `this.props.pageContext` as well as to the graphql query\n * as graphql arguments.\n * @example\n * createPage({\n *   path: `/my-sweet-new-page/`,\n *   component: path.resolve(`./src/templates/my-sweet-new-page.js`),\n *   // The context is passed as props to the component as well\n *   // as into the component's GraphQL query.\n *   context: {\n *     id: `123456`,\n *   },\n * })\n */\nactions.createPage = (\n  page: PageInput,\n  plugin?: Plugin,\n  actionOptions?: ActionOptions\n) => {\n  let noPageOrComponent = false\n  let name = `The plugin \"${plugin.name}\"`\n  if (plugin.name === `default-site-plugin`) {\n    name = `Your site's \"gatsby-node.js\"`\n  }\n  if (!page.path) {\n    const message = `${name} must set the page path when creating a page`\n    // Don't log out when testing\n    if (process.env.NODE_ENV !== `test`) {\n      console.log(chalk.bold.red(message))\n      console.log(``)\n      console.log(page)\n    } else {\n      return message\n    }\n    noPageOrComponent = true\n  }\n\n  // Validate that the context object doesn't overlap with any core page fields\n  // as this will cause trouble when running graphql queries.\n  if (_.isObject(page.context)) {\n    const reservedFields = [\n      `path`,\n      `matchPath`,\n      `component`,\n      `componentChunkName`,\n      `pluginCreator___NODE`,\n      `pluginCreatorName`,\n    ]\n    const invalidFields = Object.keys(_.pick(page.context, reservedFields))\n\n    const singularMessage = `${name} used a reserved field name in the context object when creating a page:`\n    const pluralMessage = `${name} used reserved field names in the context object when creating a page:`\n    if (invalidFields.length > 0) {\n      const error = `${\n        invalidFields.length === 1 ? singularMessage : pluralMessage\n      }\n\n${invalidFields.map(f => `  * \"${f}\"`).join(`\\n`)}\n\n${JSON.stringify(page, null, 4)}\n\nData in \"context\" is passed to GraphQL as potential arguments when running the\npage query.\n\nWhen arguments for GraphQL are constructed, the context object is combined with\nthe page object so *both* page object and context data are available as\narguments. So you don't need to add the page \"path\" to the context as it's\nalready available in GraphQL. If a context field duplicates a field already\nused by the page object, this can break functionality within Gatsby so must be\navoided.\n\nPlease choose another name for the conflicting fields.\n\nThe following fields are used by the page object and should be avoided.\n\n${reservedFields.map(f => `  * \"${f}\"`).join(`\\n`)}\n\n            `\n      if (process.env.NODE_ENV === `test`) {\n        return error\n        // Only error if the context version is different than the page\n        // version.  People in v1 often thought that they needed to also pass\n        // the path to context for it to be available in GraphQL\n      } else if (invalidFields.some(f => page.context[f] !== page[f])) {\n        report.panic(error)\n      } else {\n        if (!hasWarnedForPageComponent.has(page.component)) {\n          report.warn(error)\n          hasWarnedForPageComponent.add(page.component)\n        }\n      }\n    }\n  }\n\n  // Don't check if the component exists during tests as we use a lot of fake\n  // component paths.\n  if (process.env.NODE_ENV !== `test`) {\n    if (!fileExistsSync(page.component)) {\n      const message = `${name} created a page with a component that doesn't exist`\n      console.log(``)\n      console.log(chalk.bold.red(message))\n      console.log(``)\n      console.log(page)\n      noPageOrComponent = true\n    }\n  }\n\n  if (!page.component || !path.isAbsolute(page.component)) {\n    const message = `${name} must set the absolute path to the page component when create creating a page`\n    // Don't log out when testing\n    if (process.env.NODE_ENV !== `test`) {\n      console.log(``)\n      console.log(chalk.bold.red(message))\n      console.log(``)\n      console.log(page)\n    } else {\n      return message\n    }\n    noPageOrComponent = true\n  }\n\n  if (noPageOrComponent) {\n    report.panic(\n      `See the documentation for createPage https://www.gatsbyjs.org/docs/bound-action-creators/#createPage`\n    )\n  }\n\n  let jsonName\n  let internalComponentName\n  if (page.path === `/`) {\n    jsonName = `index`\n    internalComponentName = `ComponentIndex`\n  } else {\n    jsonName = `${kebabHash(page.path)}`\n    internalComponentName = `Component${pascalCase(page.path)}`\n  }\n\n  let internalPage: Page = {\n    jsonName,\n    internalComponentName,\n    path: page.path,\n    matchPath: page.matchPath,\n    component: page.component,\n    componentChunkName: generateComponentChunkName(page.component),\n    // Ensure the page has a context object\n    context: page.context || {},\n    updatedAt: Date.now(),\n  }\n\n  // If the path doesn't have an initial forward slash, add it.\n  if (internalPage.path[0] !== `/`) {\n    internalPage.path = `/${internalPage.path}`\n  }\n\n  // Validate that the page component imports React and exports something\n  // (hopefully a component).\n  //\n  // Only run validation once during builds.\n  if (\n    !internalPage.component.includes(`/.cache/`) &&\n    (process.env.NODE_ENV === `production` &&\n      !fileOkCache[internalPage.component])\n  ) {\n    const fileName = internalPage.component\n    const fileContent = fs.readFileSync(fileName, `utf-8`)\n    let notEmpty = true\n    let includesDefaultExport = true\n\n    if (fileContent === ``) {\n      notEmpty = false\n    }\n\n    if (\n      !fileContent.includes(`export default`) &&\n      !fileContent.includes(`module.exports`) &&\n      !fileContent.includes(`exports.default`) &&\n      // this check only applies to js and ts, not mdx\n      /\\.(jsx?|tsx?)/.test(path.extname(fileName))\n    ) {\n      includesDefaultExport = false\n    }\n    if (!notEmpty || !includesDefaultExport) {\n      const relativePath = path.relative(\n        store.getState().program.directory,\n        fileName\n      )\n\n      if (!notEmpty) {\n        report.panicOnBuild(\n          `You have an empty file in the \"src/pages\" directory at \"${relativePath}\". Please remove it or make it a valid component`\n        )\n      }\n\n      if (!includesDefaultExport) {\n        report.panicOnBuild(\n          `[${fileName}] The page component must export a React component for it to be valid`\n        )\n      }\n    }\n\n    fileOkCache[internalPage.component] = true\n  }\n\n  return {\n    ...actionOptions,\n    type: `CREATE_PAGE`,\n    plugin,\n    payload: internalPage,\n  }\n}\n\n/**\n * Delete a node\n * @param {object} $0\n * @param {object} $0.node the node object\n * @example\n * deleteNode({node: node})\n */\nactions.deleteNode = (options: any, plugin: Plugin, ...args) => {\n  let node = _.get(options, `node`)\n\n  // Check if using old method signature. Warn about incorrect usage but get\n  // node from nodeID anyway.\n  if (typeof options === `string`) {\n    console.warn(\n      `Calling \"deleteNode\" with a nodeId is deprecated. Please pass an object containing a full node instead: deleteNode({ node })`\n    )\n\n    if (args[0] && args[0].name) {\n      // `plugin` used to be the third argument\n      console.log(`\"deleteNode\" was called by ${args[0].name}`)\n    }\n\n    node = getNode(options)\n  }\n\n  let deleteDescendantsActions\n  // It's possible the file node was never created as sometimes tools will\n  // write and then immediately delete temporary files to the file system.\n  if (node) {\n    // Also delete any nodes transformed from this one.\n    const descendantNodes = findChildrenRecursively(node.children)\n    if (descendantNodes.length > 0) {\n      deleteDescendantsActions = descendantNodes.map(n =>\n        actions.deleteNode({ node: getNode(n) }, plugin)\n      )\n    }\n  }\n\n  const deleteAction = {\n    type: `DELETE_NODE`,\n    plugin,\n    payload: node,\n  }\n\n  if (deleteDescendantsActions) {\n    return [...deleteDescendantsActions, deleteAction]\n  } else {\n    return deleteAction\n  }\n}\n\n/**\n * Batch delete nodes\n * @param {Array} nodes an array of node ids\n * @example\n * deleteNodes([`node1`, `node2`])\n */\nactions.deleteNodes = (nodes: any[], plugin: Plugin) => {\n  console.log(\n    `The \"deleteNodes\" action is now deprecated and will be removed in Gatsby v3. Please use \"deleteNode\" instead.`\n  )\n  if (plugin && plugin.name) {\n    console.log(`\"deleteNodes\" was called by ${plugin.name}`)\n  }\n\n  // Also delete any nodes transformed from these.\n  const descendantNodes = _.flatten(\n    nodes.map(n => findChildrenRecursively(getNode(n).children))\n  )\n  let deleteDescendantsActions\n  if (descendantNodes.length > 0) {\n    deleteDescendantsActions = descendantNodes.map(n =>\n      actions.deleteNode({ node: getNode(n) }, plugin)\n    )\n  }\n\n  const deleteNodesAction = {\n    type: `DELETE_NODES`,\n    plugin,\n    payload: nodes,\n  }\n\n  if (deleteDescendantsActions) {\n    return [...deleteDescendantsActions, deleteNodesAction]\n  } else {\n    return deleteNodesAction\n  }\n}\n\nconst typeOwners = {}\n/**\n * Create a new node.\n * @param {Object} node a node object\n * @param {string} node.id The node's ID. Must be globally unique.\n * @param {string} node.parent The ID of the parent's node. If the node is\n * derived from another node, set that node as the parent. Otherwise it can\n * just be `null`.\n * @param {Array} node.children An array of children node IDs. If you're\n * creating the children nodes while creating the parent node, add the\n * children node IDs here directly. If you're adding a child node to a\n * parent node created by a plugin, you can't mutate this value directly\n * to add your node id, instead use the action creator `createParentChildLink`.\n * @param {Object} node.internal node fields that aren't generally\n * interesting to consumers of node data but are very useful for plugin writers\n * and Gatsby core.\n * @param {string} node.internal.mediaType An optional field to indicate to\n * transformer plugins that your node has raw content they can transform.\n * Use either an official media type (we use mime-db as our source\n * (https://www.npmjs.com/package/mime-db) or a made-up one if your data\n * doesn't fit in any existing bucket. Transformer plugins use node media types\n * for deciding if they should transform a node into a new one. E.g.\n * markdown transformers look for media types of\n * `text/markdown`.\n * @param {string} node.internal.type An arbitrary globally unique type\n * choosen by the plugin creating the node. Should be descriptive of the\n * node as the type is used in forming GraphQL types so users will query\n * for nodes based on the type choosen here. Nodes of a given type can\n * only be created by one plugin.\n * @param {string} node.internal.content An optional field. The raw content\n * of the node. Can be excluded if it'd require a lot of memory to load in\n * which case you must define a `loadNodeContent` function for this node.\n * @param {string} node.internal.contentDigest the digest for the content\n * of this node. Helps Gatsby avoid doing extra work on data that hasn't\n * changed.\n * @param {string} node.internal.description An optional field. Human\n * readable description of what this node represent / its source. It will\n * be displayed when type conflicts are found, making it easier to find\n * and correct type conflicts.\n * @example\n * createNode({\n *   // Data for the node.\n *   field1: `a string`,\n *   field2: 10,\n *   field3: true,\n *   ...arbitraryOtherData,\n *\n *   // Required fields.\n *   id: `a-node-id`,\n *   parent: `the-id-of-the-parent-node`, // or null if it's a source node without a parent\n *   children: [],\n *   internal: {\n *     type: `CoolServiceMarkdownField`,\n *     contentDigest: crypto\n *       .createHash(`md5`)\n *       .update(JSON.stringify(fieldData))\n *       .digest(`hex`),\n *     mediaType: `text/markdown`, // optional\n *     content: JSON.stringify(fieldData), // optional\n *     description: `Cool Service: \"Title of entry\"`, // optional\n *   }\n * })\n */\nactions.createNode = (\n  node: any,\n  plugin?: Plugin,\n  actionOptions?: ActionOptions = {}\n) => {\n  if (!_.isObject(node)) {\n    return console.log(\n      chalk.bold.red(\n        `The node passed to the \"createNode\" action creator must be an object`\n      )\n    )\n  }\n\n  // Ensure the new node has an internals object.\n  if (!node.internal) {\n    node.internal = {}\n  }\n\n  // Ensure the new node has a children array.\n  if (!node.array && !_.isArray(node.children)) {\n    node.children = []\n  }\n\n  // Ensure the new node has a parent field\n  if (!node.parent) {\n    node.parent = null\n  }\n\n  // Tell user not to set the owner name themself.\n  if (node.internal.owner) {\n    report.error(JSON.stringify(node, null, 4))\n    report.panic(\n      chalk.bold.red(\n        `The node internal.owner field is set automatically by Gatsby and not by plugins`\n      )\n    )\n  }\n\n  // Add the plugin name to the internal object.\n  if (plugin) {\n    node.internal.owner = plugin.name\n  }\n\n  const result = Joi.validate(node, joiSchemas.nodeSchema)\n  if (result.error) {\n    console.log(chalk.bold.red(`The new node didn't pass validation`))\n    console.log(chalk.bold.red(result.error))\n    console.log(node)\n    return { type: `VALIDATION_ERROR`, error: true }\n  }\n\n  // Ensure node isn't directly setting fields.\n  if (node.fields) {\n    throw new Error(\n      stripIndent`\n      Plugins creating nodes can not set data on the reserved field \"fields\"\n      as this is reserved for plugins which wish to extend your nodes.\n\n      If your plugin didn't add \"fields\" you're probably seeing this\n      error because you're reusing an old node object.\n\n      Node:\n\n      ${JSON.stringify(node, null, 4)}\n\n      Plugin that created the node:\n\n      ${JSON.stringify(plugin, null, 4)}\n    `\n    )\n  }\n\n  trackInlineObjectsInRootNode(node)\n\n  const oldNode = getNode(node.id)\n\n  // Ensure the plugin isn't creating a node type owned by another\n  // plugin. Type \"ownership\" is first come first served.\n  if (plugin) {\n    let pluginName = plugin.name\n\n    if (!typeOwners[node.internal.type])\n      typeOwners[node.internal.type] = pluginName\n    else if (typeOwners[node.internal.type] !== pluginName)\n      throw new Error(stripIndent`\n        The plugin \"${pluginName}\" created a node of a type owned by another plugin.\n\n        The node type \"${node.internal.type}\" is owned by \"${\n        typeOwners[node.internal.type]\n      }\".\n\n        If you copy and pasted code from elsewhere, you'll need to pick a new type name\n        for your new node(s).\n\n        The node object passed to \"createNode\":\n\n        ${JSON.stringify(node, null, 4)}\n\n        The plugin creating the node:\n\n        ${JSON.stringify(plugin, null, 4)}\n      `)\n\n    // If the node has been created in the past, check that\n    // the current plugin is the same as the previous.\n    if (oldNode && oldNode.internal.owner !== pluginName) {\n      throw new Error(\n        stripIndent`\n        Nodes can only be updated by their owner. Node \"${node.id}\" is\n        owned by \"${oldNode.internal.owner}\" and another plugin \"${pluginName}\"\n        tried to update it.\n\n        `\n      )\n    }\n  }\n\n  if (actionOptions.parentSpan) {\n    actionOptions.parentSpan.setTag(`nodeId`, node.id)\n    actionOptions.parentSpan.setTag(`nodeType`, node.id)\n  }\n\n  let deleteAction\n  let updateNodeAction\n  // Check if the node has already been processed.\n  if (oldNode && !hasNodeChanged(node.id, node.internal.contentDigest)) {\n    updateNodeAction = {\n      type: `TOUCH_NODE`,\n      plugin,\n      ...actionOptions,\n      payload: node.id,\n    }\n  } else {\n    // Remove any previously created descendant nodes as they're all due\n    // to be recreated.\n    if (oldNode) {\n      const descendantNodes = findChildrenRecursively(oldNode.children)\n      if (descendantNodes.length > 0) {\n        deleteAction = descendantNodes.map(n =>\n          actions.deleteNode({ node: getNode(n) })\n        )\n      }\n    }\n\n    updateNodeAction = {\n      type: `CREATE_NODE`,\n      plugin,\n      ...actionOptions,\n      payload: node,\n    }\n  }\n\n  if (deleteAction) {\n    return [deleteAction, updateNodeAction]\n  } else {\n    return updateNodeAction\n  }\n}\n\n/**\n * \"Touch\" a node. Tells Gatsby a node still exists and shouldn't\n * be garbage collected. Primarily useful for source plugins fetching\n * nodes from a remote system that can return only nodes that have\n * updated. The source plugin then touches all the nodes that haven't\n * updated but still exist so Gatsby knows to keep them.\n * @param {Object} $0\n * @param {string} $0.nodeId The id of a node\n * @example\n * touchNode({ nodeId: `a-node-id` })\n */\nactions.touchNode = (options: any, plugin?: Plugin) => {\n  let nodeId = _.get(options, `nodeId`)\n\n  // Check if using old method signature. Warn about incorrect usage\n  if (typeof options === `string`) {\n    console.warn(\n      `Calling \"touchNode\" with a nodeId is deprecated. Please pass an object containing a nodeId instead: touchNode({ nodeId: 'a-node-id' })`\n    )\n\n    if (plugin && plugin.name) {\n      console.log(`\"touchNode\" was called by ${plugin.name}`)\n    }\n\n    nodeId = options\n  }\n\n  return {\n    type: `TOUCH_NODE`,\n    plugin,\n    payload: nodeId,\n  }\n}\n\ntype CreateNodeInput = {\n  node: Object,\n  fieldName?: string,\n  fieldValue?: string,\n  name?: string,\n  value: any,\n}\n/**\n * Extend another node. The new node field is placed under the `fields`\n * key on the extended node object.\n *\n * Once a plugin has claimed a field name the field name can't be used by\n * other plugins.  Also since nodes are immutable, you can't mutate the node\n * directly. So to extend another node, use this.\n * @param {Object} $0\n * @param {Object} $0.node the target node object\n * @param {string} $0.fieldName [deprecated] the name for the field\n * @param {string} $0.fieldValue [deprecated] the value for the field\n * @param {string} $0.name the name for the field\n * @param {string} $0.value the value for the field\n * @example\n * createNodeField({\n *   node,\n *   name: `happiness`,\n *   value: `is sweet graphql queries`\n * })\n *\n * // The field value is now accessible at node.fields.happiness\n */\nactions.createNodeField = (\n  { node, name, value, fieldName, fieldValue }: CreateNodeInput,\n  plugin: Plugin,\n  actionOptions?: ActionOptions\n) => {\n  if (fieldName) {\n    console.warn(\n      `Calling \"createNodeField\" with \"fieldName\" is deprecated. Use \"name\" instead`\n    )\n    if (!name) {\n      name = fieldName\n    }\n  }\n  if (fieldValue) {\n    console.warn(\n      `Calling \"createNodeField\" with \"fieldValue\" is deprecated. Use \"value\" instead`\n    )\n    if (!value) {\n      value = fieldValue\n    }\n  }\n  // Ensure required fields are set.\n  if (!node.internal.fieldOwners) {\n    node.internal.fieldOwners = {}\n  }\n  if (!node.fields) {\n    node.fields = {}\n  }\n\n  /**\n   * Normalized name of the field that will be used in schema\n   */\n  const schemaFieldName = _.includes(name, `___NODE`)\n    ? name.split(`___`)[0]\n    : name\n\n  // Check that this field isn't owned by another plugin.\n  const fieldOwner = node.internal.fieldOwners[schemaFieldName]\n  if (fieldOwner && fieldOwner !== plugin.name) {\n    throw new Error(\n      stripIndent`\n      A plugin tried to update a node field that it doesn't own:\n\n      Node id: ${node.id}\n      Plugin: ${plugin.name}\n      name: ${name}\n      value: ${value}\n      `\n    )\n  }\n\n  // Update node\n  node.fields[name] = value\n  node.internal.fieldOwners[schemaFieldName] = plugin.name\n\n  return {\n    type: `ADD_FIELD_TO_NODE`,\n    plugin,\n    ...actionOptions,\n    payload: node,\n  }\n}\n\n/**\n * Creates a link between a parent and child node. This is used when you\n * transform content from a node creating a new child node. You need to add\n * this new child node to the `children` array of the parent but since you\n * don't have direct access to the immutable parent node, use this action\n * instead.\n * @param {Object} $0\n * @param {Object} $0.parent the parent node object\n * @param {Object} $0.child the child node object\n * @example\n * createParentChildLink({ parent: parentNode, child: childNode })\n */\nactions.createParentChildLink = (\n  { parent, child }: { parent: any, child: any },\n  plugin?: Plugin\n) => {\n  // Update parent\n  parent.children.push(child.id)\n  parent.children = _.uniq(parent.children)\n\n  return {\n    type: `ADD_CHILD_NODE_TO_PARENT_NODE`,\n    plugin,\n    payload: parent,\n  }\n}\n\n/**\n * Create a dependency between a page and data. Probably for\n * internal use only.\n * @param {Object} $0\n * @param {string} $0.path the path to the page\n * @param {string} $0.nodeId A node ID\n * @param {string} $0.connection A connection type\n * @private\n */\nactions.createPageDependency = (\n  {\n    path,\n    nodeId,\n    connection,\n  }: { path: string, nodeId: string, connection: string },\n  plugin: string = ``\n) => {\n  return {\n    type: `CREATE_COMPONENT_DEPENDENCY`,\n    plugin,\n    payload: {\n      path,\n      nodeId,\n      connection,\n    },\n  }\n}\n\n/**\n * Delete dependencies between an array of pages and data. Probably for\n * internal use only. Used when deleting pages.\n * @param {Array} paths the paths to delete.\n * @private\n */\nactions.deleteComponentsDependencies = (paths: string[]) => {\n  return {\n    type: `DELETE_COMPONENTS_DEPENDENCIES`,\n    payload: {\n      paths,\n    },\n  }\n}\n\n/**\n * When the query watcher extracts a GraphQL query, it calls\n * this to store the query with its component.\n * @private\n */\nactions.replaceComponentQuery = ({\n  query,\n  componentPath,\n}: {\n  query: string,\n  componentPath: string,\n}) => {\n  return {\n    type: `REPLACE_COMPONENT_QUERY`,\n    payload: {\n      query,\n      componentPath,\n    },\n  }\n}\n\n/**\n * When the query watcher extracts a \"static\" GraphQL query from <StaticQuery>\n * components, it calls this to store the query with its component.\n * @private\n */\nactions.replaceStaticQuery = (args: any, plugin?: ?Plugin = null) => {\n  return {\n    type: `REPLACE_STATIC_QUERY`,\n    plugin,\n    payload: args,\n  }\n}\n\n/**\n * Merge additional configuration into the current webpack config. A few\n * configurations options will be ignored if set, in order to try prevent accidental breakage.\n * Specifically, any change to `entry`, `output`, `target`, or `resolveLoaders` will be ignored.\n *\n * For full control over the webpack config, use `replaceWebpackConfig()`.\n *\n * @param {Object} config partial webpack config, to be merged into the current one\n */\nactions.setWebpackConfig = (config: Object, plugin?: ?Plugin = null) => {\n  return {\n    type: `SET_WEBPACK_CONFIG`,\n    plugin,\n    payload: config,\n  }\n}\n\n/**\n * Completely replace the webpack config for the current stage. This can be\n * dangerous and break Gatsby if certain configuration options are changed.\n *\n * Generally only useful for cases where you need to handle config merging logic\n * yourself, in which case consider using `webpack-merge`.\n *\n * @param {Object} config complete webpack config\n */\nactions.replaceWebpackConfig = (config: Object, plugin?: ?Plugin = null) => {\n  return {\n    type: `REPLACE_WEBPACK_CONFIG`,\n    plugin,\n    payload: config,\n  }\n}\n\n/**\n * Set top-level Babel options. Plugins and presets will be ignored. Use\n * setBabelPlugin and setBabelPreset for this.\n * @param {Object} config An options object in the shape of a normal babelrc JavaScript object\n * @example\n * setBabelOptions({\n *   options: {\n *     sourceMaps: `inline`,\n *   }\n * })\n */\nactions.setBabelOptions = (options: Object, plugin?: ?Plugin = null) => {\n  // Validate\n  let name = `The plugin \"${plugin.name}\"`\n  if (plugin.name === `default-site-plugin`) {\n    name = `Your site's \"gatsby-node.js\"`\n  }\n  if (!_.isObject(options)) {\n    console.log(`${name} must pass an object to \"setBabelOptions\"`)\n    console.log(JSON.stringify(options, null, 4))\n    if (process.env.NODE_ENV !== `test`) {\n      process.exit(1)\n    }\n  }\n\n  if (!_.isObject(options.options)) {\n    console.log(`${name} must pass options to \"setBabelOptions\"`)\n    console.log(JSON.stringify(options, null, 4))\n    if (process.env.NODE_ENV !== `test`) {\n      process.exit(1)\n    }\n  }\n\n  return {\n    type: `SET_BABEL_OPTIONS`,\n    plugin,\n    payload: options,\n  }\n}\n\n/**\n * Add new plugins or merge options into existing Babel plugins.\n * @param {Object} config A config object describing the Babel plugin to be added.\n * @param {string} config.name The name of the Babel plugin\n * @param {Object} config.options Options to pass to the Babel plugin.\n * @example\n * setBabelPlugin({\n *   name:  `babel-plugin-emotion`,\n *   options: {\n *     sourceMap: true,\n *   },\n * })\n */\nactions.setBabelPlugin = (config: Object, plugin?: ?Plugin = null) => {\n  // Validate\n  let name = `The plugin \"${plugin.name}\"`\n  if (plugin.name === `default-site-plugin`) {\n    name = `Your site's \"gatsby-node.js\"`\n  }\n  if (!config.name) {\n    console.log(`${name} must set the name of the Babel plugin`)\n    console.log(JSON.stringify(config, null, 4))\n    if (process.env.NODE_ENV !== `test`) {\n      process.exit(1)\n    }\n  }\n  if (!config.options) {\n    config.options = {}\n  }\n  return {\n    type: `SET_BABEL_PLUGIN`,\n    plugin,\n    payload: config,\n  }\n}\n\n/**\n * Add new presets or merge options into existing Babel presets.\n * @param {Object} config A config object describing the Babel plugin to be added.\n * @param {string} config.name The name of the Babel preset.\n * @param {Object} config.options Options to pass to the Babel preset.\n * @example\n * setBabelPreset({\n *   name: `@babel/preset-react`,\n *   options: {\n *     pragma: `Glamor.createElement`,\n *   },\n * })\n */\nactions.setBabelPreset = (config: Object, plugin?: ?Plugin = null) => {\n  // Validate\n  let name = `The plugin \"${plugin.name}\"`\n  if (plugin.name === `default-site-plugin`) {\n    name = `Your site's \"gatsby-node.js\"`\n  }\n  if (!config.name) {\n    console.log(`${name} must set the name of the Babel preset`)\n    console.log(JSON.stringify(config, null, 4))\n    if (process.env.NODE_ENV !== `test`) {\n      process.exit(1)\n    }\n  }\n  if (!config.options) {\n    config.options = {}\n  }\n  return {\n    type: `SET_BABEL_PRESET`,\n    plugin,\n    payload: config,\n  }\n}\n\n/**\n * Create a \"job\". This is a long-running process that are generally\n * started as side-effects to GraphQL queries.\n * [`gatsby-plugin-sharp`](/packages/gatsby-plugin-sharp/) uses this for\n * example.\n *\n * Gatsby doesn't finish its bootstrap until all jobs are ended.\n * @param {Object} job A job object with at least an id set\n * @param {id} job.id The id of the job\n * @example\n * createJob({ id: `write file id: 123`, fileName: `something.jpeg` })\n */\nactions.createJob = (job: Job, plugin?: ?Plugin = null) => {\n  return {\n    type: `CREATE_JOB`,\n    plugin,\n    payload: job,\n  }\n}\n\n/**\n * Set (update) a \"job\". Sometimes on really long running jobs you want\n * to update the job as it continues.\n *\n * @param {Object} job A job object with at least an id set\n * @param {id} job.id The id of the job\n * @example\n * setJob({ id: `write file id: 123`, progress: 50 })\n */\nactions.setJob = (job: Job, plugin?: ?Plugin = null) => {\n  return {\n    type: `SET_JOB`,\n    plugin,\n    payload: job,\n  }\n}\n\n/**\n * End a \"job\".\n *\n * Gatsby doesn't finish its bootstrap until all jobs are ended.\n * @param {Object} job  A job object with at least an id set\n * @param {id} job.id The id of the job\n * @example\n * endJob({ id: `write file id: 123` })\n */\nactions.endJob = (job: Job, plugin?: ?Plugin = null) => {\n  return {\n    type: `END_JOB`,\n    plugin,\n    payload: job,\n  }\n}\n\n/**\n * Set plugin status. A plugin can use this to save status keys e.g. the last\n * it fetched something. These values are persisted between runs of Gatsby.\n *\n * @param {Object} status  An object with arbitrary values set\n * @example\n * setPluginStatus({ lastFetched: Date.now() })\n */\nactions.setPluginStatus = (\n  status: { [key: string]: mixed },\n  plugin: Plugin\n) => {\n  return {\n    type: `SET_PLUGIN_STATUS`,\n    plugin,\n    payload: status,\n  }\n}\n\n/**\n * Create a redirect from one page to another. Server redirects don't work out\n * of the box. You must have a plugin setup to integrate the redirect data with\n * your hosting technology e.g. the [Netlify\n * plugin](/packages/gatsby-plugin-netlify/)).\n *\n * @param {Object} redirect Redirect data\n * @param {string} redirect.fromPath Any valid URL. Must start with a forward slash\n * @param {boolean} redirect.isPermanent This is a permanent redirect; defaults to temporary\n * @param {string} redirect.toPath URL of a created page (see `createPage`)\n * @param {boolean} redirect.redirectInBrowser Redirects are generally for redirecting legacy URLs to their new configuration. If you can't update your UI for some reason, set `redirectInBrowser` to true and Gatsby will handle redirecting in the client as well.\n * @example\n * createRedirect({ fromPath: '/old-url', toPath: '/new-url', isPermanent: true })\n * createRedirect({ fromPath: '/url', toPath: '/zn-CH/url', Language: 'zn' })\n */\nactions.createRedirect = ({\n  fromPath,\n  isPermanent = false,\n  redirectInBrowser = false,\n  toPath,\n  ...rest\n}) => {\n  let pathPrefix = ``\n  if (store.getState().program.prefixPaths) {\n    pathPrefix = store.getState().config.pathPrefix\n  }\n\n  // Parse urls to get their protocols\n  // url.parse will not cover protocol-relative urls so do a separate check for those\n  const parsed = url.parse(toPath)\n  const isRelativeProtocol = toPath.startsWith(`//`)\n  const toPathPrefix =\n    parsed.protocol != null || isRelativeProtocol ? `` : pathPrefix\n\n  return {\n    type: `CREATE_REDIRECT`,\n    payload: {\n      fromPath: `${pathPrefix}${fromPath}`,\n      isPermanent,\n      redirectInBrowser,\n      toPath: `${toPathPrefix}${toPath}`,\n      ...rest,\n    },\n  }\n}\n\n/**\n * Add a third-party schema to be merged into main schema. Schema has to be a\n * graphql-js GraphQLSchema object.\n *\n * This schema is going to be merged as-is. This can easily break the main\n * Gatsby schema, so it's user's responsibility to make sure it doesn't happen\n * (by eg namespacing the schema).\n *\n * @param {Object} $0\n * @param {GraphQLSchema} $0.schema GraphQL schema to add\n */\nactions.addThirdPartySchema = (\n  { schema }: { schema: GraphQLSchema },\n  plugin: Plugin,\n  traceId?: string\n) => {\n  return {\n    type: `ADD_THIRD_PARTY_SCHEMA`,\n    plugin,\n    traceId,\n    payload: schema,\n  }\n}\n\n/**\n * All action creators wrapped with a dispatch.\n */\nexports.actions = actions\n\n/**\n * All action creators wrapped with a dispatch. - *DEPRECATED*\n */\nexports.boundActionCreators = bindActionCreators(actions, store.dispatch)\n"],"file":"actions.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/redux/actions.js"],"names":["Joi","require","chalk","_","bindActionCreators","stripIndent","report","path","fs","url","kebabHash","hasNodeChanged","getNode","trackInlineObjectsInRootNode","store","fileExistsSync","sync","joiSchemas","generateComponentChunkName","actions","findChildrenRecursively","children","concat","map","child","newChildren","isArray","length","deletePage","page","type","payload","pascalCase","flow","camelCase","upperFirst","hasWarnedForPageComponent","Set","fileOkCache","createPage","plugin","actionOptions","noPageOrComponent","name","message","process","env","NODE_ENV","console","log","bold","red","isObject","context","reservedFields","invalidFields","Object","keys","pick","singularMessage","pluralMessage","error","f","join","JSON","stringify","some","panic","has","component","warn","add","isAbsolute","jsonName","internalComponentName","internalPage","matchPath","componentChunkName","updatedAt","Date","now","includes","fileName","fileContent","readFileSync","notEmpty","includesDefaultExport","test","extname","relativePath","relative","getState","program","directory","panicOnBuild","deleteNode","options","args","node","get","deleteDescendantsActions","descendantNodes","n","deleteAction","deleteNodes","nodes","flatten","deleteNodesAction","typeOwners","createNode","internal","array","parent","owner","result","validate","nodeSchema","fields","Error","oldNode","id","pluginName","parentSpan","setTag","updateNodeAction","contentDigest","touchNode","nodeId","createNodeField","value","fieldName","fieldValue","fieldOwners","schemaFieldName","split","fieldOwner","createParentChildLink","push","uniq","createPageDependency","connection","deleteComponentsDependencies","paths","replaceComponentQuery","query","componentPath","replaceStaticQuery","setWebpackConfig","config","replaceWebpackConfig","setBabelOptions","exit","setBabelPlugin","setBabelPreset","createJob","job","setJob","endJob","setPluginStatus","status","createRedirect","fromPath","isPermanent","redirectInBrowser","toPath","rest","pathPrefix","prefixPaths","parsed","parse","isRelativeProtocol","startsWith","toPathPrefix","protocol","addThirdPartySchema","schema","traceId","exports","boundActionCreators","dispatch"],"mappings":";;AACA,MAAMA,GAAG,GAAGC,OAAO,CAAE,KAAF,CAAnB;;AACA,MAAMC,KAAK,GAAGD,OAAO,CAAE,OAAF,CAArB;;AACA,MAAME,CAAC,GAAGF,OAAO,CAAE,QAAF,CAAjB;;AACA,MAAM;AAAEG,EAAAA;AAAF,IAAyBH,OAAO,CAAE,OAAF,CAAtC;;AACA,MAAM;AAAEI,EAAAA;AAAF,IAAkBJ,OAAO,CAAE,aAAF,CAA/B;;AACA,MAAMK,MAAM,GAAGL,OAAO,CAAE,yBAAF,CAAtB;;AACA,MAAMM,IAAI,GAAGN,OAAO,CAAE,MAAF,CAApB;;AACA,MAAMO,EAAE,GAAGP,OAAO,CAAE,IAAF,CAAlB;;AACA,MAAMQ,GAAG,GAAGR,OAAO,CAAE,KAAF,CAAnB;;AACA,MAAMS,SAAS,GAAGT,OAAO,CAAE,YAAF,CAAzB;;AACA,MAAM;AAAEU,EAAAA,cAAF;AAAkBC,EAAAA;AAAlB,IAA8BX,OAAO,CAAE,aAAF,CAA3C;;AACA,MAAM;AAAEY,EAAAA;AAAF,IAAmCZ,OAAO,CAAE,qBAAF,CAAhD;;AACA,MAAM;AAAEa,EAAAA;AAAF,IAAYb,OAAO,CAAE,SAAF,CAAzB;;AACA,MAAMc,cAAc,GAAGd,OAAO,CAAE,kBAAF,CAAP,CAA4Be,IAAnD;;AACA,MAAMC,UAAU,GAAGhB,OAAO,CAAE,oBAAF,CAA1B;;AACA,MAAM;AAAEiB,EAAAA;AAAF,IAAiCjB,OAAO,CAAE,yBAAF,CAA9C;;AAEA,MAAMkB,OAAO,GAAG,EAAhB;;AAEA,MAAMC,uBAAuB,GAAG,CAACC,QAAQ,GAAG,EAAZ,KAAmB;AACjDA,EAAAA,QAAQ,GAAGA,QAAQ,CAACC,MAAT,CACT,GAAGD,QAAQ,CAACE,GAAT,CAAaC,KAAK,IAAI;AACvB,UAAMC,WAAW,GAAGb,OAAO,CAACY,KAAD,CAAP,CAAeH,QAAnC;;AACA,QAAIlB,CAAC,CAACuB,OAAF,CAAUD,WAAV,KAA0BA,WAAW,CAACE,MAAZ,GAAqB,CAAnD,EAAsD;AACpD,aAAOP,uBAAuB,CAACK,WAAD,CAA9B;AACD,KAFD,MAEO;AACL,aAAO,EAAP;AACD;AACF,GAPE,CADM,CAAX;AAWA,SAAOJ,QAAP;AACD,CAbD;;AA6CA;;;;;;;;AAQAF,OAAO,CAACS,UAAR,GAAsBC,IAAD,IAAqB;AACxC,SAAO;AACLC,IAAAA,IAAI,EAAG,aADF;AAELC,IAAAA,OAAO,EAAEF;AAFJ,GAAP;AAID,CALD;;AAOA,MAAMG,UAAU,GAAG7B,CAAC,CAAC8B,IAAF,CACjB9B,CAAC,CAAC+B,SADe,EAEjB/B,CAAC,CAACgC,UAFe,CAAnB;;AAIA,MAAMC,yBAAyB,GAAG,IAAIC,GAAJ,EAAlC;AACA,MAAMC,WAAW,GAAG,EAApB;AAEA;;;;;;;;;;;;;;;;;;;;;AAoBAnB,OAAO,CAACoB,UAAR,GAAqB,CACnBV,IADmB,EAEnBW,MAFmB,EAGnBC,aAHmB,KAIhB;AACH,MAAIC,iBAAiB,GAAG,KAAxB;AACA,MAAIC,IAAI,GAAI,eAAcH,MAAM,CAACG,IAAK,GAAtC;;AACA,MAAIH,MAAM,CAACG,IAAP,KAAiB,qBAArB,EAA2C;AACzCA,IAAAA,IAAI,GAAI,8BAAR;AACD;;AACD,MAAI,CAACd,IAAI,CAACtB,IAAV,EAAgB;AACd,UAAMqC,OAAO,GAAI,GAAED,IAAK,8CAAxB,CADc,CAEd;;AACA,QAAIE,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAA0B,MAA9B,EAAqC;AACnCC,MAAAA,OAAO,CAACC,GAAR,CAAY/C,KAAK,CAACgD,IAAN,CAAWC,GAAX,CAAeP,OAAf,CAAZ;AACAI,MAAAA,OAAO,CAACC,GAAR,CAAa,EAAb;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAYpB,IAAZ;AACD,KAJD,MAIO;AACL,aAAOe,OAAP;AACD;;AACDF,IAAAA,iBAAiB,GAAG,IAApB;AACD,GAjBE,CAmBH;AACA;;;AACA,MAAIvC,CAAC,CAACiD,QAAF,CAAWvB,IAAI,CAACwB,OAAhB,CAAJ,EAA8B;AAC5B,UAAMC,cAAc,GAAG,CACpB,MADoB,EAEpB,WAFoB,EAGpB,WAHoB,EAIpB,oBAJoB,EAKpB,sBALoB,EAMpB,mBANoB,CAAvB;AAQA,UAAMC,aAAa,GAAGC,MAAM,CAACC,IAAP,CAAYtD,CAAC,CAACuD,IAAF,CAAO7B,IAAI,CAACwB,OAAZ,EAAqBC,cAArB,CAAZ,CAAtB;AAEA,UAAMK,eAAe,GAAI,GAAEhB,IAAK,yEAAhC;AACA,UAAMiB,aAAa,GAAI,GAAEjB,IAAK,wEAA9B;;AACA,QAAIY,aAAa,CAAC5B,MAAd,GAAuB,CAA3B,EAA8B;AAC5B,YAAMkC,KAAK,GAAI,GACbN,aAAa,CAAC5B,MAAd,KAAyB,CAAzB,GAA6BgC,eAA7B,GAA+CC,aAChD;;EAELL,aAAa,CAAChC,GAAd,CAAkBuC,CAAC,IAAK,QAAOA,CAAE,GAAjC,EAAqCC,IAArC,CAA2C,IAA3C,CAAgD;;EAEhDC,IAAI,CAACC,SAAL,CAAepC,IAAf,EAAqB,IAArB,EAA2B,CAA3B,CAA8B;;;;;;;;;;;;;;;;EAgB9ByB,cAAc,CAAC/B,GAAf,CAAmBuC,CAAC,IAAK,QAAOA,CAAE,GAAlC,EAAsCC,IAAtC,CAA4C,IAA5C,CAAiD;;aAtB7C;;AAyBA,UAAIlB,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAA0B,MAA9B,EAAqC;AACnC,eAAOc,KAAP,CADmC,CAEnC;AACA;AACA;AACD,OALD,MAKO,IAAIN,aAAa,CAACW,IAAd,CAAmBJ,CAAC,IAAIjC,IAAI,CAACwB,OAAL,CAAaS,CAAb,MAAoBjC,IAAI,CAACiC,CAAD,CAAhD,CAAJ,EAA0D;AAC/DxD,QAAAA,MAAM,CAAC6D,KAAP,CAAaN,KAAb;AACD,OAFM,MAEA;AACL,YAAI,CAACzB,yBAAyB,CAACgC,GAA1B,CAA8BvC,IAAI,CAACwC,SAAnC,CAAL,EAAoD;AAClD/D,UAAAA,MAAM,CAACgE,IAAP,CAAYT,KAAZ;AACAzB,UAAAA,yBAAyB,CAACmC,GAA1B,CAA8B1C,IAAI,CAACwC,SAAnC;AACD;AACF;AACF;AACF,GA1EE,CA4EH;AACA;;;AACA,MAAIxB,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAA0B,MAA9B,EAAqC;AACnC,QAAI,CAAChC,cAAc,CAACc,IAAI,CAACwC,SAAN,CAAnB,EAAqC;AACnC,YAAMzB,OAAO,GAAI,GAAED,IAAK,qDAAxB;AACAK,MAAAA,OAAO,CAACC,GAAR,CAAa,EAAb;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAY/C,KAAK,CAACgD,IAAN,CAAWC,GAAX,CAAeP,OAAf,CAAZ;AACAI,MAAAA,OAAO,CAACC,GAAR,CAAa,EAAb;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAYpB,IAAZ;AACAa,MAAAA,iBAAiB,GAAG,IAApB;AACD;AACF;;AAED,MAAI,CAACb,IAAI,CAACwC,SAAN,IAAmB,CAAC9D,IAAI,CAACiE,UAAL,CAAgB3C,IAAI,CAACwC,SAArB,CAAxB,EAAyD;AACvD,UAAMzB,OAAO,GAAI,GAAED,IAAK,+EAAxB,CADuD,CAEvD;;AACA,QAAIE,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAA0B,MAA9B,EAAqC;AACnCC,MAAAA,OAAO,CAACC,GAAR,CAAa,EAAb;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAY/C,KAAK,CAACgD,IAAN,CAAWC,GAAX,CAAeP,OAAf,CAAZ;AACAI,MAAAA,OAAO,CAACC,GAAR,CAAa,EAAb;AACAD,MAAAA,OAAO,CAACC,GAAR,CAAYpB,IAAZ;AACD,KALD,MAKO;AACL,aAAOe,OAAP;AACD;;AACDF,IAAAA,iBAAiB,GAAG,IAApB;AACD;;AAED,MAAIA,iBAAJ,EAAuB;AACrBpC,IAAAA,MAAM,CAAC6D,KAAP,CACG,sGADH;AAGD;;AAED,MAAIM,QAAJ;AACA,MAAIC,qBAAJ;;AACA,MAAI7C,IAAI,CAACtB,IAAL,KAAe,GAAnB,EAAuB;AACrBkE,IAAAA,QAAQ,GAAI,OAAZ;AACAC,IAAAA,qBAAqB,GAAI,gBAAzB;AACD,GAHD,MAGO;AACLD,IAAAA,QAAQ,GAAI,GAAE/D,SAAS,CAACmB,IAAI,CAACtB,IAAN,CAAY,EAAnC;AACAmE,IAAAA,qBAAqB,GAAI,YAAW1C,UAAU,CAACH,IAAI,CAACtB,IAAN,CAAY,EAA1D;AACD;;AAED,MAAIoE,YAAkB,GAAG;AACvBF,IAAAA,QADuB;AAEvBC,IAAAA,qBAFuB;AAGvBnE,IAAAA,IAAI,EAAEsB,IAAI,CAACtB,IAHY;AAIvBqE,IAAAA,SAAS,EAAE/C,IAAI,CAAC+C,SAJO;AAKvBP,IAAAA,SAAS,EAAExC,IAAI,CAACwC,SALO;AAMvBQ,IAAAA,kBAAkB,EAAE3D,0BAA0B,CAACW,IAAI,CAACwC,SAAN,CANvB;AAOvB;AACAhB,IAAAA,OAAO,EAAExB,IAAI,CAACwB,OAAL,IAAgB,EARF;AASvByB,IAAAA,SAAS,EAAEC,IAAI,CAACC,GAAL,EATY,CAYzB;;AAZyB,GAAzB;;AAaA,MAAIL,YAAY,CAACpE,IAAb,CAAkB,CAAlB,MAA0B,GAA9B,EAAkC;AAChCoE,IAAAA,YAAY,CAACpE,IAAb,GAAqB,IAAGoE,YAAY,CAACpE,IAAK,EAA1C;AACD,GAtIE,CAwIH;AACA;AACA;AACA;;;AACA,MACE,CAACoE,YAAY,CAACN,SAAb,CAAuBY,QAAvB,CAAiC,UAAjC,CAAD,IACCpC,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAA0B,YAA1B,IACC,CAACT,WAAW,CAACqC,YAAY,CAACN,SAAd,CAHhB,EAIE;AACA,UAAMa,QAAQ,GAAGP,YAAY,CAACN,SAA9B;AACA,UAAMc,WAAW,GAAG3E,EAAE,CAAC4E,YAAH,CAAgBF,QAAhB,EAA2B,OAA3B,CAApB;AACA,QAAIG,QAAQ,GAAG,IAAf;AACA,QAAIC,qBAAqB,GAAG,IAA5B;;AAEA,QAAIH,WAAW,KAAM,EAArB,EAAwB;AACtBE,MAAAA,QAAQ,GAAG,KAAX;AACD;;AAED,QACE,CAACF,WAAW,CAACF,QAAZ,CAAsB,gBAAtB,CAAD,IACA,CAACE,WAAW,CAACF,QAAZ,CAAsB,gBAAtB,CADD,IAEA,CAACE,WAAW,CAACF,QAAZ,CAAsB,iBAAtB,CAFD,IAGA;AACA,oBAAgBM,IAAhB,CAAqBhF,IAAI,CAACiF,OAAL,CAAaN,QAAb,CAArB,CALF,EAME;AACAI,MAAAA,qBAAqB,GAAG,KAAxB;AACD;;AACD,QAAI,CAACD,QAAD,IAAa,CAACC,qBAAlB,EAAyC;AACvC,YAAMG,YAAY,GAAGlF,IAAI,CAACmF,QAAL,CACnB5E,KAAK,CAAC6E,QAAN,GAAiBC,OAAjB,CAAyBC,SADN,EAEnBX,QAFmB,CAArB;;AAKA,UAAI,CAACG,QAAL,EAAe;AACb/E,QAAAA,MAAM,CAACwF,YAAP,CACG,2DAA0DL,YAAa,kDAD1E;AAGD;;AAED,UAAI,CAACH,qBAAL,EAA4B;AAC1BhF,QAAAA,MAAM,CAACwF,YAAP,CACG,IAAGZ,QAAS,uEADf;AAGD;AACF;;AAED5C,IAAAA,WAAW,CAACqC,YAAY,CAACN,SAAd,CAAX,GAAsC,IAAtC;AACD;;AAED,SAAO,EACL,GAAG5B,aADE;AAELX,IAAAA,IAAI,EAAG,aAFF;AAGLU,IAAAA,MAHK;AAILT,IAAAA,OAAO,EAAE4C;AAJJ,GAAP;AAMD,CAnMD;AAqMA;;;;;;;;;AAOAxD,OAAO,CAAC4E,UAAR,GAAqB,CAACC,OAAD,EAAexD,MAAf,EAA+B,GAAGyD,IAAlC,KAA2C;AAC9D,MAAIC,IAAI,GAAG/F,CAAC,CAACgG,GAAF,CAAMH,OAAN,EAAgB,MAAhB,CAAX,CAD8D,CAG9D;AACA;;;AACA,MAAI,OAAOA,OAAP,KAAoB,QAAxB,EAAiC;AAC/BhD,IAAAA,OAAO,CAACsB,IAAR,CACG,8HADH;;AAIA,QAAI2B,IAAI,CAAC,CAAD,CAAJ,IAAWA,IAAI,CAAC,CAAD,CAAJ,CAAQtD,IAAvB,EAA6B;AAC3B;AACAK,MAAAA,OAAO,CAACC,GAAR,CAAa,8BAA6BgD,IAAI,CAAC,CAAD,CAAJ,CAAQtD,IAAK,EAAvD;AACD;;AAEDuD,IAAAA,IAAI,GAAGtF,OAAO,CAACoF,OAAD,CAAd;AACD;;AAED,MAAII,wBAAJ,CAlB8D,CAmB9D;AACA;;AACA,MAAIF,IAAJ,EAAU;AACR;AACA,UAAMG,eAAe,GAAGjF,uBAAuB,CAAC8E,IAAI,CAAC7E,QAAN,CAA/C;;AACA,QAAIgF,eAAe,CAAC1E,MAAhB,GAAyB,CAA7B,EAAgC;AAC9ByE,MAAAA,wBAAwB,GAAGC,eAAe,CAAC9E,GAAhB,CAAoB+E,CAAC,IAC9CnF,OAAO,CAAC4E,UAAR,CAAmB;AAAEG,QAAAA,IAAI,EAAEtF,OAAO,CAAC0F,CAAD;AAAf,OAAnB,EAAyC9D,MAAzC,CADyB,CAA3B;AAGD;AACF;;AAED,QAAM+D,YAAY,GAAG;AACnBzE,IAAAA,IAAI,EAAG,aADY;AAEnBU,IAAAA,MAFmB;AAGnBT,IAAAA,OAAO,EAAEmE;AAHU,GAArB;;AAMA,MAAIE,wBAAJ,EAA8B;AAC5B,WAAO,CAAC,GAAGA,wBAAJ,EAA8BG,YAA9B,CAAP;AACD,GAFD,MAEO;AACL,WAAOA,YAAP;AACD;AACF,CA1CD;AA4CA;;;;;;;;AAMApF,OAAO,CAACqF,WAAR,GAAsB,CAACC,KAAD,EAAejE,MAAf,KAAkC;AACtDQ,EAAAA,OAAO,CAACC,GAAR,CACG,+GADH;;AAGA,MAAIT,MAAM,IAAIA,MAAM,CAACG,IAArB,EAA2B;AACzBK,IAAAA,OAAO,CAACC,GAAR,CAAa,+BAA8BT,MAAM,CAACG,IAAK,EAAvD;AACD,GANqD,CAQtD;;;AACA,QAAM0D,eAAe,GAAGlG,CAAC,CAACuG,OAAF,CACtBD,KAAK,CAAClF,GAAN,CAAU+E,CAAC,IAAIlF,uBAAuB,CAACR,OAAO,CAAC0F,CAAD,CAAP,CAAWjF,QAAZ,CAAtC,CADsB,CAAxB;;AAGA,MAAI+E,wBAAJ;;AACA,MAAIC,eAAe,CAAC1E,MAAhB,GAAyB,CAA7B,EAAgC;AAC9ByE,IAAAA,wBAAwB,GAAGC,eAAe,CAAC9E,GAAhB,CAAoB+E,CAAC,IAC9CnF,OAAO,CAAC4E,UAAR,CAAmB;AAAEG,MAAAA,IAAI,EAAEtF,OAAO,CAAC0F,CAAD;AAAf,KAAnB,EAAyC9D,MAAzC,CADyB,CAA3B;AAGD;;AAED,QAAMmE,iBAAiB,GAAG;AACxB7E,IAAAA,IAAI,EAAG,cADiB;AAExBU,IAAAA,MAFwB;AAGxBT,IAAAA,OAAO,EAAE0E;AAHe,GAA1B;;AAMA,MAAIL,wBAAJ,EAA8B;AAC5B,WAAO,CAAC,GAAGA,wBAAJ,EAA8BO,iBAA9B,CAAP;AACD,GAFD,MAEO;AACL,WAAOA,iBAAP;AACD;AACF,CA9BD;;AAgCA,MAAMC,UAAU,GAAG,EAAnB;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8DAzF,OAAO,CAAC0F,UAAR,GAAqB,CACnBX,IADmB,EAEnB1D,MAFmB,EAGnBC,aAA6B,GAAG,EAHb,KAIhB;AACH,MAAI,CAACtC,CAAC,CAACiD,QAAF,CAAW8C,IAAX,CAAL,EAAuB;AACrB,WAAOlD,OAAO,CAACC,GAAR,CACL/C,KAAK,CAACgD,IAAN,CAAWC,GAAX,CACG,sEADH,CADK,CAAP;AAKD,GAPE,CASH;;;AACA,MAAI,CAAC+C,IAAI,CAACY,QAAV,EAAoB;AAClBZ,IAAAA,IAAI,CAACY,QAAL,GAAgB,EAAhB;AACD,GAZE,CAcH;;;AACA,MAAI,CAACZ,IAAI,CAACa,KAAN,IAAe,CAAC5G,CAAC,CAACuB,OAAF,CAAUwE,IAAI,CAAC7E,QAAf,CAApB,EAA8C;AAC5C6E,IAAAA,IAAI,CAAC7E,QAAL,GAAgB,EAAhB;AACD,GAjBE,CAmBH;;;AACA,MAAI,CAAC6E,IAAI,CAACc,MAAV,EAAkB;AAChBd,IAAAA,IAAI,CAACc,MAAL,GAAc,IAAd;AACD,GAtBE,CAwBH;;;AACA,MAAId,IAAI,CAACY,QAAL,CAAcG,KAAlB,EAAyB;AACvB3G,IAAAA,MAAM,CAACuD,KAAP,CAAaG,IAAI,CAACC,SAAL,CAAeiC,IAAf,EAAqB,IAArB,EAA2B,CAA3B,CAAb;AACA5F,IAAAA,MAAM,CAAC6D,KAAP,CACEjE,KAAK,CAACgD,IAAN,CAAWC,GAAX,CACG,iFADH,CADF;AAKD,GAhCE,CAkCH;;;AACA,MAAIX,MAAJ,EAAY;AACV0D,IAAAA,IAAI,CAACY,QAAL,CAAcG,KAAd,GAAsBzE,MAAM,CAACG,IAA7B;AACD;;AAED,QAAMuE,MAAM,GAAGlH,GAAG,CAACmH,QAAJ,CAAajB,IAAb,EAAmBjF,UAAU,CAACmG,UAA9B,CAAf;;AACA,MAAIF,MAAM,CAACrD,KAAX,EAAkB;AAChBb,IAAAA,OAAO,CAACC,GAAR,CAAY/C,KAAK,CAACgD,IAAN,CAAWC,GAAX,CAAgB,qCAAhB,CAAZ;AACAH,IAAAA,OAAO,CAACC,GAAR,CAAY/C,KAAK,CAACgD,IAAN,CAAWC,GAAX,CAAe+D,MAAM,CAACrD,KAAtB,CAAZ;AACAb,IAAAA,OAAO,CAACC,GAAR,CAAYiD,IAAZ;AACA,WAAO;AAAEpE,MAAAA,IAAI,EAAG,kBAAT;AAA4B+B,MAAAA,KAAK,EAAE;AAAnC,KAAP;AACD,GA7CE,CA+CH;;;AACA,MAAIqC,IAAI,CAACmB,MAAT,EAAiB;AACf,UAAM,IAAIC,KAAJ,CACJjH,WAAY;;;;;;;;;QASV2D,IAAI,CAACC,SAAL,CAAeiC,IAAf,EAAqB,IAArB,EAA2B,CAA3B,CAA8B;;;;QAI9BlC,IAAI,CAACC,SAAL,CAAezB,MAAf,EAAuB,IAAvB,EAA6B,CAA7B,CAAgC;KAd9B,CAAN;AAiBD;;AAED3B,EAAAA,4BAA4B,CAACqF,IAAD,CAA5B;AAEA,QAAMqB,OAAO,GAAG3G,OAAO,CAACsF,IAAI,CAACsB,EAAN,CAAvB,CAtEG,CAwEH;AACA;;AACA,MAAIhF,MAAJ,EAAY;AACV,QAAIiF,UAAU,GAAGjF,MAAM,CAACG,IAAxB;AAEA,QAAI,CAACiE,UAAU,CAACV,IAAI,CAACY,QAAL,CAAchF,IAAf,CAAf,EACE8E,UAAU,CAACV,IAAI,CAACY,QAAL,CAAchF,IAAf,CAAV,GAAiC2F,UAAjC,CADF,KAEK,IAAIb,UAAU,CAACV,IAAI,CAACY,QAAL,CAAchF,IAAf,CAAV,KAAmC2F,UAAvC,EACH,MAAM,IAAIH,KAAJ,CAAUjH,WAAY;sBACZoH,UAAW;;yBAERvB,IAAI,CAACY,QAAL,CAAchF,IAAK,kBACpC8E,UAAU,CAACV,IAAI,CAACY,QAAL,CAAchF,IAAf,CACX;;;;;;;UAOGkC,IAAI,CAACC,SAAL,CAAeiC,IAAf,EAAqB,IAArB,EAA2B,CAA3B,CAA8B;;;;UAI9BlC,IAAI,CAACC,SAAL,CAAezB,MAAf,EAAuB,IAAvB,EAA6B,CAA7B,CAAgC;OAhB9B,CAAN,CANQ,CAyBV;AACA;;AACA,QAAI+E,OAAO,IAAIA,OAAO,CAACT,QAAR,CAAiBG,KAAjB,KAA2BQ,UAA1C,EAAsD;AACpD,YAAM,IAAIH,KAAJ,CACJjH,WAAY;0DACsC6F,IAAI,CAACsB,EAAG;oBAC9CD,OAAO,CAACT,QAAR,CAAiBG,KAAM,yBAAwBQ,UAAW;;;SAHlE,CAAN;AAQD;AACF;;AAED,MAAIhF,aAAa,CAACiF,UAAlB,EAA8B;AAC5BjF,IAAAA,aAAa,CAACiF,UAAd,CAAyBC,MAAzB,CAAiC,QAAjC,EAA0CzB,IAAI,CAACsB,EAA/C;AACA/E,IAAAA,aAAa,CAACiF,UAAd,CAAyBC,MAAzB,CAAiC,UAAjC,EAA4CzB,IAAI,CAACsB,EAAjD;AACD;;AAED,MAAIjB,YAAJ;AACA,MAAIqB,gBAAJ,CAvHG,CAwHH;;AACA,MAAIL,OAAO,IAAI,CAAC5G,cAAc,CAACuF,IAAI,CAACsB,EAAN,EAAUtB,IAAI,CAACY,QAAL,CAAce,aAAxB,CAA9B,EAAsE;AACpED,IAAAA,gBAAgB,GAAG;AACjB9F,MAAAA,IAAI,EAAG,YADU;AAEjBU,MAAAA,MAFiB;AAGjB,SAAGC,aAHc;AAIjBV,MAAAA,OAAO,EAAEmE,IAAI,CAACsB;AAJG,KAAnB;AAMD,GAPD,MAOO;AACL;AACA;AACA,QAAID,OAAJ,EAAa;AACX,YAAMlB,eAAe,GAAGjF,uBAAuB,CAACmG,OAAO,CAAClG,QAAT,CAA/C;;AACA,UAAIgF,eAAe,CAAC1E,MAAhB,GAAyB,CAA7B,EAAgC;AAC9B4E,QAAAA,YAAY,GAAGF,eAAe,CAAC9E,GAAhB,CAAoB+E,CAAC,IAClCnF,OAAO,CAAC4E,UAAR,CAAmB;AAAEG,UAAAA,IAAI,EAAEtF,OAAO,CAAC0F,CAAD;AAAf,SAAnB,CADa,CAAf;AAGD;AACF;;AAEDsB,IAAAA,gBAAgB,GAAG;AACjB9F,MAAAA,IAAI,EAAG,aADU;AAEjBU,MAAAA,MAFiB;AAGjB,SAAGC,aAHc;AAIjBV,MAAAA,OAAO,EAAEmE;AAJQ,KAAnB;AAMD;;AAED,MAAIK,YAAJ,EAAkB;AAChB,WAAO,CAACA,YAAD,EAAeqB,gBAAf,CAAP;AACD,GAFD,MAEO;AACL,WAAOA,gBAAP;AACD;AACF,CA7JD;AA+JA;;;;;;;;;;;;;AAWAzG,OAAO,CAAC2G,SAAR,GAAoB,CAAC9B,OAAD,EAAexD,MAAf,KAAmC;AACrD,MAAIuF,MAAM,GAAG5H,CAAC,CAACgG,GAAF,CAAMH,OAAN,EAAgB,QAAhB,CAAb,CADqD,CAGrD;;;AACA,MAAI,OAAOA,OAAP,KAAoB,QAAxB,EAAiC;AAC/BhD,IAAAA,OAAO,CAACsB,IAAR,CACG,wIADH;;AAIA,QAAI9B,MAAM,IAAIA,MAAM,CAACG,IAArB,EAA2B;AACzBK,MAAAA,OAAO,CAACC,GAAR,CAAa,6BAA4BT,MAAM,CAACG,IAAK,EAArD;AACD;;AAEDoF,IAAAA,MAAM,GAAG/B,OAAT;AACD;;AAED,SAAO;AACLlE,IAAAA,IAAI,EAAG,YADF;AAELU,IAAAA,MAFK;AAGLT,IAAAA,OAAO,EAAEgG;AAHJ,GAAP;AAKD,CArBD;;AA8BA;;;;;;;;;;;;;;;;;;;;;;AAsBA5G,OAAO,CAAC6G,eAAR,GAA0B,CACxB;AAAE9B,EAAAA,IAAF;AAAQvD,EAAAA,IAAR;AAAcsF,EAAAA,KAAd;AAAqBC,EAAAA,SAArB;AAAgCC,EAAAA;AAAhC,CADwB,EAExB3F,MAFwB,EAGxBC,aAHwB,KAIrB;AACH,MAAIyF,SAAJ,EAAe;AACblF,IAAAA,OAAO,CAACsB,IAAR,CACG,8EADH;;AAGA,QAAI,CAAC3B,IAAL,EAAW;AACTA,MAAAA,IAAI,GAAGuF,SAAP;AACD;AACF;;AACD,MAAIC,UAAJ,EAAgB;AACdnF,IAAAA,OAAO,CAACsB,IAAR,CACG,gFADH;;AAGA,QAAI,CAAC2D,KAAL,EAAY;AACVA,MAAAA,KAAK,GAAGE,UAAR;AACD;AACF,GAhBE,CAiBH;;;AACA,MAAI,CAACjC,IAAI,CAACY,QAAL,CAAcsB,WAAnB,EAAgC;AAC9BlC,IAAAA,IAAI,CAACY,QAAL,CAAcsB,WAAd,GAA4B,EAA5B;AACD;;AACD,MAAI,CAAClC,IAAI,CAACmB,MAAV,EAAkB;AAChBnB,IAAAA,IAAI,CAACmB,MAAL,GAAc,EAAd;AACD;AAED;;;;;AAGA,QAAMgB,eAAe,GAAGlI,CAAC,CAAC8E,QAAF,CAAWtC,IAAX,EAAkB,SAAlB,IACpBA,IAAI,CAAC2F,KAAL,CAAY,KAAZ,EAAkB,CAAlB,CADoB,GAEpB3F,IAFJ,CA5BG,CAgCH;;AACA,QAAM4F,UAAU,GAAGrC,IAAI,CAACY,QAAL,CAAcsB,WAAd,CAA0BC,eAA1B,CAAnB;;AACA,MAAIE,UAAU,IAAIA,UAAU,KAAK/F,MAAM,CAACG,IAAxC,EAA8C;AAC5C,UAAM,IAAI2E,KAAJ,CACJjH,WAAY;;;iBAGD6F,IAAI,CAACsB,EAAG;gBACThF,MAAM,CAACG,IAAK;cACdA,IAAK;eACJsF,KAAM;OAPX,CAAN;AAUD,GA7CE,CA+CH;;;AACA/B,EAAAA,IAAI,CAACmB,MAAL,CAAY1E,IAAZ,IAAoBsF,KAApB;AACA/B,EAAAA,IAAI,CAACY,QAAL,CAAcsB,WAAd,CAA0BC,eAA1B,IAA6C7F,MAAM,CAACG,IAApD;AAEA,SAAO;AACLb,IAAAA,IAAI,EAAG,mBADF;AAELU,IAAAA,MAFK;AAGL,OAAGC,aAHE;AAILV,IAAAA,OAAO,EAAEmE;AAJJ,GAAP;AAMD,CA7DD;AA+DA;;;;;;;;;;;;;;AAYA/E,OAAO,CAACqH,qBAAR,GAAgC,CAC9B;AAAExB,EAAAA,MAAF;AAAUxF,EAAAA;AAAV,CAD8B,EAE9BgB,MAF8B,KAG3B;AACH;AACAwE,EAAAA,MAAM,CAAC3F,QAAP,CAAgBoH,IAAhB,CAAqBjH,KAAK,CAACgG,EAA3B;AACAR,EAAAA,MAAM,CAAC3F,QAAP,GAAkBlB,CAAC,CAACuI,IAAF,CAAO1B,MAAM,CAAC3F,QAAd,CAAlB;AAEA,SAAO;AACLS,IAAAA,IAAI,EAAG,+BADF;AAELU,IAAAA,MAFK;AAGLT,IAAAA,OAAO,EAAEiF;AAHJ,GAAP;AAKD,CAbD;AAeA;;;;;;;;;;;AASA7F,OAAO,CAACwH,oBAAR,GAA+B,CAC7B;AACEpI,EAAAA,IADF;AAEEwH,EAAAA,MAFF;AAGEa,EAAAA;AAHF,CAD6B,EAM7BpG,MAAc,GAAI,EANW,KAO1B;AACH,SAAO;AACLV,IAAAA,IAAI,EAAG,6BADF;AAELU,IAAAA,MAFK;AAGLT,IAAAA,OAAO,EAAE;AACPxB,MAAAA,IADO;AAEPwH,MAAAA,MAFO;AAGPa,MAAAA;AAHO;AAHJ,GAAP;AASD,CAjBD;AAmBA;;;;;;;;AAMAzH,OAAO,CAAC0H,4BAAR,GAAwCC,KAAD,IAAqB;AAC1D,SAAO;AACLhH,IAAAA,IAAI,EAAG,gCADF;AAELC,IAAAA,OAAO,EAAE;AACP+G,MAAAA;AADO;AAFJ,GAAP;AAMD,CAPD;AASA;;;;;;;AAKA3H,OAAO,CAAC4H,qBAAR,GAAgC,CAAC;AAC/BC,EAAAA,KAD+B;AAE/BC,EAAAA;AAF+B,CAAD,KAM1B;AACJ,SAAO;AACLnH,IAAAA,IAAI,EAAG,yBADF;AAELC,IAAAA,OAAO,EAAE;AACPiH,MAAAA,KADO;AAEPC,MAAAA;AAFO;AAFJ,GAAP;AAOD,CAdD;AAgBA;;;;;;;AAKA9H,OAAO,CAAC+H,kBAAR,GAA6B,CAACjD,IAAD,EAAYzD,MAAgB,GAAG,IAA/B,KAAwC;AACnE,SAAO;AACLV,IAAAA,IAAI,EAAG,sBADF;AAELU,IAAAA,MAFK;AAGLT,IAAAA,OAAO,EAAEkE;AAHJ,GAAP;AAKD,CAND;AAQA;;;;;;;;;;;AASA9E,OAAO,CAACgI,gBAAR,GAA2B,CAACC,MAAD,EAAiB5G,MAAgB,GAAG,IAApC,KAA6C;AACtE,SAAO;AACLV,IAAAA,IAAI,EAAG,oBADF;AAELU,IAAAA,MAFK;AAGLT,IAAAA,OAAO,EAAEqH;AAHJ,GAAP;AAKD,CAND;AAQA;;;;;;;;;;;AASAjI,OAAO,CAACkI,oBAAR,GAA+B,CAACD,MAAD,EAAiB5G,MAAgB,GAAG,IAApC,KAA6C;AAC1E,SAAO;AACLV,IAAAA,IAAI,EAAG,wBADF;AAELU,IAAAA,MAFK;AAGLT,IAAAA,OAAO,EAAEqH;AAHJ,GAAP;AAKD,CAND;AAQA;;;;;;;;;;;;;AAWAjI,OAAO,CAACmI,eAAR,GAA0B,CAACtD,OAAD,EAAkBxD,MAAgB,GAAG,IAArC,KAA8C;AACtE;AACA,MAAIG,IAAI,GAAI,eAAcH,MAAM,CAACG,IAAK,GAAtC;;AACA,MAAIH,MAAM,CAACG,IAAP,KAAiB,qBAArB,EAA2C;AACzCA,IAAAA,IAAI,GAAI,8BAAR;AACD;;AACD,MAAI,CAACxC,CAAC,CAACiD,QAAF,CAAW4C,OAAX,CAAL,EAA0B;AACxBhD,IAAAA,OAAO,CAACC,GAAR,CAAa,GAAEN,IAAK,2CAApB;AACAK,IAAAA,OAAO,CAACC,GAAR,CAAYe,IAAI,CAACC,SAAL,CAAe+B,OAAf,EAAwB,IAAxB,EAA8B,CAA9B,CAAZ;;AACA,QAAInD,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAA0B,MAA9B,EAAqC;AACnCF,MAAAA,OAAO,CAAC0G,IAAR,CAAa,CAAb;AACD;AACF;;AAED,MAAI,CAACpJ,CAAC,CAACiD,QAAF,CAAW4C,OAAO,CAACA,OAAnB,CAAL,EAAkC;AAChChD,IAAAA,OAAO,CAACC,GAAR,CAAa,GAAEN,IAAK,yCAApB;AACAK,IAAAA,OAAO,CAACC,GAAR,CAAYe,IAAI,CAACC,SAAL,CAAe+B,OAAf,EAAwB,IAAxB,EAA8B,CAA9B,CAAZ;;AACA,QAAInD,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAA0B,MAA9B,EAAqC;AACnCF,MAAAA,OAAO,CAAC0G,IAAR,CAAa,CAAb;AACD;AACF;;AAED,SAAO;AACLzH,IAAAA,IAAI,EAAG,mBADF;AAELU,IAAAA,MAFK;AAGLT,IAAAA,OAAO,EAAEiE;AAHJ,GAAP;AAKD,CA3BD;AA6BA;;;;;;;;;;;;;;;AAaA7E,OAAO,CAACqI,cAAR,GAAyB,CAACJ,MAAD,EAAiB5G,MAAgB,GAAG,IAApC,KAA6C;AACpE;AACA,MAAIG,IAAI,GAAI,eAAcH,MAAM,CAACG,IAAK,GAAtC;;AACA,MAAIH,MAAM,CAACG,IAAP,KAAiB,qBAArB,EAA2C;AACzCA,IAAAA,IAAI,GAAI,8BAAR;AACD;;AACD,MAAI,CAACyG,MAAM,CAACzG,IAAZ,EAAkB;AAChBK,IAAAA,OAAO,CAACC,GAAR,CAAa,GAAEN,IAAK,wCAApB;AACAK,IAAAA,OAAO,CAACC,GAAR,CAAYe,IAAI,CAACC,SAAL,CAAemF,MAAf,EAAuB,IAAvB,EAA6B,CAA7B,CAAZ;;AACA,QAAIvG,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAA0B,MAA9B,EAAqC;AACnCF,MAAAA,OAAO,CAAC0G,IAAR,CAAa,CAAb;AACD;AACF;;AACD,MAAI,CAACH,MAAM,CAACpD,OAAZ,EAAqB;AACnBoD,IAAAA,MAAM,CAACpD,OAAP,GAAiB,EAAjB;AACD;;AACD,SAAO;AACLlE,IAAAA,IAAI,EAAG,kBADF;AAELU,IAAAA,MAFK;AAGLT,IAAAA,OAAO,EAAEqH;AAHJ,GAAP;AAKD,CArBD;AAuBA;;;;;;;;;;;;;;;AAaAjI,OAAO,CAACsI,cAAR,GAAyB,CAACL,MAAD,EAAiB5G,MAAgB,GAAG,IAApC,KAA6C;AACpE;AACA,MAAIG,IAAI,GAAI,eAAcH,MAAM,CAACG,IAAK,GAAtC;;AACA,MAAIH,MAAM,CAACG,IAAP,KAAiB,qBAArB,EAA2C;AACzCA,IAAAA,IAAI,GAAI,8BAAR;AACD;;AACD,MAAI,CAACyG,MAAM,CAACzG,IAAZ,EAAkB;AAChBK,IAAAA,OAAO,CAACC,GAAR,CAAa,GAAEN,IAAK,wCAApB;AACAK,IAAAA,OAAO,CAACC,GAAR,CAAYe,IAAI,CAACC,SAAL,CAAemF,MAAf,EAAuB,IAAvB,EAA6B,CAA7B,CAAZ;;AACA,QAAIvG,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAA0B,MAA9B,EAAqC;AACnCF,MAAAA,OAAO,CAAC0G,IAAR,CAAa,CAAb;AACD;AACF;;AACD,MAAI,CAACH,MAAM,CAACpD,OAAZ,EAAqB;AACnBoD,IAAAA,MAAM,CAACpD,OAAP,GAAiB,EAAjB;AACD;;AACD,SAAO;AACLlE,IAAAA,IAAI,EAAG,kBADF;AAELU,IAAAA,MAFK;AAGLT,IAAAA,OAAO,EAAEqH;AAHJ,GAAP;AAKD,CArBD;AAuBA;;;;;;;;;;;;;;AAYAjI,OAAO,CAACuI,SAAR,GAAoB,CAACC,GAAD,EAAWnH,MAAgB,GAAG,IAA9B,KAAuC;AACzD,SAAO;AACLV,IAAAA,IAAI,EAAG,YADF;AAELU,IAAAA,MAFK;AAGLT,IAAAA,OAAO,EAAE4H;AAHJ,GAAP;AAKD,CAND;AAQA;;;;;;;;;;;AASAxI,OAAO,CAACyI,MAAR,GAAiB,CAACD,GAAD,EAAWnH,MAAgB,GAAG,IAA9B,KAAuC;AACtD,SAAO;AACLV,IAAAA,IAAI,EAAG,SADF;AAELU,IAAAA,MAFK;AAGLT,IAAAA,OAAO,EAAE4H;AAHJ,GAAP;AAKD,CAND;AAQA;;;;;;;;;;;AASAxI,OAAO,CAAC0I,MAAR,GAAiB,CAACF,GAAD,EAAWnH,MAAgB,GAAG,IAA9B,KAAuC;AACtD,SAAO;AACLV,IAAAA,IAAI,EAAG,SADF;AAELU,IAAAA,MAFK;AAGLT,IAAAA,OAAO,EAAE4H;AAHJ,GAAP;AAKD,CAND;AAQA;;;;;;;;;;AAQAxI,OAAO,CAAC2I,eAAR,GAA0B,CACxBC,MADwB,EAExBvH,MAFwB,KAGrB;AACH,SAAO;AACLV,IAAAA,IAAI,EAAG,mBADF;AAELU,IAAAA,MAFK;AAGLT,IAAAA,OAAO,EAAEgI;AAHJ,GAAP;AAKD,CATD;AAWA;;;;;;;;;;;;;;;;;AAeA5I,OAAO,CAAC6I,cAAR,GAAyB,CAAC;AACxBC,EAAAA,QADwB;AAExBC,EAAAA,WAAW,GAAG,KAFU;AAGxBC,EAAAA,iBAAiB,GAAG,KAHI;AAIxBC,EAAAA,MAJwB;AAKxB,KAAGC;AALqB,CAAD,KAMnB;AACJ,MAAIC,UAAU,GAAI,EAAlB;;AACA,MAAIxJ,KAAK,CAAC6E,QAAN,GAAiBC,OAAjB,CAAyB2E,WAA7B,EAA0C;AACxCD,IAAAA,UAAU,GAAGxJ,KAAK,CAAC6E,QAAN,GAAiByD,MAAjB,CAAwBkB,UAArC;AACD,GAJG,CAMJ;AACA;;;AACA,QAAME,MAAM,GAAG/J,GAAG,CAACgK,KAAJ,CAAUL,MAAV,CAAf;AACA,QAAMM,kBAAkB,GAAGN,MAAM,CAACO,UAAP,CAAmB,IAAnB,CAA3B;AACA,QAAMC,YAAY,GAChBJ,MAAM,CAACK,QAAP,IAAmB,IAAnB,IAA2BH,kBAA3B,GAAiD,EAAjD,GAAqDJ,UADvD;AAGA,SAAO;AACLxI,IAAAA,IAAI,EAAG,iBADF;AAELC,IAAAA,OAAO,EAAE;AACPkI,MAAAA,QAAQ,EAAG,GAAEK,UAAW,GAAEL,QAAS,EAD5B;AAEPC,MAAAA,WAFO;AAGPC,MAAAA,iBAHO;AAIPC,MAAAA,MAAM,EAAG,GAAEQ,YAAa,GAAER,MAAO,EAJ1B;AAKP,SAAGC;AALI;AAFJ,GAAP;AAUD,CA7BD;AA+BA;;;;;;;;;;;;;AAWAlJ,OAAO,CAAC2J,mBAAR,GAA8B,CAC5B;AAAEC,EAAAA;AAAF,CAD4B,EAE5BvI,MAF4B,EAG5BwI,OAH4B,KAIzB;AACH,SAAO;AACLlJ,IAAAA,IAAI,EAAG,wBADF;AAELU,IAAAA,MAFK;AAGLwI,IAAAA,OAHK;AAILjJ,IAAAA,OAAO,EAAEgJ;AAJJ,GAAP;AAMD,CAXD;AAaA;;;;;AAGAE,OAAO,CAAC9J,OAAR,GAAkBA,OAAlB;AAEA;;;;AAGA8J,OAAO,CAACC,mBAAR,GAA8B9K,kBAAkB,CAACe,OAAD,EAAUL,KAAK,CAACqK,QAAhB,CAAhD","sourcesContent":["// @flow\nconst Joi = require(`joi`)\nconst chalk = require(`chalk`)\nconst _ = require(`lodash`)\nconst { bindActionCreators } = require(`redux`)\nconst { stripIndent } = require(`common-tags`)\nconst report = require(`gatsby-cli/lib/reporter`)\nconst path = require(`path`)\nconst fs = require(`fs`)\nconst url = require(`url`)\nconst kebabHash = require(`kebab-hash`)\nconst { hasNodeChanged, getNode } = require(`../db/nodes`)\nconst { trackInlineObjectsInRootNode } = require(`../db/node-tracking`)\nconst { store } = require(`./index`)\nconst fileExistsSync = require(`fs-exists-cached`).sync\nconst joiSchemas = require(`../joi-schemas/joi`)\nconst { generateComponentChunkName } = require(`../utils/js-chunk-names`)\n\nconst actions = {}\n\nconst findChildrenRecursively = (children = []) => {\n  children = children.concat(\n    ...children.map(child => {\n      const newChildren = getNode(child).children\n      if (_.isArray(newChildren) && newChildren.length > 0) {\n        return findChildrenRecursively(newChildren)\n      } else {\n        return []\n      }\n    })\n  )\n\n  return children\n}\n\ntype Job = {\n  id: string,\n}\ntype PageInput = {\n  path: string,\n  component: string,\n  context?: Object,\n}\n\ntype Page = {\n  path: string,\n  matchPath: ?string,\n  component: string,\n  context: Object,\n  internalComponentName: string,\n  jsonName: string,\n  componentChunkName: string,\n  updatedAt: number,\n}\n\ntype Plugin = {\n  name: string,\n}\n\ntype ActionOptions = {\n  traceId: ?string,\n  parentSpan: ?Object,\n  followsSpan: ?Object,\n}\n\n/**\n * Delete a page\n * @param {Object} page a page object\n * @param {string} page.path The path of the page\n * @param {string} page.component The absolute path to the page component\n * @example\n * deletePage(page)\n */\nactions.deletePage = (page: PageInput) => {\n  return {\n    type: `DELETE_PAGE`,\n    payload: page,\n  }\n}\n\nconst pascalCase = _.flow(\n  _.camelCase,\n  _.upperFirst\n)\nconst hasWarnedForPageComponent = new Set()\nconst fileOkCache = {}\n\n/**\n * Create a page. See [the guide on creating and modifying pages](/docs/creating-and-modifying-pages/)\n * for detailed documentation about creating pages.\n * @param {Object} page a page object\n * @param {string} page.path Any valid URL. Must start with a forward slash\n * @param {string} page.component The absolute path to the component for this page\n * @param {Object} page.context Context data for this page. Passed as props\n * to the component `this.props.pageContext` as well as to the graphql query\n * as graphql arguments.\n * @example\n * createPage({\n *   path: `/my-sweet-new-page/`,\n *   component: path.resolve(`./src/templates/my-sweet-new-page.js`),\n *   // The context is passed as props to the component as well\n *   // as into the component's GraphQL query.\n *   context: {\n *     id: `123456`,\n *   },\n * })\n */\nactions.createPage = (\n  page: PageInput,\n  plugin?: Plugin,\n  actionOptions?: ActionOptions\n) => {\n  let noPageOrComponent = false\n  let name = `The plugin \"${plugin.name}\"`\n  if (plugin.name === `default-site-plugin`) {\n    name = `Your site's \"gatsby-node.js\"`\n  }\n  if (!page.path) {\n    const message = `${name} must set the page path when creating a page`\n    // Don't log out when testing\n    if (process.env.NODE_ENV !== `test`) {\n      console.log(chalk.bold.red(message))\n      console.log(``)\n      console.log(page)\n    } else {\n      return message\n    }\n    noPageOrComponent = true\n  }\n\n  // Validate that the context object doesn't overlap with any core page fields\n  // as this will cause trouble when running graphql queries.\n  if (_.isObject(page.context)) {\n    const reservedFields = [\n      `path`,\n      `matchPath`,\n      `component`,\n      `componentChunkName`,\n      `pluginCreator___NODE`,\n      `pluginCreatorName`,\n    ]\n    const invalidFields = Object.keys(_.pick(page.context, reservedFields))\n\n    const singularMessage = `${name} used a reserved field name in the context object when creating a page:`\n    const pluralMessage = `${name} used reserved field names in the context object when creating a page:`\n    if (invalidFields.length > 0) {\n      const error = `${\n        invalidFields.length === 1 ? singularMessage : pluralMessage\n      }\n\n${invalidFields.map(f => `  * \"${f}\"`).join(`\\n`)}\n\n${JSON.stringify(page, null, 4)}\n\nData in \"context\" is passed to GraphQL as potential arguments when running the\npage query.\n\nWhen arguments for GraphQL are constructed, the context object is combined with\nthe page object so *both* page object and context data are available as\narguments. So you don't need to add the page \"path\" to the context as it's\nalready available in GraphQL. If a context field duplicates a field already\nused by the page object, this can break functionality within Gatsby so must be\navoided.\n\nPlease choose another name for the conflicting fields.\n\nThe following fields are used by the page object and should be avoided.\n\n${reservedFields.map(f => `  * \"${f}\"`).join(`\\n`)}\n\n            `\n      if (process.env.NODE_ENV === `test`) {\n        return error\n        // Only error if the context version is different than the page\n        // version.  People in v1 often thought that they needed to also pass\n        // the path to context for it to be available in GraphQL\n      } else if (invalidFields.some(f => page.context[f] !== page[f])) {\n        report.panic(error)\n      } else {\n        if (!hasWarnedForPageComponent.has(page.component)) {\n          report.warn(error)\n          hasWarnedForPageComponent.add(page.component)\n        }\n      }\n    }\n  }\n\n  // Don't check if the component exists during tests as we use a lot of fake\n  // component paths.\n  if (process.env.NODE_ENV !== `test`) {\n    if (!fileExistsSync(page.component)) {\n      const message = `${name} created a page with a component that doesn't exist`\n      console.log(``)\n      console.log(chalk.bold.red(message))\n      console.log(``)\n      console.log(page)\n      noPageOrComponent = true\n    }\n  }\n\n  if (!page.component || !path.isAbsolute(page.component)) {\n    const message = `${name} must set the absolute path to the page component when create creating a page`\n    // Don't log out when testing\n    if (process.env.NODE_ENV !== `test`) {\n      console.log(``)\n      console.log(chalk.bold.red(message))\n      console.log(``)\n      console.log(page)\n    } else {\n      return message\n    }\n    noPageOrComponent = true\n  }\n\n  if (noPageOrComponent) {\n    report.panic(\n      `See the documentation for createPage https://www.gatsbyjs.org/docs/bound-action-creators/#createPage`\n    )\n  }\n\n  let jsonName\n  let internalComponentName\n  if (page.path === `/`) {\n    jsonName = `index`\n    internalComponentName = `ComponentIndex`\n  } else {\n    jsonName = `${kebabHash(page.path)}`\n    internalComponentName = `Component${pascalCase(page.path)}`\n  }\n\n  let internalPage: Page = {\n    jsonName,\n    internalComponentName,\n    path: page.path,\n    matchPath: page.matchPath,\n    component: page.component,\n    componentChunkName: generateComponentChunkName(page.component),\n    // Ensure the page has a context object\n    context: page.context || {},\n    updatedAt: Date.now(),\n  }\n\n  // If the path doesn't have an initial forward slash, add it.\n  if (internalPage.path[0] !== `/`) {\n    internalPage.path = `/${internalPage.path}`\n  }\n\n  // Validate that the page component imports React and exports something\n  // (hopefully a component).\n  //\n  // Only run validation once during builds.\n  if (\n    !internalPage.component.includes(`/.cache/`) &&\n    (process.env.NODE_ENV === `production` &&\n      !fileOkCache[internalPage.component])\n  ) {\n    const fileName = internalPage.component\n    const fileContent = fs.readFileSync(fileName, `utf-8`)\n    let notEmpty = true\n    let includesDefaultExport = true\n\n    if (fileContent === ``) {\n      notEmpty = false\n    }\n\n    if (\n      !fileContent.includes(`export default`) &&\n      !fileContent.includes(`module.exports`) &&\n      !fileContent.includes(`exports.default`) &&\n      // this check only applies to js and ts, not mdx\n      /\\.(jsx?|tsx?)/.test(path.extname(fileName))\n    ) {\n      includesDefaultExport = false\n    }\n    if (!notEmpty || !includesDefaultExport) {\n      const relativePath = path.relative(\n        store.getState().program.directory,\n        fileName\n      )\n\n      if (!notEmpty) {\n        report.panicOnBuild(\n          `You have an empty file in the \"src/pages\" directory at \"${relativePath}\". Please remove it or make it a valid component`\n        )\n      }\n\n      if (!includesDefaultExport) {\n        report.panicOnBuild(\n          `[${fileName}] The page component must export a React component for it to be valid`\n        )\n      }\n    }\n\n    fileOkCache[internalPage.component] = true\n  }\n\n  return {\n    ...actionOptions,\n    type: `CREATE_PAGE`,\n    plugin,\n    payload: internalPage,\n  }\n}\n\n/**\n * Delete a node\n * @param {object} $0\n * @param {object} $0.node the node object\n * @example\n * deleteNode({node: node})\n */\nactions.deleteNode = (options: any, plugin: Plugin, ...args) => {\n  let node = _.get(options, `node`)\n\n  // Check if using old method signature. Warn about incorrect usage but get\n  // node from nodeID anyway.\n  if (typeof options === `string`) {\n    console.warn(\n      `Calling \"deleteNode\" with a nodeId is deprecated. Please pass an object containing a full node instead: deleteNode({ node })`\n    )\n\n    if (args[0] && args[0].name) {\n      // `plugin` used to be the third argument\n      console.log(`\"deleteNode\" was called by ${args[0].name}`)\n    }\n\n    node = getNode(options)\n  }\n\n  let deleteDescendantsActions\n  // It's possible the file node was never created as sometimes tools will\n  // write and then immediately delete temporary files to the file system.\n  if (node) {\n    // Also delete any nodes transformed from this one.\n    const descendantNodes = findChildrenRecursively(node.children)\n    if (descendantNodes.length > 0) {\n      deleteDescendantsActions = descendantNodes.map(n =>\n        actions.deleteNode({ node: getNode(n) }, plugin)\n      )\n    }\n  }\n\n  const deleteAction = {\n    type: `DELETE_NODE`,\n    plugin,\n    payload: node,\n  }\n\n  if (deleteDescendantsActions) {\n    return [...deleteDescendantsActions, deleteAction]\n  } else {\n    return deleteAction\n  }\n}\n\n/**\n * Batch delete nodes\n * @param {Array} nodes an array of node ids\n * @example\n * deleteNodes([`node1`, `node2`])\n */\nactions.deleteNodes = (nodes: any[], plugin: Plugin) => {\n  console.log(\n    `The \"deleteNodes\" action is now deprecated and will be removed in Gatsby v3. Please use \"deleteNode\" instead.`\n  )\n  if (plugin && plugin.name) {\n    console.log(`\"deleteNodes\" was called by ${plugin.name}`)\n  }\n\n  // Also delete any nodes transformed from these.\n  const descendantNodes = _.flatten(\n    nodes.map(n => findChildrenRecursively(getNode(n).children))\n  )\n  let deleteDescendantsActions\n  if (descendantNodes.length > 0) {\n    deleteDescendantsActions = descendantNodes.map(n =>\n      actions.deleteNode({ node: getNode(n) }, plugin)\n    )\n  }\n\n  const deleteNodesAction = {\n    type: `DELETE_NODES`,\n    plugin,\n    payload: nodes,\n  }\n\n  if (deleteDescendantsActions) {\n    return [...deleteDescendantsActions, deleteNodesAction]\n  } else {\n    return deleteNodesAction\n  }\n}\n\nconst typeOwners = {}\n/**\n * Create a new node.\n * @param {Object} node a node object\n * @param {string} node.id The node's ID. Must be globally unique.\n * @param {string} node.parent The ID of the parent's node. If the node is\n * derived from another node, set that node as the parent. Otherwise it can\n * just be `null`.\n * @param {Array} node.children An array of children node IDs. If you're\n * creating the children nodes while creating the parent node, add the\n * children node IDs here directly. If you're adding a child node to a\n * parent node created by a plugin, you can't mutate this value directly\n * to add your node id, instead use the action creator `createParentChildLink`.\n * @param {Object} node.internal node fields that aren't generally\n * interesting to consumers of node data but are very useful for plugin writers\n * and Gatsby core.\n * @param {string} node.internal.mediaType An optional field to indicate to\n * transformer plugins that your node has raw content they can transform.\n * Use either an official media type (we use mime-db as our source\n * (https://www.npmjs.com/package/mime-db) or a made-up one if your data\n * doesn't fit in any existing bucket. Transformer plugins use node media types\n * for deciding if they should transform a node into a new one. E.g.\n * markdown transformers look for media types of\n * `text/markdown`.\n * @param {string} node.internal.type An arbitrary globally unique type\n * choosen by the plugin creating the node. Should be descriptive of the\n * node as the type is used in forming GraphQL types so users will query\n * for nodes based on the type choosen here. Nodes of a given type can\n * only be created by one plugin.\n * @param {string} node.internal.content An optional field. The raw content\n * of the node. Can be excluded if it'd require a lot of memory to load in\n * which case you must define a `loadNodeContent` function for this node.\n * @param {string} node.internal.contentDigest the digest for the content\n * of this node. Helps Gatsby avoid doing extra work on data that hasn't\n * changed.\n * @param {string} node.internal.description An optional field. Human\n * readable description of what this node represent / its source. It will\n * be displayed when type conflicts are found, making it easier to find\n * and correct type conflicts.\n * @example\n * createNode({\n *   // Data for the node.\n *   field1: `a string`,\n *   field2: 10,\n *   field3: true,\n *   ...arbitraryOtherData,\n *\n *   // Required fields.\n *   id: `a-node-id`,\n *   parent: `the-id-of-the-parent-node`, // or null if it's a source node without a parent\n *   children: [],\n *   internal: {\n *     type: `CoolServiceMarkdownField`,\n *     contentDigest: crypto\n *       .createHash(`md5`)\n *       .update(JSON.stringify(fieldData))\n *       .digest(`hex`),\n *     mediaType: `text/markdown`, // optional\n *     content: JSON.stringify(fieldData), // optional\n *     description: `Cool Service: \"Title of entry\"`, // optional\n *   }\n * })\n */\nactions.createNode = (\n  node: any,\n  plugin?: Plugin,\n  actionOptions?: ActionOptions = {}\n) => {\n  if (!_.isObject(node)) {\n    return console.log(\n      chalk.bold.red(\n        `The node passed to the \"createNode\" action creator must be an object`\n      )\n    )\n  }\n\n  // Ensure the new node has an internals object.\n  if (!node.internal) {\n    node.internal = {}\n  }\n\n  // Ensure the new node has a children array.\n  if (!node.array && !_.isArray(node.children)) {\n    node.children = []\n  }\n\n  // Ensure the new node has a parent field\n  if (!node.parent) {\n    node.parent = null\n  }\n\n  // Tell user not to set the owner name themself.\n  if (node.internal.owner) {\n    report.error(JSON.stringify(node, null, 4))\n    report.panic(\n      chalk.bold.red(\n        `The node internal.owner field is set automatically by Gatsby and not by plugins`\n      )\n    )\n  }\n\n  // Add the plugin name to the internal object.\n  if (plugin) {\n    node.internal.owner = plugin.name\n  }\n\n  const result = Joi.validate(node, joiSchemas.nodeSchema)\n  if (result.error) {\n    console.log(chalk.bold.red(`The new node didn't pass validation`))\n    console.log(chalk.bold.red(result.error))\n    console.log(node)\n    return { type: `VALIDATION_ERROR`, error: true }\n  }\n\n  // Ensure node isn't directly setting fields.\n  if (node.fields) {\n    throw new Error(\n      stripIndent`\n      Plugins creating nodes can not set data on the reserved field \"fields\"\n      as this is reserved for plugins which wish to extend your nodes.\n\n      If your plugin didn't add \"fields\" you're probably seeing this\n      error because you're reusing an old node object.\n\n      Node:\n\n      ${JSON.stringify(node, null, 4)}\n\n      Plugin that created the node:\n\n      ${JSON.stringify(plugin, null, 4)}\n    `\n    )\n  }\n\n  trackInlineObjectsInRootNode(node)\n\n  const oldNode = getNode(node.id)\n\n  // Ensure the plugin isn't creating a node type owned by another\n  // plugin. Type \"ownership\" is first come first served.\n  if (plugin) {\n    let pluginName = plugin.name\n\n    if (!typeOwners[node.internal.type])\n      typeOwners[node.internal.type] = pluginName\n    else if (typeOwners[node.internal.type] !== pluginName)\n      throw new Error(stripIndent`\n        The plugin \"${pluginName}\" created a node of a type owned by another plugin.\n\n        The node type \"${node.internal.type}\" is owned by \"${\n        typeOwners[node.internal.type]\n      }\".\n\n        If you copy and pasted code from elsewhere, you'll need to pick a new type name\n        for your new node(s).\n\n        The node object passed to \"createNode\":\n\n        ${JSON.stringify(node, null, 4)}\n\n        The plugin creating the node:\n\n        ${JSON.stringify(plugin, null, 4)}\n      `)\n\n    // If the node has been created in the past, check that\n    // the current plugin is the same as the previous.\n    if (oldNode && oldNode.internal.owner !== pluginName) {\n      throw new Error(\n        stripIndent`\n        Nodes can only be updated by their owner. Node \"${node.id}\" is\n        owned by \"${oldNode.internal.owner}\" and another plugin \"${pluginName}\"\n        tried to update it.\n\n        `\n      )\n    }\n  }\n\n  if (actionOptions.parentSpan) {\n    actionOptions.parentSpan.setTag(`nodeId`, node.id)\n    actionOptions.parentSpan.setTag(`nodeType`, node.id)\n  }\n\n  let deleteAction\n  let updateNodeAction\n  // Check if the node has already been processed.\n  if (oldNode && !hasNodeChanged(node.id, node.internal.contentDigest)) {\n    updateNodeAction = {\n      type: `TOUCH_NODE`,\n      plugin,\n      ...actionOptions,\n      payload: node.id,\n    }\n  } else {\n    // Remove any previously created descendant nodes as they're all due\n    // to be recreated.\n    if (oldNode) {\n      const descendantNodes = findChildrenRecursively(oldNode.children)\n      if (descendantNodes.length > 0) {\n        deleteAction = descendantNodes.map(n =>\n          actions.deleteNode({ node: getNode(n) })\n        )\n      }\n    }\n\n    updateNodeAction = {\n      type: `CREATE_NODE`,\n      plugin,\n      ...actionOptions,\n      payload: node,\n    }\n  }\n\n  if (deleteAction) {\n    return [deleteAction, updateNodeAction]\n  } else {\n    return updateNodeAction\n  }\n}\n\n/**\n * \"Touch\" a node. Tells Gatsby a node still exists and shouldn't\n * be garbage collected. Primarily useful for source plugins fetching\n * nodes from a remote system that can return only nodes that have\n * updated. The source plugin then touches all the nodes that haven't\n * updated but still exist so Gatsby knows to keep them.\n * @param {Object} $0\n * @param {string} $0.nodeId The id of a node\n * @example\n * touchNode({ nodeId: `a-node-id` })\n */\nactions.touchNode = (options: any, plugin?: Plugin) => {\n  let nodeId = _.get(options, `nodeId`)\n\n  // Check if using old method signature. Warn about incorrect usage\n  if (typeof options === `string`) {\n    console.warn(\n      `Calling \"touchNode\" with a nodeId is deprecated. Please pass an object containing a nodeId instead: touchNode({ nodeId: 'a-node-id' })`\n    )\n\n    if (plugin && plugin.name) {\n      console.log(`\"touchNode\" was called by ${plugin.name}`)\n    }\n\n    nodeId = options\n  }\n\n  return {\n    type: `TOUCH_NODE`,\n    plugin,\n    payload: nodeId,\n  }\n}\n\ntype CreateNodeInput = {\n  node: Object,\n  fieldName?: string,\n  fieldValue?: string,\n  name?: string,\n  value: any,\n}\n/**\n * Extend another node. The new node field is placed under the `fields`\n * key on the extended node object.\n *\n * Once a plugin has claimed a field name the field name can't be used by\n * other plugins.  Also since nodes are immutable, you can't mutate the node\n * directly. So to extend another node, use this.\n * @param {Object} $0\n * @param {Object} $0.node the target node object\n * @param {string} $0.fieldName [deprecated] the name for the field\n * @param {string} $0.fieldValue [deprecated] the value for the field\n * @param {string} $0.name the name for the field\n * @param {string} $0.value the value for the field\n * @example\n * createNodeField({\n *   node,\n *   name: `happiness`,\n *   value: `is sweet graphql queries`\n * })\n *\n * // The field value is now accessible at node.fields.happiness\n */\nactions.createNodeField = (\n  { node, name, value, fieldName, fieldValue }: CreateNodeInput,\n  plugin: Plugin,\n  actionOptions?: ActionOptions\n) => {\n  if (fieldName) {\n    console.warn(\n      `Calling \"createNodeField\" with \"fieldName\" is deprecated. Use \"name\" instead`\n    )\n    if (!name) {\n      name = fieldName\n    }\n  }\n  if (fieldValue) {\n    console.warn(\n      `Calling \"createNodeField\" with \"fieldValue\" is deprecated. Use \"value\" instead`\n    )\n    if (!value) {\n      value = fieldValue\n    }\n  }\n  // Ensure required fields are set.\n  if (!node.internal.fieldOwners) {\n    node.internal.fieldOwners = {}\n  }\n  if (!node.fields) {\n    node.fields = {}\n  }\n\n  /**\n   * Normalized name of the field that will be used in schema\n   */\n  const schemaFieldName = _.includes(name, `___NODE`)\n    ? name.split(`___`)[0]\n    : name\n\n  // Check that this field isn't owned by another plugin.\n  const fieldOwner = node.internal.fieldOwners[schemaFieldName]\n  if (fieldOwner && fieldOwner !== plugin.name) {\n    throw new Error(\n      stripIndent`\n      A plugin tried to update a node field that it doesn't own:\n\n      Node id: ${node.id}\n      Plugin: ${plugin.name}\n      name: ${name}\n      value: ${value}\n      `\n    )\n  }\n\n  // Update node\n  node.fields[name] = value\n  node.internal.fieldOwners[schemaFieldName] = plugin.name\n\n  return {\n    type: `ADD_FIELD_TO_NODE`,\n    plugin,\n    ...actionOptions,\n    payload: node,\n  }\n}\n\n/**\n * Creates a link between a parent and child node. This is used when you\n * transform content from a node creating a new child node. You need to add\n * this new child node to the `children` array of the parent but since you\n * don't have direct access to the immutable parent node, use this action\n * instead.\n * @param {Object} $0\n * @param {Object} $0.parent the parent node object\n * @param {Object} $0.child the child node object\n * @example\n * createParentChildLink({ parent: parentNode, child: childNode })\n */\nactions.createParentChildLink = (\n  { parent, child }: { parent: any, child: any },\n  plugin?: Plugin\n) => {\n  // Update parent\n  parent.children.push(child.id)\n  parent.children = _.uniq(parent.children)\n\n  return {\n    type: `ADD_CHILD_NODE_TO_PARENT_NODE`,\n    plugin,\n    payload: parent,\n  }\n}\n\n/**\n * Create a dependency between a page and data. Probably for\n * internal use only.\n * @param {Object} $0\n * @param {string} $0.path the path to the page\n * @param {string} $0.nodeId A node ID\n * @param {string} $0.connection A connection type\n * @private\n */\nactions.createPageDependency = (\n  {\n    path,\n    nodeId,\n    connection,\n  }: { path: string, nodeId: string, connection: string },\n  plugin: string = ``\n) => {\n  return {\n    type: `CREATE_COMPONENT_DEPENDENCY`,\n    plugin,\n    payload: {\n      path,\n      nodeId,\n      connection,\n    },\n  }\n}\n\n/**\n * Delete dependencies between an array of pages and data. Probably for\n * internal use only. Used when deleting pages.\n * @param {Array} paths the paths to delete.\n * @private\n */\nactions.deleteComponentsDependencies = (paths: string[]) => {\n  return {\n    type: `DELETE_COMPONENTS_DEPENDENCIES`,\n    payload: {\n      paths,\n    },\n  }\n}\n\n/**\n * When the query watcher extracts a GraphQL query, it calls\n * this to store the query with its component.\n * @private\n */\nactions.replaceComponentQuery = ({\n  query,\n  componentPath,\n}: {\n  query: string,\n  componentPath: string,\n}) => {\n  return {\n    type: `REPLACE_COMPONENT_QUERY`,\n    payload: {\n      query,\n      componentPath,\n    },\n  }\n}\n\n/**\n * When the query watcher extracts a \"static\" GraphQL query from <StaticQuery>\n * components, it calls this to store the query with its component.\n * @private\n */\nactions.replaceStaticQuery = (args: any, plugin?: ?Plugin = null) => {\n  return {\n    type: `REPLACE_STATIC_QUERY`,\n    plugin,\n    payload: args,\n  }\n}\n\n/**\n * Merge additional configuration into the current webpack config. A few\n * configurations options will be ignored if set, in order to try prevent accidental breakage.\n * Specifically, any change to `entry`, `output`, `target`, or `resolveLoaders` will be ignored.\n *\n * For full control over the webpack config, use `replaceWebpackConfig()`.\n *\n * @param {Object} config partial webpack config, to be merged into the current one\n */\nactions.setWebpackConfig = (config: Object, plugin?: ?Plugin = null) => {\n  return {\n    type: `SET_WEBPACK_CONFIG`,\n    plugin,\n    payload: config,\n  }\n}\n\n/**\n * Completely replace the webpack config for the current stage. This can be\n * dangerous and break Gatsby if certain configuration options are changed.\n *\n * Generally only useful for cases where you need to handle config merging logic\n * yourself, in which case consider using `webpack-merge`.\n *\n * @param {Object} config complete webpack config\n */\nactions.replaceWebpackConfig = (config: Object, plugin?: ?Plugin = null) => {\n  return {\n    type: `REPLACE_WEBPACK_CONFIG`,\n    plugin,\n    payload: config,\n  }\n}\n\n/**\n * Set top-level Babel options. Plugins and presets will be ignored. Use\n * setBabelPlugin and setBabelPreset for this.\n * @param {Object} config An options object in the shape of a normal babelrc JavaScript object\n * @example\n * setBabelOptions({\n *   options: {\n *     sourceMaps: `inline`,\n *   }\n * })\n */\nactions.setBabelOptions = (options: Object, plugin?: ?Plugin = null) => {\n  // Validate\n  let name = `The plugin \"${plugin.name}\"`\n  if (plugin.name === `default-site-plugin`) {\n    name = `Your site's \"gatsby-node.js\"`\n  }\n  if (!_.isObject(options)) {\n    console.log(`${name} must pass an object to \"setBabelOptions\"`)\n    console.log(JSON.stringify(options, null, 4))\n    if (process.env.NODE_ENV !== `test`) {\n      process.exit(1)\n    }\n  }\n\n  if (!_.isObject(options.options)) {\n    console.log(`${name} must pass options to \"setBabelOptions\"`)\n    console.log(JSON.stringify(options, null, 4))\n    if (process.env.NODE_ENV !== `test`) {\n      process.exit(1)\n    }\n  }\n\n  return {\n    type: `SET_BABEL_OPTIONS`,\n    plugin,\n    payload: options,\n  }\n}\n\n/**\n * Add new plugins or merge options into existing Babel plugins.\n * @param {Object} config A config object describing the Babel plugin to be added.\n * @param {string} config.name The name of the Babel plugin\n * @param {Object} config.options Options to pass to the Babel plugin.\n * @example\n * setBabelPlugin({\n *   name:  `babel-plugin-emotion`,\n *   options: {\n *     sourceMap: true,\n *   },\n * })\n */\nactions.setBabelPlugin = (config: Object, plugin?: ?Plugin = null) => {\n  // Validate\n  let name = `The plugin \"${plugin.name}\"`\n  if (plugin.name === `default-site-plugin`) {\n    name = `Your site's \"gatsby-node.js\"`\n  }\n  if (!config.name) {\n    console.log(`${name} must set the name of the Babel plugin`)\n    console.log(JSON.stringify(config, null, 4))\n    if (process.env.NODE_ENV !== `test`) {\n      process.exit(1)\n    }\n  }\n  if (!config.options) {\n    config.options = {}\n  }\n  return {\n    type: `SET_BABEL_PLUGIN`,\n    plugin,\n    payload: config,\n  }\n}\n\n/**\n * Add new presets or merge options into existing Babel presets.\n * @param {Object} config A config object describing the Babel plugin to be added.\n * @param {string} config.name The name of the Babel preset.\n * @param {Object} config.options Options to pass to the Babel preset.\n * @example\n * setBabelPreset({\n *   name: `@babel/preset-react`,\n *   options: {\n *     pragma: `Glamor.createElement`,\n *   },\n * })\n */\nactions.setBabelPreset = (config: Object, plugin?: ?Plugin = null) => {\n  // Validate\n  let name = `The plugin \"${plugin.name}\"`\n  if (plugin.name === `default-site-plugin`) {\n    name = `Your site's \"gatsby-node.js\"`\n  }\n  if (!config.name) {\n    console.log(`${name} must set the name of the Babel preset`)\n    console.log(JSON.stringify(config, null, 4))\n    if (process.env.NODE_ENV !== `test`) {\n      process.exit(1)\n    }\n  }\n  if (!config.options) {\n    config.options = {}\n  }\n  return {\n    type: `SET_BABEL_PRESET`,\n    plugin,\n    payload: config,\n  }\n}\n\n/**\n * Create a \"job\". This is a long-running process that are generally\n * started as side-effects to GraphQL queries.\n * [`gatsby-plugin-sharp`](/packages/gatsby-plugin-sharp/) uses this for\n * example.\n *\n * Gatsby doesn't finish its bootstrap until all jobs are ended.\n * @param {Object} job A job object with at least an id set\n * @param {id} job.id The id of the job\n * @example\n * createJob({ id: `write file id: 123`, fileName: `something.jpeg` })\n */\nactions.createJob = (job: Job, plugin?: ?Plugin = null) => {\n  return {\n    type: `CREATE_JOB`,\n    plugin,\n    payload: job,\n  }\n}\n\n/**\n * Set (update) a \"job\". Sometimes on really long running jobs you want\n * to update the job as it continues.\n *\n * @param {Object} job A job object with at least an id set\n * @param {id} job.id The id of the job\n * @example\n * setJob({ id: `write file id: 123`, progress: 50 })\n */\nactions.setJob = (job: Job, plugin?: ?Plugin = null) => {\n  return {\n    type: `SET_JOB`,\n    plugin,\n    payload: job,\n  }\n}\n\n/**\n * End a \"job\".\n *\n * Gatsby doesn't finish its bootstrap until all jobs are ended.\n * @param {Object} job  A job object with at least an id set\n * @param {id} job.id The id of the job\n * @example\n * endJob({ id: `write file id: 123` })\n */\nactions.endJob = (job: Job, plugin?: ?Plugin = null) => {\n  return {\n    type: `END_JOB`,\n    plugin,\n    payload: job,\n  }\n}\n\n/**\n * Set plugin status. A plugin can use this to save status keys e.g. the last\n * it fetched something. These values are persisted between runs of Gatsby.\n *\n * @param {Object} status  An object with arbitrary values set\n * @example\n * setPluginStatus({ lastFetched: Date.now() })\n */\nactions.setPluginStatus = (\n  status: { [key: string]: mixed },\n  plugin: Plugin\n) => {\n  return {\n    type: `SET_PLUGIN_STATUS`,\n    plugin,\n    payload: status,\n  }\n}\n\n/**\n * Create a redirect from one page to another. Server redirects don't work out\n * of the box. You must have a plugin setup to integrate the redirect data with\n * your hosting technology e.g. the [Netlify\n * plugin](/packages/gatsby-plugin-netlify/)).\n *\n * @param {Object} redirect Redirect data\n * @param {string} redirect.fromPath Any valid URL. Must start with a forward slash\n * @param {boolean} redirect.isPermanent This is a permanent redirect; defaults to temporary\n * @param {string} redirect.toPath URL of a created page (see `createPage`)\n * @param {boolean} redirect.redirectInBrowser Redirects are generally for redirecting legacy URLs to their new configuration. If you can't update your UI for some reason, set `redirectInBrowser` to true and Gatsby will handle redirecting in the client as well.\n * @example\n * createRedirect({ fromPath: '/old-url', toPath: '/new-url', isPermanent: true })\n * createRedirect({ fromPath: '/url', toPath: '/zn-CH/url', Language: 'zn' })\n */\nactions.createRedirect = ({\n  fromPath,\n  isPermanent = false,\n  redirectInBrowser = false,\n  toPath,\n  ...rest\n}) => {\n  let pathPrefix = ``\n  if (store.getState().program.prefixPaths) {\n    pathPrefix = store.getState().config.pathPrefix\n  }\n\n  // Parse urls to get their protocols\n  // url.parse will not cover protocol-relative urls so do a separate check for those\n  const parsed = url.parse(toPath)\n  const isRelativeProtocol = toPath.startsWith(`//`)\n  const toPathPrefix =\n    parsed.protocol != null || isRelativeProtocol ? `` : pathPrefix\n\n  return {\n    type: `CREATE_REDIRECT`,\n    payload: {\n      fromPath: `${pathPrefix}${fromPath}`,\n      isPermanent,\n      redirectInBrowser,\n      toPath: `${toPathPrefix}${toPath}`,\n      ...rest,\n    },\n  }\n}\n\n/**\n * Add a third-party schema to be merged into main schema. Schema has to be a\n * graphql-js GraphQLSchema object.\n *\n * This schema is going to be merged as-is. This can easily break the main\n * Gatsby schema, so it's user's responsibility to make sure it doesn't happen\n * (by eg namespacing the schema).\n *\n * @param {Object} $0\n * @param {GraphQLSchema} $0.schema GraphQL schema to add\n */\nactions.addThirdPartySchema = (\n  { schema }: { schema: GraphQLSchema },\n  plugin: Plugin,\n  traceId?: string\n) => {\n  return {\n    type: `ADD_THIRD_PARTY_SCHEMA`,\n    plugin,\n    traceId,\n    payload: schema,\n  }\n}\n\n/**\n * All action creators wrapped with a dispatch.\n */\nexports.actions = actions\n\n/**\n * All action creators wrapped with a dispatch. - *DEPRECATED*\n */\nexports.boundActionCreators = bindActionCreators(actions, store.dispatch)\n"],"file":"actions.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/redux/actions/add-page-dependency.js
+++ b/node_modules/gatsby/dist/redux/actions/add-page-dependency.js
@@ -2,11 +2,13 @@
 
 const _ = require(`lodash`);
 
-const _require = require(`../`),
-      store = _require.store;
+const {
+  store
+} = require(`../`);
 
-const _require2 = require(`../actions.js`),
-      actions = _require2.actions;
+const {
+  actions
+} = require(`../actions.js`);
 
 function createPageDependency({
   path,
--- a/node_modules/gatsby/dist/redux/actions/add-page-dependency.js.map
+++ b/node_modules/gatsby/dist/redux/actions/add-page-dependency.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../../src/redux/actions/add-page-dependency.js"],"names":["_","require","store","actions","createPageDependency","path","nodeId","connection","state","getState","nodeDependencyExists","connectionDependencyExists","includes","componentDataDependencies","nodes","connections","action","dispatch","module","exports"],"mappings":";;AAAA,MAAMA,CAAC,GAAGC,OAAO,CAAE,QAAF,CAAjB;;iBAEkBA,OAAO,CAAE,KAAF,C;MAAjBC,K,YAAAA,K;;kBACYD,OAAO,CAAE,eAAF,C;MAAnBE,O,aAAAA,O;;AAER,SAASC,oBAAT,CAA8B;AAAEC,EAAAA,IAAF;AAAQC,EAAAA,MAAR;AAAgBC,EAAAA;AAAhB,CAA9B,EAA4D;AAC1D,QAAMC,KAAK,GAAGN,KAAK,CAACO,QAAN,EAAd,CAD0D,CAG1D;AACA;;AACA,MAAIC,oBAAoB,GAAG,KAA3B;AACA,MAAIC,0BAA0B,GAAG,KAAjC;;AACA,MAAI,CAACL,MAAL,EAAa;AACXI,IAAAA,oBAAoB,GAAG,IAAvB;AACD;;AACD,MACEJ,MAAM,IACNN,CAAC,CAACY,QAAF,CAAWJ,KAAK,CAACK,yBAAN,CAAgCC,KAAhC,CAAsCR,MAAtC,CAAX,EAA0DD,IAA1D,CAFF,EAGE;AACAK,IAAAA,oBAAoB,GAAG,IAAvB;AACD;;AACD,MAAI,CAACH,UAAL,EAAiB;AACfI,IAAAA,0BAA0B,GAAG,IAA7B;AACD;;AACD,MACEJ,UAAU,IACVP,CAAC,CAACY,QAAF,CAAWJ,KAAK,CAACK,yBAAN,CAAgCE,WAA3C,EAAwDR,UAAxD,CAFF,EAGE;AACAI,IAAAA,0BAA0B,GAAG,IAA7B;AACD;;AACD,MAAID,oBAAoB,IAAIC,0BAA5B,EAAwD;AACtD;AACD,GA3ByD,CA6B1D;;;AACA,QAAMK,MAAM,GAAGb,OAAO,CAACC,oBAAR,CAA6B;AAAEC,IAAAA,IAAF;AAAQC,IAAAA,MAAR;AAAgBC,IAAAA;AAAhB,GAA7B,CAAf;AACAL,EAAAA,KAAK,CAACe,QAAN,CAAeD,MAAf;AACD;;AAEDE,MAAM,CAACC,OAAP,GAAiBf,oBAAjB","sourcesContent":["const _ = require(`lodash`)\n\nconst { store } = require(`../`)\nconst { actions } = require(`../actions.js`)\n\nfunction createPageDependency({ path, nodeId, connection }) {\n  const state = store.getState()\n\n  // Check that the dependencies aren't already recorded so we\n  // can avoid creating lots of very noisy actions.\n  let nodeDependencyExists = false\n  let connectionDependencyExists = false\n  if (!nodeId) {\n    nodeDependencyExists = true\n  }\n  if (\n    nodeId &&\n    _.includes(state.componentDataDependencies.nodes[nodeId], path)\n  ) {\n    nodeDependencyExists = true\n  }\n  if (!connection) {\n    connectionDependencyExists = true\n  }\n  if (\n    connection &&\n    _.includes(state.componentDataDependencies.connections, connection)\n  ) {\n    connectionDependencyExists = true\n  }\n  if (nodeDependencyExists && connectionDependencyExists) {\n    return\n  }\n\n  // It's new, let's dispatch it\n  const action = actions.createPageDependency({ path, nodeId, connection })\n  store.dispatch(action)\n}\n\nmodule.exports = createPageDependency\n"],"file":"add-page-dependency.js"}
\ No newline at end of file
+{"version":3,"sources":["../../../src/redux/actions/add-page-dependency.js"],"names":["_","require","store","actions","createPageDependency","path","nodeId","connection","state","getState","nodeDependencyExists","connectionDependencyExists","includes","componentDataDependencies","nodes","connections","action","dispatch","module","exports"],"mappings":";;AAAA,MAAMA,CAAC,GAAGC,OAAO,CAAE,QAAF,CAAjB;;AAEA,MAAM;AAAEC,EAAAA;AAAF,IAAYD,OAAO,CAAE,KAAF,CAAzB;;AACA,MAAM;AAAEE,EAAAA;AAAF,IAAcF,OAAO,CAAE,eAAF,CAA3B;;AAEA,SAASG,oBAAT,CAA8B;AAAEC,EAAAA,IAAF;AAAQC,EAAAA,MAAR;AAAgBC,EAAAA;AAAhB,CAA9B,EAA4D;AAC1D,QAAMC,KAAK,GAAGN,KAAK,CAACO,QAAN,EAAd,CAD0D,CAG1D;AACA;;AACA,MAAIC,oBAAoB,GAAG,KAA3B;AACA,MAAIC,0BAA0B,GAAG,KAAjC;;AACA,MAAI,CAACL,MAAL,EAAa;AACXI,IAAAA,oBAAoB,GAAG,IAAvB;AACD;;AACD,MACEJ,MAAM,IACNN,CAAC,CAACY,QAAF,CAAWJ,KAAK,CAACK,yBAAN,CAAgCC,KAAhC,CAAsCR,MAAtC,CAAX,EAA0DD,IAA1D,CAFF,EAGE;AACAK,IAAAA,oBAAoB,GAAG,IAAvB;AACD;;AACD,MAAI,CAACH,UAAL,EAAiB;AACfI,IAAAA,0BAA0B,GAAG,IAA7B;AACD;;AACD,MACEJ,UAAU,IACVP,CAAC,CAACY,QAAF,CAAWJ,KAAK,CAACK,yBAAN,CAAgCE,WAA3C,EAAwDR,UAAxD,CAFF,EAGE;AACAI,IAAAA,0BAA0B,GAAG,IAA7B;AACD;;AACD,MAAID,oBAAoB,IAAIC,0BAA5B,EAAwD;AACtD;AACD,GA3ByD,CA6B1D;;;AACA,QAAMK,MAAM,GAAGb,OAAO,CAACC,oBAAR,CAA6B;AAAEC,IAAAA,IAAF;AAAQC,IAAAA,MAAR;AAAgBC,IAAAA;AAAhB,GAA7B,CAAf;AACAL,EAAAA,KAAK,CAACe,QAAN,CAAeD,MAAf;AACD;;AAEDE,MAAM,CAACC,OAAP,GAAiBf,oBAAjB","sourcesContent":["const _ = require(`lodash`)\n\nconst { store } = require(`../`)\nconst { actions } = require(`../actions.js`)\n\nfunction createPageDependency({ path, nodeId, connection }) {\n  const state = store.getState()\n\n  // Check that the dependencies aren't already recorded so we\n  // can avoid creating lots of very noisy actions.\n  let nodeDependencyExists = false\n  let connectionDependencyExists = false\n  if (!nodeId) {\n    nodeDependencyExists = true\n  }\n  if (\n    nodeId &&\n    _.includes(state.componentDataDependencies.nodes[nodeId], path)\n  ) {\n    nodeDependencyExists = true\n  }\n  if (!connection) {\n    connectionDependencyExists = true\n  }\n  if (\n    connection &&\n    _.includes(state.componentDataDependencies.connections, connection)\n  ) {\n    connectionDependencyExists = true\n  }\n  if (nodeDependencyExists && connectionDependencyExists) {\n    return\n  }\n\n  // It's new, let's dispatch it\n  const action = actions.createPageDependency({ path, nodeId, connection })\n  store.dispatch(action)\n}\n\nmodule.exports = createPageDependency\n"],"file":"add-page-dependency.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/redux/index.js
+++ b/node_modules/gatsby/dist/redux/index.js
@@ -26,21 +26,7 @@ const objectToMap = obj => {
 const mapToObject = map => {
   const obj = {};
 
-  for (var _iterator = map, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {
-    var _ref;
-
-    if (_isArray) {
-      if (_i >= _iterator.length) break;
-      _ref = _iterator[_i++];
-    } else {
-      _i = _iterator.next();
-      if (_i.done) break;
-      _ref = _i.value;
-    }
-
-    let _ref2 = _ref,
-        key = _ref2[0],
-        value = _ref2[1];
+  for (let [key, value] of map) {
     obj[key] = value;
   }
 
@@ -73,7 +59,8 @@ try {
 } catch (e) {// ignore errors.
 }
 
-const store = Redux.createStore(Redux.combineReducers(Object.assign({}, reducers)), initialState, Redux.applyMiddleware(function multi({
+const store = Redux.createStore(Redux.combineReducers({ ...reducers
+}), initialState, Redux.applyMiddleware(function multi({
   dispatch
 }) {
   return next => action => Array.isArray(action) ? action.filter(Boolean).map(dispatch) : next(action);
--- a/node_modules/gatsby/dist/redux/index.js.map
+++ b/node_modules/gatsby/dist/redux/index.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/redux/index.js"],"names":["Redux","require","_","fs","mitt","stringify","emitter","reducers","objectToMap","obj","map","Map","Object","keys","forEach","key","set","mapToObject","value","initialState","file","readFileSync","process","cwd","Buffer","isBuffer","JSON","parse","staticQueryComponents","components","nodes","e","store","createStore","combineReducers","applyMiddleware","multi","dispatch","next","action","Array","isArray","filter","Boolean","saveState","state","pickedState","pick","stringified","writeFile","saveStateDebounced","debounce","subscribe","lastAction","getState","emit","type","bootstrapFinished","env","gatsby_executing_command","on","exports"],"mappings":"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","sourcesContent":["const Redux = require(`redux`)\nconst _ = require(`lodash`)\nconst fs = require(`fs`)\nconst mitt = require(`mitt`)\nconst stringify = require(`json-stringify-safe`)\n\n// Create event emitter for actions\nconst emitter = mitt()\n\n// Reducers\nconst reducers = require(`./reducers`)\n\nconst objectToMap = obj => {\n  let map = new Map()\n  Object.keys(obj).forEach(key => {\n    map.set(key, obj[key])\n  })\n  return map\n}\n\nconst mapToObject = map => {\n  const obj = {}\n  for (let [key, value] of map) {\n    obj[key] = value\n  }\n  return obj\n}\n\n// Read from cache the old node data.\nlet initialState = {}\ntry {\n  const file = fs.readFileSync(`${process.cwd()}/.cache/redux-state.json`)\n  // Apparently the file mocking in node-tracking-test.js\n  // can override the file reading replacing the mocked string with\n  // an already parsed object.\n  if (Buffer.isBuffer(file) || typeof file === `string`) {\n    initialState = JSON.parse(file)\n  }\n  if (initialState.staticQueryComponents) {\n    initialState.staticQueryComponents = objectToMap(\n      initialState.staticQueryComponents\n    )\n  }\n  if (initialState.components) {\n    initialState.components = objectToMap(initialState.components)\n  }\n  if (initialState.nodes) {\n    initialState.nodes = objectToMap(initialState.nodes)\n  }\n} catch (e) {\n  // ignore errors.\n}\n\nconst store = Redux.createStore(\n  Redux.combineReducers({ ...reducers }),\n  initialState,\n  Redux.applyMiddleware(function multi({ dispatch }) {\n    return next => action =>\n      Array.isArray(action)\n        ? action.filter(Boolean).map(dispatch)\n        : next(action)\n  })\n)\n\n// Persist state.\nconst saveState = state => {\n  const pickedState = _.pick(state, [\n    `nodes`,\n    `status`,\n    `componentDataDependencies`,\n    `jsonDataPaths`,\n    `components`,\n    `staticQueryComponents`,\n  ])\n\n  pickedState.staticQueryComponents = mapToObject(\n    pickedState.staticQueryComponents\n  )\n  pickedState.components = mapToObject(pickedState.components)\n  pickedState.nodes = mapToObject(pickedState.nodes)\n  const stringified = stringify(pickedState, null, 2)\n  fs.writeFile(\n    `${process.cwd()}/.cache/redux-state.json`,\n    stringified,\n    () => {}\n  )\n}\nconst saveStateDebounced = _.debounce(saveState, 1000)\n\nstore.subscribe(() => {\n  const lastAction = store.getState().lastAction\n  emitter.emit(lastAction.type, lastAction)\n})\n\n// During development, once bootstrap is finished, persist state on changes.\nlet bootstrapFinished = false\nif (process.env.gatsby_executing_command === `develop`) {\n  emitter.on(`BOOTSTRAP_FINISHED`, () => {\n    bootstrapFinished = true\n    saveState(store.getState())\n  })\n  emitter.on(`*`, () => {\n    if (bootstrapFinished) {\n      saveStateDebounced(store.getState())\n    }\n  })\n}\n\n// During builds, persist state once bootstrap has finished.\nif (process.env.gatsby_executing_command === `build`) {\n  emitter.on(`BOOTSTRAP_FINISHED`, () => {\n    saveState(store.getState())\n  })\n}\n\n/** Event emitter */\nexports.emitter = emitter\n\n/** Redux store */\nexports.store = store\n"],"file":"index.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/redux/index.js"],"names":["Redux","require","_","fs","mitt","stringify","emitter","reducers","objectToMap","obj","map","Map","Object","keys","forEach","key","set","mapToObject","value","initialState","file","readFileSync","process","cwd","Buffer","isBuffer","JSON","parse","staticQueryComponents","components","nodes","e","store","createStore","combineReducers","applyMiddleware","multi","dispatch","next","action","Array","isArray","filter","Boolean","saveState","state","pickedState","pick","stringified","writeFile","saveStateDebounced","debounce","subscribe","lastAction","getState","emit","type","bootstrapFinished","env","gatsby_executing_command","on","exports"],"mappings":"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","sourcesContent":["const Redux = require(`redux`)\nconst _ = require(`lodash`)\nconst fs = require(`fs`)\nconst mitt = require(`mitt`)\nconst stringify = require(`json-stringify-safe`)\n\n// Create event emitter for actions\nconst emitter = mitt()\n\n// Reducers\nconst reducers = require(`./reducers`)\n\nconst objectToMap = obj => {\n  let map = new Map()\n  Object.keys(obj).forEach(key => {\n    map.set(key, obj[key])\n  })\n  return map\n}\n\nconst mapToObject = map => {\n  const obj = {}\n  for (let [key, value] of map) {\n    obj[key] = value\n  }\n  return obj\n}\n\n// Read from cache the old node data.\nlet initialState = {}\ntry {\n  const file = fs.readFileSync(`${process.cwd()}/.cache/redux-state.json`)\n  // Apparently the file mocking in node-tracking-test.js\n  // can override the file reading replacing the mocked string with\n  // an already parsed object.\n  if (Buffer.isBuffer(file) || typeof file === `string`) {\n    initialState = JSON.parse(file)\n  }\n  if (initialState.staticQueryComponents) {\n    initialState.staticQueryComponents = objectToMap(\n      initialState.staticQueryComponents\n    )\n  }\n  if (initialState.components) {\n    initialState.components = objectToMap(initialState.components)\n  }\n  if (initialState.nodes) {\n    initialState.nodes = objectToMap(initialState.nodes)\n  }\n} catch (e) {\n  // ignore errors.\n}\n\nconst store = Redux.createStore(\n  Redux.combineReducers({ ...reducers }),\n  initialState,\n  Redux.applyMiddleware(function multi({ dispatch }) {\n    return next => action =>\n      Array.isArray(action)\n        ? action.filter(Boolean).map(dispatch)\n        : next(action)\n  })\n)\n\n// Persist state.\nconst saveState = state => {\n  const pickedState = _.pick(state, [\n    `nodes`,\n    `status`,\n    `componentDataDependencies`,\n    `jsonDataPaths`,\n    `components`,\n    `staticQueryComponents`,\n  ])\n\n  pickedState.staticQueryComponents = mapToObject(\n    pickedState.staticQueryComponents\n  )\n  pickedState.components = mapToObject(pickedState.components)\n  pickedState.nodes = mapToObject(pickedState.nodes)\n  const stringified = stringify(pickedState, null, 2)\n  fs.writeFile(\n    `${process.cwd()}/.cache/redux-state.json`,\n    stringified,\n    () => {}\n  )\n}\nconst saveStateDebounced = _.debounce(saveState, 1000)\n\nstore.subscribe(() => {\n  const lastAction = store.getState().lastAction\n  emitter.emit(lastAction.type, lastAction)\n})\n\n// During development, once bootstrap is finished, persist state on changes.\nlet bootstrapFinished = false\nif (process.env.gatsby_executing_command === `develop`) {\n  emitter.on(`BOOTSTRAP_FINISHED`, () => {\n    bootstrapFinished = true\n    saveState(store.getState())\n  })\n  emitter.on(`*`, () => {\n    if (bootstrapFinished) {\n      saveStateDebounced(store.getState())\n    }\n  })\n}\n\n// During builds, persist state once bootstrap has finished.\nif (process.env.gatsby_executing_command === `build`) {\n  emitter.on(`BOOTSTRAP_FINISHED`, () => {\n    saveState(store.getState())\n  })\n}\n\n/** Event emitter */\nexports.emitter = emitter\n\n/** Redux store */\nexports.store = store\n"],"file":"index.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/redux/nodes.js
+++ b/node_modules/gatsby/dist/redux/nodes.js
@@ -4,8 +4,9 @@ const _ = require(`lodash`);
 
 const Promise = require(`bluebird`);
 
-const _require = require(`./index`),
-      store = _require.store;
+const {
+  store
+} = require(`./index`);
 /**
  * Get all nodes from redux store.
  *
@@ -70,8 +71,9 @@ exports.loadNodeContent = node => {
       // Load plugin's loader function
       const plugin = store.getState().flattenedPlugins.find(plug => plug.name === node.internal.owner);
 
-      const _require2 = require(plugin.resolve),
-            loadNodeContent = _require2.loadNodeContent;
+      const {
+        loadNodeContent
+      } = require(plugin.resolve);
 
       if (!loadNodeContent) {
         throw new Error(`Could not find function loadNodeContent for plugin ${plugin.name}`);
--- a/node_modules/gatsby/dist/redux/nodes.js.map
+++ b/node_modules/gatsby/dist/redux/nodes.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/redux/nodes.js"],"names":["_","require","Promise","store","getNodes","nodes","getState","Array","from","values","exports","getNode","id","get","getNodesByType","type","filter","node","internal","hasNodeChanged","digest","contentDigest","loadNodeContent","isString","content","resolve","plugin","flattenedPlugins","find","plug","name","owner","Error","then","getNodeAndSavePathDependency","path","createPageDependency","nodeId"],"mappings":";;AAAA,MAAMA,CAAC,GAAGC,OAAO,CAAE,QAAF,CAAjB;;AACA,MAAMC,OAAO,GAAGD,OAAO,CAAE,UAAF,CAAvB;;iBACkBA,OAAO,CAAE,SAAF,C;MAAjBE,K,YAAAA,K;AAER;;;;;;;AAKA,MAAMC,QAAQ,GAAG,MAAM;AACrB,QAAMC,KAAK,GAAGF,KAAK,CAACG,QAAN,GAAiBD,KAA/B;;AACA,MAAIA,KAAJ,EAAW;AACT,WAAOE,KAAK,CAACC,IAAN,CAAWH,KAAK,CAACI,MAAN,EAAX,CAAP;AACD,GAFD,MAEO;AACL,WAAO,EAAP;AACD;AACF,CAPD;;AASAC,OAAO,CAACN,QAAR,GAAmBA,QAAnB;;AAEA,MAAMO,OAAO,GAAGC,EAAE,IAAIT,KAAK,CAACG,QAAN,GAAiBD,KAAjB,CAAuBQ,GAAvB,CAA2BD,EAA3B,CAAtB;AAEA;;;;;;;AAKAF,OAAO,CAACC,OAAR,GAAkBA,OAAlB;;AAEAD,OAAO,CAACI,cAAR,GAAyBC,IAAI,IAC3BX,QAAQ,GAAGY,MAAX,CAAkBC,IAAI,IAAIA,IAAI,CAACC,QAAL,CAAcH,IAAd,KAAuBA,IAAjD,CADF;AAGA;;;;;;;;;AAOAL,OAAO,CAACS,cAAR,GAAyB,CAACP,EAAD,EAAKQ,MAAL,KAAgB;AACvC,QAAMH,IAAI,GAAGd,KAAK,CAACG,QAAN,GAAiBD,KAAjB,CAAuBQ,GAAvB,CAA2BD,EAA3B,CAAb;;AACA,MAAI,CAACK,IAAL,EAAW;AACT,WAAO,IAAP;AACD,GAFD,MAEO;AACL,WAAOA,IAAI,CAACC,QAAL,CAAcG,aAAd,KAAgCD,MAAvC;AACD;AACF,CAPD;AASA;;;;;;;;AAMAV,OAAO,CAACY,eAAR,GAA0BL,IAAI,IAAI;AAChC,MAAIjB,CAAC,CAACuB,QAAF,CAAWN,IAAI,CAACC,QAAL,CAAcM,OAAzB,CAAJ,EAAuC;AACrC,WAAOtB,OAAO,CAACuB,OAAR,CAAgBR,IAAI,CAACC,QAAL,CAAcM,OAA9B,CAAP;AACD,GAFD,MAEO;AACL,WAAO,IAAItB,OAAJ,CAAYuB,OAAO,IAAI;AAC5B;AACA,YAAMC,MAAM,GAAGvB,KAAK,CACjBG,QADY,GAEZqB,gBAFY,CAEKC,IAFL,CAEUC,IAAI,IAAIA,IAAI,CAACC,IAAL,KAAcb,IAAI,CAACC,QAAL,CAAca,KAF9C,CAAf;;AAF4B,wBAKA9B,OAAO,CAACyB,MAAM,CAACD,OAAR,CALP;AAAA,YAKpBH,eALoB,aAKpBA,eALoB;;AAM5B,UAAI,CAACA,eAAL,EAAsB;AACpB,cAAM,IAAIU,KAAJ,CACH,sDAAqDN,MAAM,CAACI,IAAK,EAD9D,CAAN;AAGD;;AAED,aAAOR,eAAe,CAACL,IAAD,CAAf,CAAsBgB,IAAtB,CAA2BT,OAAO,IAAI;AAC3C;AACAC,QAAAA,OAAO,CAACD,OAAD,CAAP;AACD,OAHM,CAAP;AAID,KAhBM,CAAP;AAiBD;AACF,CAtBD;AAwBA;;;;;;;;;AAOAd,OAAO,CAACwB,4BAAR,GAAuC,CAACtB,EAAD,EAAKuB,IAAL,KAAc;AACnD,QAAMC,oBAAoB,GAAGnC,OAAO,CAAE,+BAAF,CAApC;;AACA,QAAMgB,IAAI,GAAGN,OAAO,CAACC,EAAD,CAApB;AACAwB,EAAAA,oBAAoB,CAAC;AAAED,IAAAA,IAAF;AAAQE,IAAAA,MAAM,EAAEzB;AAAhB,GAAD,CAApB;AACA,SAAOK,IAAP;AACD,CALD","sourcesContent":["const _ = require(`lodash`)\nconst Promise = require(`bluebird`)\nconst { store } = require(`./index`)\n\n/**\n * Get all nodes from redux store.\n *\n * @returns {Array}\n */\nconst getNodes = () => {\n  const nodes = store.getState().nodes\n  if (nodes) {\n    return Array.from(nodes.values())\n  } else {\n    return []\n  }\n}\n\nexports.getNodes = getNodes\n\nconst getNode = id => store.getState().nodes.get(id)\n\n/** Get node by id from store.\n *\n * @param {string} id\n * @returns {Object}\n */\nexports.getNode = getNode\n\nexports.getNodesByType = type =>\n  getNodes().filter(node => node.internal.type === type)\n\n/**\n * Determine if node has changed.\n *\n * @param {string} id\n * @param {string} digest\n * @returns {boolean}\n */\nexports.hasNodeChanged = (id, digest) => {\n  const node = store.getState().nodes.get(id)\n  if (!node) {\n    return true\n  } else {\n    return node.internal.contentDigest !== digest\n  }\n}\n\n/**\n * Get content for a node from the plugin that created it.\n *\n * @param {Object} node\n * @returns {promise}\n */\nexports.loadNodeContent = node => {\n  if (_.isString(node.internal.content)) {\n    return Promise.resolve(node.internal.content)\n  } else {\n    return new Promise(resolve => {\n      // Load plugin's loader function\n      const plugin = store\n        .getState()\n        .flattenedPlugins.find(plug => plug.name === node.internal.owner)\n      const { loadNodeContent } = require(plugin.resolve)\n      if (!loadNodeContent) {\n        throw new Error(\n          `Could not find function loadNodeContent for plugin ${plugin.name}`\n        )\n      }\n\n      return loadNodeContent(node).then(content => {\n        // TODO update node's content field here.\n        resolve(content)\n      })\n    })\n  }\n}\n\n/**\n * Get node and save path dependency.\n *\n * @param {string} id\n * @param {string} path\n * @returns {Object} node\n */\nexports.getNodeAndSavePathDependency = (id, path) => {\n  const createPageDependency = require(`./actions/add-page-dependency`)\n  const node = getNode(id)\n  createPageDependency({ path, nodeId: id })\n  return node\n}\n"],"file":"nodes.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/redux/nodes.js"],"names":["_","require","Promise","store","getNodes","nodes","getState","Array","from","values","exports","getNode","id","get","getNodesByType","type","filter","node","internal","hasNodeChanged","digest","contentDigest","loadNodeContent","isString","content","resolve","plugin","flattenedPlugins","find","plug","name","owner","Error","then","getNodeAndSavePathDependency","path","createPageDependency","nodeId"],"mappings":";;AAAA,MAAMA,CAAC,GAAGC,OAAO,CAAE,QAAF,CAAjB;;AACA,MAAMC,OAAO,GAAGD,OAAO,CAAE,UAAF,CAAvB;;AACA,MAAM;AAAEE,EAAAA;AAAF,IAAYF,OAAO,CAAE,SAAF,CAAzB;AAEA;;;;;;;AAKA,MAAMG,QAAQ,GAAG,MAAM;AACrB,QAAMC,KAAK,GAAGF,KAAK,CAACG,QAAN,GAAiBD,KAA/B;;AACA,MAAIA,KAAJ,EAAW;AACT,WAAOE,KAAK,CAACC,IAAN,CAAWH,KAAK,CAACI,MAAN,EAAX,CAAP;AACD,GAFD,MAEO;AACL,WAAO,EAAP;AACD;AACF,CAPD;;AASAC,OAAO,CAACN,QAAR,GAAmBA,QAAnB;;AAEA,MAAMO,OAAO,GAAGC,EAAE,IAAIT,KAAK,CAACG,QAAN,GAAiBD,KAAjB,CAAuBQ,GAAvB,CAA2BD,EAA3B,CAAtB;AAEA;;;;;;;AAKAF,OAAO,CAACC,OAAR,GAAkBA,OAAlB;;AAEAD,OAAO,CAACI,cAAR,GAAyBC,IAAI,IAC3BX,QAAQ,GAAGY,MAAX,CAAkBC,IAAI,IAAIA,IAAI,CAACC,QAAL,CAAcH,IAAd,KAAuBA,IAAjD,CADF;AAGA;;;;;;;;;AAOAL,OAAO,CAACS,cAAR,GAAyB,CAACP,EAAD,EAAKQ,MAAL,KAAgB;AACvC,QAAMH,IAAI,GAAGd,KAAK,CAACG,QAAN,GAAiBD,KAAjB,CAAuBQ,GAAvB,CAA2BD,EAA3B,CAAb;;AACA,MAAI,CAACK,IAAL,EAAW;AACT,WAAO,IAAP;AACD,GAFD,MAEO;AACL,WAAOA,IAAI,CAACC,QAAL,CAAcG,aAAd,KAAgCD,MAAvC;AACD;AACF,CAPD;AASA;;;;;;;;AAMAV,OAAO,CAACY,eAAR,GAA0BL,IAAI,IAAI;AAChC,MAAIjB,CAAC,CAACuB,QAAF,CAAWN,IAAI,CAACC,QAAL,CAAcM,OAAzB,CAAJ,EAAuC;AACrC,WAAOtB,OAAO,CAACuB,OAAR,CAAgBR,IAAI,CAACC,QAAL,CAAcM,OAA9B,CAAP;AACD,GAFD,MAEO;AACL,WAAO,IAAItB,OAAJ,CAAYuB,OAAO,IAAI;AAC5B;AACA,YAAMC,MAAM,GAAGvB,KAAK,CACjBG,QADY,GAEZqB,gBAFY,CAEKC,IAFL,CAEUC,IAAI,IAAIA,IAAI,CAACC,IAAL,KAAcb,IAAI,CAACC,QAAL,CAAca,KAF9C,CAAf;;AAGA,YAAM;AAAET,QAAAA;AAAF,UAAsBrB,OAAO,CAACyB,MAAM,CAACD,OAAR,CAAnC;;AACA,UAAI,CAACH,eAAL,EAAsB;AACpB,cAAM,IAAIU,KAAJ,CACH,sDAAqDN,MAAM,CAACI,IAAK,EAD9D,CAAN;AAGD;;AAED,aAAOR,eAAe,CAACL,IAAD,CAAf,CAAsBgB,IAAtB,CAA2BT,OAAO,IAAI;AAC3C;AACAC,QAAAA,OAAO,CAACD,OAAD,CAAP;AACD,OAHM,CAAP;AAID,KAhBM,CAAP;AAiBD;AACF,CAtBD;AAwBA;;;;;;;;;AAOAd,OAAO,CAACwB,4BAAR,GAAuC,CAACtB,EAAD,EAAKuB,IAAL,KAAc;AACnD,QAAMC,oBAAoB,GAAGnC,OAAO,CAAE,+BAAF,CAApC;;AACA,QAAMgB,IAAI,GAAGN,OAAO,CAACC,EAAD,CAApB;AACAwB,EAAAA,oBAAoB,CAAC;AAAED,IAAAA,IAAF;AAAQE,IAAAA,MAAM,EAAEzB;AAAhB,GAAD,CAApB;AACA,SAAOK,IAAP;AACD,CALD","sourcesContent":["const _ = require(`lodash`)\nconst Promise = require(`bluebird`)\nconst { store } = require(`./index`)\n\n/**\n * Get all nodes from redux store.\n *\n * @returns {Array}\n */\nconst getNodes = () => {\n  const nodes = store.getState().nodes\n  if (nodes) {\n    return Array.from(nodes.values())\n  } else {\n    return []\n  }\n}\n\nexports.getNodes = getNodes\n\nconst getNode = id => store.getState().nodes.get(id)\n\n/** Get node by id from store.\n *\n * @param {string} id\n * @returns {Object}\n */\nexports.getNode = getNode\n\nexports.getNodesByType = type =>\n  getNodes().filter(node => node.internal.type === type)\n\n/**\n * Determine if node has changed.\n *\n * @param {string} id\n * @param {string} digest\n * @returns {boolean}\n */\nexports.hasNodeChanged = (id, digest) => {\n  const node = store.getState().nodes.get(id)\n  if (!node) {\n    return true\n  } else {\n    return node.internal.contentDigest !== digest\n  }\n}\n\n/**\n * Get content for a node from the plugin that created it.\n *\n * @param {Object} node\n * @returns {promise}\n */\nexports.loadNodeContent = node => {\n  if (_.isString(node.internal.content)) {\n    return Promise.resolve(node.internal.content)\n  } else {\n    return new Promise(resolve => {\n      // Load plugin's loader function\n      const plugin = store\n        .getState()\n        .flattenedPlugins.find(plug => plug.name === node.internal.owner)\n      const { loadNodeContent } = require(plugin.resolve)\n      if (!loadNodeContent) {\n        throw new Error(\n          `Could not find function loadNodeContent for plugin ${plugin.name}`\n        )\n      }\n\n      return loadNodeContent(node).then(content => {\n        // TODO update node's content field here.\n        resolve(content)\n      })\n    })\n  }\n}\n\n/**\n * Get node and save path dependency.\n *\n * @param {string} id\n * @param {string} path\n * @returns {Object} node\n */\nexports.getNodeAndSavePathDependency = (id, path) => {\n  const createPageDependency = require(`./actions/add-page-dependency`)\n  const node = getNode(id)\n  createPageDependency({ path, nodeId: id })\n  return node\n}\n"],"file":"nodes.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/redux/plugin-runner.js
+++ b/node_modules/gatsby/dist/redux/plugin-runner.js
@@ -1,11 +1,13 @@
 "use strict";
 
 // Invoke plugins for certain actions.
-const _require = require(`./index`),
-      emitter = _require.emitter;
+const {
+  emitter
+} = require(`./index`);
 
-const _require2 = require(`../db/nodes`),
-      getNode = _require2.getNode;
+const {
+  getNode
+} = require(`../db/nodes`);
 
 const apiRunnerNode = require(`../utils/api-runner-node`);
 
--- a/node_modules/gatsby/dist/redux/plugin-runner.js.map
+++ b/node_modules/gatsby/dist/redux/plugin-runner.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/redux/plugin-runner.js"],"names":["require","emitter","getNode","apiRunnerNode","on","action","node","payload","id","traceTags","nodeId","nodeType","internal","type","traceId","parentSpan","page","plugin","name"],"mappings":";;AAAA;iBAEoBA,OAAO,CAAE,SAAF,C;MAAnBC,O,YAAAA,O;;kBACYD,OAAO,CAAE,aAAF,C;MAAnBE,O,aAAAA,O;;AACR,MAAMC,aAAa,GAAGH,OAAO,CAAE,0BAAF,CAA7B;;AAEAC,OAAO,CAACG,EAAR,CAAY,aAAZ,EAA0BC,MAAM,IAAI;AAClC,QAAMC,IAAI,GAAGJ,OAAO,CAACG,MAAM,CAACE,OAAP,CAAeC,EAAhB,CAApB;AACA,QAAMC,SAAS,GAAG;AAAEC,IAAAA,MAAM,EAAEJ,IAAI,CAACE,EAAf;AAAmBG,IAAAA,QAAQ,EAAEL,IAAI,CAACM,QAAL,CAAcC;AAA3C,GAAlB;AACAV,EAAAA,aAAa,CAAE,cAAF,EAAiB;AAC5BG,IAAAA,IAD4B;AAE5BQ,IAAAA,OAAO,EAAET,MAAM,CAACS,OAFY;AAG5BC,IAAAA,UAAU,EAAEV,MAAM,CAACU,UAHS;AAI5BN,IAAAA;AAJ4B,GAAjB,CAAb;AAMD,CATD;AAWAR,OAAO,CAACG,EAAR,CAAY,aAAZ,EAA0BC,MAAM,IAAI;AAClC,QAAMW,IAAI,GAAGX,MAAM,CAACE,OAApB;AACAJ,EAAAA,aAAa,CACV,cADU,EAEX;AAAEa,IAAAA,IAAF;AAAQF,IAAAA,OAAO,EAAET,MAAM,CAACS,OAAxB;AAAiCC,IAAAA,UAAU,EAAEV,MAAM,CAACU;AAApD,GAFW,EAGXV,MAAM,CAACY,MAAP,CAAcC,IAHH,CAAb;AAKD,CAPD","sourcesContent":["// Invoke plugins for certain actions.\n\nconst { emitter } = require(`./index`)\nconst { getNode } = require(`../db/nodes`)\nconst apiRunnerNode = require(`../utils/api-runner-node`)\n\nemitter.on(`CREATE_NODE`, action => {\n  const node = getNode(action.payload.id)\n  const traceTags = { nodeId: node.id, nodeType: node.internal.type }\n  apiRunnerNode(`onCreateNode`, {\n    node,\n    traceId: action.traceId,\n    parentSpan: action.parentSpan,\n    traceTags,\n  })\n})\n\nemitter.on(`CREATE_PAGE`, action => {\n  const page = action.payload\n  apiRunnerNode(\n    `onCreatePage`,\n    { page, traceId: action.traceId, parentSpan: action.parentSpan },\n    action.plugin.name\n  )\n})\n"],"file":"plugin-runner.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/redux/plugin-runner.js"],"names":["emitter","require","getNode","apiRunnerNode","on","action","node","payload","id","traceTags","nodeId","nodeType","internal","type","traceId","parentSpan","page","plugin","name"],"mappings":";;AAAA;AAEA,MAAM;AAAEA,EAAAA;AAAF,IAAcC,OAAO,CAAE,SAAF,CAA3B;;AACA,MAAM;AAAEC,EAAAA;AAAF,IAAcD,OAAO,CAAE,aAAF,CAA3B;;AACA,MAAME,aAAa,GAAGF,OAAO,CAAE,0BAAF,CAA7B;;AAEAD,OAAO,CAACI,EAAR,CAAY,aAAZ,EAA0BC,MAAM,IAAI;AAClC,QAAMC,IAAI,GAAGJ,OAAO,CAACG,MAAM,CAACE,OAAP,CAAeC,EAAhB,CAApB;AACA,QAAMC,SAAS,GAAG;AAAEC,IAAAA,MAAM,EAAEJ,IAAI,CAACE,EAAf;AAAmBG,IAAAA,QAAQ,EAAEL,IAAI,CAACM,QAAL,CAAcC;AAA3C,GAAlB;AACAV,EAAAA,aAAa,CAAE,cAAF,EAAiB;AAC5BG,IAAAA,IAD4B;AAE5BQ,IAAAA,OAAO,EAAET,MAAM,CAACS,OAFY;AAG5BC,IAAAA,UAAU,EAAEV,MAAM,CAACU,UAHS;AAI5BN,IAAAA;AAJ4B,GAAjB,CAAb;AAMD,CATD;AAWAT,OAAO,CAACI,EAAR,CAAY,aAAZ,EAA0BC,MAAM,IAAI;AAClC,QAAMW,IAAI,GAAGX,MAAM,CAACE,OAApB;AACAJ,EAAAA,aAAa,CACV,cADU,EAEX;AAAEa,IAAAA,IAAF;AAAQF,IAAAA,OAAO,EAAET,MAAM,CAACS,OAAxB;AAAiCC,IAAAA,UAAU,EAAEV,MAAM,CAACU;AAApD,GAFW,EAGXV,MAAM,CAACY,MAAP,CAAcC,IAHH,CAAb;AAKD,CAPD","sourcesContent":["// Invoke plugins for certain actions.\n\nconst { emitter } = require(`./index`)\nconst { getNode } = require(`../db/nodes`)\nconst apiRunnerNode = require(`../utils/api-runner-node`)\n\nemitter.on(`CREATE_NODE`, action => {\n  const node = getNode(action.payload.id)\n  const traceTags = { nodeId: node.id, nodeType: node.internal.type }\n  apiRunnerNode(`onCreateNode`, {\n    node,\n    traceId: action.traceId,\n    parentSpan: action.parentSpan,\n    traceTags,\n  })\n})\n\nemitter.on(`CREATE_PAGE`, action => {\n  const page = action.payload\n  apiRunnerNode(\n    `onCreatePage`,\n    { page, traceId: action.traceId, parentSpan: action.parentSpan },\n    action.plugin.name\n  )\n})\n"],"file":"plugin-runner.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/redux/reducers/api-to-plugins.js
+++ b/node_modules/gatsby/dist/redux/reducers/api-to-plugins.js
@@ -3,7 +3,8 @@
 module.exports = (state = [], action) => {
   switch (action.type) {
     case `SET_SITE_API_TO_PLUGINS`:
-      return Object.assign({}, action.payload);
+      return { ...action.payload
+      };
 
     default:
       return state;
--- a/node_modules/gatsby/dist/redux/reducers/api-to-plugins.js.map
+++ b/node_modules/gatsby/dist/redux/reducers/api-to-plugins.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../../src/redux/reducers/api-to-plugins.js"],"names":["module","exports","state","action","type","payload"],"mappings":";;AAAAA,MAAM,CAACC,OAAP,GAAiB,CAACC,KAAK,GAAG,EAAT,EAAaC,MAAb,KAAwB;AACvC,UAAQA,MAAM,CAACC,IAAf;AACE,SAAM,yBAAN;AACE,+BAAYD,MAAM,CAACE,OAAnB;;AACF;AACE,aAAOH,KAAP;AAJJ;AAMD,CAPD","sourcesContent":["module.exports = (state = [], action) => {\n  switch (action.type) {\n    case `SET_SITE_API_TO_PLUGINS`:\n      return { ...action.payload }\n    default:\n      return state\n  }\n}\n"],"file":"api-to-plugins.js"}
\ No newline at end of file
+{"version":3,"sources":["../../../src/redux/reducers/api-to-plugins.js"],"names":["module","exports","state","action","type","payload"],"mappings":";;AAAAA,MAAM,CAACC,OAAP,GAAiB,CAACC,KAAK,GAAG,EAAT,EAAaC,MAAb,KAAwB;AACvC,UAAQA,MAAM,CAACC,IAAf;AACE,SAAM,yBAAN;AACE,aAAO,EAAE,GAAGD,MAAM,CAACE;AAAZ,OAAP;;AACF;AACE,aAAOH,KAAP;AAJJ;AAMD,CAPD","sourcesContent":["module.exports = (state = [], action) => {\n  switch (action.type) {\n    case `SET_SITE_API_TO_PLUGINS`:\n      return { ...action.payload }\n    default:\n      return state\n  }\n}\n"],"file":"api-to-plugins.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/redux/reducers/babelrc.js
+++ b/node_modules/gatsby/dist/redux/reducers/babelrc.js
@@ -94,7 +94,9 @@ module.exports = (state = {
             return;
           }
 
-          state.stages[stage].options = Object.assign({}, state.stages[stage].options, action.payload.options);
+          state.stages[stage].options = { ...state.stages[stage].options,
+            ...action.payload.options
+          };
         });
         return state;
       }
--- a/node_modules/gatsby/dist/redux/reducers/babelrc.js.map
+++ b/node_modules/gatsby/dist/redux/reducers/babelrc.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../../src/redux/reducers/babelrc.js"],"names":["_","require","module","exports","state","stages","develop","plugins","presets","options","cacheDirectory","sourceType","action","type","Object","keys","forEach","stage","payload","index","findIndex","p","name","plugin","merge"],"mappings":";;AAAA,MAAMA,CAAC,GAAGC,OAAO,CAAE,QAAF,CAAjB;;AAEAC,MAAM,CAACC,OAAP,GAAiB,CACfC,KAAK,GAAG;AACNC,EAAAA,MAAM,EAAE;AACNC,IAAAA,OAAO,EAAE;AACPC,MAAAA,OAAO,EAAE,EADF;AAEPC,MAAAA,OAAO,EAAE,EAFF;AAGPC,MAAAA,OAAO,EAAE;AACPC,QAAAA,cAAc,EAAE,IADT;AAEPC,QAAAA,UAAU,EAAG;AAFN;AAHF,KADH;AASN,oBAAgB;AACdJ,MAAAA,OAAO,EAAE,EADK;AAEdC,MAAAA,OAAO,EAAE,EAFK;AAGdC,MAAAA,OAAO,EAAE;AACPC,QAAAA,cAAc,EAAE,IADT;AAEPC,QAAAA,UAAU,EAAG;AAFN;AAHK,KATV;AAiBN,kBAAc;AACZJ,MAAAA,OAAO,EAAE,EADG;AAEZC,MAAAA,OAAO,EAAE,EAFG;AAGZC,MAAAA,OAAO,EAAE;AACPC,QAAAA,cAAc,EAAE,IADT;AAEPC,QAAAA,UAAU,EAAG;AAFN;AAHG,KAjBR;AAyBN,wBAAoB;AAClBJ,MAAAA,OAAO,EAAE,EADS;AAElBC,MAAAA,OAAO,EAAE,EAFS;AAGlBC,MAAAA,OAAO,EAAE;AACPC,QAAAA,cAAc,EAAE,IADT;AAEPC,QAAAA,UAAU,EAAG;AAFN;AAHS;AAzBd;AADF,CADO,EAqCfC,MArCe,KAsCZ;AACH,UAAQA,MAAM,CAACC,IAAf;AACE,SAAM,kBAAN;AAAyB;AACvBC,QAAAA,MAAM,CAACC,IAAP,CAAYX,KAAK,CAACC,MAAlB,EAA0BW,OAA1B,CAAkCC,KAAK,IAAI;AACzC,cAAIL,MAAM,CAACM,OAAP,CAAeD,KAAf,IAAwBL,MAAM,CAACM,OAAP,CAAeD,KAAf,KAAyBA,KAArD,EAA4D;AAC1D;AACD;;AAED,gBAAME,KAAK,GAAGnB,CAAC,CAACoB,SAAF,CACZhB,KAAK,CAACC,MAAN,CAAaY,KAAb,EAAoBV,OADR,EAEZc,CAAC,IAAIA,CAAC,CAACC,IAAF,KAAWV,MAAM,CAACM,OAAP,CAAeI,IAFnB,CAAd,CALyC,CASzC;AACA;;;AACA,cAAIH,KAAK,KAAK,CAAC,CAAf,EAAkB;AAChB,kBAAMI,MAAM,GAAGnB,KAAK,CAACC,MAAN,CAAaY,KAAb,EAAoBV,OAApB,CAA4BY,KAA5B,CAAf;AACAf,YAAAA,KAAK,CAACC,MAAN,CAAaY,KAAb,EAAoBV,OAApB,CAA4BY,KAA5B,IAAqC;AACnCG,cAAAA,IAAI,EAAEC,MAAM,CAACD,IADsB;AAEnCb,cAAAA,OAAO,EAAET,CAAC,CAACwB,KAAF,CAAQD,MAAM,CAACd,OAAf,EAAwBG,MAAM,CAACM,OAAP,CAAeT,OAAvC;AAF0B,aAArC;AAID,WAND,MAMO;AACLL,YAAAA,KAAK,CAACC,MAAN,CAAaY,KAAb,EAAoBV,OAApB,GAA8B,CAC5B,GAAGH,KAAK,CAACC,MAAN,CAAaY,KAAb,EAAoBV,OADK,EAE5BK,MAAM,CAACM,OAFqB,CAA9B;AAID;AACF,SAvBD;AAyBA,eAAOd,KAAP;AACD;;AACD,SAAM,kBAAN;AAAyB;AACvBU,QAAAA,MAAM,CAACC,IAAP,CAAYX,KAAK,CAACC,MAAlB,EAA0BW,OAA1B,CAAkCC,KAAK,IAAI;AACzC,cAAIL,MAAM,CAACM,OAAP,CAAeD,KAAf,IAAwBL,MAAM,CAACM,OAAP,CAAeD,KAAf,KAAyBA,KAArD,EAA4D;AAC1D;AACD;;AAED,gBAAME,KAAK,GAAGnB,CAAC,CAACoB,SAAF,CACZhB,KAAK,CAACC,MAAN,CAAaY,KAAb,EAAoBT,OADR,EAEZa,CAAC,IAAIA,CAAC,CAACC,IAAF,KAAWV,MAAM,CAACM,OAAP,CAAeI,IAFnB,CAAd,CALyC,CASzC;AACA;;;AACA,cAAIH,KAAK,KAAK,CAAC,CAAf,EAAkB;AAChB,kBAAMI,MAAM,GAAGnB,KAAK,CAACC,MAAN,CAAaY,KAAb,EAAoBT,OAApB,CAA4BW,KAA5B,CAAf;AACAf,YAAAA,KAAK,CAACC,MAAN,CAAaY,KAAb,EAAoBT,OAApB,CAA4BW,KAA5B,IAAqC;AACnCG,cAAAA,IAAI,EAAEC,MAAM,CAACD,IADsB;AAEnCb,cAAAA,OAAO,EAAET,CAAC,CAACwB,KAAF,CAAQD,MAAM,CAACd,OAAf,EAAwBG,MAAM,CAACM,OAAP,CAAeT,OAAvC;AAF0B,aAArC;AAID,WAND,MAMO;AACLL,YAAAA,KAAK,CAACC,MAAN,CAAaY,KAAb,EAAoBT,OAApB,GAA8B,CAC5B,GAAGJ,KAAK,CAACC,MAAN,CAAaY,KAAb,EAAoBT,OADK,EAE5BI,MAAM,CAACM,OAFqB,CAA9B;AAID;AACF,SAvBD;AAwBA,eAAOd,KAAP;AACD;;AACD,SAAM,mBAAN;AAA0B;AACxBU,QAAAA,MAAM,CAACC,IAAP,CAAYX,KAAK,CAACC,MAAlB,EAA0BW,OAA1B,CAAkCC,KAAK,IAAI;AACzC,cAAIL,MAAM,CAACM,OAAP,CAAeD,KAAf,IAAwBL,MAAM,CAACM,OAAP,CAAeD,KAAf,KAAyBA,KAArD,EAA4D;AAC1D;AACD;;AAEDb,UAAAA,KAAK,CAACC,MAAN,CAAaY,KAAb,EAAoBR,OAApB,qBACKL,KAAK,CAACC,MAAN,CAAaY,KAAb,EAAoBR,OADzB,EAEKG,MAAM,CAACM,OAAP,CAAeT,OAFpB;AAID,SATD;AAUA,eAAOL,KAAP;AACD;AApEH;;AAuEA,SAAOA,KAAP;AACD,CA/GD","sourcesContent":["const _ = require(`lodash`)\n\nmodule.exports = (\n  state = {\n    stages: {\n      develop: {\n        plugins: [],\n        presets: [],\n        options: {\n          cacheDirectory: true,\n          sourceType: `unambiguous`,\n        },\n      },\n      \"develop-html\": {\n        plugins: [],\n        presets: [],\n        options: {\n          cacheDirectory: true,\n          sourceType: `unambiguous`,\n        },\n      },\n      \"build-html\": {\n        plugins: [],\n        presets: [],\n        options: {\n          cacheDirectory: true,\n          sourceType: `unambiguous`,\n        },\n      },\n      \"build-javascript\": {\n        plugins: [],\n        presets: [],\n        options: {\n          cacheDirectory: true,\n          sourceType: `unambiguous`,\n        },\n      },\n    },\n  },\n  action\n) => {\n  switch (action.type) {\n    case `SET_BABEL_PLUGIN`: {\n      Object.keys(state.stages).forEach(stage => {\n        if (action.payload.stage && action.payload.stage !== stage) {\n          return\n        }\n\n        const index = _.findIndex(\n          state.stages[stage].plugins,\n          p => p.name === action.payload.name\n        )\n        // If the plugin already exists, merge the options.\n        // Otherwise, add it to the end.\n        if (index !== -1) {\n          const plugin = state.stages[stage].plugins[index]\n          state.stages[stage].plugins[index] = {\n            name: plugin.name,\n            options: _.merge(plugin.options, action.payload.options),\n          }\n        } else {\n          state.stages[stage].plugins = [\n            ...state.stages[stage].plugins,\n            action.payload,\n          ]\n        }\n      })\n\n      return state\n    }\n    case `SET_BABEL_PRESET`: {\n      Object.keys(state.stages).forEach(stage => {\n        if (action.payload.stage && action.payload.stage !== stage) {\n          return\n        }\n\n        const index = _.findIndex(\n          state.stages[stage].presets,\n          p => p.name === action.payload.name\n        )\n        // If the plugin already exists, merge the options.\n        // Otherwise, add it to the end.\n        if (index !== -1) {\n          const plugin = state.stages[stage].presets[index]\n          state.stages[stage].presets[index] = {\n            name: plugin.name,\n            options: _.merge(plugin.options, action.payload.options),\n          }\n        } else {\n          state.stages[stage].presets = [\n            ...state.stages[stage].presets,\n            action.payload,\n          ]\n        }\n      })\n      return state\n    }\n    case `SET_BABEL_OPTIONS`: {\n      Object.keys(state.stages).forEach(stage => {\n        if (action.payload.stage && action.payload.stage !== stage) {\n          return\n        }\n\n        state.stages[stage].options = {\n          ...state.stages[stage].options,\n          ...action.payload.options,\n        }\n      })\n      return state\n    }\n  }\n\n  return state\n}\n"],"file":"babelrc.js"}
\ No newline at end of file
+{"version":3,"sources":["../../../src/redux/reducers/babelrc.js"],"names":["_","require","module","exports","state","stages","develop","plugins","presets","options","cacheDirectory","sourceType","action","type","Object","keys","forEach","stage","payload","index","findIndex","p","name","plugin","merge"],"mappings":"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","sourcesContent":["const _ = require(`lodash`)\n\nmodule.exports = (\n  state = {\n    stages: {\n      develop: {\n        plugins: [],\n        presets: [],\n        options: {\n          cacheDirectory: true,\n          sourceType: `unambiguous`,\n        },\n      },\n      \"develop-html\": {\n        plugins: [],\n        presets: [],\n        options: {\n          cacheDirectory: true,\n          sourceType: `unambiguous`,\n        },\n      },\n      \"build-html\": {\n        plugins: [],\n        presets: [],\n        options: {\n          cacheDirectory: true,\n          sourceType: `unambiguous`,\n        },\n      },\n      \"build-javascript\": {\n        plugins: [],\n        presets: [],\n        options: {\n          cacheDirectory: true,\n          sourceType: `unambiguous`,\n        },\n      },\n    },\n  },\n  action\n) => {\n  switch (action.type) {\n    case `SET_BABEL_PLUGIN`: {\n      Object.keys(state.stages).forEach(stage => {\n        if (action.payload.stage && action.payload.stage !== stage) {\n          return\n        }\n\n        const index = _.findIndex(\n          state.stages[stage].plugins,\n          p => p.name === action.payload.name\n        )\n        // If the plugin already exists, merge the options.\n        // Otherwise, add it to the end.\n        if (index !== -1) {\n          const plugin = state.stages[stage].plugins[index]\n          state.stages[stage].plugins[index] = {\n            name: plugin.name,\n            options: _.merge(plugin.options, action.payload.options),\n          }\n        } else {\n          state.stages[stage].plugins = [\n            ...state.stages[stage].plugins,\n            action.payload,\n          ]\n        }\n      })\n\n      return state\n    }\n    case `SET_BABEL_PRESET`: {\n      Object.keys(state.stages).forEach(stage => {\n        if (action.payload.stage && action.payload.stage !== stage) {\n          return\n        }\n\n        const index = _.findIndex(\n          state.stages[stage].presets,\n          p => p.name === action.payload.name\n        )\n        // If the plugin already exists, merge the options.\n        // Otherwise, add it to the end.\n        if (index !== -1) {\n          const plugin = state.stages[stage].presets[index]\n          state.stages[stage].presets[index] = {\n            name: plugin.name,\n            options: _.merge(plugin.options, action.payload.options),\n          }\n        } else {\n          state.stages[stage].presets = [\n            ...state.stages[stage].presets,\n            action.payload,\n          ]\n        }\n      })\n      return state\n    }\n    case `SET_BABEL_OPTIONS`: {\n      Object.keys(state.stages).forEach(stage => {\n        if (action.payload.stage && action.payload.stage !== stage) {\n          return\n        }\n\n        state.stages[stage].options = {\n          ...state.stages[stage].options,\n          ...action.payload.options,\n        }\n      })\n      return state\n    }\n  }\n\n  return state\n}\n"],"file":"babelrc.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/redux/reducers/components.js
+++ b/node_modules/gatsby/dist/redux/reducers/components.js
@@ -24,9 +24,9 @@ module.exports = (state = new Map(), action) => {
 
     case `REPLACE_COMPONENT_QUERY`:
       action.payload.componentPath = normalize(action.payload.componentPath);
-      state.set(action.payload.componentPath, Object.assign({}, state.get(action.payload.componentPath), {
+      state.set(action.payload.componentPath, { ...state.get(action.payload.componentPath),
         query: action.payload.query
-      }));
+      });
       return state;
   }
 
--- a/node_modules/gatsby/dist/redux/reducers/components.js.map
+++ b/node_modules/gatsby/dist/redux/reducers/components.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../../src/redux/reducers/components.js"],"names":["_","require","normalize","module","exports","state","Map","action","type","payload","componentPath","component","set","merge","query","get","delete"],"mappings":";;AAAA,MAAMA,CAAC,GAAGC,OAAO,CAAE,QAAF,CAAjB;;AACA,MAAMC,SAAS,GAAGD,OAAO,CAAE,gBAAF,CAAzB;;AAEAE,MAAM,CAACC,OAAP,GAAiB,CAACC,KAAK,GAAG,IAAIC,GAAJ,EAAT,EAAoBC,MAApB,KAA+B;AAC9C,UAAQA,MAAM,CAACC,IAAf;AACE,SAAM,cAAN;AACE,aAAO,IAAIF,GAAJ,EAAP;;AACF,SAAM,aAAN;AACEC,MAAAA,MAAM,CAACE,OAAP,CAAeC,aAAf,GAA+BR,SAAS,CAACK,MAAM,CAACE,OAAP,CAAeE,SAAhB,CAAxC;AACAN,MAAAA,KAAK,CAACO,GAAN,CACEL,MAAM,CAACE,OAAP,CAAeC,aADjB,EAEEV,CAAC,CAACa,KAAF,CAAQ;AAAEC,QAAAA,KAAK,EAAG;AAAV,OAAR,EAAuBT,KAAK,CAACU,GAAN,CAAUR,MAAM,CAACE,OAAP,CAAeC,aAAzB,CAAvB,EAAgE;AAC9DA,QAAAA,aAAa,EAAEH,MAAM,CAACE,OAAP,CAAeC;AADgC,OAAhE,CAFF;AAMA,aAAOL,KAAP;;AACF,SAAM,2BAAN;AACEA,MAAAA,KAAK,CAACW,MAAN,CAAad,SAAS,CAACK,MAAM,CAACE,OAAP,CAAeC,aAAhB,CAAtB;AACA,aAAOL,KAAP;;AACF,SAAM,yBAAN;AACEE,MAAAA,MAAM,CAACE,OAAP,CAAeC,aAAf,GAA+BR,SAAS,CAACK,MAAM,CAACE,OAAP,CAAeC,aAAhB,CAAxC;AACAL,MAAAA,KAAK,CAACO,GAAN,CAAUL,MAAM,CAACE,OAAP,CAAeC,aAAzB,oBACKL,KAAK,CAACU,GAAN,CAAUR,MAAM,CAACE,OAAP,CAAeC,aAAzB,CADL;AAEEI,QAAAA,KAAK,EAAEP,MAAM,CAACE,OAAP,CAAeK;AAFxB;AAIA,aAAOT,KAAP;AArBJ;;AAwBA,SAAOA,KAAP;AACD,CA1BD","sourcesContent":["const _ = require(`lodash`)\nconst normalize = require(`normalize-path`)\n\nmodule.exports = (state = new Map(), action) => {\n  switch (action.type) {\n    case `DELETE_CACHE`:\n      return new Map()\n    case `CREATE_PAGE`:\n      action.payload.componentPath = normalize(action.payload.component)\n      state.set(\n        action.payload.componentPath,\n        _.merge({ query: `` }, state.get(action.payload.componentPath), {\n          componentPath: action.payload.componentPath,\n        })\n      )\n      return state\n    case `REMOVE_TEMPLATE_COMPONENT`:\n      state.delete(normalize(action.payload.componentPath))\n      return state\n    case `REPLACE_COMPONENT_QUERY`:\n      action.payload.componentPath = normalize(action.payload.componentPath)\n      state.set(action.payload.componentPath, {\n        ...state.get(action.payload.componentPath),\n        query: action.payload.query,\n      })\n      return state\n  }\n\n  return state\n}\n"],"file":"components.js"}
\ No newline at end of file
+{"version":3,"sources":["../../../src/redux/reducers/components.js"],"names":["_","require","normalize","module","exports","state","Map","action","type","payload","componentPath","component","set","merge","query","get","delete"],"mappings":";;AAAA,MAAMA,CAAC,GAAGC,OAAO,CAAE,QAAF,CAAjB;;AACA,MAAMC,SAAS,GAAGD,OAAO,CAAE,gBAAF,CAAzB;;AAEAE,MAAM,CAACC,OAAP,GAAiB,CAACC,KAAK,GAAG,IAAIC,GAAJ,EAAT,EAAoBC,MAApB,KAA+B;AAC9C,UAAQA,MAAM,CAACC,IAAf;AACE,SAAM,cAAN;AACE,aAAO,IAAIF,GAAJ,EAAP;;AACF,SAAM,aAAN;AACEC,MAAAA,MAAM,CAACE,OAAP,CAAeC,aAAf,GAA+BR,SAAS,CAACK,MAAM,CAACE,OAAP,CAAeE,SAAhB,CAAxC;AACAN,MAAAA,KAAK,CAACO,GAAN,CACEL,MAAM,CAACE,OAAP,CAAeC,aADjB,EAEEV,CAAC,CAACa,KAAF,CAAQ;AAAEC,QAAAA,KAAK,EAAG;AAAV,OAAR,EAAuBT,KAAK,CAACU,GAAN,CAAUR,MAAM,CAACE,OAAP,CAAeC,aAAzB,CAAvB,EAAgE;AAC9DA,QAAAA,aAAa,EAAEH,MAAM,CAACE,OAAP,CAAeC;AADgC,OAAhE,CAFF;AAMA,aAAOL,KAAP;;AACF,SAAM,2BAAN;AACEA,MAAAA,KAAK,CAACW,MAAN,CAAad,SAAS,CAACK,MAAM,CAACE,OAAP,CAAeC,aAAhB,CAAtB;AACA,aAAOL,KAAP;;AACF,SAAM,yBAAN;AACEE,MAAAA,MAAM,CAACE,OAAP,CAAeC,aAAf,GAA+BR,SAAS,CAACK,MAAM,CAACE,OAAP,CAAeC,aAAhB,CAAxC;AACAL,MAAAA,KAAK,CAACO,GAAN,CAAUL,MAAM,CAACE,OAAP,CAAeC,aAAzB,EAAwC,EACtC,GAAGL,KAAK,CAACU,GAAN,CAAUR,MAAM,CAACE,OAAP,CAAeC,aAAzB,CADmC;AAEtCI,QAAAA,KAAK,EAAEP,MAAM,CAACE,OAAP,CAAeK;AAFgB,OAAxC;AAIA,aAAOT,KAAP;AArBJ;;AAwBA,SAAOA,KAAP;AACD,CA1BD","sourcesContent":["const _ = require(`lodash`)\nconst normalize = require(`normalize-path`)\n\nmodule.exports = (state = new Map(), action) => {\n  switch (action.type) {\n    case `DELETE_CACHE`:\n      return new Map()\n    case `CREATE_PAGE`:\n      action.payload.componentPath = normalize(action.payload.component)\n      state.set(\n        action.payload.componentPath,\n        _.merge({ query: `` }, state.get(action.payload.componentPath), {\n          componentPath: action.payload.componentPath,\n        })\n      )\n      return state\n    case `REMOVE_TEMPLATE_COMPONENT`:\n      state.delete(normalize(action.payload.componentPath))\n      return state\n    case `REPLACE_COMPONENT_QUERY`:\n      action.payload.componentPath = normalize(action.payload.componentPath)\n      state.set(action.payload.componentPath, {\n        ...state.get(action.payload.componentPath),\n        query: action.payload.query,\n      })\n      return state\n  }\n\n  return state\n}\n"],"file":"components.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/redux/reducers/config.js
+++ b/node_modules/gatsby/dist/redux/reducers/config.js
@@ -6,8 +6,9 @@ const chalk = require(`chalk`);
 
 const _ = require(`lodash`);
 
-const _require = require(`../../joi-schemas/joi`),
-      gatsbyConfigSchema = _require.gatsbyConfigSchema;
+const {
+  gatsbyConfigSchema
+} = require(`../../joi-schemas/joi`);
 
 module.exports = (state = {}, action) => {
   switch (action.type) {
@@ -52,7 +53,8 @@ module.exports = (state = {}, action) => {
           action = _.set(action, [`payload`, `polyfill`], true);
         }
 
-        return Object.assign({}, action.payload);
+        return { ...action.payload
+        };
       }
 
     default:
--- a/node_modules/gatsby/dist/redux/reducers/config.js.map
+++ b/node_modules/gatsby/dist/redux/reducers/config.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../../src/redux/reducers/config.js"],"names":["Joi","require","chalk","_","gatsbyConfigSchema","module","exports","state","action","type","result","validate","payload","error","console","log","blue","bgYellow","bold","red","linkPrefix","Error","pathPrefix","startsWith","endsWith","slice","has","set"],"mappings":";;AAAA,MAAMA,GAAG,GAAGC,OAAO,CAAE,KAAF,CAAnB;;AACA,MAAMC,KAAK,GAAGD,OAAO,CAAE,OAAF,CAArB;;AACA,MAAME,CAAC,GAAGF,OAAO,CAAE,QAAF,CAAjB;;iBAE+BA,OAAO,CAAE,uBAAF,C;MAA9BG,kB,YAAAA,kB;;AAERC,MAAM,CAACC,OAAP,GAAiB,CAACC,KAAK,GAAG,EAAT,EAAaC,MAAb,KAAwB;AACvC,UAAQA,MAAM,CAACC,IAAf;AACE,SAAM,iBAAN;AAAwB;AACtB;AACA,cAAMC,MAAM,GAAGV,GAAG,CAACW,QAAJ,CAAaH,MAAM,CAACI,OAApB,EAA6BR,kBAA7B,CAAf,CAFsB,CAGtB;AACA;AACA;;AACA,YAAIM,MAAM,CAACG,KAAX,EAAkB;AAChBC,UAAAA,OAAO,CAACC,GAAR,CACEb,KAAK,CAACc,IAAN,CAAWC,QAAX,CAAqB,+CAArB,CADF;AAGAH,UAAAA,OAAO,CAACC,GAAR,CAAYb,KAAK,CAACgB,IAAN,CAAWC,GAAX,CAAeT,MAAM,CAACG,KAAtB,CAAZ;;AACA,cAAIL,MAAM,CAACI,OAAP,CAAeQ,UAAnB,EAA+B;AAC7BN,YAAAA,OAAO,CAACC,GAAR,CAAa,gDAAb;AACD;;AACD,gBAAM,IAAIM,KAAJ,CAAW,+CAAX,CAAN;AACD,SAfqB,CAiBtB;AACA;;;AACA,YAAIb,MAAM,CAACI,OAAP,IAAkBJ,MAAM,CAACI,OAAP,CAAeU,UAArC,EAAiD;AAC/C,cAAI,CAACnB,CAAC,CAACoB,UAAF,CAAaf,MAAM,CAACI,OAAP,CAAeU,UAA5B,EAAyC,GAAzC,CAAL,EAAmD;AACjDd,YAAAA,MAAM,CAACI,OAAP,CAAeU,UAAf,GAA6B,IAAGd,MAAM,CAACI,OAAP,CAAeU,UAAW,EAA1D;AACD;;AACD,cAAInB,CAAC,CAACqB,QAAF,CAAWhB,MAAM,CAACI,OAAP,CAAeU,UAA1B,EAAuC,GAAvC,CAAJ,EAAgD;AAC9Cd,YAAAA,MAAM,CAACI,OAAP,CAAeU,UAAf,GAA4Bd,MAAM,CAACI,OAAP,CAAeU,UAAf,CAA0BG,KAA1B,CAAgC,CAAhC,EAAmC,CAAC,CAApC,CAA5B;AACD;AACF,SA1BqB,CA4BtB;AACA;;;AACA,YAAI,CAACtB,CAAC,CAACuB,GAAF,CAAMlB,MAAN,EAAc,CAAE,SAAF,EAAa,YAAb,CAAd,CAAL,EAA+C;AAC7CA,UAAAA,MAAM,GAAGL,CAAC,CAACwB,GAAF,CAAMnB,MAAN,EAAc,CAAE,SAAF,EAAa,YAAb,CAAd,EAA0C,EAA1C,CAAT;AACD,SAhCqB,CAkCtB;;;AACA,YAAI,CAACL,CAAC,CAACuB,GAAF,CAAMlB,MAAN,EAAc,CAAE,SAAF,EAAa,UAAb,CAAd,CAAL,EAA6C;AAC3CA,UAAAA,MAAM,GAAGL,CAAC,CAACwB,GAAF,CAAMnB,MAAN,EAAc,CAAE,SAAF,EAAa,UAAb,CAAd,EAAuC,IAAvC,CAAT;AACD;;AAED,iCACKA,MAAM,CAACI,OADZ;AAGD;;AACD;AACE,aAAOL,KAAP;AA7CJ;AA+CD,CAhDD","sourcesContent":["const Joi = require(`joi`)\nconst chalk = require(`chalk`)\nconst _ = require(`lodash`)\n\nconst { gatsbyConfigSchema } = require(`../../joi-schemas/joi`)\n\nmodule.exports = (state = {}, action) => {\n  switch (action.type) {\n    case `SET_SITE_CONFIG`: {\n      // Validate the config.\n      const result = Joi.validate(action.payload, gatsbyConfigSchema)\n      // TODO use Redux for capturing errors from different\n      // parts of Gatsby so a) can capture richer errors and b) be\n      // more flexible how to display them.\n      if (result.error) {\n        console.log(\n          chalk.blue.bgYellow(`The site's gatsby-config.js failed validation`)\n        )\n        console.log(chalk.bold.red(result.error))\n        if (action.payload.linkPrefix) {\n          console.log(`\"linkPrefix\" should be changed to \"pathPrefix\"`)\n        }\n        throw new Error(`The site's gatsby-config.js failed validation`)\n      }\n\n      // Ensure that the pathPrefix (if set) starts with a forward slash\n      // and doesn't end with a slash.\n      if (action.payload && action.payload.pathPrefix) {\n        if (!_.startsWith(action.payload.pathPrefix, `/`)) {\n          action.payload.pathPrefix = `/${action.payload.pathPrefix}`\n        }\n        if (_.endsWith(action.payload.pathPrefix, `/`)) {\n          action.payload.pathPrefix = action.payload.pathPrefix.slice(0, -1)\n        }\n      }\n\n      // If pathPrefix isn't set, set it to an empty string\n      // to avoid it showing up as undefined elsewhere.\n      if (!_.has(action, [`payload`, `pathPrefix`])) {\n        action = _.set(action, [`payload`, `pathPrefix`], ``)\n      }\n\n      // Default polyfill to true.\n      if (!_.has(action, [`payload`, `polyfill`])) {\n        action = _.set(action, [`payload`, `polyfill`], true)\n      }\n\n      return {\n        ...action.payload,\n      }\n    }\n    default:\n      return state\n  }\n}\n"],"file":"config.js"}
\ No newline at end of file
+{"version":3,"sources":["../../../src/redux/reducers/config.js"],"names":["Joi","require","chalk","_","gatsbyConfigSchema","module","exports","state","action","type","result","validate","payload","error","console","log","blue","bgYellow","bold","red","linkPrefix","Error","pathPrefix","startsWith","endsWith","slice","has","set"],"mappings":";;AAAA,MAAMA,GAAG,GAAGC,OAAO,CAAE,KAAF,CAAnB;;AACA,MAAMC,KAAK,GAAGD,OAAO,CAAE,OAAF,CAArB;;AACA,MAAME,CAAC,GAAGF,OAAO,CAAE,QAAF,CAAjB;;AAEA,MAAM;AAAEG,EAAAA;AAAF,IAAyBH,OAAO,CAAE,uBAAF,CAAtC;;AAEAI,MAAM,CAACC,OAAP,GAAiB,CAACC,KAAK,GAAG,EAAT,EAAaC,MAAb,KAAwB;AACvC,UAAQA,MAAM,CAACC,IAAf;AACE,SAAM,iBAAN;AAAwB;AACtB;AACA,cAAMC,MAAM,GAAGV,GAAG,CAACW,QAAJ,CAAaH,MAAM,CAACI,OAApB,EAA6BR,kBAA7B,CAAf,CAFsB,CAGtB;AACA;AACA;;AACA,YAAIM,MAAM,CAACG,KAAX,EAAkB;AAChBC,UAAAA,OAAO,CAACC,GAAR,CACEb,KAAK,CAACc,IAAN,CAAWC,QAAX,CAAqB,+CAArB,CADF;AAGAH,UAAAA,OAAO,CAACC,GAAR,CAAYb,KAAK,CAACgB,IAAN,CAAWC,GAAX,CAAeT,MAAM,CAACG,KAAtB,CAAZ;;AACA,cAAIL,MAAM,CAACI,OAAP,CAAeQ,UAAnB,EAA+B;AAC7BN,YAAAA,OAAO,CAACC,GAAR,CAAa,gDAAb;AACD;;AACD,gBAAM,IAAIM,KAAJ,CAAW,+CAAX,CAAN;AACD,SAfqB,CAiBtB;AACA;;;AACA,YAAIb,MAAM,CAACI,OAAP,IAAkBJ,MAAM,CAACI,OAAP,CAAeU,UAArC,EAAiD;AAC/C,cAAI,CAACnB,CAAC,CAACoB,UAAF,CAAaf,MAAM,CAACI,OAAP,CAAeU,UAA5B,EAAyC,GAAzC,CAAL,EAAmD;AACjDd,YAAAA,MAAM,CAACI,OAAP,CAAeU,UAAf,GAA6B,IAAGd,MAAM,CAACI,OAAP,CAAeU,UAAW,EAA1D;AACD;;AACD,cAAInB,CAAC,CAACqB,QAAF,CAAWhB,MAAM,CAACI,OAAP,CAAeU,UAA1B,EAAuC,GAAvC,CAAJ,EAAgD;AAC9Cd,YAAAA,MAAM,CAACI,OAAP,CAAeU,UAAf,GAA4Bd,MAAM,CAACI,OAAP,CAAeU,UAAf,CAA0BG,KAA1B,CAAgC,CAAhC,EAAmC,CAAC,CAApC,CAA5B;AACD;AACF,SA1BqB,CA4BtB;AACA;;;AACA,YAAI,CAACtB,CAAC,CAACuB,GAAF,CAAMlB,MAAN,EAAc,CAAE,SAAF,EAAa,YAAb,CAAd,CAAL,EAA+C;AAC7CA,UAAAA,MAAM,GAAGL,CAAC,CAACwB,GAAF,CAAMnB,MAAN,EAAc,CAAE,SAAF,EAAa,YAAb,CAAd,EAA0C,EAA1C,CAAT;AACD,SAhCqB,CAkCtB;;;AACA,YAAI,CAACL,CAAC,CAACuB,GAAF,CAAMlB,MAAN,EAAc,CAAE,SAAF,EAAa,UAAb,CAAd,CAAL,EAA6C;AAC3CA,UAAAA,MAAM,GAAGL,CAAC,CAACwB,GAAF,CAAMnB,MAAN,EAAc,CAAE,SAAF,EAAa,UAAb,CAAd,EAAuC,IAAvC,CAAT;AACD;;AAED,eAAO,EACL,GAAGA,MAAM,CAACI;AADL,SAAP;AAGD;;AACD;AACE,aAAOL,KAAP;AA7CJ;AA+CD,CAhDD","sourcesContent":["const Joi = require(`joi`)\nconst chalk = require(`chalk`)\nconst _ = require(`lodash`)\n\nconst { gatsbyConfigSchema } = require(`../../joi-schemas/joi`)\n\nmodule.exports = (state = {}, action) => {\n  switch (action.type) {\n    case `SET_SITE_CONFIG`: {\n      // Validate the config.\n      const result = Joi.validate(action.payload, gatsbyConfigSchema)\n      // TODO use Redux for capturing errors from different\n      // parts of Gatsby so a) can capture richer errors and b) be\n      // more flexible how to display them.\n      if (result.error) {\n        console.log(\n          chalk.blue.bgYellow(`The site's gatsby-config.js failed validation`)\n        )\n        console.log(chalk.bold.red(result.error))\n        if (action.payload.linkPrefix) {\n          console.log(`\"linkPrefix\" should be changed to \"pathPrefix\"`)\n        }\n        throw new Error(`The site's gatsby-config.js failed validation`)\n      }\n\n      // Ensure that the pathPrefix (if set) starts with a forward slash\n      // and doesn't end with a slash.\n      if (action.payload && action.payload.pathPrefix) {\n        if (!_.startsWith(action.payload.pathPrefix, `/`)) {\n          action.payload.pathPrefix = `/${action.payload.pathPrefix}`\n        }\n        if (_.endsWith(action.payload.pathPrefix, `/`)) {\n          action.payload.pathPrefix = action.payload.pathPrefix.slice(0, -1)\n        }\n      }\n\n      // If pathPrefix isn't set, set it to an empty string\n      // to avoid it showing up as undefined elsewhere.\n      if (!_.has(action, [`payload`, `pathPrefix`])) {\n        action = _.set(action, [`payload`, `pathPrefix`], ``)\n      }\n\n      // Default polyfill to true.\n      if (!_.has(action, [`payload`, `polyfill`])) {\n        action = _.set(action, [`payload`, `polyfill`], true)\n      }\n\n      return {\n        ...action.payload,\n      }\n    }\n    default:\n      return state\n  }\n}\n"],"file":"config.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/redux/reducers/jobs.js
+++ b/node_modules/gatsby/dist/redux/reducers/jobs.js
@@ -2,8 +2,9 @@
 
 const _ = require(`lodash`);
 
-const _require = require(`common-tags`),
-      oneLine = _require.oneLine;
+const {
+  oneLine
+} = require(`common-tags`);
 
 const moment = require(`moment`);
 
@@ -21,10 +22,10 @@ module.exports = (state = {
 
         const index = _.findIndex(state.active, j => j.id === action.payload.id);
 
-        const mergedJob = _.merge(state.active[index], Object.assign({}, action.payload, {
+        const mergedJob = _.merge(state.active[index], { ...action.payload,
           createdAt: Date.now(),
           plugin: action.plugin
-        }));
+        });
 
         if (index !== -1) {
           return {
@@ -34,10 +35,10 @@ module.exports = (state = {
         } else {
           return {
             done: state.done,
-            active: state.active.concat([Object.assign({}, action.payload, {
+            active: state.active.concat([{ ...action.payload,
               createdAt: Date.now(),
               plugin: action.plugin
-            })])
+            }])
           };
         }
       }
@@ -59,10 +60,10 @@ module.exports = (state = {
         }
 
         return {
-          done: state.done.concat([Object.assign({}, job, {
+          done: state.done.concat([{ ...job,
             completedAt,
             runTime: moment(completedAt).diff(moment(job.createdAt))
-          })]),
+          }]),
           active: state.active.filter(j => j.id !== action.payload.id)
         };
       }
--- a/node_modules/gatsby/dist/redux/reducers/jobs.js.map
+++ b/node_modules/gatsby/dist/redux/reducers/jobs.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../../src/redux/reducers/jobs.js"],"names":["_","require","oneLine","moment","module","exports","state","active","done","action","type","payload","id","Error","index","findIndex","j","mergedJob","merge","createdAt","Date","now","plugin","slice","concat","completedAt","job","find","get","runTime","diff","filter"],"mappings":"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","sourcesContent":["const _ = require(`lodash`)\nconst { oneLine } = require(`common-tags`)\nconst moment = require(`moment`)\n\nmodule.exports = (state = { active: [], done: [] }, action) => {\n  switch (action.type) {\n    case `CREATE_JOB`:\n    case `SET_JOB`: {\n      if (!action.payload.id) {\n        throw new Error(`An ID must be provided when creating or setting job`)\n      }\n      const index = _.findIndex(state.active, j => j.id === action.payload.id)\n      const mergedJob = _.merge(state.active[index], {\n        ...action.payload,\n        createdAt: Date.now(),\n        plugin: action.plugin,\n      })\n      if (index !== -1) {\n        return {\n          done: state.done,\n          active: [\n            ...state.active\n              .slice(0, index)\n              .concat([mergedJob])\n              .concat(state.active.slice(index + 1)),\n          ],\n        }\n      } else {\n        return {\n          done: state.done,\n          active: state.active.concat([\n            {\n              ...action.payload,\n              createdAt: Date.now(),\n              plugin: action.plugin,\n            },\n          ]),\n        }\n      }\n    }\n    case `END_JOB`: {\n      if (!action.payload.id) {\n        throw new Error(`An ID must be provided when ending a job`)\n      }\n      const completedAt = Date.now()\n      const job = state.active.find(j => j.id === action.payload.id)\n      if (!job) {\n        throw new Error(oneLine`\n          The plugin \"${_.get(action, `plugin.name`, `anonymous`)}\"\n          tried to end a job with the id \"${action.payload.id}\"\n          that either hasn't yet been created or has already been ended`)\n      }\n\n      return {\n        done: state.done.concat([\n          {\n            ...job,\n            completedAt,\n            runTime: moment(completedAt).diff(moment(job.createdAt)),\n          },\n        ]),\n        active: state.active.filter(j => j.id !== action.payload.id),\n      }\n    }\n  }\n\n  return state\n}\n"],"file":"jobs.js"}
\ No newline at end of file
+{"version":3,"sources":["../../../src/redux/reducers/jobs.js"],"names":["_","require","oneLine","moment","module","exports","state","active","done","action","type","payload","id","Error","index","findIndex","j","mergedJob","merge","createdAt","Date","now","plugin","slice","concat","completedAt","job","find","get","runTime","diff","filter"],"mappings":"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","sourcesContent":["const _ = require(`lodash`)\nconst { oneLine } = require(`common-tags`)\nconst moment = require(`moment`)\n\nmodule.exports = (state = { active: [], done: [] }, action) => {\n  switch (action.type) {\n    case `CREATE_JOB`:\n    case `SET_JOB`: {\n      if (!action.payload.id) {\n        throw new Error(`An ID must be provided when creating or setting job`)\n      }\n      const index = _.findIndex(state.active, j => j.id === action.payload.id)\n      const mergedJob = _.merge(state.active[index], {\n        ...action.payload,\n        createdAt: Date.now(),\n        plugin: action.plugin,\n      })\n      if (index !== -1) {\n        return {\n          done: state.done,\n          active: [\n            ...state.active\n              .slice(0, index)\n              .concat([mergedJob])\n              .concat(state.active.slice(index + 1)),\n          ],\n        }\n      } else {\n        return {\n          done: state.done,\n          active: state.active.concat([\n            {\n              ...action.payload,\n              createdAt: Date.now(),\n              plugin: action.plugin,\n            },\n          ]),\n        }\n      }\n    }\n    case `END_JOB`: {\n      if (!action.payload.id) {\n        throw new Error(`An ID must be provided when ending a job`)\n      }\n      const completedAt = Date.now()\n      const job = state.active.find(j => j.id === action.payload.id)\n      if (!job) {\n        throw new Error(oneLine`\n          The plugin \"${_.get(action, `plugin.name`, `anonymous`)}\"\n          tried to end a job with the id \"${action.payload.id}\"\n          that either hasn't yet been created or has already been ended`)\n      }\n\n      return {\n        done: state.done.concat([\n          {\n            ...job,\n            completedAt,\n            runTime: moment(completedAt).diff(moment(job.createdAt)),\n          },\n        ]),\n        active: state.active.filter(j => j.id !== action.payload.id),\n      }\n    }\n  }\n\n  return state\n}\n"],"file":"jobs.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/redux/reducers/program.js
+++ b/node_modules/gatsby/dist/redux/reducers/program.js
@@ -5,12 +5,13 @@ module.exports = (state = {
 }, action) => {
   switch (action.type) {
     case `SET_PROGRAM`:
-      return Object.assign({}, action.payload);
+      return { ...action.payload
+      };
 
     case `SET_PROGRAM_EXTENSIONS`:
-      return Object.assign({}, state, {
+      return { ...state,
         extensions: action.payload
-      });
+      };
 
     default:
       return state;
--- a/node_modules/gatsby/dist/redux/reducers/program.js.map
+++ b/node_modules/gatsby/dist/redux/reducers/program.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../../src/redux/reducers/program.js"],"names":["module","exports","state","directory","action","type","payload","extensions"],"mappings":";;AAAAA,MAAM,CAACC,OAAP,GAAiB,CAACC,KAAK,GAAG;AAAEC,EAAAA,SAAS,EAAG;AAAd,CAAT,EAA6BC,MAA7B,KAAwC;AACvD,UAAQA,MAAM,CAACC,IAAf;AACE,SAAM,aAAN;AACE,+BACKD,MAAM,CAACE,OADZ;;AAIF,SAAM,wBAAN;AACE,+BACKJ,KADL;AAEEK,QAAAA,UAAU,EAAEH,MAAM,CAACE;AAFrB;;AAKF;AACE,aAAOJ,KAAP;AAbJ;AAeD,CAhBD","sourcesContent":["module.exports = (state = { directory: `/` }, action) => {\n  switch (action.type) {\n    case `SET_PROGRAM`:\n      return {\n        ...action.payload,\n      }\n\n    case `SET_PROGRAM_EXTENSIONS`:\n      return {\n        ...state,\n        extensions: action.payload,\n      }\n\n    default:\n      return state\n  }\n}\n"],"file":"program.js"}
\ No newline at end of file
+{"version":3,"sources":["../../../src/redux/reducers/program.js"],"names":["module","exports","state","directory","action","type","payload","extensions"],"mappings":";;AAAAA,MAAM,CAACC,OAAP,GAAiB,CAACC,KAAK,GAAG;AAAEC,EAAAA,SAAS,EAAG;AAAd,CAAT,EAA6BC,MAA7B,KAAwC;AACvD,UAAQA,MAAM,CAACC,IAAf;AACE,SAAM,aAAN;AACE,aAAO,EACL,GAAGD,MAAM,CAACE;AADL,OAAP;;AAIF,SAAM,wBAAN;AACE,aAAO,EACL,GAAGJ,KADE;AAELK,QAAAA,UAAU,EAAEH,MAAM,CAACE;AAFd,OAAP;;AAKF;AACE,aAAOJ,KAAP;AAbJ;AAeD,CAhBD","sourcesContent":["module.exports = (state = { directory: `/` }, action) => {\n  switch (action.type) {\n    case `SET_PROGRAM`:\n      return {\n        ...action.payload,\n      }\n\n    case `SET_PROGRAM_EXTENSIONS`:\n      return {\n        ...state,\n        extensions: action.payload,\n      }\n\n    default:\n      return state\n  }\n}\n"],"file":"program.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/redux/reducers/status.js
+++ b/node_modules/gatsby/dist/redux/reducers/status.js
@@ -12,9 +12,9 @@ module.exports = (state = {
       };
 
     case `UPDATE_PLUGINS_HASH`:
-      return Object.assign({}, state, {
+      return { ...state,
         PLUGINS_HASH: action.payload
-      });
+      };
 
     case `SET_PLUGIN_STATUS`:
       if (!action.plugin && !action.plugin.name) {
@@ -25,11 +25,11 @@ module.exports = (state = {
         throw new Error(`You must pass an object into setPluginStatus. What was passed in was ${JSON.stringify(action.payload, null, 4)}`);
       }
 
-      return Object.assign({}, state, {
-        plugins: Object.assign({}, state.plugins, {
+      return { ...state,
+        plugins: { ...state.plugins,
           [action.plugin.name]: _.merge({}, state.plugins[action.plugin.name], action.payload)
-        })
-      });
+        }
+      };
 
     default:
       return state;
--- a/node_modules/gatsby/dist/redux/reducers/status.js.map
+++ b/node_modules/gatsby/dist/redux/reducers/status.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../../src/redux/reducers/status.js"],"names":["_","require","module","exports","state","plugins","action","type","PLUGINS_HASH","payload","plugin","name","Error","isObject","JSON","stringify","merge"],"mappings":";;AAAA,MAAMA,CAAC,GAAGC,OAAO,CAAE,QAAF,CAAjB;;AAEAC,MAAM,CAACC,OAAP,GAAiB,CAACC,KAAK,GAAG;AAAEC,EAAAA,OAAO,EAAE;AAAX,CAAT,EAA0BC,MAA1B,KAAqC;AACpD,UAAQA,MAAM,CAACC,IAAf;AACE,SAAM,cAAN;AACE,aAAO;AAAEF,QAAAA,OAAO,EAAE;AAAX,OAAP;;AACF,SAAM,qBAAN;AACE,+BACKD,KADL;AAEEI,QAAAA,YAAY,EAAEF,MAAM,CAACG;AAFvB;;AAIF,SAAM,mBAAN;AACE,UAAI,CAACH,MAAM,CAACI,MAAR,IAAkB,CAACJ,MAAM,CAACI,MAAP,CAAcC,IAArC,EAA2C;AACzC,cAAM,IAAIC,KAAJ,CAAW,8CAAX,CAAN;AACD;;AACD,UAAI,CAACZ,CAAC,CAACa,QAAF,CAAWP,MAAM,CAACG,OAAlB,CAAL,EAAiC;AAC/B,cAAM,IAAIG,KAAJ,CACH,wEAAuEE,IAAI,CAACC,SAAL,CACtET,MAAM,CAACG,OAD+D,EAEtE,IAFsE,EAGtE,CAHsE,CAItE,EALE,CAAN;AAOD;;AACD,+BACKL,KADL;AAEEC,QAAAA,OAAO,oBACFD,KAAK,CAACC,OADJ;AAEL,WAACC,MAAM,CAACI,MAAP,CAAcC,IAAf,GAAsBX,CAAC,CAACgB,KAAF,CACpB,EADoB,EAEpBZ,KAAK,CAACC,OAAN,CAAcC,MAAM,CAACI,MAAP,CAAcC,IAA5B,CAFoB,EAGpBL,MAAM,CAACG,OAHa;AAFjB;AAFT;;AAWF;AACE,aAAOL,KAAP;AAjCJ;AAmCD,CApCD","sourcesContent":["const _ = require(`lodash`)\n\nmodule.exports = (state = { plugins: {} }, action) => {\n  switch (action.type) {\n    case `DELETE_CACHE`:\n      return { plugins: {} }\n    case `UPDATE_PLUGINS_HASH`:\n      return {\n        ...state,\n        PLUGINS_HASH: action.payload,\n      }\n    case `SET_PLUGIN_STATUS`:\n      if (!action.plugin && !action.plugin.name) {\n        throw new Error(`You can't set plugin status without a plugin`)\n      }\n      if (!_.isObject(action.payload)) {\n        throw new Error(\n          `You must pass an object into setPluginStatus. What was passed in was ${JSON.stringify(\n            action.payload,\n            null,\n            4\n          )}`\n        )\n      }\n      return {\n        ...state,\n        plugins: {\n          ...state.plugins,\n          [action.plugin.name]: _.merge(\n            {},\n            state.plugins[action.plugin.name],\n            action.payload\n          ),\n        },\n      }\n    default:\n      return state\n  }\n}\n"],"file":"status.js"}
\ No newline at end of file
+{"version":3,"sources":["../../../src/redux/reducers/status.js"],"names":["_","require","module","exports","state","plugins","action","type","PLUGINS_HASH","payload","plugin","name","Error","isObject","JSON","stringify","merge"],"mappings":";;AAAA,MAAMA,CAAC,GAAGC,OAAO,CAAE,QAAF,CAAjB;;AAEAC,MAAM,CAACC,OAAP,GAAiB,CAACC,KAAK,GAAG;AAAEC,EAAAA,OAAO,EAAE;AAAX,CAAT,EAA0BC,MAA1B,KAAqC;AACpD,UAAQA,MAAM,CAACC,IAAf;AACE,SAAM,cAAN;AACE,aAAO;AAAEF,QAAAA,OAAO,EAAE;AAAX,OAAP;;AACF,SAAM,qBAAN;AACE,aAAO,EACL,GAAGD,KADE;AAELI,QAAAA,YAAY,EAAEF,MAAM,CAACG;AAFhB,OAAP;;AAIF,SAAM,mBAAN;AACE,UAAI,CAACH,MAAM,CAACI,MAAR,IAAkB,CAACJ,MAAM,CAACI,MAAP,CAAcC,IAArC,EAA2C;AACzC,cAAM,IAAIC,KAAJ,CAAW,8CAAX,CAAN;AACD;;AACD,UAAI,CAACZ,CAAC,CAACa,QAAF,CAAWP,MAAM,CAACG,OAAlB,CAAL,EAAiC;AAC/B,cAAM,IAAIG,KAAJ,CACH,wEAAuEE,IAAI,CAACC,SAAL,CACtET,MAAM,CAACG,OAD+D,EAEtE,IAFsE,EAGtE,CAHsE,CAItE,EALE,CAAN;AAOD;;AACD,aAAO,EACL,GAAGL,KADE;AAELC,QAAAA,OAAO,EAAE,EACP,GAAGD,KAAK,CAACC,OADF;AAEP,WAACC,MAAM,CAACI,MAAP,CAAcC,IAAf,GAAsBX,CAAC,CAACgB,KAAF,CACpB,EADoB,EAEpBZ,KAAK,CAACC,OAAN,CAAcC,MAAM,CAACI,MAAP,CAAcC,IAA5B,CAFoB,EAGpBL,MAAM,CAACG,OAHa;AAFf;AAFJ,OAAP;;AAWF;AACE,aAAOL,KAAP;AAjCJ;AAmCD,CApCD","sourcesContent":["const _ = require(`lodash`)\n\nmodule.exports = (state = { plugins: {} }, action) => {\n  switch (action.type) {\n    case `DELETE_CACHE`:\n      return { plugins: {} }\n    case `UPDATE_PLUGINS_HASH`:\n      return {\n        ...state,\n        PLUGINS_HASH: action.payload,\n      }\n    case `SET_PLUGIN_STATUS`:\n      if (!action.plugin && !action.plugin.name) {\n        throw new Error(`You can't set plugin status without a plugin`)\n      }\n      if (!_.isObject(action.payload)) {\n        throw new Error(\n          `You must pass an object into setPluginStatus. What was passed in was ${JSON.stringify(\n            action.payload,\n            null,\n            4\n          )}`\n        )\n      }\n      return {\n        ...state,\n        plugins: {\n          ...state.plugins,\n          [action.plugin.name]: _.merge(\n            {},\n            state.plugins[action.plugin.name],\n            action.payload\n          ),\n        },\n      }\n    default:\n      return state\n  }\n}\n"],"file":"status.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/redux/reducers/webpack.js
+++ b/node_modules/gatsby/dist/redux/reducers/webpack.js
@@ -15,7 +15,8 @@ module.exports = (state = {}, action) => {
       }
 
     case `REPLACE_WEBPACK_CONFIG`:
-      return Object.assign({}, action.payload);
+      return { ...action.payload
+      };
 
     default:
       return state;
--- a/node_modules/gatsby/dist/redux/reducers/webpack.js.map
+++ b/node_modules/gatsby/dist/redux/reducers/webpack.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../../src/redux/reducers/webpack.js"],"names":["merge","require","module","exports","state","action","type","nextConfig","payload","entry","output","target","resolveLoaders"],"mappings":";;AAAA,MAAMA,KAAK,GAAGC,OAAO,CAAE,eAAF,CAArB;;AAEAC,MAAM,CAACC,OAAP,GAAiB,CAACC,KAAK,GAAG,EAAT,EAAaC,MAAb,KAAwB;AACvC,UAAQA,MAAM,CAACC,IAAf;AACE,SAAM,oBAAN;AAA2B;AACzB,YAAIC,UAAU,GAAGF,MAAM,CAACG,OAAxB;AACA,eAAOD,UAAU,CAACE,KAAlB;AACA,eAAOF,UAAU,CAACG,MAAlB;AACA,eAAOH,UAAU,CAACI,MAAlB;AACA,eAAOJ,UAAU,CAACK,cAAlB;AAEA,eAAOZ,KAAK,CAACI,KAAD,EAAQG,UAAR,CAAZ;AACD;;AACD,SAAM,wBAAN;AACE,+BAAYF,MAAM,CAACG,OAAnB;;AAEF;AACE,aAAOJ,KAAP;AAdJ;AAgBD,CAjBD","sourcesContent":["const merge = require(`webpack-merge`)\n\nmodule.exports = (state = {}, action) => {\n  switch (action.type) {\n    case `SET_WEBPACK_CONFIG`: {\n      let nextConfig = action.payload\n      delete nextConfig.entry\n      delete nextConfig.output\n      delete nextConfig.target\n      delete nextConfig.resolveLoaders\n\n      return merge(state, nextConfig)\n    }\n    case `REPLACE_WEBPACK_CONFIG`:\n      return { ...action.payload }\n\n    default:\n      return state\n  }\n}\n"],"file":"webpack.js"}
\ No newline at end of file
+{"version":3,"sources":["../../../src/redux/reducers/webpack.js"],"names":["merge","require","module","exports","state","action","type","nextConfig","payload","entry","output","target","resolveLoaders"],"mappings":";;AAAA,MAAMA,KAAK,GAAGC,OAAO,CAAE,eAAF,CAArB;;AAEAC,MAAM,CAACC,OAAP,GAAiB,CAACC,KAAK,GAAG,EAAT,EAAaC,MAAb,KAAwB;AACvC,UAAQA,MAAM,CAACC,IAAf;AACE,SAAM,oBAAN;AAA2B;AACzB,YAAIC,UAAU,GAAGF,MAAM,CAACG,OAAxB;AACA,eAAOD,UAAU,CAACE,KAAlB;AACA,eAAOF,UAAU,CAACG,MAAlB;AACA,eAAOH,UAAU,CAACI,MAAlB;AACA,eAAOJ,UAAU,CAACK,cAAlB;AAEA,eAAOZ,KAAK,CAACI,KAAD,EAAQG,UAAR,CAAZ;AACD;;AACD,SAAM,wBAAN;AACE,aAAO,EAAE,GAAGF,MAAM,CAACG;AAAZ,OAAP;;AAEF;AACE,aAAOJ,KAAP;AAdJ;AAgBD,CAjBD","sourcesContent":["const merge = require(`webpack-merge`)\n\nmodule.exports = (state = {}, action) => {\n  switch (action.type) {\n    case `SET_WEBPACK_CONFIG`: {\n      let nextConfig = action.payload\n      delete nextConfig.entry\n      delete nextConfig.output\n      delete nextConfig.target\n      delete nextConfig.resolveLoaders\n\n      return merge(state, nextConfig)\n    }\n    case `REPLACE_WEBPACK_CONFIG`:\n      return { ...action.payload }\n\n    default:\n      return state\n  }\n}\n"],"file":"webpack.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/redux/run-sift.js
+++ b/node_modules/gatsby/dist/redux/run-sift.js
@@ -8,12 +8,14 @@ const prepareRegex = require(`../utils/prepare-regex`);
 
 const Promise = require(`bluebird`);
 
-const _require = require(`../db/node-tracking`),
-      trackInlineObjectsInRootNode = _require.trackInlineObjectsInRootNode;
+const {
+  trackInlineObjectsInRootNode
+} = require(`../db/node-tracking`);
 
-const _require2 = require(`../db/nodes`),
-      getNode = _require2.getNode,
-      getNodesByType = _require2.getNodesByType;
+const {
+  getNode,
+  getNodesByType
+} = require(`../db/nodes`);
 
 const resolvedNodesCache = new Map();
 const enhancedNodeCache = new Map();
@@ -22,10 +24,11 @@ const enhancedNodePromiseCache = new Map();
 const enhancedNodeCacheId = ({
   node,
   args
-}) => node && node.internal && node.internal.contentDigest ? JSON.stringify(Object.assign({
+}) => node && node.internal && node.internal.contentDigest ? JSON.stringify({
   nodeid: node.id,
-  digest: node.internal.contentDigest
-}, args)) : null;
+  digest: node.internal.contentDigest,
+  ...args
+}) : null;
 
 const nodesCache = new Map();
 
@@ -160,20 +163,22 @@ function resolveRecursive(node, siftFieldsObj, gqFields) {
 
     return v;
   }).then(v => [k, v]))).then(resolvedFields => {
-    const myNode = Object.assign({}, node);
+    const myNode = { ...node
+    };
     resolvedFields.forEach(([k, v]) => myNode[k] = v);
     return myNode;
   });
 }
 
 function resolveNodes(nodes, typeName, firstOnly, fieldsToSift, gqlFields) {
-  const nodesCacheKey = JSON.stringify(Object.assign({
+  const nodesCacheKey = JSON.stringify({
     // typeName + count being the same is a pretty good
     // indication that the nodes are the same.
     typeName,
     firstOnly,
-    nodesLength: nodes.length
-  }, fieldsToSift));
+    nodesLength: nodes.length,
+    ...fieldsToSift
+  });
 
   if (process.env.NODE_ENV === `production` && resolvedNodesCache.has(nodesCacheKey)) {
     return Promise.resolve(resolvedNodesCache.get(nodesCacheKey));
@@ -256,22 +261,22 @@ function handleMany(siftArgs, nodes, sort) {
 
 
 module.exports = args => {
-  const queryArgs = args.queryArgs,
-        gqlType = args.gqlType,
-        _args$firstOnly = args.firstOnly,
-        firstOnly = _args$firstOnly === void 0 ? false : _args$firstOnly; // Clone args as for some reason graphql-js removes the constructor
+  const {
+    queryArgs,
+    gqlType,
+    firstOnly = false
+  } = args; // Clone args as for some reason graphql-js removes the constructor
   // from nested objects which breaks a check in sift.js.
 
   const clonedArgs = JSON.parse(JSON.stringify(queryArgs)); // If nodes weren't provided, then load them from the DB
 
   const nodes = args.nodes || loadNodes(gqlType.name);
-
-  const _parseFilter = parseFilter(clonedArgs.filter),
-        siftArgs = _parseFilter.siftArgs,
-        fieldsToSift = _parseFilter.fieldsToSift; // If the the query for single node only has a filter for an "id"
+  const {
+    siftArgs,
+    fieldsToSift
+  } = parseFilter(clonedArgs.filter); // If the the query for single node only has a filter for an "id"
   // using "eq" operator, then we'll just grab that ID and return it.
 
-
   if (isEqId(firstOnly, fieldsToSift, siftArgs)) {
     return resolveRecursive(getNode(siftArgs[0].id[`$eq`]), fieldsToSift, gqlType.getFields()).then(node => node ? [node] : []);
   }
--- a/node_modules/gatsby/dist/redux/run-sift.js.map
+++ b/node_modules/gatsby/dist/redux/run-sift.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/redux/run-sift.js"],"names":["sift","require","_","prepareRegex","Promise","trackInlineObjectsInRootNode","getNode","getNodesByType","resolvedNodesCache","Map","enhancedNodeCache","enhancedNodePromiseCache","enhancedNodeCacheId","node","args","internal","contentDigest","JSON","stringify","nodeid","id","digest","nodesCache","loadNodes","type","nodes","process","env","NODE_ENV","has","get","set","siftifyArgs","object","newObject","each","v","k","isPlainObject","Minimatch","mm","makeRe","extractFieldsToSift","prekey","key","preobj","obj","val","forEach","parseFilter","filter","siftArgs","fieldsToSift","includes","push","isEqId","firstOnly","Object","keys","length","awaitSiftField","fields","field","resolve","fieldName","undefined","resolveRecursive","siftFieldsObj","gqFields","all","map","then","innerSift","innerGqConfig","isObject","isFunction","getFields","isArray","ofType","item","resolvedFields","myNode","resolveNodes","typeName","gqlFields","nodesCacheKey","nodesLength","cacheKey","enhancedNodeGenerationPromise","resolvedNode","resolvedNodes","handleFirst","index","isEmpty","indexOf","$and","handleMany","sort","result","convertedFields","replace","orderBy","order","module","exports","queryArgs","gqlType","clonedArgs","parse","name"],"mappings":"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","sourcesContent":["// @flow\nconst sift = require(`sift`)\nconst _ = require(`lodash`)\nconst prepareRegex = require(`../utils/prepare-regex`)\nconst Promise = require(`bluebird`)\nconst { trackInlineObjectsInRootNode } = require(`../db/node-tracking`)\nconst { getNode, getNodesByType } = require(`../db/nodes`)\n\nconst resolvedNodesCache = new Map()\nconst enhancedNodeCache = new Map()\nconst enhancedNodePromiseCache = new Map()\nconst enhancedNodeCacheId = ({ node, args }) =>\n  node && node.internal && node.internal.contentDigest\n    ? JSON.stringify({\n        nodeid: node.id,\n        digest: node.internal.contentDigest,\n        ...args,\n      })\n    : null\n\nconst nodesCache = new Map()\n\nfunction loadNodes(type) {\n  let nodes\n  // this caching can be removed if we move to loki\n  if (process.env.NODE_ENV === `production` && nodesCache.has(type)) {\n    nodes = nodesCache.get(type)\n  } else {\n    nodes = getNodesByType(type)\n    nodesCache.set(type, nodes)\n  }\n  return nodes\n}\n\n/////////////////////////////////////////////////////////////////////\n// Parse filter\n/////////////////////////////////////////////////////////////////////\n\nfunction siftifyArgs(object) {\n  const newObject = {}\n  _.each(object, (v, k) => {\n    if (_.isPlainObject(v)) {\n      if (k === `elemMatch`) {\n        k = `$elemMatch`\n      }\n      newObject[k] = siftifyArgs(v)\n    } else {\n      // Compile regex first.\n      if (k === `regex`) {\n        newObject[`$regex`] = prepareRegex(v)\n      } else if (k === `glob`) {\n        const Minimatch = require(`minimatch`).Minimatch\n        const mm = new Minimatch(v)\n        newObject[`$regex`] = mm.makeRe()\n      } else {\n        newObject[`$${k}`] = v\n      }\n    }\n  })\n  return newObject\n}\n\n// Build an object that excludes the innermost leafs,\n// this avoids including { eq: x } when resolving fields.\nfunction extractFieldsToSift(prekey, key, preobj, obj, val) {\n  if (_.isPlainObject(val)) {\n    _.forEach((val: any), (v, k) => {\n      if (k === `elemMatch`) {\n        // elemMatch is operator for arrays and not field we want to prepare\n        // so we need to skip it\n        extractFieldsToSift(prekey, key, preobj, obj, v)\n        return\n      }\n      preobj[prekey] = obj\n      extractFieldsToSift(key, k, obj, {}, v)\n    })\n  } else {\n    preobj[prekey] = true\n  }\n}\n\n/**\n * Parse filter and returns an object with two fields:\n * - siftArgs: the filter in a format that sift understands\n * - fieldsToSift: filter with operate leaves (e.g { eq: 3 })\n *   removed. Used later to resolve all filter fields\n */\nfunction parseFilter(filter) {\n  const siftArgs = []\n  const fieldsToSift = {}\n  if (filter) {\n    _.each(filter, (v, k) => {\n      // Ignore connection and sorting args.\n      if (_.includes([`skip`, `limit`, `sort`], k)) return\n\n      siftArgs.push(\n        siftifyArgs({\n          [k]: v,\n        })\n      )\n      extractFieldsToSift(``, k, {}, fieldsToSift, v)\n    })\n  }\n  return { siftArgs, fieldsToSift }\n}\n\n/////////////////////////////////////////////////////////////////////\n// Resolve nodes\n/////////////////////////////////////////////////////////////////////\n\nfunction isEqId(firstOnly, fieldsToSift, siftArgs) {\n  return (\n    firstOnly &&\n    Object.keys(fieldsToSift).length === 1 &&\n    Object.keys(fieldsToSift)[0] === `id` &&\n    Object.keys(siftArgs[0].id).length === 1 &&\n    Object.keys(siftArgs[0].id)[0] === `$eq`\n  )\n}\n\nfunction awaitSiftField(fields, node, k) {\n  const field = fields[k]\n  if (field.resolve) {\n    return field.resolve(\n      node,\n      {},\n      {},\n      {\n        fieldName: k,\n      }\n    )\n  } else if (node[k] !== undefined) {\n    return node[k]\n  }\n\n  return undefined\n}\n\n// Resolves every field used in the node.\nfunction resolveRecursive(node, siftFieldsObj, gqFields) {\n  return Promise.all(\n    _.keys(siftFieldsObj).map(k =>\n      Promise.resolve(awaitSiftField(gqFields, node, k))\n        .then(v => {\n          const innerSift = siftFieldsObj[k]\n          const innerGqConfig = gqFields[k]\n          if (\n            _.isObject(innerSift) &&\n            v != null &&\n            innerGqConfig &&\n            innerGqConfig.type\n          ) {\n            if (_.isFunction(innerGqConfig.type.getFields)) {\n              // this is single object\n              return resolveRecursive(\n                v,\n                innerSift,\n                innerGqConfig.type.getFields()\n              )\n            } else if (\n              _.isArray(v) &&\n              innerGqConfig.type.ofType &&\n              _.isFunction(innerGqConfig.type.ofType.getFields)\n            ) {\n              // this is array\n              return Promise.all(\n                v.map(item =>\n                  resolveRecursive(\n                    item,\n                    innerSift,\n                    innerGqConfig.type.ofType.getFields()\n                  )\n                )\n              )\n            }\n          }\n\n          return v\n        })\n        .then(v => [k, v])\n    )\n  ).then(resolvedFields => {\n    const myNode = {\n      ...node,\n    }\n    resolvedFields.forEach(([k, v]) => (myNode[k] = v))\n    return myNode\n  })\n}\n\nfunction resolveNodes(nodes, typeName, firstOnly, fieldsToSift, gqlFields) {\n  const nodesCacheKey = JSON.stringify({\n    // typeName + count being the same is a pretty good\n    // indication that the nodes are the same.\n    typeName,\n    firstOnly,\n    nodesLength: nodes.length,\n    ...fieldsToSift,\n  })\n  if (\n    process.env.NODE_ENV === `production` &&\n    resolvedNodesCache.has(nodesCacheKey)\n  ) {\n    return Promise.resolve(resolvedNodesCache.get(nodesCacheKey))\n  } else {\n    return Promise.all(\n      nodes.map(node => {\n        const cacheKey = enhancedNodeCacheId({\n          node,\n          args: fieldsToSift,\n        })\n        if (cacheKey && enhancedNodeCache.has(cacheKey)) {\n          return Promise.resolve(enhancedNodeCache.get(cacheKey))\n        } else if (cacheKey && enhancedNodePromiseCache.has(cacheKey)) {\n          return enhancedNodePromiseCache.get(cacheKey)\n        }\n\n        const enhancedNodeGenerationPromise = new Promise(resolve => {\n          resolveRecursive(node, fieldsToSift, gqlFields).then(resolvedNode => {\n            trackInlineObjectsInRootNode(resolvedNode)\n            if (cacheKey) {\n              enhancedNodeCache.set(cacheKey, resolvedNode)\n            }\n            resolve(resolvedNode)\n          })\n        })\n        enhancedNodePromiseCache.set(cacheKey, enhancedNodeGenerationPromise)\n        return enhancedNodeGenerationPromise\n      })\n    ).then(resolvedNodes => {\n      resolvedNodesCache.set(nodesCacheKey, resolvedNodes)\n      return resolvedNodes\n    })\n  }\n}\n\n/////////////////////////////////////////////////////////////////////\n// Run Sift\n/////////////////////////////////////////////////////////////////////\n\nfunction handleFirst(siftArgs, nodes) {\n  const index = _.isEmpty(siftArgs)\n    ? 0\n    : sift.indexOf(\n        {\n          $and: siftArgs,\n        },\n        nodes\n      )\n\n  if (index !== -1) {\n    return [nodes[index]]\n  } else {\n    return []\n  }\n}\n\nfunction handleMany(siftArgs, nodes, sort) {\n  let result = _.isEmpty(siftArgs)\n    ? nodes\n    : sift(\n        {\n          $and: siftArgs,\n        },\n        nodes\n      )\n\n  if (!result || !result.length) return null\n\n  // Sort results.\n  if (sort) {\n    // create functions that return the item to compare on\n    // uses _.get so nested fields can be retrieved\n    const convertedFields = sort.fields\n      .map(field => field.replace(/___/g, `.`))\n      .map(field => v => _.get(v, field))\n\n    result = _.orderBy(result, convertedFields, sort.order)\n  }\n  return result\n}\n\n/**\n * Filters a list of nodes using mongodb-like syntax.\n *\n * @param args raw graphql query filter as an object\n * @param nodes The nodes array to run sift over (Optional\n *   will load itself if not present)\n * @param type gqlType. Created in build-node-types\n * @param firstOnly true if you want to return only the first result\n *   found. This will return a collection of size 1. Not a single\n *   element\n * @returns Collection of results. Collection will be limited to size\n *   if `firstOnly` is true\n */\nmodule.exports = (args: Object) => {\n  const { queryArgs, gqlType, firstOnly = false } = args\n  // Clone args as for some reason graphql-js removes the constructor\n  // from nested objects which breaks a check in sift.js.\n  const clonedArgs = JSON.parse(JSON.stringify(queryArgs))\n\n  // If nodes weren't provided, then load them from the DB\n  const nodes = args.nodes || loadNodes(gqlType.name)\n\n  const { siftArgs, fieldsToSift } = parseFilter(clonedArgs.filter)\n\n  // If the the query for single node only has a filter for an \"id\"\n  // using \"eq\" operator, then we'll just grab that ID and return it.\n  if (isEqId(firstOnly, fieldsToSift, siftArgs)) {\n    return resolveRecursive(\n      getNode(siftArgs[0].id[`$eq`]),\n      fieldsToSift,\n      gqlType.getFields()\n    ).then(node => (node ? [node] : []))\n  }\n\n  return resolveNodes(\n    nodes,\n    gqlType.name,\n    firstOnly,\n    fieldsToSift,\n    gqlType.getFields()\n  ).then(resolvedNodes => {\n    if (firstOnly) {\n      return handleFirst(siftArgs, resolvedNodes)\n    } else {\n      return handleMany(siftArgs, resolvedNodes, clonedArgs.sort)\n    }\n  })\n}\n"],"file":"run-sift.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/redux/run-sift.js"],"names":["sift","require","_","prepareRegex","Promise","trackInlineObjectsInRootNode","getNode","getNodesByType","resolvedNodesCache","Map","enhancedNodeCache","enhancedNodePromiseCache","enhancedNodeCacheId","node","args","internal","contentDigest","JSON","stringify","nodeid","id","digest","nodesCache","loadNodes","type","nodes","process","env","NODE_ENV","has","get","set","siftifyArgs","object","newObject","each","v","k","isPlainObject","Minimatch","mm","makeRe","extractFieldsToSift","prekey","key","preobj","obj","val","forEach","parseFilter","filter","siftArgs","fieldsToSift","includes","push","isEqId","firstOnly","Object","keys","length","awaitSiftField","fields","field","resolve","fieldName","undefined","resolveRecursive","siftFieldsObj","gqFields","all","map","then","innerSift","innerGqConfig","isObject","isFunction","getFields","isArray","ofType","item","resolvedFields","myNode","resolveNodes","typeName","gqlFields","nodesCacheKey","nodesLength","cacheKey","enhancedNodeGenerationPromise","resolvedNode","resolvedNodes","handleFirst","index","isEmpty","indexOf","$and","handleMany","sort","result","convertedFields","replace","orderBy","order","module","exports","queryArgs","gqlType","clonedArgs","parse","name"],"mappings":"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","sourcesContent":["// @flow\nconst sift = require(`sift`)\nconst _ = require(`lodash`)\nconst prepareRegex = require(`../utils/prepare-regex`)\nconst Promise = require(`bluebird`)\nconst { trackInlineObjectsInRootNode } = require(`../db/node-tracking`)\nconst { getNode, getNodesByType } = require(`../db/nodes`)\n\nconst resolvedNodesCache = new Map()\nconst enhancedNodeCache = new Map()\nconst enhancedNodePromiseCache = new Map()\nconst enhancedNodeCacheId = ({ node, args }) =>\n  node && node.internal && node.internal.contentDigest\n    ? JSON.stringify({\n        nodeid: node.id,\n        digest: node.internal.contentDigest,\n        ...args,\n      })\n    : null\n\nconst nodesCache = new Map()\n\nfunction loadNodes(type) {\n  let nodes\n  // this caching can be removed if we move to loki\n  if (process.env.NODE_ENV === `production` && nodesCache.has(type)) {\n    nodes = nodesCache.get(type)\n  } else {\n    nodes = getNodesByType(type)\n    nodesCache.set(type, nodes)\n  }\n  return nodes\n}\n\n/////////////////////////////////////////////////////////////////////\n// Parse filter\n/////////////////////////////////////////////////////////////////////\n\nfunction siftifyArgs(object) {\n  const newObject = {}\n  _.each(object, (v, k) => {\n    if (_.isPlainObject(v)) {\n      if (k === `elemMatch`) {\n        k = `$elemMatch`\n      }\n      newObject[k] = siftifyArgs(v)\n    } else {\n      // Compile regex first.\n      if (k === `regex`) {\n        newObject[`$regex`] = prepareRegex(v)\n      } else if (k === `glob`) {\n        const Minimatch = require(`minimatch`).Minimatch\n        const mm = new Minimatch(v)\n        newObject[`$regex`] = mm.makeRe()\n      } else {\n        newObject[`$${k}`] = v\n      }\n    }\n  })\n  return newObject\n}\n\n// Build an object that excludes the innermost leafs,\n// this avoids including { eq: x } when resolving fields.\nfunction extractFieldsToSift(prekey, key, preobj, obj, val) {\n  if (_.isPlainObject(val)) {\n    _.forEach((val: any), (v, k) => {\n      if (k === `elemMatch`) {\n        // elemMatch is operator for arrays and not field we want to prepare\n        // so we need to skip it\n        extractFieldsToSift(prekey, key, preobj, obj, v)\n        return\n      }\n      preobj[prekey] = obj\n      extractFieldsToSift(key, k, obj, {}, v)\n    })\n  } else {\n    preobj[prekey] = true\n  }\n}\n\n/**\n * Parse filter and returns an object with two fields:\n * - siftArgs: the filter in a format that sift understands\n * - fieldsToSift: filter with operate leaves (e.g { eq: 3 })\n *   removed. Used later to resolve all filter fields\n */\nfunction parseFilter(filter) {\n  const siftArgs = []\n  const fieldsToSift = {}\n  if (filter) {\n    _.each(filter, (v, k) => {\n      // Ignore connection and sorting args.\n      if (_.includes([`skip`, `limit`, `sort`], k)) return\n\n      siftArgs.push(\n        siftifyArgs({\n          [k]: v,\n        })\n      )\n      extractFieldsToSift(``, k, {}, fieldsToSift, v)\n    })\n  }\n  return { siftArgs, fieldsToSift }\n}\n\n/////////////////////////////////////////////////////////////////////\n// Resolve nodes\n/////////////////////////////////////////////////////////////////////\n\nfunction isEqId(firstOnly, fieldsToSift, siftArgs) {\n  return (\n    firstOnly &&\n    Object.keys(fieldsToSift).length === 1 &&\n    Object.keys(fieldsToSift)[0] === `id` &&\n    Object.keys(siftArgs[0].id).length === 1 &&\n    Object.keys(siftArgs[0].id)[0] === `$eq`\n  )\n}\n\nfunction awaitSiftField(fields, node, k) {\n  const field = fields[k]\n  if (field.resolve) {\n    return field.resolve(\n      node,\n      {},\n      {},\n      {\n        fieldName: k,\n      }\n    )\n  } else if (node[k] !== undefined) {\n    return node[k]\n  }\n\n  return undefined\n}\n\n// Resolves every field used in the node.\nfunction resolveRecursive(node, siftFieldsObj, gqFields) {\n  return Promise.all(\n    _.keys(siftFieldsObj).map(k =>\n      Promise.resolve(awaitSiftField(gqFields, node, k))\n        .then(v => {\n          const innerSift = siftFieldsObj[k]\n          const innerGqConfig = gqFields[k]\n          if (\n            _.isObject(innerSift) &&\n            v != null &&\n            innerGqConfig &&\n            innerGqConfig.type\n          ) {\n            if (_.isFunction(innerGqConfig.type.getFields)) {\n              // this is single object\n              return resolveRecursive(\n                v,\n                innerSift,\n                innerGqConfig.type.getFields()\n              )\n            } else if (\n              _.isArray(v) &&\n              innerGqConfig.type.ofType &&\n              _.isFunction(innerGqConfig.type.ofType.getFields)\n            ) {\n              // this is array\n              return Promise.all(\n                v.map(item =>\n                  resolveRecursive(\n                    item,\n                    innerSift,\n                    innerGqConfig.type.ofType.getFields()\n                  )\n                )\n              )\n            }\n          }\n\n          return v\n        })\n        .then(v => [k, v])\n    )\n  ).then(resolvedFields => {\n    const myNode = {\n      ...node,\n    }\n    resolvedFields.forEach(([k, v]) => (myNode[k] = v))\n    return myNode\n  })\n}\n\nfunction resolveNodes(nodes, typeName, firstOnly, fieldsToSift, gqlFields) {\n  const nodesCacheKey = JSON.stringify({\n    // typeName + count being the same is a pretty good\n    // indication that the nodes are the same.\n    typeName,\n    firstOnly,\n    nodesLength: nodes.length,\n    ...fieldsToSift,\n  })\n  if (\n    process.env.NODE_ENV === `production` &&\n    resolvedNodesCache.has(nodesCacheKey)\n  ) {\n    return Promise.resolve(resolvedNodesCache.get(nodesCacheKey))\n  } else {\n    return Promise.all(\n      nodes.map(node => {\n        const cacheKey = enhancedNodeCacheId({\n          node,\n          args: fieldsToSift,\n        })\n        if (cacheKey && enhancedNodeCache.has(cacheKey)) {\n          return Promise.resolve(enhancedNodeCache.get(cacheKey))\n        } else if (cacheKey && enhancedNodePromiseCache.has(cacheKey)) {\n          return enhancedNodePromiseCache.get(cacheKey)\n        }\n\n        const enhancedNodeGenerationPromise = new Promise(resolve => {\n          resolveRecursive(node, fieldsToSift, gqlFields).then(resolvedNode => {\n            trackInlineObjectsInRootNode(resolvedNode)\n            if (cacheKey) {\n              enhancedNodeCache.set(cacheKey, resolvedNode)\n            }\n            resolve(resolvedNode)\n          })\n        })\n        enhancedNodePromiseCache.set(cacheKey, enhancedNodeGenerationPromise)\n        return enhancedNodeGenerationPromise\n      })\n    ).then(resolvedNodes => {\n      resolvedNodesCache.set(nodesCacheKey, resolvedNodes)\n      return resolvedNodes\n    })\n  }\n}\n\n/////////////////////////////////////////////////////////////////////\n// Run Sift\n/////////////////////////////////////////////////////////////////////\n\nfunction handleFirst(siftArgs, nodes) {\n  const index = _.isEmpty(siftArgs)\n    ? 0\n    : sift.indexOf(\n        {\n          $and: siftArgs,\n        },\n        nodes\n      )\n\n  if (index !== -1) {\n    return [nodes[index]]\n  } else {\n    return []\n  }\n}\n\nfunction handleMany(siftArgs, nodes, sort) {\n  let result = _.isEmpty(siftArgs)\n    ? nodes\n    : sift(\n        {\n          $and: siftArgs,\n        },\n        nodes\n      )\n\n  if (!result || !result.length) return null\n\n  // Sort results.\n  if (sort) {\n    // create functions that return the item to compare on\n    // uses _.get so nested fields can be retrieved\n    const convertedFields = sort.fields\n      .map(field => field.replace(/___/g, `.`))\n      .map(field => v => _.get(v, field))\n\n    result = _.orderBy(result, convertedFields, sort.order)\n  }\n  return result\n}\n\n/**\n * Filters a list of nodes using mongodb-like syntax.\n *\n * @param args raw graphql query filter as an object\n * @param nodes The nodes array to run sift over (Optional\n *   will load itself if not present)\n * @param type gqlType. Created in build-node-types\n * @param firstOnly true if you want to return only the first result\n *   found. This will return a collection of size 1. Not a single\n *   element\n * @returns Collection of results. Collection will be limited to size\n *   if `firstOnly` is true\n */\nmodule.exports = (args: Object) => {\n  const { queryArgs, gqlType, firstOnly = false } = args\n  // Clone args as for some reason graphql-js removes the constructor\n  // from nested objects which breaks a check in sift.js.\n  const clonedArgs = JSON.parse(JSON.stringify(queryArgs))\n\n  // If nodes weren't provided, then load them from the DB\n  const nodes = args.nodes || loadNodes(gqlType.name)\n\n  const { siftArgs, fieldsToSift } = parseFilter(clonedArgs.filter)\n\n  // If the the query for single node only has a filter for an \"id\"\n  // using \"eq\" operator, then we'll just grab that ID and return it.\n  if (isEqId(firstOnly, fieldsToSift, siftArgs)) {\n    return resolveRecursive(\n      getNode(siftArgs[0].id[`$eq`]),\n      fieldsToSift,\n      gqlType.getFields()\n    ).then(node => (node ? [node] : []))\n  }\n\n  return resolveNodes(\n    nodes,\n    gqlType.name,\n    firstOnly,\n    fieldsToSift,\n    gqlType.getFields()\n  ).then(resolvedNodes => {\n    if (firstOnly) {\n      return handleFirst(siftArgs, resolvedNodes)\n    } else {\n      return handleMany(siftArgs, resolvedNodes, clonedArgs.sort)\n    }\n  })\n}\n"],"file":"run-sift.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/schema/build-connection-fields.js
+++ b/node_modules/gatsby/dist/schema/build-connection-fields.js
@@ -2,27 +2,31 @@
 
 const _ = require(`lodash`);
 
-const _require = require(`graphql`),
-      GraphQLInt = _require.GraphQLInt,
-      GraphQLList = _require.GraphQLList,
-      GraphQLString = _require.GraphQLString,
-      GraphQLEnumType = _require.GraphQLEnumType;
-
-const _require2 = require(`graphql-skip-limit`),
-      connectionArgs = _require2.connectionArgs,
-      connectionDefinitions = _require2.connectionDefinitions,
-      connectionFromArray = _require2.connectionFromArray;
-
-const _require3 = require(`./data-tree-utils`),
-      buildFieldEnumValues = _require3.buildFieldEnumValues;
+const {
+  GraphQLInt,
+  GraphQLList,
+  GraphQLString,
+  GraphQLEnumType
+} = require(`graphql`);
+
+const {
+  connectionArgs,
+  connectionDefinitions,
+  connectionFromArray
+} = require(`graphql-skip-limit`);
+
+const {
+  buildFieldEnumValues
+} = require(`./data-tree-utils`);
 
 module.exports = type => {
   const enumValues = buildFieldEnumValues({
     nodes: type.nodes,
     typeName: type.name
   });
-
-  const _connectionDefinition = connectionDefinitions({
+  const {
+    connectionType: groupConnection
+  } = connectionDefinitions({
     name: _.camelCase(`${type.name} groupConnection`),
     nodeType: type.nodeObjectType,
     connectionFields: () => {
@@ -38,9 +42,7 @@ module.exports = type => {
         }
       };
     }
-  }),
-        groupConnection = _connectionDefinition.connectionType;
-
+  });
   return {
     totalCount: {
       type: GraphQLInt
@@ -70,14 +72,14 @@ module.exports = type => {
     },
     group: {
       type: new GraphQLList(groupConnection),
-      args: Object.assign({}, connectionArgs, {
+      args: { ...connectionArgs,
         field: {
           type: new GraphQLEnumType({
             name: _.camelCase(`${type.name} group enum`),
             values: enumValues
           })
         }
-      }),
+      },
 
       resolve(connection, args) {
         const fieldName = args.field.replace(/___/g, `.`);
--- a/node_modules/gatsby/dist/schema/build-connection-fields.js.map
+++ b/node_modules/gatsby/dist/schema/build-connection-fields.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/schema/build-connection-fields.js"],"names":["_","require","GraphQLInt","GraphQLList","GraphQLString","GraphQLEnumType","connectionArgs","connectionDefinitions","connectionFromArray","buildFieldEnumValues","module","exports","type","enumValues","nodes","typeName","name","camelCase","nodeType","nodeObjectType","connectionFields","field","fieldValue","totalCount","groupConnection","connectionType","distinct","args","values","resolve","connection","fieldName","includes","replace","fields","edges","map","edge","get","node","sortBy","filter","uniq","flatten","identity","group","connectionNodes","groups","isArray","find","reduce","vals","n","has","concat","forEach","val","groupBy","groupConnections","sortedFieldValues","keys","each","groupNodes","groupConn","length","push"],"mappings":"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","sourcesContent":["// @flow\nconst _ = require(`lodash`)\nconst {\n  GraphQLInt,\n  GraphQLList,\n  GraphQLString,\n  GraphQLEnumType,\n} = require(`graphql`)\nconst {\n  connectionArgs,\n  connectionDefinitions,\n  connectionFromArray,\n} = require(`graphql-skip-limit`)\n\nconst { buildFieldEnumValues } = require(`./data-tree-utils`)\n\nmodule.exports = type => {\n  const enumValues = buildFieldEnumValues({\n    nodes: type.nodes,\n    typeName: type.name,\n  })\n  const { connectionType: groupConnection } = connectionDefinitions({\n    name: _.camelCase(`${type.name} groupConnection`),\n    nodeType: type.nodeObjectType,\n    connectionFields: () => {\n      return {\n        field: { type: GraphQLString },\n        fieldValue: { type: GraphQLString },\n        totalCount: { type: GraphQLInt },\n      }\n    },\n  })\n\n  return {\n    totalCount: {\n      type: GraphQLInt,\n    },\n    distinct: {\n      type: new GraphQLList(GraphQLString),\n      args: {\n        field: {\n          type: new GraphQLEnumType({\n            name: _.camelCase(`${type.name} distinct enum`),\n            values: enumValues,\n          }),\n        },\n      },\n      resolve(connection, args) {\n        let fieldName = args.field\n        if (_.includes(args.field, `___`)) {\n          fieldName = args.field.replace(/___/g, `.`)\n        }\n        const fields = connection.edges.map(edge => _.get(edge.node, fieldName))\n        return _.sortBy(_.filter(_.uniq(_.flatten(fields)), _.identity))\n      },\n    },\n    group: {\n      type: new GraphQLList(groupConnection),\n      args: {\n        ...connectionArgs,\n        field: {\n          type: new GraphQLEnumType({\n            name: _.camelCase(`${type.name} group enum`),\n            values: enumValues,\n          }),\n        },\n      },\n      resolve(connection, args) {\n        const fieldName = args.field.replace(/___/g, `.`)\n        const connectionNodes = connection.edges.map(edge => edge.node)\n\n        let groups = {}\n        // Do a custom grouping for arrays (w/ a group per array value)\n        // Find the first node with this field and check if it's an array.\n        if (_.isArray(_.get(_.find(connectionNodes, fieldName), fieldName))) {\n          const values = _.uniq(\n            _.reduce(\n              connectionNodes,\n              (vals, n) => {\n                if (_.has(n, fieldName)) {\n                  return vals.concat(_.get(n, fieldName))\n                } else {\n                  return vals\n                }\n              },\n              []\n            )\n          )\n          values.forEach(val => {\n            groups[val] = _.filter(connectionNodes, n =>\n              _.includes(_.get(n, fieldName), val)\n            )\n          })\n        } else {\n          groups = _.groupBy(connectionNodes, fieldName)\n        }\n        const groupConnections = []\n\n        // Do default sort by fieldValue\n        const sortedFieldValues = _.sortBy(_.keys(groups))\n        _.each(sortedFieldValues, fieldValue => {\n          const groupNodes = groups[fieldValue]\n          const groupConn = connectionFromArray(groupNodes, args)\n          groupConn.totalCount = groupNodes.length\n          groupConn.field = fieldName\n          groupConn.fieldValue = fieldValue\n          groupConnections.push(groupConn)\n        })\n\n        return groupConnections\n      },\n    },\n  }\n}\n"],"file":"build-connection-fields.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/schema/build-connection-fields.js"],"names":["_","require","GraphQLInt","GraphQLList","GraphQLString","GraphQLEnumType","connectionArgs","connectionDefinitions","connectionFromArray","buildFieldEnumValues","module","exports","type","enumValues","nodes","typeName","name","connectionType","groupConnection","camelCase","nodeType","nodeObjectType","connectionFields","field","fieldValue","totalCount","distinct","args","values","resolve","connection","fieldName","includes","replace","fields","edges","map","edge","get","node","sortBy","filter","uniq","flatten","identity","group","connectionNodes","groups","isArray","find","reduce","vals","n","has","concat","forEach","val","groupBy","groupConnections","sortedFieldValues","keys","each","groupNodes","groupConn","length","push"],"mappings":"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","sourcesContent":["// @flow\nconst _ = require(`lodash`)\nconst {\n  GraphQLInt,\n  GraphQLList,\n  GraphQLString,\n  GraphQLEnumType,\n} = require(`graphql`)\nconst {\n  connectionArgs,\n  connectionDefinitions,\n  connectionFromArray,\n} = require(`graphql-skip-limit`)\n\nconst { buildFieldEnumValues } = require(`./data-tree-utils`)\n\nmodule.exports = type => {\n  const enumValues = buildFieldEnumValues({\n    nodes: type.nodes,\n    typeName: type.name,\n  })\n  const { connectionType: groupConnection } = connectionDefinitions({\n    name: _.camelCase(`${type.name} groupConnection`),\n    nodeType: type.nodeObjectType,\n    connectionFields: () => {\n      return {\n        field: { type: GraphQLString },\n        fieldValue: { type: GraphQLString },\n        totalCount: { type: GraphQLInt },\n      }\n    },\n  })\n\n  return {\n    totalCount: {\n      type: GraphQLInt,\n    },\n    distinct: {\n      type: new GraphQLList(GraphQLString),\n      args: {\n        field: {\n          type: new GraphQLEnumType({\n            name: _.camelCase(`${type.name} distinct enum`),\n            values: enumValues,\n          }),\n        },\n      },\n      resolve(connection, args) {\n        let fieldName = args.field\n        if (_.includes(args.field, `___`)) {\n          fieldName = args.field.replace(/___/g, `.`)\n        }\n        const fields = connection.edges.map(edge => _.get(edge.node, fieldName))\n        return _.sortBy(_.filter(_.uniq(_.flatten(fields)), _.identity))\n      },\n    },\n    group: {\n      type: new GraphQLList(groupConnection),\n      args: {\n        ...connectionArgs,\n        field: {\n          type: new GraphQLEnumType({\n            name: _.camelCase(`${type.name} group enum`),\n            values: enumValues,\n          }),\n        },\n      },\n      resolve(connection, args) {\n        const fieldName = args.field.replace(/___/g, `.`)\n        const connectionNodes = connection.edges.map(edge => edge.node)\n\n        let groups = {}\n        // Do a custom grouping for arrays (w/ a group per array value)\n        // Find the first node with this field and check if it's an array.\n        if (_.isArray(_.get(_.find(connectionNodes, fieldName), fieldName))) {\n          const values = _.uniq(\n            _.reduce(\n              connectionNodes,\n              (vals, n) => {\n                if (_.has(n, fieldName)) {\n                  return vals.concat(_.get(n, fieldName))\n                } else {\n                  return vals\n                }\n              },\n              []\n            )\n          )\n          values.forEach(val => {\n            groups[val] = _.filter(connectionNodes, n =>\n              _.includes(_.get(n, fieldName), val)\n            )\n          })\n        } else {\n          groups = _.groupBy(connectionNodes, fieldName)\n        }\n        const groupConnections = []\n\n        // Do default sort by fieldValue\n        const sortedFieldValues = _.sortBy(_.keys(groups))\n        _.each(sortedFieldValues, fieldValue => {\n          const groupNodes = groups[fieldValue]\n          const groupConn = connectionFromArray(groupNodes, args)\n          groupConn.totalCount = groupNodes.length\n          groupConn.field = fieldName\n          groupConn.fieldValue = fieldValue\n          groupConnections.push(groupConn)\n        })\n\n        return groupConnections\n      },\n    },\n  }\n}\n"],"file":"build-connection-fields.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/schema/build-node-connections.js
+++ b/node_modules/gatsby/dist/schema/build-node-connections.js
@@ -1,23 +1,23 @@
 "use strict";
 
-var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
-
-var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
-
 const _ = require(`lodash`);
 
-const _require = require(`graphql-skip-limit`),
-      connectionArgs = _require.connectionArgs,
-      connectionDefinitions = _require.connectionDefinitions;
+const {
+  connectionArgs,
+  connectionDefinitions
+} = require(`graphql-skip-limit`);
 
-const _require2 = require(`graphql`),
-      GraphQLInputObjectType = _require2.GraphQLInputObjectType;
+const {
+  GraphQLInputObjectType
+} = require(`graphql`);
 
-const _require3 = require(`./infer-graphql-input-fields`),
-      inferInputObjectStructureFromNodes = _require3.inferInputObjectStructureFromNodes;
+const {
+  inferInputObjectStructureFromNodes
+} = require(`./infer-graphql-input-fields`);
 
-const _require4 = require(`./infer-graphql-input-fields-from-fields`),
-      inferInputObjectStructureFromFields = _require4.inferInputObjectStructureFromFields;
+const {
+  inferInputObjectStructureFromFields
+} = require(`./infer-graphql-input-fields-from-fields`);
 
 const buildSortArg = require(`./create-sort-field`);
 
@@ -25,11 +25,13 @@ const buildConnectionFields = require(`./build-connection-fields`);
 
 const createPageDependency = require(`../redux/actions/add-page-dependency`);
 
-const _require5 = require(`graphql-skip-limit`),
-      connectionFromArray = _require5.connectionFromArray;
+const {
+  connectionFromArray
+} = require(`graphql-skip-limit`);
 
-const _require6 = require(`../db/nodes`),
-      runQuery = _require6.runQuery;
+const {
+  runQuery
+} = require(`../db/nodes`);
 
 function handleQueryResult({
   results,
@@ -55,35 +57,26 @@ function handleQueryResult({
 }
 
 function buildResolver(gqlType) {
-  return (
-    /*#__PURE__*/
-    function () {
-      var _ref = (0, _asyncToGenerator2.default)(function* (object, queryArgs, b, {
-        rootValue
-      }) {
-        let path;
-
-        if (typeof rootValue !== `undefined`) {
-          path = rootValue.path;
-        }
-
-        const results = yield runQuery({
-          queryArgs,
-          firstOnly: false,
-          gqlType
-        });
-        return handleQueryResult({
-          results,
-          queryArgs,
-          path
-        });
-      });
+  return async (object, queryArgs, b, {
+    rootValue
+  }) => {
+    let path;
 
-      return function (_x, _x2, _x3, _x4) {
-        return _ref.apply(this, arguments);
-      };
-    }()
-  );
+    if (typeof rootValue !== `undefined`) {
+      path = rootValue.path;
+    }
+
+    const results = await runQuery({
+      queryArgs,
+      firstOnly: false,
+      gqlType
+    });
+    return handleQueryResult({
+      results,
+      queryArgs,
+      path
+    });
+  };
 }
 
 function buildFilterArg(typeName, filterFields) {
@@ -97,16 +90,17 @@ function buildFilterArg(typeName, filterFields) {
 }
 
 function buildFieldConfig(processedType) {
-  const nodes = processedType.nodes,
-        nodeObjectType = processedType.nodeObjectType;
+  const {
+    nodes,
+    nodeObjectType
+  } = processedType;
   const typeName = `${processedType.name}Connection`;
-
-  const _connectionDefinition = connectionDefinitions({
+  const {
+    connectionType: outputType
+  } = connectionDefinitions({
     nodeType: nodeObjectType,
     connectionFields: () => buildConnectionFields(processedType)
-  }),
-        outputType = _connectionDefinition.connectionType;
-
+  });
   const inferredInputFieldsFromNodes = inferInputObjectStructureFromNodes({
     nodes,
     typeName
@@ -119,10 +113,10 @@ function buildFieldConfig(processedType) {
   const filterFields = _.merge({}, inferredInputFieldsFromNodes.inferredFields, inferredInputFieldsFromPlugins.inferredFields);
 
   const sortNames = inferredInputFieldsFromNodes.sort.concat(inferredInputFieldsFromPlugins.sort);
-  const argsMap = Object.assign({}, connectionArgs, {
+  const argsMap = { ...connectionArgs,
     sort: buildSortArg(typeName, sortNames),
     filter: buildFilterArg(processedType.name, filterFields)
-  });
+  };
   return {
     type: outputType,
     description: `Connection to all ${processedType.name} nodes`,
--- a/node_modules/gatsby/dist/schema/build-node-connections.js.map
+++ b/node_modules/gatsby/dist/schema/build-node-connections.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/schema/build-node-connections.js"],"names":["_","require","connectionArgs","connectionDefinitions","GraphQLInputObjectType","inferInputObjectStructureFromNodes","inferInputObjectStructureFromFields","buildSortArg","buildConnectionFields","createPageDependency","connectionFromArray","runQuery","handleQueryResult","results","queryArgs","path","length","connection","totalCount","internal","connectionType","edges","node","type","buildResolver","gqlType","object","b","rootValue","firstOnly","buildFilterArg","typeName","filterFields","name","camelCase","description","fields","buildFieldConfig","processedType","nodes","nodeObjectType","nodeType","connectionFields","outputType","inferredInputFieldsFromNodes","inferredInputFieldsFromPlugins","fieldsFromPlugins","merge","inferredFields","sortNames","sort","concat","argsMap","filter","args","resolve","buildFieldConfigMap","fieldName","fieldConfig","fieldConfigReducer","fieldConfigMap","Object","assign","buildAll","processedTypes","reduce","module","exports"],"mappings":";;;;;;AACA,MAAMA,CAAC,GAAGC,OAAO,CAAE,QAAF,CAAjB;;iBACkDA,OAAO,CAAE,oBAAF,C;MAAjDC,c,YAAAA,c;MAAgBC,qB,YAAAA,qB;;kBACWF,OAAO,CAAE,SAAF,C;MAAlCG,sB,aAAAA,sB;;kBAGJH,OAAO,CAAE,8BAAF,C;MADTI,kC,aAAAA,kC;;kBAIEJ,OAAO,CAAE,0CAAF,C;MADTK,mC,aAAAA,mC;;AAEF,MAAMC,YAAY,GAAGN,OAAO,CAAE,qBAAF,CAA5B;;AACA,MAAMO,qBAAqB,GAAGP,OAAO,CAAE,2BAAF,CAArC;;AACA,MAAMQ,oBAAoB,GAAGR,OAAO,CAAE,sCAAF,CAApC;;kBACgCA,OAAO,CAAE,oBAAF,C;MAA/BS,mB,aAAAA,mB;;kBACaT,OAAO,CAAE,aAAF,C;MAApBU,Q,aAAAA,Q;;AAER,SAASC,iBAAT,CAA2B;AAAEC,EAAAA,OAAF;AAAWC,EAAAA,SAAX;AAAsBC,EAAAA;AAAtB,CAA3B,EAAyD;AACvD,MAAIF,OAAO,IAAIA,OAAO,CAACG,MAAvB,EAA+B;AAC7B,UAAMC,UAAU,GAAGP,mBAAmB,CAACG,OAAD,EAAUC,SAAV,CAAtC;AACAG,IAAAA,UAAU,CAACC,UAAX,GAAwBL,OAAO,CAACG,MAAhC;;AAEA,QAAIH,OAAO,CAAC,CAAD,CAAP,CAAWM,QAAf,EAAyB;AACvB,YAAMC,cAAc,GAAGH,UAAU,CAACI,KAAX,CAAiB,CAAjB,EAAoBC,IAApB,CAAyBH,QAAzB,CAAkCI,IAAzD;AACAd,MAAAA,oBAAoB,CAAC;AACnBM,QAAAA,IADmB;AAEnBE,QAAAA,UAAU,EAAEG;AAFO,OAAD,CAApB;AAID;;AACD,WAAOH,UAAP;AACD,GAZD,MAYO;AACL,WAAO,IAAP;AACD;AACF;;AAED,SAASO,aAAT,CAAuBC,OAAvB,EAAgC;AAC9B;AAAA;AAAA;AAAA,iDAAO,WAAOC,MAAP,EAAeZ,SAAf,EAA0Ba,CAA1B,EAA6B;AAAEC,QAAAA;AAAF,OAA7B,EAA+C;AACpD,YAAIb,IAAJ;;AACA,YAAI,OAAOa,SAAP,KAAsB,WAA1B,EAAsC;AACpCb,UAAAA,IAAI,GAAGa,SAAS,CAACb,IAAjB;AACD;;AACD,cAAMF,OAAO,SAASF,QAAQ,CAAC;AAC7BG,UAAAA,SAD6B;AAE7Be,UAAAA,SAAS,EAAE,KAFkB;AAG7BJ,UAAAA;AAH6B,SAAD,CAA9B;AAKA,eAAOb,iBAAiB,CAAC;AAAEC,UAAAA,OAAF;AAAWC,UAAAA,SAAX;AAAsBC,UAAAA;AAAtB,SAAD,CAAxB;AACD,OAXD;;AAAA;AAAA;AAAA;AAAA;AAAA;AAYD;;AAED,SAASe,cAAT,CAAwBC,QAAxB,EAAkCC,YAAlC,EAAgD;AAC9C,SAAO;AACLT,IAAAA,IAAI,EAAE,IAAInB,sBAAJ,CAA2B;AAC/B6B,MAAAA,IAAI,EAAEjC,CAAC,CAACkC,SAAF,CAAa,UAASH,QAAS,EAA/B,CADyB;AAE/BI,MAAAA,WAAW,EAAG,iCAFiB;AAG/BC,MAAAA,MAAM,EAAE,MAAMJ;AAHiB,KAA3B;AADD,GAAP;AAOD;;AAED,SAASK,gBAAT,CAA0BC,aAA1B,EAAyC;AAAA,QAC/BC,KAD+B,GACLD,aADK,CAC/BC,KAD+B;AAAA,QACxBC,cADwB,GACLF,aADK,CACxBE,cADwB;AAEvC,QAAMT,QAAQ,GAAI,GAAEO,aAAa,CAACL,IAAK,YAAvC;;AAFuC,gCAGA9B,qBAAqB,CAAC;AAC3DsC,IAAAA,QAAQ,EAAED,cADiD;AAE3DE,IAAAA,gBAAgB,EAAE,MAAMlC,qBAAqB,CAAC8B,aAAD;AAFc,GAAD,CAHrB;AAAA,QAGfK,UAHe,yBAG/BvB,cAH+B;;AAQvC,QAAMwB,4BAA4B,GAAGvC,kCAAkC,CAAC;AACtEkC,IAAAA,KADsE;AAEtER,IAAAA;AAFsE,GAAD,CAAvE;AAKA,QAAMc,8BAA8B,GAAGvC,mCAAmC,CAAC;AACzE8B,IAAAA,MAAM,EAAEE,aAAa,CAACQ,iBADmD;AAEzEf,IAAAA;AAFyE,GAAD,CAA1E;;AAKA,QAAMC,YAAY,GAAGhC,CAAC,CAAC+C,KAAF,CACnB,EADmB,EAEnBH,4BAA4B,CAACI,cAFV,EAGnBH,8BAA8B,CAACG,cAHZ,CAArB;;AAKA,QAAMC,SAAS,GAAGL,4BAA4B,CAACM,IAA7B,CAAkCC,MAAlC,CAChBN,8BAA8B,CAACK,IADf,CAAlB;AAIA,QAAME,OAAO,qBACRlD,cADQ;AAEXgD,IAAAA,IAAI,EAAE3C,YAAY,CAACwB,QAAD,EAAWkB,SAAX,CAFP;AAGXI,IAAAA,MAAM,EAAEvB,cAAc,CAACQ,aAAa,CAACL,IAAf,EAAqBD,YAArB;AAHX,IAAb;AAMA,SAAO;AACLT,IAAAA,IAAI,EAAEoB,UADD;AAELR,IAAAA,WAAW,EAAG,qBAAoBG,aAAa,CAACL,IAAK,QAFhD;AAGLqB,IAAAA,IAAI,EAAEF,OAHD;AAILG,IAAAA,OAAO,EAAE/B,aAAa,CAACgB,cAAD;AAJjB,GAAP;AAMD;;AAED,SAASgB,mBAAT,CAA6BlB,aAA7B,EAA4C;AAC1C,QAAMmB,SAAS,GAAGzD,CAAC,CAACkC,SAAF,CAAa,OAAMI,aAAa,CAACL,IAAK,EAAtC,CAAlB;;AACA,QAAMyB,WAAW,GAAGrB,gBAAgB,CAACC,aAAD,CAApC;AACA,SAAO;AAAE,KAACmB,SAAD,GAAaC;AAAf,GAAP;AACD;;AAED,SAASC,kBAAT,CAA4BC,cAA5B,EAA4CrC,IAA5C,EAAkD;AAChD,SAAOsC,MAAM,CAACC,MAAP,CAAcF,cAAd,EAA8BJ,mBAAmB,CAACjC,IAAD,CAAjD,CAAP;AACD;;AAED,SAASwC,QAAT,CAAkBC,cAAlB,EAAkC;AAChC,SAAOA,cAAc,CAClBX,MADI,CACG9B,IAAI,IAAIA,IAAI,CAACU,IAAL,KAAe,MAD1B,EAEJgC,MAFI,CAEGN,kBAFH,EAEuB,EAFvB,CAAP;AAGD;;AAEDO,MAAM,CAACC,OAAP,GAAiB;AACf9B,EAAAA,gBADe;AAEfmB,EAAAA,mBAFe;AAGfO,EAAAA;AAHe,CAAjB","sourcesContent":["// @flow\nconst _ = require(`lodash`)\nconst { connectionArgs, connectionDefinitions } = require(`graphql-skip-limit`)\nconst { GraphQLInputObjectType } = require(`graphql`)\nconst {\n  inferInputObjectStructureFromNodes,\n} = require(`./infer-graphql-input-fields`)\nconst {\n  inferInputObjectStructureFromFields,\n} = require(`./infer-graphql-input-fields-from-fields`)\nconst buildSortArg = require(`./create-sort-field`)\nconst buildConnectionFields = require(`./build-connection-fields`)\nconst createPageDependency = require(`../redux/actions/add-page-dependency`)\nconst { connectionFromArray } = require(`graphql-skip-limit`)\nconst { runQuery } = require(`../db/nodes`)\n\nfunction handleQueryResult({ results, queryArgs, path }) {\n  if (results && results.length) {\n    const connection = connectionFromArray(results, queryArgs)\n    connection.totalCount = results.length\n\n    if (results[0].internal) {\n      const connectionType = connection.edges[0].node.internal.type\n      createPageDependency({\n        path,\n        connection: connectionType,\n      })\n    }\n    return connection\n  } else {\n    return null\n  }\n}\n\nfunction buildResolver(gqlType) {\n  return async (object, queryArgs, b, { rootValue }) => {\n    let path\n    if (typeof rootValue !== `undefined`) {\n      path = rootValue.path\n    }\n    const results = await runQuery({\n      queryArgs,\n      firstOnly: false,\n      gqlType,\n    })\n    return handleQueryResult({ results, queryArgs, path })\n  }\n}\n\nfunction buildFilterArg(typeName, filterFields) {\n  return {\n    type: new GraphQLInputObjectType({\n      name: _.camelCase(`filter ${typeName}`),\n      description: `Filter connection on its fields`,\n      fields: () => filterFields,\n    }),\n  }\n}\n\nfunction buildFieldConfig(processedType) {\n  const { nodes, nodeObjectType } = processedType\n  const typeName = `${processedType.name}Connection`\n  const { connectionType: outputType } = connectionDefinitions({\n    nodeType: nodeObjectType,\n    connectionFields: () => buildConnectionFields(processedType),\n  })\n\n  const inferredInputFieldsFromNodes = inferInputObjectStructureFromNodes({\n    nodes,\n    typeName,\n  })\n\n  const inferredInputFieldsFromPlugins = inferInputObjectStructureFromFields({\n    fields: processedType.fieldsFromPlugins,\n    typeName,\n  })\n\n  const filterFields = _.merge(\n    {},\n    inferredInputFieldsFromNodes.inferredFields,\n    inferredInputFieldsFromPlugins.inferredFields\n  )\n  const sortNames = inferredInputFieldsFromNodes.sort.concat(\n    inferredInputFieldsFromPlugins.sort\n  )\n\n  const argsMap = {\n    ...connectionArgs,\n    sort: buildSortArg(typeName, sortNames),\n    filter: buildFilterArg(processedType.name, filterFields),\n  }\n\n  return {\n    type: outputType,\n    description: `Connection to all ${processedType.name} nodes`,\n    args: argsMap,\n    resolve: buildResolver(nodeObjectType),\n  }\n}\n\nfunction buildFieldConfigMap(processedType) {\n  const fieldName = _.camelCase(`all ${processedType.name}`)\n  const fieldConfig = buildFieldConfig(processedType)\n  return { [fieldName]: fieldConfig }\n}\n\nfunction fieldConfigReducer(fieldConfigMap, type) {\n  return Object.assign(fieldConfigMap, buildFieldConfigMap(type))\n}\n\nfunction buildAll(processedTypes) {\n  return processedTypes\n    .filter(type => type.name !== `Site`)\n    .reduce(fieldConfigReducer, {})\n}\n\nmodule.exports = {\n  buildFieldConfig,\n  buildFieldConfigMap,\n  buildAll,\n}\n"],"file":"build-node-connections.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/schema/build-node-connections.js"],"names":["_","require","connectionArgs","connectionDefinitions","GraphQLInputObjectType","inferInputObjectStructureFromNodes","inferInputObjectStructureFromFields","buildSortArg","buildConnectionFields","createPageDependency","connectionFromArray","runQuery","handleQueryResult","results","queryArgs","path","length","connection","totalCount","internal","connectionType","edges","node","type","buildResolver","gqlType","object","b","rootValue","firstOnly","buildFilterArg","typeName","filterFields","name","camelCase","description","fields","buildFieldConfig","processedType","nodes","nodeObjectType","outputType","nodeType","connectionFields","inferredInputFieldsFromNodes","inferredInputFieldsFromPlugins","fieldsFromPlugins","merge","inferredFields","sortNames","sort","concat","argsMap","filter","args","resolve","buildFieldConfigMap","fieldName","fieldConfig","fieldConfigReducer","fieldConfigMap","Object","assign","buildAll","processedTypes","reduce","module","exports"],"mappings":"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","sourcesContent":["// @flow\nconst _ = require(`lodash`)\nconst { connectionArgs, connectionDefinitions } = require(`graphql-skip-limit`)\nconst { GraphQLInputObjectType } = require(`graphql`)\nconst {\n  inferInputObjectStructureFromNodes,\n} = require(`./infer-graphql-input-fields`)\nconst {\n  inferInputObjectStructureFromFields,\n} = require(`./infer-graphql-input-fields-from-fields`)\nconst buildSortArg = require(`./create-sort-field`)\nconst buildConnectionFields = require(`./build-connection-fields`)\nconst createPageDependency = require(`../redux/actions/add-page-dependency`)\nconst { connectionFromArray } = require(`graphql-skip-limit`)\nconst { runQuery } = require(`../db/nodes`)\n\nfunction handleQueryResult({ results, queryArgs, path }) {\n  if (results && results.length) {\n    const connection = connectionFromArray(results, queryArgs)\n    connection.totalCount = results.length\n\n    if (results[0].internal) {\n      const connectionType = connection.edges[0].node.internal.type\n      createPageDependency({\n        path,\n        connection: connectionType,\n      })\n    }\n    return connection\n  } else {\n    return null\n  }\n}\n\nfunction buildResolver(gqlType) {\n  return async (object, queryArgs, b, { rootValue }) => {\n    let path\n    if (typeof rootValue !== `undefined`) {\n      path = rootValue.path\n    }\n    const results = await runQuery({\n      queryArgs,\n      firstOnly: false,\n      gqlType,\n    })\n    return handleQueryResult({ results, queryArgs, path })\n  }\n}\n\nfunction buildFilterArg(typeName, filterFields) {\n  return {\n    type: new GraphQLInputObjectType({\n      name: _.camelCase(`filter ${typeName}`),\n      description: `Filter connection on its fields`,\n      fields: () => filterFields,\n    }),\n  }\n}\n\nfunction buildFieldConfig(processedType) {\n  const { nodes, nodeObjectType } = processedType\n  const typeName = `${processedType.name}Connection`\n  const { connectionType: outputType } = connectionDefinitions({\n    nodeType: nodeObjectType,\n    connectionFields: () => buildConnectionFields(processedType),\n  })\n\n  const inferredInputFieldsFromNodes = inferInputObjectStructureFromNodes({\n    nodes,\n    typeName,\n  })\n\n  const inferredInputFieldsFromPlugins = inferInputObjectStructureFromFields({\n    fields: processedType.fieldsFromPlugins,\n    typeName,\n  })\n\n  const filterFields = _.merge(\n    {},\n    inferredInputFieldsFromNodes.inferredFields,\n    inferredInputFieldsFromPlugins.inferredFields\n  )\n  const sortNames = inferredInputFieldsFromNodes.sort.concat(\n    inferredInputFieldsFromPlugins.sort\n  )\n\n  const argsMap = {\n    ...connectionArgs,\n    sort: buildSortArg(typeName, sortNames),\n    filter: buildFilterArg(processedType.name, filterFields),\n  }\n\n  return {\n    type: outputType,\n    description: `Connection to all ${processedType.name} nodes`,\n    args: argsMap,\n    resolve: buildResolver(nodeObjectType),\n  }\n}\n\nfunction buildFieldConfigMap(processedType) {\n  const fieldName = _.camelCase(`all ${processedType.name}`)\n  const fieldConfig = buildFieldConfig(processedType)\n  return { [fieldName]: fieldConfig }\n}\n\nfunction fieldConfigReducer(fieldConfigMap, type) {\n  return Object.assign(fieldConfigMap, buildFieldConfigMap(type))\n}\n\nfunction buildAll(processedTypes) {\n  return processedTypes\n    .filter(type => type.name !== `Site`)\n    .reduce(fieldConfigReducer, {})\n}\n\nmodule.exports = {\n  buildFieldConfig,\n  buildFieldConfigMap,\n  buildAll,\n}\n"],"file":"build-node-connections.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/schema/build-node-types.js
+++ b/node_modules/gatsby/dist/schema/build-node-types.js
@@ -1,47 +1,52 @@
 "use strict";
 
-var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
-
-var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
-
 const _ = require(`lodash`);
 
-const _require = require(`graphql`),
-      GraphQLObjectType = _require.GraphQLObjectType,
-      GraphQLNonNull = _require.GraphQLNonNull,
-      GraphQLID = _require.GraphQLID,
-      GraphQLList = _require.GraphQLList;
+const {
+  GraphQLObjectType,
+  GraphQLNonNull,
+  GraphQLID,
+  GraphQLList
+} = require(`graphql`);
 
 const tracer = require(`opentracing`).globalTracer();
 
 const apiRunner = require(`../utils/api-runner-node`);
 
-const _require2 = require(`./infer-graphql-type`),
-      inferObjectStructureFromNodes = _require2.inferObjectStructureFromNodes;
+const {
+  inferObjectStructureFromNodes
+} = require(`./infer-graphql-type`);
 
-const _require3 = require(`./infer-graphql-input-fields-from-fields`),
-      inferInputObjectStructureFromFields = _require3.inferInputObjectStructureFromFields;
+const {
+  inferInputObjectStructureFromFields
+} = require(`./infer-graphql-input-fields-from-fields`);
 
-const _require4 = require(`./infer-graphql-input-fields`),
-      inferInputObjectStructureFromNodes = _require4.inferInputObjectStructureFromNodes;
+const {
+  inferInputObjectStructureFromNodes
+} = require(`./infer-graphql-input-fields`);
 
-const _require5 = require(`./node-interface`),
-      nodeInterface = _require5.nodeInterface;
+const {
+  nodeInterface
+} = require(`./node-interface`);
 
-const _require6 = require(`../db/nodes`),
-      getNodes = _require6.getNodes,
-      getNode = _require6.getNode;
+const {
+  getNodes,
+  getNode
+} = require(`../db/nodes`);
 
 const pageDependencyResolver = require(`./page-dependency-resolver`);
 
-const _require7 = require(`./types/type-file`),
-      setFileNodeRootType = _require7.setFileNodeRootType;
+const {
+  setFileNodeRootType
+} = require(`./types/type-file`);
 
-const _require8 = require(`./data-tree-utils`),
-      clearTypeExampleValues = _require8.clearTypeExampleValues;
+const {
+  clearTypeExampleValues
+} = require(`./data-tree-utils`);
 
-const _require9 = require(`../db/nodes`),
-      runQuery = _require9.runQuery;
+const {
+  runQuery
+} = require(`../db/nodes`);
 
 const defaultNodeFields = {
   id: {
@@ -103,7 +108,9 @@ function buildChildFieldConfigMap(typeName, nodeObjectType) {
 }
 
 function inferChildFieldConfigMap(type, typeName, processedTypes) {
-  const nodeObjectType = processedTypes[typeName].nodeObjectType; // Does this child type have one child per parent or multiple?
+  const {
+    nodeObjectType
+  } = processedTypes[typeName]; // Does this child type have one child per parent or multiple?
 
   const maxChildCount = _.maxBy(_.values(_.groupBy(type, c => c.parent)), g => g.length).length;
 
@@ -137,38 +144,34 @@ function inferFields({
     types: _.values(processedTypes),
     ignoreFields: Object.keys(pluginFields)
   });
-  return Object.assign({}, defaultNodeFields, childFields, inferredFields, pluginFields);
+  return { ...defaultNodeFields,
+    ...childFields,
+    ...inferredFields,
+    ...pluginFields
+  };
 }
 
 function buildResolver(gqlType) {
-  return (
-    /*#__PURE__*/
-    function () {
-      var _ref = (0, _asyncToGenerator2.default)(function* (a, queryArgs) {
-        if (!_.isObject(queryArgs)) {
-          queryArgs = {};
-        }
-
-        const results = yield runQuery({
-          queryArgs: {
-            filter: Object.assign({}, queryArgs)
-          },
-          firstOnly: true,
-          gqlType
-        });
-
-        if (results.length > 0) {
-          return results[0];
-        } else {
-          return null;
+  return async (a, queryArgs) => {
+    if (!_.isObject(queryArgs)) {
+      queryArgs = {};
+    }
+
+    const results = await runQuery({
+      queryArgs: {
+        filter: { ...queryArgs
         }
-      });
+      },
+      firstOnly: true,
+      gqlType
+    });
 
-      return function (_x, _x2) {
-        return _ref.apply(this, arguments);
-      };
-    }()
-  );
+    if (results.length > 0) {
+      return results[0];
+    } else {
+      return null;
+    }
+  };
 }
 
 function buildNodeObjectType({
@@ -190,99 +193,76 @@ function buildNodeObjectType({
   });
 }
 
-function buildProcessedType(_x3, _x4, _x5, _x6) {
-  return _buildProcessedType.apply(this, arguments);
-}
-
-function _buildProcessedType() {
-  _buildProcessedType = (0, _asyncToGenerator2.default)(function* (nodes, typeName, processedTypes, span) {
-    const intermediateType = {};
-    intermediateType.name = typeName;
-    intermediateType.nodes = nodes;
-    const pluginFields = yield apiRunner(`setFieldsOnGraphQLNodeType`, {
-      type: intermediateType,
-      traceId: `initial-setFieldsOnGraphQLNodeType`,
-      parentSpan: span
-    });
-
-    const mergedFieldsFromPlugins = _.merge(...pluginFields);
+async function buildProcessedType(nodes, typeName, processedTypes, span) {
+  const intermediateType = {};
+  intermediateType.name = typeName;
+  intermediateType.nodes = nodes;
+  const pluginFields = await apiRunner(`setFieldsOnGraphQLNodeType`, {
+    type: intermediateType,
+    traceId: `initial-setFieldsOnGraphQLNodeType`,
+    parentSpan: span
+  });
 
-    const pluginInputFields = inferInputObjectStructureFromFields({
-      fields: mergedFieldsFromPlugins
-    });
-    const gqlType = buildNodeObjectType({
-      typeName,
-      nodes,
-      pluginFields: mergedFieldsFromPlugins,
-      processedTypes
-    });
-    const nodeInputFields = inferInputObjectStructureFromNodes({
-      nodes,
-      typeName
-    });
+  const mergedFieldsFromPlugins = _.merge(...pluginFields);
 
-    const filterFields = _.merge({}, nodeInputFields.inferredFields, pluginInputFields.inferredFields);
-
-    return Object.assign({}, intermediateType, {
-      fieldsFromPlugins: mergedFieldsFromPlugins,
-      nodeObjectType: gqlType,
-      node: {
-        name: typeName,
-        type: gqlType,
-        args: filterFields,
-        resolve: pageDependencyResolver(buildResolver(gqlType))
-      }
-    });
+  const pluginInputFields = inferInputObjectStructureFromFields({
+    fields: mergedFieldsFromPlugins
+  });
+  const gqlType = buildNodeObjectType({
+    typeName,
+    nodes,
+    pluginFields: mergedFieldsFromPlugins,
+    processedTypes
+  });
+  const nodeInputFields = inferInputObjectStructureFromNodes({
+    nodes,
+    typeName
   });
-  return _buildProcessedType.apply(this, arguments);
+
+  const filterFields = _.merge({}, nodeInputFields.inferredFields, pluginInputFields.inferredFields);
+
+  return { ...intermediateType,
+    fieldsFromPlugins: mergedFieldsFromPlugins,
+    nodeObjectType: gqlType,
+    node: {
+      name: typeName,
+      type: gqlType,
+      args: filterFields,
+      resolve: pageDependencyResolver(buildResolver(gqlType))
+    }
+  };
 }
 
 function groupNodesByType(nodes) {
   return _.groupBy(nodes.filter(node => node.internal && !node.internal.ignoreType), node => node.internal.type);
 }
 
-module.exports =
-/*#__PURE__*/
-function () {
-  var _ref2 = (0, _asyncToGenerator2.default)(function* ({
-    parentSpan
-  }) {
-    const spanArgs = parentSpan ? {
-      childOf: parentSpan
-    } : {};
-    const span = tracer.startSpan(`build schema`, spanArgs);
-    const types = groupNodesByType(getNodes());
-    const processedTypes = {};
-    clearTypeExampleValues(); // Reset stored File type to not point to outdated type definition
-
-    setFileNodeRootType(null); // Create node types and node fields for nodes that have a resolve function.
-
-    yield Promise.all(_.map(types,
-    /*#__PURE__*/
-    function () {
-      var _ref3 = (0, _asyncToGenerator2.default)(function* (nodes, typeName) {
-        const fieldName = _.camelCase(typeName);
-
-        const processedType = yield buildProcessedType(nodes, typeName, processedTypes, span);
-        processedTypes[fieldName] = processedType; // Special case to construct linked file type used by type inferring
-
-        if (typeName === `File`) {
-          setFileNodeRootType(processedType.nodeObjectType);
-        }
-
-        return;
-      });
-
-      return function (_x8, _x9) {
-        return _ref3.apply(this, arguments);
-      };
-    }()));
-    span.finish();
-    return processedTypes;
-  });
-
-  return function (_x7) {
-    return _ref2.apply(this, arguments);
-  };
-}();
+module.exports = async ({
+  parentSpan
+}) => {
+  const spanArgs = parentSpan ? {
+    childOf: parentSpan
+  } : {};
+  const span = tracer.startSpan(`build schema`, spanArgs);
+  const types = groupNodesByType(getNodes());
+  const processedTypes = {};
+  clearTypeExampleValues(); // Reset stored File type to not point to outdated type definition
+
+  setFileNodeRootType(null); // Create node types and node fields for nodes that have a resolve function.
+
+  await Promise.all(_.map(types, async (nodes, typeName) => {
+    const fieldName = _.camelCase(typeName);
+
+    const processedType = await buildProcessedType(nodes, typeName, processedTypes, span);
+    processedTypes[fieldName] = processedType; // Special case to construct linked file type used by type inferring
+
+    if (typeName === `File`) {
+      setFileNodeRootType(processedType.nodeObjectType);
+    }
+
+    return;
+  }));
+  span.finish();
+  return processedTypes;
+};
 //# sourceMappingURL=build-node-types.js.map
\ No newline at end of file
--- a/node_modules/gatsby/dist/schema/build-node-types.js.map
+++ b/node_modules/gatsby/dist/schema/build-node-types.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/schema/build-node-types.js"],"names":["_","require","GraphQLObjectType","GraphQLNonNull","GraphQLID","GraphQLList","tracer","globalTracer","apiRunner","inferObjectStructureFromNodes","inferInputObjectStructureFromFields","inferInputObjectStructureFromNodes","nodeInterface","getNodes","getNode","pageDependencyResolver","setFileNodeRootType","clearTypeExampleValues","runQuery","defaultNodeFields","id","type","description","parent","resolve","node","children","map","groupChildNodesByType","nodes","flatMap","groupBy","internal","camelCase","undefined","value","nodeIsOfType","typeName","makeChildrenResolver","filter","buildChildrenFieldConfigMap","nodeObjectType","fieldName","fieldConfig","makeChildResolver","find","buildChildFieldConfigMap","inferChildFieldConfigMap","processedTypes","maxChildCount","maxBy","values","c","g","length","inferChildFields","childNodesByType","configMaps","assign","apply","inferFields","pluginFields","childFields","inferredFields","types","ignoreFields","Object","keys","buildResolver","gqlType","a","queryArgs","isObject","results","firstOnly","buildNodeObjectType","name","interfaces","fields","isTypeOf","buildProcessedType","span","intermediateType","traceId","parentSpan","mergedFieldsFromPlugins","merge","pluginInputFields","nodeInputFields","filterFields","fieldsFromPlugins","args","groupNodesByType","ignoreType","module","exports","spanArgs","childOf","startSpan","Promise","all","processedType","finish"],"mappings":"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","sourcesContent":["// @flow\nconst _ = require(`lodash`)\nconst {\n  GraphQLObjectType,\n  GraphQLNonNull,\n  GraphQLID,\n  GraphQLList,\n} = require(`graphql`)\nconst tracer = require(`opentracing`).globalTracer()\n\nconst apiRunner = require(`../utils/api-runner-node`)\nconst { inferObjectStructureFromNodes } = require(`./infer-graphql-type`)\nconst {\n  inferInputObjectStructureFromFields,\n} = require(`./infer-graphql-input-fields-from-fields`)\nconst {\n  inferInputObjectStructureFromNodes,\n} = require(`./infer-graphql-input-fields`)\nconst { nodeInterface } = require(`./node-interface`)\nconst { getNodes, getNode } = require(`../db/nodes`)\nconst pageDependencyResolver = require(`./page-dependency-resolver`)\nconst { setFileNodeRootType } = require(`./types/type-file`)\nconst { clearTypeExampleValues } = require(`./data-tree-utils`)\nconst { runQuery } = require(`../db/nodes`)\n\nimport type { ProcessedNodeType } from \"./infer-graphql-type\"\n\ntype TypeMap = {\n  [typeName: string]: ProcessedNodeType,\n}\n\nconst defaultNodeFields = {\n  id: {\n    type: new GraphQLNonNull(GraphQLID),\n    description: `The id of this node.`,\n  },\n  parent: {\n    type: nodeInterface,\n    description: `The parent of this node.`,\n    resolve: pageDependencyResolver(node => getNode(node.parent)),\n  },\n  children: {\n    type: new GraphQLList(nodeInterface),\n    description: `The children of this node.`,\n    resolve: pageDependencyResolver(node => node.children.map(getNode)),\n  },\n}\n\nfunction groupChildNodesByType(nodes) {\n  return _(nodes)\n    .flatMap(node => node.children.map(getNode))\n    .groupBy(\n      node => (node.internal ? _.camelCase(node.internal.type) : undefined)\n    )\n    .value()\n}\n\nfunction nodeIsOfType(typeName) {\n  return node => _.camelCase(node.internal.type) === typeName\n}\n\nfunction makeChildrenResolver(typeName) {\n  return node => node.children.map(getNode).filter(nodeIsOfType(typeName))\n}\n\nfunction buildChildrenFieldConfigMap(typeName, nodeObjectType) {\n  const fieldName = _.camelCase(`children ${typeName}`)\n  const fieldConfig = {\n    type: new GraphQLList(nodeObjectType),\n    description: `The children of this node of type ${typeName}`,\n    resolve: pageDependencyResolver(makeChildrenResolver(typeName)),\n  }\n  return { [fieldName]: fieldConfig }\n}\n\nfunction makeChildResolver(typeName) {\n  return node => node.children.map(getNode).find(nodeIsOfType(typeName))\n}\n\nfunction buildChildFieldConfigMap(typeName, nodeObjectType) {\n  const fieldName = _.camelCase(`child ${typeName}`)\n  const fieldConfig = {\n    type: nodeObjectType,\n    description: `The child of this node of type ${typeName}`,\n    resolve: pageDependencyResolver(makeChildResolver(typeName)),\n  }\n  return { [fieldName]: fieldConfig }\n}\n\nfunction inferChildFieldConfigMap(type, typeName, processedTypes) {\n  const { nodeObjectType } = processedTypes[typeName]\n  // Does this child type have one child per parent or multiple?\n  const maxChildCount = _.maxBy(\n    _.values(_.groupBy(type, c => c.parent)),\n    g => g.length\n  ).length\n\n  if (maxChildCount > 1) {\n    return buildChildrenFieldConfigMap(typeName, nodeObjectType)\n  } else {\n    return buildChildFieldConfigMap(typeName, nodeObjectType)\n  }\n}\n\nfunction inferChildFields(nodes, processedTypes) {\n  // Create children fields for each type of children e.g.\n  // \"childrenMarkdownRemark\".\n  const childNodesByType = groupChildNodesByType(nodes)\n\n  const configMaps = _.map(childNodesByType, (type, typeName) =>\n    inferChildFieldConfigMap(type, typeName, processedTypes)\n  )\n  return _.assign.apply(null, [{}, ...configMaps])\n}\n\nfunction inferFields({ nodes, pluginFields, processedTypes }) {\n  // Create children fields for each type of children e.g.\n  // \"childrenMarkdownRemark\".\n  const childFields = inferChildFields(nodes, processedTypes)\n\n  const inferredFields = inferObjectStructureFromNodes({\n    nodes,\n    types: _.values(processedTypes),\n    ignoreFields: Object.keys(pluginFields),\n  })\n\n  return {\n    ...defaultNodeFields,\n    ...childFields,\n    ...inferredFields,\n    ...pluginFields,\n  }\n}\n\nfunction buildResolver(gqlType) {\n  return async (a, queryArgs) => {\n    if (!_.isObject(queryArgs)) {\n      queryArgs = {}\n    }\n\n    const results = await runQuery({\n      queryArgs: {\n        filter: {\n          ...queryArgs,\n        },\n      },\n      firstOnly: true,\n      gqlType,\n    })\n\n    if (results.length > 0) {\n      return results[0]\n    } else {\n      return null\n    }\n  }\n}\n\nfunction buildNodeObjectType({\n  typeName,\n  nodes,\n  pluginFields,\n  processedTypes,\n}) {\n  return new GraphQLObjectType({\n    name: typeName,\n    description: `Node of type ${typeName}`,\n    interfaces: [nodeInterface],\n    fields: () => inferFields({ nodes, pluginFields, processedTypes }),\n    isTypeOf: value => value.internal.type === typeName,\n  })\n}\n\nasync function buildProcessedType(nodes, typeName, processedTypes, span) {\n  const intermediateType = {}\n\n  intermediateType.name = typeName\n  intermediateType.nodes = nodes\n\n  const pluginFields = await apiRunner(`setFieldsOnGraphQLNodeType`, {\n    type: intermediateType,\n    traceId: `initial-setFieldsOnGraphQLNodeType`,\n    parentSpan: span,\n  })\n\n  const mergedFieldsFromPlugins = _.merge(...pluginFields)\n\n  const pluginInputFields = inferInputObjectStructureFromFields({\n    fields: mergedFieldsFromPlugins,\n  })\n\n  const gqlType = buildNodeObjectType({\n    typeName,\n    nodes,\n    pluginFields: mergedFieldsFromPlugins,\n    processedTypes,\n  })\n\n  const nodeInputFields = inferInputObjectStructureFromNodes({\n    nodes,\n    typeName,\n  })\n\n  const filterFields = _.merge(\n    {},\n    nodeInputFields.inferredFields,\n    pluginInputFields.inferredFields\n  )\n\n  return {\n    ...intermediateType,\n    fieldsFromPlugins: mergedFieldsFromPlugins,\n    nodeObjectType: gqlType,\n    node: {\n      name: typeName,\n      type: gqlType,\n      args: filterFields,\n      resolve: pageDependencyResolver(buildResolver(gqlType)),\n    },\n  }\n}\n\nfunction groupNodesByType(nodes) {\n  return _.groupBy(\n    nodes.filter(node => node.internal && !node.internal.ignoreType),\n    node => node.internal.type\n  )\n}\n\nmodule.exports = async ({ parentSpan }) => {\n  const spanArgs = parentSpan ? { childOf: parentSpan } : {}\n  const span = tracer.startSpan(`build schema`, spanArgs)\n\n  const types = groupNodesByType(getNodes())\n  const processedTypes: TypeMap = {}\n\n  clearTypeExampleValues()\n\n  // Reset stored File type to not point to outdated type definition\n  setFileNodeRootType(null)\n\n  // Create node types and node fields for nodes that have a resolve function.\n  await Promise.all(\n    _.map(types, async (nodes, typeName) => {\n      const fieldName = _.camelCase(typeName)\n      const processedType = await buildProcessedType(\n        nodes,\n        typeName,\n        processedTypes,\n        span\n      )\n      processedTypes[fieldName] = processedType\n      // Special case to construct linked file type used by type inferring\n      if (typeName === `File`) {\n        setFileNodeRootType(processedType.nodeObjectType)\n      }\n      return\n    })\n  )\n\n  span.finish()\n\n  return processedTypes\n}\n"],"file":"build-node-types.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/schema/build-node-types.js"],"names":["_","require","GraphQLObjectType","GraphQLNonNull","GraphQLID","GraphQLList","tracer","globalTracer","apiRunner","inferObjectStructureFromNodes","inferInputObjectStructureFromFields","inferInputObjectStructureFromNodes","nodeInterface","getNodes","getNode","pageDependencyResolver","setFileNodeRootType","clearTypeExampleValues","runQuery","defaultNodeFields","id","type","description","parent","resolve","node","children","map","groupChildNodesByType","nodes","flatMap","groupBy","internal","camelCase","undefined","value","nodeIsOfType","typeName","makeChildrenResolver","filter","buildChildrenFieldConfigMap","nodeObjectType","fieldName","fieldConfig","makeChildResolver","find","buildChildFieldConfigMap","inferChildFieldConfigMap","processedTypes","maxChildCount","maxBy","values","c","g","length","inferChildFields","childNodesByType","configMaps","assign","apply","inferFields","pluginFields","childFields","inferredFields","types","ignoreFields","Object","keys","buildResolver","gqlType","a","queryArgs","isObject","results","firstOnly","buildNodeObjectType","name","interfaces","fields","isTypeOf","buildProcessedType","span","intermediateType","traceId","parentSpan","mergedFieldsFromPlugins","merge","pluginInputFields","nodeInputFields","filterFields","fieldsFromPlugins","args","groupNodesByType","ignoreType","module","exports","spanArgs","childOf","startSpan","Promise","all","processedType","finish"],"mappings":"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","sourcesContent":["// @flow\nconst _ = require(`lodash`)\nconst {\n  GraphQLObjectType,\n  GraphQLNonNull,\n  GraphQLID,\n  GraphQLList,\n} = require(`graphql`)\nconst tracer = require(`opentracing`).globalTracer()\n\nconst apiRunner = require(`../utils/api-runner-node`)\nconst { inferObjectStructureFromNodes } = require(`./infer-graphql-type`)\nconst {\n  inferInputObjectStructureFromFields,\n} = require(`./infer-graphql-input-fields-from-fields`)\nconst {\n  inferInputObjectStructureFromNodes,\n} = require(`./infer-graphql-input-fields`)\nconst { nodeInterface } = require(`./node-interface`)\nconst { getNodes, getNode } = require(`../db/nodes`)\nconst pageDependencyResolver = require(`./page-dependency-resolver`)\nconst { setFileNodeRootType } = require(`./types/type-file`)\nconst { clearTypeExampleValues } = require(`./data-tree-utils`)\nconst { runQuery } = require(`../db/nodes`)\n\nimport type { ProcessedNodeType } from \"./infer-graphql-type\"\n\ntype TypeMap = {\n  [typeName: string]: ProcessedNodeType,\n}\n\nconst defaultNodeFields = {\n  id: {\n    type: new GraphQLNonNull(GraphQLID),\n    description: `The id of this node.`,\n  },\n  parent: {\n    type: nodeInterface,\n    description: `The parent of this node.`,\n    resolve: pageDependencyResolver(node => getNode(node.parent)),\n  },\n  children: {\n    type: new GraphQLList(nodeInterface),\n    description: `The children of this node.`,\n    resolve: pageDependencyResolver(node => node.children.map(getNode)),\n  },\n}\n\nfunction groupChildNodesByType(nodes) {\n  return _(nodes)\n    .flatMap(node => node.children.map(getNode))\n    .groupBy(\n      node => (node.internal ? _.camelCase(node.internal.type) : undefined)\n    )\n    .value()\n}\n\nfunction nodeIsOfType(typeName) {\n  return node => _.camelCase(node.internal.type) === typeName\n}\n\nfunction makeChildrenResolver(typeName) {\n  return node => node.children.map(getNode).filter(nodeIsOfType(typeName))\n}\n\nfunction buildChildrenFieldConfigMap(typeName, nodeObjectType) {\n  const fieldName = _.camelCase(`children ${typeName}`)\n  const fieldConfig = {\n    type: new GraphQLList(nodeObjectType),\n    description: `The children of this node of type ${typeName}`,\n    resolve: pageDependencyResolver(makeChildrenResolver(typeName)),\n  }\n  return { [fieldName]: fieldConfig }\n}\n\nfunction makeChildResolver(typeName) {\n  return node => node.children.map(getNode).find(nodeIsOfType(typeName))\n}\n\nfunction buildChildFieldConfigMap(typeName, nodeObjectType) {\n  const fieldName = _.camelCase(`child ${typeName}`)\n  const fieldConfig = {\n    type: nodeObjectType,\n    description: `The child of this node of type ${typeName}`,\n    resolve: pageDependencyResolver(makeChildResolver(typeName)),\n  }\n  return { [fieldName]: fieldConfig }\n}\n\nfunction inferChildFieldConfigMap(type, typeName, processedTypes) {\n  const { nodeObjectType } = processedTypes[typeName]\n  // Does this child type have one child per parent or multiple?\n  const maxChildCount = _.maxBy(\n    _.values(_.groupBy(type, c => c.parent)),\n    g => g.length\n  ).length\n\n  if (maxChildCount > 1) {\n    return buildChildrenFieldConfigMap(typeName, nodeObjectType)\n  } else {\n    return buildChildFieldConfigMap(typeName, nodeObjectType)\n  }\n}\n\nfunction inferChildFields(nodes, processedTypes) {\n  // Create children fields for each type of children e.g.\n  // \"childrenMarkdownRemark\".\n  const childNodesByType = groupChildNodesByType(nodes)\n\n  const configMaps = _.map(childNodesByType, (type, typeName) =>\n    inferChildFieldConfigMap(type, typeName, processedTypes)\n  )\n  return _.assign.apply(null, [{}, ...configMaps])\n}\n\nfunction inferFields({ nodes, pluginFields, processedTypes }) {\n  // Create children fields for each type of children e.g.\n  // \"childrenMarkdownRemark\".\n  const childFields = inferChildFields(nodes, processedTypes)\n\n  const inferredFields = inferObjectStructureFromNodes({\n    nodes,\n    types: _.values(processedTypes),\n    ignoreFields: Object.keys(pluginFields),\n  })\n\n  return {\n    ...defaultNodeFields,\n    ...childFields,\n    ...inferredFields,\n    ...pluginFields,\n  }\n}\n\nfunction buildResolver(gqlType) {\n  return async (a, queryArgs) => {\n    if (!_.isObject(queryArgs)) {\n      queryArgs = {}\n    }\n\n    const results = await runQuery({\n      queryArgs: {\n        filter: {\n          ...queryArgs,\n        },\n      },\n      firstOnly: true,\n      gqlType,\n    })\n\n    if (results.length > 0) {\n      return results[0]\n    } else {\n      return null\n    }\n  }\n}\n\nfunction buildNodeObjectType({\n  typeName,\n  nodes,\n  pluginFields,\n  processedTypes,\n}) {\n  return new GraphQLObjectType({\n    name: typeName,\n    description: `Node of type ${typeName}`,\n    interfaces: [nodeInterface],\n    fields: () => inferFields({ nodes, pluginFields, processedTypes }),\n    isTypeOf: value => value.internal.type === typeName,\n  })\n}\n\nasync function buildProcessedType(nodes, typeName, processedTypes, span) {\n  const intermediateType = {}\n\n  intermediateType.name = typeName\n  intermediateType.nodes = nodes\n\n  const pluginFields = await apiRunner(`setFieldsOnGraphQLNodeType`, {\n    type: intermediateType,\n    traceId: `initial-setFieldsOnGraphQLNodeType`,\n    parentSpan: span,\n  })\n\n  const mergedFieldsFromPlugins = _.merge(...pluginFields)\n\n  const pluginInputFields = inferInputObjectStructureFromFields({\n    fields: mergedFieldsFromPlugins,\n  })\n\n  const gqlType = buildNodeObjectType({\n    typeName,\n    nodes,\n    pluginFields: mergedFieldsFromPlugins,\n    processedTypes,\n  })\n\n  const nodeInputFields = inferInputObjectStructureFromNodes({\n    nodes,\n    typeName,\n  })\n\n  const filterFields = _.merge(\n    {},\n    nodeInputFields.inferredFields,\n    pluginInputFields.inferredFields\n  )\n\n  return {\n    ...intermediateType,\n    fieldsFromPlugins: mergedFieldsFromPlugins,\n    nodeObjectType: gqlType,\n    node: {\n      name: typeName,\n      type: gqlType,\n      args: filterFields,\n      resolve: pageDependencyResolver(buildResolver(gqlType)),\n    },\n  }\n}\n\nfunction groupNodesByType(nodes) {\n  return _.groupBy(\n    nodes.filter(node => node.internal && !node.internal.ignoreType),\n    node => node.internal.type\n  )\n}\n\nmodule.exports = async ({ parentSpan }) => {\n  const spanArgs = parentSpan ? { childOf: parentSpan } : {}\n  const span = tracer.startSpan(`build schema`, spanArgs)\n\n  const types = groupNodesByType(getNodes())\n  const processedTypes: TypeMap = {}\n\n  clearTypeExampleValues()\n\n  // Reset stored File type to not point to outdated type definition\n  setFileNodeRootType(null)\n\n  // Create node types and node fields for nodes that have a resolve function.\n  await Promise.all(\n    _.map(types, async (nodes, typeName) => {\n      const fieldName = _.camelCase(typeName)\n      const processedType = await buildProcessedType(\n        nodes,\n        typeName,\n        processedTypes,\n        span\n      )\n      processedTypes[fieldName] = processedType\n      // Special case to construct linked file type used by type inferring\n      if (typeName === `File`) {\n        setFileNodeRootType(processedType.nodeObjectType)\n      }\n      return\n    })\n  )\n\n  span.finish()\n\n  return processedTypes\n}\n"],"file":"build-node-types.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/schema/create-sort-field.js
+++ b/node_modules/gatsby/dist/schema/create-sort-field.js
@@ -1,10 +1,11 @@
 "use strict";
 
-const _require = require(`graphql`),
-      GraphQLInputObjectType = _require.GraphQLInputObjectType,
-      GraphQLList = _require.GraphQLList,
-      GraphQLEnumType = _require.GraphQLEnumType,
-      GraphQLNonNull = _require.GraphQLNonNull;
+const {
+  GraphQLInputObjectType,
+  GraphQLList,
+  GraphQLEnumType,
+  GraphQLNonNull
+} = require(`graphql`);
 
 const _ = require(`lodash`);
 
--- a/node_modules/gatsby/dist/schema/create-sort-field.js.map
+++ b/node_modules/gatsby/dist/schema/create-sort-field.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/schema/create-sort-field.js"],"names":["require","GraphQLInputObjectType","GraphQLList","GraphQLEnumType","GraphQLNonNull","_","createKey","module","exports","createSortField","typeName","fieldNames","enumValues","forEach","field","value","SortByType","name","values","type","camelCase","fields","order","defaultValue","ASC","DESC"],"mappings":";;iBAMIA,OAAO,CAAE,SAAF,C;MAJTC,sB,YAAAA,sB;MACAC,W,YAAAA,W;MACAC,e,YAAAA,e;MACAC,c,YAAAA,c;;AAEF,MAAMC,CAAC,GAAGL,OAAO,CAAE,QAAF,CAAjB;;AACA,MAAMM,SAAS,GAAGN,OAAO,CAAE,cAAF,CAAzB,C,CAEA;;;AACAO,MAAM,CAACC,OAAP,GAAiB,SAASC,eAAT,CACfC,QADe,EAEfC,UAFe,EAGf;AACA,QAAMC,UAAU,GAAG,EAAnB;AACAD,EAAAA,UAAU,CAACE,OAAX,CAAmBC,KAAK,IAAI;AAC1BF,IAAAA,UAAU,CAACN,SAAS,CAACQ,KAAD,CAAV,CAAV,GAA+B;AAAEC,MAAAA,KAAK,EAAED;AAAT,KAA/B;AACD,GAFD;AAIA,QAAME,UAAU,GAAG,IAAIb,eAAJ,CAAoB;AACrCc,IAAAA,IAAI,EAAG,GAAEP,QAAS,kBADmB;AAErCQ,IAAAA,MAAM,EAAEN;AAF6B,GAApB,CAAnB;AAKA,SAAO;AACLO,IAAAA,IAAI,EAAE,IAAIlB,sBAAJ,CAA2B;AAC/BgB,MAAAA,IAAI,EAAEZ,CAAC,CAACe,SAAF,CAAa,GAAEV,QAAS,OAAxB,CADyB;AAE/BW,MAAAA,MAAM,EAAE;AACNA,QAAAA,MAAM,EAAE;AACNJ,UAAAA,IAAI,EAAEZ,CAAC,CAACe,SAAF,CAAa,GAAEV,QAAS,aAAxB,CADA;AAENS,UAAAA,IAAI,EAAE,IAAIf,cAAJ,CAAmB,IAAIF,WAAJ,CAAgBc,UAAhB,CAAnB;AAFA,SADF;AAKNM,QAAAA,KAAK,EAAE;AACLL,UAAAA,IAAI,EAAEZ,CAAC,CAACe,SAAF,CAAa,GAAEV,QAAS,YAAxB,CADD;AAELa,UAAAA,YAAY,EAAG,KAFV;AAGLJ,UAAAA,IAAI,EAAE,IAAIhB,eAAJ,CAAoB;AACxBc,YAAAA,IAAI,EAAEZ,CAAC,CAACe,SAAF,CAAa,GAAEV,QAAS,kBAAxB,CADkB;AAExBQ,YAAAA,MAAM,EAAE;AACNM,cAAAA,GAAG,EAAE;AAAET,gBAAAA,KAAK,EAAG;AAAV,eADC;AAENU,cAAAA,IAAI,EAAE;AAAEV,gBAAAA,KAAK,EAAG;AAAV;AAFA;AAFgB,WAApB;AAHD;AALD;AAFuB,KAA3B;AADD,GAAP;AAsBD,CApCD","sourcesContent":["// @flow\nconst {\n  GraphQLInputObjectType,\n  GraphQLList,\n  GraphQLEnumType,\n  GraphQLNonNull,\n} = require(`graphql`)\nconst _ = require(`lodash`)\nconst createKey = require(`./create-key`)\n\n// builds an input field for sorting, given an array of names to sort on\nmodule.exports = function createSortField(\n  typeName: string,\n  fieldNames: string[]\n) {\n  const enumValues = {}\n  fieldNames.forEach(field => {\n    enumValues[createKey(field)] = { value: field }\n  })\n\n  const SortByType = new GraphQLEnumType({\n    name: `${typeName}SortByFieldsEnum`,\n    values: enumValues,\n  })\n\n  return {\n    type: new GraphQLInputObjectType({\n      name: _.camelCase(`${typeName} sort`),\n      fields: {\n        fields: {\n          name: _.camelCase(`${typeName} sortFields`),\n          type: new GraphQLNonNull(new GraphQLList(SortByType)),\n        },\n        order: {\n          name: _.camelCase(`${typeName} sortOrder`),\n          defaultValue: `ASC`,\n          type: new GraphQLEnumType({\n            name: _.camelCase(`${typeName} sortOrderValues`),\n            values: {\n              ASC: { value: `asc` },\n              DESC: { value: `desc` },\n            },\n          }),\n        },\n      },\n    }),\n  }\n}\n"],"file":"create-sort-field.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/schema/create-sort-field.js"],"names":["GraphQLInputObjectType","GraphQLList","GraphQLEnumType","GraphQLNonNull","require","_","createKey","module","exports","createSortField","typeName","fieldNames","enumValues","forEach","field","value","SortByType","name","values","type","camelCase","fields","order","defaultValue","ASC","DESC"],"mappings":";;AACA,MAAM;AACJA,EAAAA,sBADI;AAEJC,EAAAA,WAFI;AAGJC,EAAAA,eAHI;AAIJC,EAAAA;AAJI,IAKFC,OAAO,CAAE,SAAF,CALX;;AAMA,MAAMC,CAAC,GAAGD,OAAO,CAAE,QAAF,CAAjB;;AACA,MAAME,SAAS,GAAGF,OAAO,CAAE,cAAF,CAAzB,C,CAEA;;;AACAG,MAAM,CAACC,OAAP,GAAiB,SAASC,eAAT,CACfC,QADe,EAEfC,UAFe,EAGf;AACA,QAAMC,UAAU,GAAG,EAAnB;AACAD,EAAAA,UAAU,CAACE,OAAX,CAAmBC,KAAK,IAAI;AAC1BF,IAAAA,UAAU,CAACN,SAAS,CAACQ,KAAD,CAAV,CAAV,GAA+B;AAAEC,MAAAA,KAAK,EAAED;AAAT,KAA/B;AACD,GAFD;AAIA,QAAME,UAAU,GAAG,IAAId,eAAJ,CAAoB;AACrCe,IAAAA,IAAI,EAAG,GAAEP,QAAS,kBADmB;AAErCQ,IAAAA,MAAM,EAAEN;AAF6B,GAApB,CAAnB;AAKA,SAAO;AACLO,IAAAA,IAAI,EAAE,IAAInB,sBAAJ,CAA2B;AAC/BiB,MAAAA,IAAI,EAAEZ,CAAC,CAACe,SAAF,CAAa,GAAEV,QAAS,OAAxB,CADyB;AAE/BW,MAAAA,MAAM,EAAE;AACNA,QAAAA,MAAM,EAAE;AACNJ,UAAAA,IAAI,EAAEZ,CAAC,CAACe,SAAF,CAAa,GAAEV,QAAS,aAAxB,CADA;AAENS,UAAAA,IAAI,EAAE,IAAIhB,cAAJ,CAAmB,IAAIF,WAAJ,CAAgBe,UAAhB,CAAnB;AAFA,SADF;AAKNM,QAAAA,KAAK,EAAE;AACLL,UAAAA,IAAI,EAAEZ,CAAC,CAACe,SAAF,CAAa,GAAEV,QAAS,YAAxB,CADD;AAELa,UAAAA,YAAY,EAAG,KAFV;AAGLJ,UAAAA,IAAI,EAAE,IAAIjB,eAAJ,CAAoB;AACxBe,YAAAA,IAAI,EAAEZ,CAAC,CAACe,SAAF,CAAa,GAAEV,QAAS,kBAAxB,CADkB;AAExBQ,YAAAA,MAAM,EAAE;AACNM,cAAAA,GAAG,EAAE;AAAET,gBAAAA,KAAK,EAAG;AAAV,eADC;AAENU,cAAAA,IAAI,EAAE;AAAEV,gBAAAA,KAAK,EAAG;AAAV;AAFA;AAFgB,WAApB;AAHD;AALD;AAFuB,KAA3B;AADD,GAAP;AAsBD,CApCD","sourcesContent":["// @flow\nconst {\n  GraphQLInputObjectType,\n  GraphQLList,\n  GraphQLEnumType,\n  GraphQLNonNull,\n} = require(`graphql`)\nconst _ = require(`lodash`)\nconst createKey = require(`./create-key`)\n\n// builds an input field for sorting, given an array of names to sort on\nmodule.exports = function createSortField(\n  typeName: string,\n  fieldNames: string[]\n) {\n  const enumValues = {}\n  fieldNames.forEach(field => {\n    enumValues[createKey(field)] = { value: field }\n  })\n\n  const SortByType = new GraphQLEnumType({\n    name: `${typeName}SortByFieldsEnum`,\n    values: enumValues,\n  })\n\n  return {\n    type: new GraphQLInputObjectType({\n      name: _.camelCase(`${typeName} sort`),\n      fields: {\n        fields: {\n          name: _.camelCase(`${typeName} sortFields`),\n          type: new GraphQLNonNull(new GraphQLList(SortByType)),\n        },\n        order: {\n          name: _.camelCase(`${typeName} sortOrder`),\n          defaultValue: `ASC`,\n          type: new GraphQLEnumType({\n            name: _.camelCase(`${typeName} sortOrderValues`),\n            values: {\n              ASC: { value: `asc` },\n              DESC: { value: `desc` },\n            },\n          }),\n        },\n      },\n    }),\n  }\n}\n"],"file":"create-sort-field.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/schema/data-tree-utils.js
+++ b/node_modules/gatsby/dist/schema/data-tree-utils.js
@@ -10,8 +10,9 @@ const invariant = require(`invariant`);
 
 const createKey = require(`./create-key`);
 
-const _require = require(`./type-conflict-reporter`),
-      typeConflictReporter = _require.typeConflictReporter;
+const {
+  typeConflictReporter
+} = require(`./type-conflict-reporter`);
 
 const DateType = require(`./types/type-date`);
 
@@ -169,10 +170,11 @@ const extractFromArrays = (values, entries, selector) => {
   const flattenEntries = _.flatten(entries.map(entry => {
     invariant(Array.isArray(entry.value), `this is validated in the previous call`);
     return entry.value.map(value => {
-      return Object.assign({
+      return {
         value,
-        parent: entry.parent
-      }, extractTypes(value));
+        parent: entry.parent,
+        ...extractTypes(value)
+      };
     });
   }));
 
@@ -204,19 +206,7 @@ const extractFieldExamples = (nodes, selector, ignoreFields = []) => {
 
   const example = {};
 
-  for (var _iterator = allKeys, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {
-    var _ref;
-
-    if (_isArray) {
-      if (_i >= _iterator.length) break;
-      _ref = _iterator[_i++];
-    } else {
-      _i = _iterator.next();
-      if (_i.done) break;
-      _ref = _i.value;
-    }
-
-    let key = _ref;
+  for (let key of allKeys) {
     if (ignoreFields.includes(key)) continue;
     const nextSelector = selector ? `${selector}.${key}` : key;
     const nodeWithValues = nodes.filter(node => {
@@ -232,10 +222,11 @@ const extractFieldExamples = (nodes, selector, ignoreFields = []) => {
 
     const entries = nodeWithValues.map(node => {
       const value = node[key];
-      return Object.assign({
+      return {
         value,
-        parent: node
-      }, extractTypes(value));
+        parent: node,
+        ...extractTypes(value)
+      };
     });
     const value = extractFromEntries(entries, nextSelector, key);
     if (!isDefined(value)) continue;
--- a/node_modules/gatsby/dist/schema/data-tree-utils.js.map
+++ b/node_modules/gatsby/dist/schema/data-tree-utils.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/schema/data-tree-utils.js"],"names":["_","require","flatten","typeOf","invariant","createKey","typeConflictReporter","DateType","is32BitInteger","INVALID_VALUE","Symbol","isDefined","v","isEmptyObjectOrArray","obj","isDate","isObject","isEmpty","every","value","key","isScalar","val","Date","extractTypes","Array","isArray","uniqueTypes","uniq","filter","map","item","type","sort","join","arrayTypes","isMixOfDateObjectsAndDateStrings","values","length","includes","allValuesAreDates","shouldInfer","conflictIsValidSpecialCase","entries","entriesOfUniqueType","isConsistentlyScalarOrArray","entry","getExampleScalarFromArray","reduce","nextValue","isNumber","extractFromEntries","selector","uniqBy","addConflict","exampleValue","concatanedItems","extractFromArrays","isPlainObject","extractFieldExamples","filteredItems","flattenEntries","parent","arrayItemExample","nodes","ignoreFields","allKeys","flatMap","keys","example","nextSelector","nodeWithValues","node","buildFieldEnumValues","options","enumValues","getExampleValues","maxDepth","safe","delimiter","Object","forEach","field","typeExampleValues","Map","clearTypeExampleValues","clear","clearConflicts","typeName","cachedValue","get","set","extractFieldNames","module","exports"],"mappings":"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","sourcesContent":["// @flow\nconst _ = require(`lodash`)\nconst flatten = require(`flat`)\nconst typeOf = require(`type-of`)\nconst invariant = require(`invariant`)\n\nconst createKey = require(`./create-key`)\nconst { typeConflictReporter } = require(`./type-conflict-reporter`)\nconst DateType = require(`./types/type-date`)\nconst is32BitInteger = require(`../utils/is-32-bit-integer`)\n\nimport type { TypeEntry } from \"./type-conflict-reporter\"\n\ntype ExampleValue = Object\n\nconst INVALID_VALUE = Symbol(`INVALID_VALUE`)\nconst isDefined = v => v != null\n\nconst isEmptyObjectOrArray = (obj: any): boolean => {\n  if (obj === INVALID_VALUE) {\n    return true\n  } else if (_.isDate(obj)) {\n    return false\n    // Simple \"is object empty\" check.\n  } else if (_.isObject(obj) && _.isEmpty(obj)) {\n    return true\n  } else if (_.isObject(obj)) {\n    return _.every(obj, (value, key) => {\n      if (!isDefined(value)) {\n        return true\n      } else if (_.isObject(value)) {\n        return isEmptyObjectOrArray(value)\n      } else {\n        return false\n      }\n    })\n  }\n  return false\n}\n\nconst isScalar = val => !_.isObject(val) || val instanceof Date\n\nconst extractTypes = value => {\n  if (Array.isArray(value)) {\n    const uniqueTypes = _.uniq(\n      value.filter(isDefined).map(item => extractTypes(item).type)\n    ).sort()\n    return {\n      type: `array<${uniqueTypes.join(`|`)}>`,\n      arrayTypes: uniqueTypes,\n    }\n  } else {\n    const type = typeOf(value)\n    return {\n      type,\n      arrayTypes: [],\n    }\n  }\n}\n\nconst isMixOfDateObjectsAndDateStrings = (\n  values: any[],\n  uniqueTypes: string[]\n): boolean => {\n  if (\n    uniqueTypes.length === 2 &&\n    uniqueTypes.includes(`string`) &&\n    uniqueTypes.includes(`date`)\n  ) {\n    const allValuesAreDates = values.every(value => {\n      if (typeOf(value) === `date`) return true\n\n      // use infer checker to determine if string is a date\n      return DateType.shouldInfer(value)\n    })\n\n    return allValuesAreDates\n  }\n\n  return false\n}\n\nconst conflictIsValidSpecialCase = (\n  entries: TypeEntry[],\n  entriesOfUniqueType: TypeEntry[]\n): boolean => {\n  const isConsistentlyScalarOrArray = entriesOfUniqueType.every(\n    entry =>\n      entry.arrayTypes.length > 0 ===\n      entriesOfUniqueType[0].arrayTypes.length > 0\n  )\n  if (isConsistentlyScalarOrArray) {\n    // Get values and run them through special cases, to see if there actually\n    // is a conflict. This is done so late in process, because those checks\n    // would be expensive to do earlier during extraction, so we do them\n    // only when we have potential conflict.\n\n    let uniqueTypes: string[]\n    let values: any[]\n    const isArray = entriesOfUniqueType[0].arrayTypes.length > 0\n\n    if (isArray) {\n      values = _.flatten(entries.map(entry => entry.value))\n      uniqueTypes = _.uniq(\n        _.flatten(entriesOfUniqueType.map(entry => entry.arrayTypes))\n      )\n    } else {\n      values = entries.map(entry => entry.value)\n      uniqueTypes = entriesOfUniqueType.map(entry => entry.type)\n    }\n\n    return isMixOfDateObjectsAndDateStrings(values, uniqueTypes)\n  }\n  return false\n}\n\nconst getExampleScalarFromArray = values =>\n  _.reduce(\n    values,\n    (value, nextValue) => {\n      // Prefer floats over ints as they're more specific.\n      if (nextValue && _.isNumber(nextValue) && !is32BitInteger(nextValue)) {\n        return nextValue\n      } else if (value === null) {\n        return nextValue\n      } else {\n        return value\n      }\n    },\n    null\n  )\n\nconst extractFromEntries = (\n  entries: TypeEntry[],\n  selector: string,\n  key: string\n): ?mixed => {\n  const entriesOfUniqueType = _.uniqBy(entries, entry => entry.type)\n\n  if (entriesOfUniqueType.length == 0) {\n    // skip if no defined types\n    return null\n  } else if (\n    entriesOfUniqueType.length > 1 ||\n    entriesOfUniqueType[0].arrayTypes.length > 1\n  ) {\n    // there is multiple types or array of multiple types\n    // that aren't handled by any special case\n    if (!conflictIsValidSpecialCase(entries, entriesOfUniqueType)) {\n      if (selector) {\n        typeConflictReporter.addConflict(selector, entriesOfUniqueType)\n      }\n      return INVALID_VALUE\n    }\n  }\n\n  // Now we have entries of single type, we can merge them\n  const values = entries.map(entry => entry.value)\n\n  const exampleValue = entriesOfUniqueType[0].value\n\n  if (isScalar(exampleValue)) {\n    return getExampleScalarFromArray(values)\n  } else if (_.isObject(exampleValue)) {\n    if (Array.isArray(exampleValue)) {\n      const concatanedItems = _.flatten(values)\n      // Linked node arrays don't get reduced further as we\n      // want to preserve all the linked node types.\n      if (key.includes(`___NODE`)) {\n        return concatanedItems\n      }\n\n      return extractFromArrays(concatanedItems, entries, selector)\n    } else if (_.isPlainObject(exampleValue)) {\n      return extractFieldExamples(values, selector)\n    }\n  }\n  // unsuported object\n  return INVALID_VALUE\n}\n\nconst extractFromArrays = (values, entries: TypeEntry[], selector: string) => {\n  const filteredItems = values.filter(isDefined)\n  if (filteredItems.length === 0) {\n    return null\n  }\n  if (isScalar(filteredItems[0])) {\n    return [getExampleScalarFromArray(filteredItems)]\n  }\n\n  const flattenEntries: TypeEntry[] = _.flatten(\n    entries.map(entry => {\n      invariant(\n        Array.isArray(entry.value),\n        `this is validated in the previous call`\n      )\n\n      return entry.value.map(value => {\n        return {\n          value,\n          parent: entry.parent,\n          ...extractTypes(value),\n        }\n      })\n    })\n  )\n\n  const arrayItemExample = extractFromEntries(\n    flattenEntries,\n    `${selector}[]`,\n    ``\n  )\n  if (!isDefined(arrayItemExample) || arrayItemExample === INVALID_VALUE) {\n    return INVALID_VALUE\n  }\n\n  return [arrayItemExample]\n}\n\n/**\n * Takes an array of source nodes and returns a pristine\n * example that can be used to infer types.\n *\n * Arrays are flattened to either: `null` for empty or sparse arrays or a\n * an array of a sigle merged example. e.g:\n *\n *  - ['red'], ['blue', 'yellow'] -> ['red']\n *  - [{ color: 'red'}, { color: 'blue', ht: 5 }] -> [{ color: 'red', ht: 5 }]\n *\n * @param {*Nodes} args\n */\nconst extractFieldExamples = (\n  nodes: any[],\n  selector: string,\n  ignoreFields?: string[] = []\n): ExampleValue => {\n  // get list of keys in all nodes\n  const allKeys = _(nodes)\n    .flatMap(_.keys)\n    .uniq()\n\n  const example = {}\n  for (let key of allKeys) {\n    if (ignoreFields.includes(key)) continue\n    const nextSelector = selector ? `${selector}.${key}` : key\n\n    const nodeWithValues = nodes.filter(node => {\n      if (!node) return false\n\n      const value = node[key]\n      if (_.isObject(value)) {\n        return !isEmptyObjectOrArray(value)\n      } else {\n        return isDefined(value)\n      }\n    })\n\n    // we want to keep track of nodes as we need it to get origin of data\n    const entries = nodeWithValues.map(node => {\n      const value = node[key]\n      return {\n        value,\n        parent: node,\n        ...extractTypes(value),\n      }\n    })\n\n    const value = extractFromEntries(entries, nextSelector, key)\n    if (!isDefined(value)) continue\n\n    example[key] = value\n  }\n\n  return example\n}\n\nconst buildFieldEnumValues = (options: ExampleValueOptions) => {\n  const enumValues = {}\n  const values = flatten(getExampleValues(options), {\n    maxDepth: 3,\n    safe: true, // don't flatten arrays.\n    delimiter: `___`,\n  })\n  Object.keys(values).forEach(field => {\n    if (values[field] == null) return\n    enumValues[createKey(field)] = { field }\n  })\n\n  return enumValues\n}\n\nlet typeExampleValues: Map<string, Object> = new Map()\n\nconst clearTypeExampleValues = () => {\n  typeExampleValues.clear()\n  typeConflictReporter.clearConflicts()\n}\n\ntype ExampleValueOptions = {\n  nodes: Object[],\n  typeName?: string,\n  ignoreFields?: string[],\n}\n\nconst getExampleValues = ({\n  nodes,\n  typeName,\n  ignoreFields,\n}: ExampleValueOptions): ExampleValue => {\n  const cachedValue = typeName && typeExampleValues.get(typeName)\n\n  // if type is defined and is in example value cache return it\n  if (cachedValue) return cachedValue\n\n  // if nodes were passed extract field example from it\n  if (nodes && nodes.length > 0) {\n    const exampleValue = extractFieldExamples(\n      nodes,\n      typeName || ``,\n      ignoreFields\n    )\n    // if type is set - cache results\n    if (typeName) typeExampleValues.set(typeName, exampleValue)\n    return exampleValue\n  }\n\n  return {}\n}\n\n// extract a list of field names\n// nested objects get flattened to \"outer___inner\" which will be converted back to\n// \"outer.inner\" by run-sift\nconst extractFieldNames = (nodes: Object[]) => {\n  const values = flatten(\n    getExampleValues({\n      nodes,\n      typeName: _.get(nodes[0], `internal.type`),\n    }),\n    {\n      maxDepth: 3,\n      safe: true, // don't flatten arrays.\n      delimiter: `___`,\n    }\n  )\n\n  return Object.keys(values)\n}\n\nmodule.exports = {\n  INVALID_VALUE,\n  buildFieldEnumValues,\n  extractFieldNames,\n  isEmptyObjectOrArray,\n  clearTypeExampleValues,\n  getExampleValues,\n}\n"],"file":"data-tree-utils.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/schema/data-tree-utils.js"],"names":["_","require","flatten","typeOf","invariant","createKey","typeConflictReporter","DateType","is32BitInteger","INVALID_VALUE","Symbol","isDefined","v","isEmptyObjectOrArray","obj","isDate","isObject","isEmpty","every","value","key","isScalar","val","Date","extractTypes","Array","isArray","uniqueTypes","uniq","filter","map","item","type","sort","join","arrayTypes","isMixOfDateObjectsAndDateStrings","values","length","includes","allValuesAreDates","shouldInfer","conflictIsValidSpecialCase","entries","entriesOfUniqueType","isConsistentlyScalarOrArray","entry","getExampleScalarFromArray","reduce","nextValue","isNumber","extractFromEntries","selector","uniqBy","addConflict","exampleValue","concatanedItems","extractFromArrays","isPlainObject","extractFieldExamples","filteredItems","flattenEntries","parent","arrayItemExample","nodes","ignoreFields","allKeys","flatMap","keys","example","nextSelector","nodeWithValues","node","buildFieldEnumValues","options","enumValues","getExampleValues","maxDepth","safe","delimiter","Object","forEach","field","typeExampleValues","Map","clearTypeExampleValues","clear","clearConflicts","typeName","cachedValue","get","set","extractFieldNames","module","exports"],"mappings":"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","sourcesContent":["// @flow\nconst _ = require(`lodash`)\nconst flatten = require(`flat`)\nconst typeOf = require(`type-of`)\nconst invariant = require(`invariant`)\n\nconst createKey = require(`./create-key`)\nconst { typeConflictReporter } = require(`./type-conflict-reporter`)\nconst DateType = require(`./types/type-date`)\nconst is32BitInteger = require(`../utils/is-32-bit-integer`)\n\nimport type { TypeEntry } from \"./type-conflict-reporter\"\n\ntype ExampleValue = Object\n\nconst INVALID_VALUE = Symbol(`INVALID_VALUE`)\nconst isDefined = v => v != null\n\nconst isEmptyObjectOrArray = (obj: any): boolean => {\n  if (obj === INVALID_VALUE) {\n    return true\n  } else if (_.isDate(obj)) {\n    return false\n    // Simple \"is object empty\" check.\n  } else if (_.isObject(obj) && _.isEmpty(obj)) {\n    return true\n  } else if (_.isObject(obj)) {\n    return _.every(obj, (value, key) => {\n      if (!isDefined(value)) {\n        return true\n      } else if (_.isObject(value)) {\n        return isEmptyObjectOrArray(value)\n      } else {\n        return false\n      }\n    })\n  }\n  return false\n}\n\nconst isScalar = val => !_.isObject(val) || val instanceof Date\n\nconst extractTypes = value => {\n  if (Array.isArray(value)) {\n    const uniqueTypes = _.uniq(\n      value.filter(isDefined).map(item => extractTypes(item).type)\n    ).sort()\n    return {\n      type: `array<${uniqueTypes.join(`|`)}>`,\n      arrayTypes: uniqueTypes,\n    }\n  } else {\n    const type = typeOf(value)\n    return {\n      type,\n      arrayTypes: [],\n    }\n  }\n}\n\nconst isMixOfDateObjectsAndDateStrings = (\n  values: any[],\n  uniqueTypes: string[]\n): boolean => {\n  if (\n    uniqueTypes.length === 2 &&\n    uniqueTypes.includes(`string`) &&\n    uniqueTypes.includes(`date`)\n  ) {\n    const allValuesAreDates = values.every(value => {\n      if (typeOf(value) === `date`) return true\n\n      // use infer checker to determine if string is a date\n      return DateType.shouldInfer(value)\n    })\n\n    return allValuesAreDates\n  }\n\n  return false\n}\n\nconst conflictIsValidSpecialCase = (\n  entries: TypeEntry[],\n  entriesOfUniqueType: TypeEntry[]\n): boolean => {\n  const isConsistentlyScalarOrArray = entriesOfUniqueType.every(\n    entry =>\n      entry.arrayTypes.length > 0 ===\n      entriesOfUniqueType[0].arrayTypes.length > 0\n  )\n  if (isConsistentlyScalarOrArray) {\n    // Get values and run them through special cases, to see if there actually\n    // is a conflict. This is done so late in process, because those checks\n    // would be expensive to do earlier during extraction, so we do them\n    // only when we have potential conflict.\n\n    let uniqueTypes: string[]\n    let values: any[]\n    const isArray = entriesOfUniqueType[0].arrayTypes.length > 0\n\n    if (isArray) {\n      values = _.flatten(entries.map(entry => entry.value))\n      uniqueTypes = _.uniq(\n        _.flatten(entriesOfUniqueType.map(entry => entry.arrayTypes))\n      )\n    } else {\n      values = entries.map(entry => entry.value)\n      uniqueTypes = entriesOfUniqueType.map(entry => entry.type)\n    }\n\n    return isMixOfDateObjectsAndDateStrings(values, uniqueTypes)\n  }\n  return false\n}\n\nconst getExampleScalarFromArray = values =>\n  _.reduce(\n    values,\n    (value, nextValue) => {\n      // Prefer floats over ints as they're more specific.\n      if (nextValue && _.isNumber(nextValue) && !is32BitInteger(nextValue)) {\n        return nextValue\n      } else if (value === null) {\n        return nextValue\n      } else {\n        return value\n      }\n    },\n    null\n  )\n\nconst extractFromEntries = (\n  entries: TypeEntry[],\n  selector: string,\n  key: string\n): ?mixed => {\n  const entriesOfUniqueType = _.uniqBy(entries, entry => entry.type)\n\n  if (entriesOfUniqueType.length == 0) {\n    // skip if no defined types\n    return null\n  } else if (\n    entriesOfUniqueType.length > 1 ||\n    entriesOfUniqueType[0].arrayTypes.length > 1\n  ) {\n    // there is multiple types or array of multiple types\n    // that aren't handled by any special case\n    if (!conflictIsValidSpecialCase(entries, entriesOfUniqueType)) {\n      if (selector) {\n        typeConflictReporter.addConflict(selector, entriesOfUniqueType)\n      }\n      return INVALID_VALUE\n    }\n  }\n\n  // Now we have entries of single type, we can merge them\n  const values = entries.map(entry => entry.value)\n\n  const exampleValue = entriesOfUniqueType[0].value\n\n  if (isScalar(exampleValue)) {\n    return getExampleScalarFromArray(values)\n  } else if (_.isObject(exampleValue)) {\n    if (Array.isArray(exampleValue)) {\n      const concatanedItems = _.flatten(values)\n      // Linked node arrays don't get reduced further as we\n      // want to preserve all the linked node types.\n      if (key.includes(`___NODE`)) {\n        return concatanedItems\n      }\n\n      return extractFromArrays(concatanedItems, entries, selector)\n    } else if (_.isPlainObject(exampleValue)) {\n      return extractFieldExamples(values, selector)\n    }\n  }\n  // unsuported object\n  return INVALID_VALUE\n}\n\nconst extractFromArrays = (values, entries: TypeEntry[], selector: string) => {\n  const filteredItems = values.filter(isDefined)\n  if (filteredItems.length === 0) {\n    return null\n  }\n  if (isScalar(filteredItems[0])) {\n    return [getExampleScalarFromArray(filteredItems)]\n  }\n\n  const flattenEntries: TypeEntry[] = _.flatten(\n    entries.map(entry => {\n      invariant(\n        Array.isArray(entry.value),\n        `this is validated in the previous call`\n      )\n\n      return entry.value.map(value => {\n        return {\n          value,\n          parent: entry.parent,\n          ...extractTypes(value),\n        }\n      })\n    })\n  )\n\n  const arrayItemExample = extractFromEntries(\n    flattenEntries,\n    `${selector}[]`,\n    ``\n  )\n  if (!isDefined(arrayItemExample) || arrayItemExample === INVALID_VALUE) {\n    return INVALID_VALUE\n  }\n\n  return [arrayItemExample]\n}\n\n/**\n * Takes an array of source nodes and returns a pristine\n * example that can be used to infer types.\n *\n * Arrays are flattened to either: `null` for empty or sparse arrays or a\n * an array of a sigle merged example. e.g:\n *\n *  - ['red'], ['blue', 'yellow'] -> ['red']\n *  - [{ color: 'red'}, { color: 'blue', ht: 5 }] -> [{ color: 'red', ht: 5 }]\n *\n * @param {*Nodes} args\n */\nconst extractFieldExamples = (\n  nodes: any[],\n  selector: string,\n  ignoreFields?: string[] = []\n): ExampleValue => {\n  // get list of keys in all nodes\n  const allKeys = _(nodes)\n    .flatMap(_.keys)\n    .uniq()\n\n  const example = {}\n  for (let key of allKeys) {\n    if (ignoreFields.includes(key)) continue\n    const nextSelector = selector ? `${selector}.${key}` : key\n\n    const nodeWithValues = nodes.filter(node => {\n      if (!node) return false\n\n      const value = node[key]\n      if (_.isObject(value)) {\n        return !isEmptyObjectOrArray(value)\n      } else {\n        return isDefined(value)\n      }\n    })\n\n    // we want to keep track of nodes as we need it to get origin of data\n    const entries = nodeWithValues.map(node => {\n      const value = node[key]\n      return {\n        value,\n        parent: node,\n        ...extractTypes(value),\n      }\n    })\n\n    const value = extractFromEntries(entries, nextSelector, key)\n    if (!isDefined(value)) continue\n\n    example[key] = value\n  }\n\n  return example\n}\n\nconst buildFieldEnumValues = (options: ExampleValueOptions) => {\n  const enumValues = {}\n  const values = flatten(getExampleValues(options), {\n    maxDepth: 3,\n    safe: true, // don't flatten arrays.\n    delimiter: `___`,\n  })\n  Object.keys(values).forEach(field => {\n    if (values[field] == null) return\n    enumValues[createKey(field)] = { field }\n  })\n\n  return enumValues\n}\n\nlet typeExampleValues: Map<string, Object> = new Map()\n\nconst clearTypeExampleValues = () => {\n  typeExampleValues.clear()\n  typeConflictReporter.clearConflicts()\n}\n\ntype ExampleValueOptions = {\n  nodes: Object[],\n  typeName?: string,\n  ignoreFields?: string[],\n}\n\nconst getExampleValues = ({\n  nodes,\n  typeName,\n  ignoreFields,\n}: ExampleValueOptions): ExampleValue => {\n  const cachedValue = typeName && typeExampleValues.get(typeName)\n\n  // if type is defined and is in example value cache return it\n  if (cachedValue) return cachedValue\n\n  // if nodes were passed extract field example from it\n  if (nodes && nodes.length > 0) {\n    const exampleValue = extractFieldExamples(\n      nodes,\n      typeName || ``,\n      ignoreFields\n    )\n    // if type is set - cache results\n    if (typeName) typeExampleValues.set(typeName, exampleValue)\n    return exampleValue\n  }\n\n  return {}\n}\n\n// extract a list of field names\n// nested objects get flattened to \"outer___inner\" which will be converted back to\n// \"outer.inner\" by run-sift\nconst extractFieldNames = (nodes: Object[]) => {\n  const values = flatten(\n    getExampleValues({\n      nodes,\n      typeName: _.get(nodes[0], `internal.type`),\n    }),\n    {\n      maxDepth: 3,\n      safe: true, // don't flatten arrays.\n      delimiter: `___`,\n    }\n  )\n\n  return Object.keys(values)\n}\n\nmodule.exports = {\n  INVALID_VALUE,\n  buildFieldEnumValues,\n  extractFieldNames,\n  isEmptyObjectOrArray,\n  clearTypeExampleValues,\n  getExampleValues,\n}\n"],"file":"data-tree-utils.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/schema/index.js
+++ b/node_modules/gatsby/dist/schema/index.js
@@ -1,29 +1,29 @@
 "use strict";
 
-var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
-
-var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
-
 const _ = require(`lodash`);
 
-const _require = require(`graphql`),
-      GraphQLSchema = _require.GraphQLSchema,
-      GraphQLObjectType = _require.GraphQLObjectType;
+const {
+  GraphQLSchema,
+  GraphQLObjectType
+} = require(`graphql`);
 
-const _require2 = require(`graphql-tools`),
-      mergeSchemas = _require2.mergeSchemas;
+const {
+  mergeSchemas
+} = require(`graphql-tools`);
 
 const buildNodeTypes = require(`./build-node-types`);
 
 const nodeConnections = require(`./build-node-connections`);
 
-const _require3 = require(`../redux`),
-      store = _require3.store;
+const {
+  store
+} = require(`../redux`);
 
 const invariant = require(`invariant`);
 
-const _require4 = require(`./infer-graphql-type`),
-      clearUnionTypes = _require4.clearUnionTypes;
+const {
+  clearUnionTypes
+} = require(`./infer-graphql-type`);
 
 function buildNodesSchema(fields) {
   return new GraphQLSchema({
@@ -36,35 +36,29 @@ function buildNodesSchema(fields) {
 
 module.exports.buildNodesSchema = buildNodesSchema;
 
-module.exports.build =
-/*#__PURE__*/
-function () {
-  var _ref = (0, _asyncToGenerator2.default)(function* ({
+module.exports.build = async ({
+  parentSpan
+}) => {
+  clearUnionTypes();
+  const typesGQL = await buildNodeTypes({
     parentSpan
-  }) {
-    clearUnionTypes();
-    const typesGQL = yield buildNodeTypes({
-      parentSpan
-    });
-    const connections = nodeConnections.buildAll(_.values(typesGQL)); // Pull off just the graphql node from each type object.
+  });
+  const connections = nodeConnections.buildAll(_.values(typesGQL)); // Pull off just the graphql node from each type object.
 
-    const nodes = _.mapValues(typesGQL, `node`);
+  const nodes = _.mapValues(typesGQL, `node`);
 
-    invariant(!_.isEmpty(nodes), `There are no available GQL nodes`);
-    invariant(!_.isEmpty(connections), `There are no available GQL connections`);
-    const thirdPartySchemas = store.getState().thirdPartySchemas || [];
-    const gatsbySchema = buildNodesSchema(Object.assign({}, connections, nodes));
-    const schema = mergeSchemas({
-      schemas: [gatsbySchema, ...thirdPartySchemas]
-    });
-    store.dispatch({
-      type: `SET_SCHEMA`,
-      payload: schema
-    });
+  invariant(!_.isEmpty(nodes), `There are no available GQL nodes`);
+  invariant(!_.isEmpty(connections), `There are no available GQL connections`);
+  const thirdPartySchemas = store.getState().thirdPartySchemas || [];
+  const gatsbySchema = buildNodesSchema({ ...connections,
+    ...nodes
   });
-
-  return function (_x) {
-    return _ref.apply(this, arguments);
-  };
-}();
+  const schema = mergeSchemas({
+    schemas: [gatsbySchema, ...thirdPartySchemas]
+  });
+  store.dispatch({
+    type: `SET_SCHEMA`,
+    payload: schema
+  });
+};
 //# sourceMappingURL=index.js.map
\ No newline at end of file
--- a/node_modules/gatsby/dist/schema/index.js.map
+++ b/node_modules/gatsby/dist/schema/index.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/schema/index.js"],"names":["_","require","GraphQLSchema","GraphQLObjectType","mergeSchemas","buildNodeTypes","nodeConnections","store","invariant","clearUnionTypes","buildNodesSchema","fields","query","name","module","exports","build","parentSpan","typesGQL","connections","buildAll","values","nodes","mapValues","isEmpty","thirdPartySchemas","getState","gatsbySchema","schema","schemas","dispatch","type","payload"],"mappings":";;;;;;AACA,MAAMA,CAAC,GAAGC,OAAO,CAAE,QAAF,CAAjB;;iBAC6CA,OAAO,CAAE,SAAF,C;MAA5CC,a,YAAAA,a;MAAeC,iB,YAAAA,iB;;kBACEF,OAAO,CAAE,eAAF,C;MAAxBG,Y,aAAAA,Y;;AAER,MAAMC,cAAc,GAAGJ,OAAO,CAAE,oBAAF,CAA9B;;AACA,MAAMK,eAAe,GAAGL,OAAO,CAAE,0BAAF,CAA/B;;kBACkBA,OAAO,CAAE,UAAF,C;MAAjBM,K,aAAAA,K;;AACR,MAAMC,SAAS,GAAGP,OAAO,CAAE,WAAF,CAAzB;;kBAC4BA,OAAO,CAAE,sBAAF,C;MAA3BQ,e,aAAAA,e;;AAER,SAASC,gBAAT,CAA0BC,MAA1B,EAAkC;AAChC,SAAO,IAAIT,aAAJ,CAAkB;AACvBU,IAAAA,KAAK,EAAE,IAAIT,iBAAJ,CAAsB;AAC3BU,MAAAA,IAAI,EAAG,eADoB;AAE3BF,MAAAA;AAF2B,KAAtB;AADgB,GAAlB,CAAP;AAMD;;AACDG,MAAM,CAACC,OAAP,CAAeL,gBAAf,GAAkCA,gBAAlC;;AAEAI,MAAM,CAACC,OAAP,CAAeC,KAAf;AAAA;AAAA;AAAA,6CAAuB,WAAO;AAAEC,IAAAA;AAAF,GAAP,EAA0B;AAC/CR,IAAAA,eAAe;AACf,UAAMS,QAAQ,SAASb,cAAc,CAAC;AAAEY,MAAAA;AAAF,KAAD,CAArC;AACA,UAAME,WAAW,GAAGb,eAAe,CAACc,QAAhB,CAAyBpB,CAAC,CAACqB,MAAF,CAASH,QAAT,CAAzB,CAApB,CAH+C,CAK/C;;AACA,UAAMI,KAAK,GAAGtB,CAAC,CAACuB,SAAF,CAAYL,QAAZ,EAAuB,MAAvB,CAAd;;AAEAV,IAAAA,SAAS,CAAC,CAACR,CAAC,CAACwB,OAAF,CAAUF,KAAV,CAAF,EAAqB,kCAArB,CAAT;AACAd,IAAAA,SAAS,CAAC,CAACR,CAAC,CAACwB,OAAF,CAAUL,WAAV,CAAF,EAA2B,wCAA3B,CAAT;AAEA,UAAMM,iBAAiB,GAAGlB,KAAK,CAACmB,QAAN,GAAiBD,iBAAjB,IAAsC,EAAhE;AAEA,UAAME,YAAY,GAAGjB,gBAAgB,mBAAMS,WAAN,EAAsBG,KAAtB,EAArC;AAEA,UAAMM,MAAM,GAAGxB,YAAY,CAAC;AAC1ByB,MAAAA,OAAO,EAAE,CAACF,YAAD,EAAe,GAAGF,iBAAlB;AADiB,KAAD,CAA3B;AAIAlB,IAAAA,KAAK,CAACuB,QAAN,CAAe;AACbC,MAAAA,IAAI,EAAG,YADM;AAEbC,MAAAA,OAAO,EAAEJ;AAFI,KAAf;AAID,GAvBD;;AAAA;AAAA;AAAA;AAAA","sourcesContent":["/* @flow */\nconst _ = require(`lodash`)\nconst { GraphQLSchema, GraphQLObjectType } = require(`graphql`)\nconst { mergeSchemas } = require(`graphql-tools`)\n\nconst buildNodeTypes = require(`./build-node-types`)\nconst nodeConnections = require(`./build-node-connections`)\nconst { store } = require(`../redux`)\nconst invariant = require(`invariant`)\nconst { clearUnionTypes } = require(`./infer-graphql-type`)\n\nfunction buildNodesSchema(fields) {\n  return new GraphQLSchema({\n    query: new GraphQLObjectType({\n      name: `RootQueryType`,\n      fields,\n    }),\n  })\n}\nmodule.exports.buildNodesSchema = buildNodesSchema\n\nmodule.exports.build = async ({ parentSpan }) => {\n  clearUnionTypes()\n  const typesGQL = await buildNodeTypes({ parentSpan })\n  const connections = nodeConnections.buildAll(_.values(typesGQL))\n\n  // Pull off just the graphql node from each type object.\n  const nodes = _.mapValues(typesGQL, `node`)\n\n  invariant(!_.isEmpty(nodes), `There are no available GQL nodes`)\n  invariant(!_.isEmpty(connections), `There are no available GQL connections`)\n\n  const thirdPartySchemas = store.getState().thirdPartySchemas || []\n\n  const gatsbySchema = buildNodesSchema({ ...connections, ...nodes })\n\n  const schema = mergeSchemas({\n    schemas: [gatsbySchema, ...thirdPartySchemas],\n  })\n\n  store.dispatch({\n    type: `SET_SCHEMA`,\n    payload: schema,\n  })\n}\n"],"file":"index.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/schema/index.js"],"names":["_","require","GraphQLSchema","GraphQLObjectType","mergeSchemas","buildNodeTypes","nodeConnections","store","invariant","clearUnionTypes","buildNodesSchema","fields","query","name","module","exports","build","parentSpan","typesGQL","connections","buildAll","values","nodes","mapValues","isEmpty","thirdPartySchemas","getState","gatsbySchema","schema","schemas","dispatch","type","payload"],"mappings":";;AACA,MAAMA,CAAC,GAAGC,OAAO,CAAE,QAAF,CAAjB;;AACA,MAAM;AAAEC,EAAAA,aAAF;AAAiBC,EAAAA;AAAjB,IAAuCF,OAAO,CAAE,SAAF,CAApD;;AACA,MAAM;AAAEG,EAAAA;AAAF,IAAmBH,OAAO,CAAE,eAAF,CAAhC;;AAEA,MAAMI,cAAc,GAAGJ,OAAO,CAAE,oBAAF,CAA9B;;AACA,MAAMK,eAAe,GAAGL,OAAO,CAAE,0BAAF,CAA/B;;AACA,MAAM;AAAEM,EAAAA;AAAF,IAAYN,OAAO,CAAE,UAAF,CAAzB;;AACA,MAAMO,SAAS,GAAGP,OAAO,CAAE,WAAF,CAAzB;;AACA,MAAM;AAAEQ,EAAAA;AAAF,IAAsBR,OAAO,CAAE,sBAAF,CAAnC;;AAEA,SAASS,gBAAT,CAA0BC,MAA1B,EAAkC;AAChC,SAAO,IAAIT,aAAJ,CAAkB;AACvBU,IAAAA,KAAK,EAAE,IAAIT,iBAAJ,CAAsB;AAC3BU,MAAAA,IAAI,EAAG,eADoB;AAE3BF,MAAAA;AAF2B,KAAtB;AADgB,GAAlB,CAAP;AAMD;;AACDG,MAAM,CAACC,OAAP,CAAeL,gBAAf,GAAkCA,gBAAlC;;AAEAI,MAAM,CAACC,OAAP,CAAeC,KAAf,GAAuB,OAAO;AAAEC,EAAAA;AAAF,CAAP,KAA0B;AAC/CR,EAAAA,eAAe;AACf,QAAMS,QAAQ,GAAG,MAAMb,cAAc,CAAC;AAAEY,IAAAA;AAAF,GAAD,CAArC;AACA,QAAME,WAAW,GAAGb,eAAe,CAACc,QAAhB,CAAyBpB,CAAC,CAACqB,MAAF,CAASH,QAAT,CAAzB,CAApB,CAH+C,CAK/C;;AACA,QAAMI,KAAK,GAAGtB,CAAC,CAACuB,SAAF,CAAYL,QAAZ,EAAuB,MAAvB,CAAd;;AAEAV,EAAAA,SAAS,CAAC,CAACR,CAAC,CAACwB,OAAF,CAAUF,KAAV,CAAF,EAAqB,kCAArB,CAAT;AACAd,EAAAA,SAAS,CAAC,CAACR,CAAC,CAACwB,OAAF,CAAUL,WAAV,CAAF,EAA2B,wCAA3B,CAAT;AAEA,QAAMM,iBAAiB,GAAGlB,KAAK,CAACmB,QAAN,GAAiBD,iBAAjB,IAAsC,EAAhE;AAEA,QAAME,YAAY,GAAGjB,gBAAgB,CAAC,EAAE,GAAGS,WAAL;AAAkB,OAAGG;AAArB,GAAD,CAArC;AAEA,QAAMM,MAAM,GAAGxB,YAAY,CAAC;AAC1ByB,IAAAA,OAAO,EAAE,CAACF,YAAD,EAAe,GAAGF,iBAAlB;AADiB,GAAD,CAA3B;AAIAlB,EAAAA,KAAK,CAACuB,QAAN,CAAe;AACbC,IAAAA,IAAI,EAAG,YADM;AAEbC,IAAAA,OAAO,EAAEJ;AAFI,GAAf;AAID,CAvBD","sourcesContent":["/* @flow */\nconst _ = require(`lodash`)\nconst { GraphQLSchema, GraphQLObjectType } = require(`graphql`)\nconst { mergeSchemas } = require(`graphql-tools`)\n\nconst buildNodeTypes = require(`./build-node-types`)\nconst nodeConnections = require(`./build-node-connections`)\nconst { store } = require(`../redux`)\nconst invariant = require(`invariant`)\nconst { clearUnionTypes } = require(`./infer-graphql-type`)\n\nfunction buildNodesSchema(fields) {\n  return new GraphQLSchema({\n    query: new GraphQLObjectType({\n      name: `RootQueryType`,\n      fields,\n    }),\n  })\n}\nmodule.exports.buildNodesSchema = buildNodesSchema\n\nmodule.exports.build = async ({ parentSpan }) => {\n  clearUnionTypes()\n  const typesGQL = await buildNodeTypes({ parentSpan })\n  const connections = nodeConnections.buildAll(_.values(typesGQL))\n\n  // Pull off just the graphql node from each type object.\n  const nodes = _.mapValues(typesGQL, `node`)\n\n  invariant(!_.isEmpty(nodes), `There are no available GQL nodes`)\n  invariant(!_.isEmpty(connections), `There are no available GQL connections`)\n\n  const thirdPartySchemas = store.getState().thirdPartySchemas || []\n\n  const gatsbySchema = buildNodesSchema({ ...connections, ...nodes })\n\n  const schema = mergeSchemas({\n    schemas: [gatsbySchema, ...thirdPartySchemas],\n  })\n\n  store.dispatch({\n    type: `SET_SCHEMA`,\n    payload: schema,\n  })\n}\n"],"file":"index.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/schema/infer-graphql-input-fields-from-fields.js
+++ b/node_modules/gatsby/dist/schema/infer-graphql-input-fields-from-fields.js
@@ -3,20 +3,21 @@
 exports.__esModule = true;
 exports.inferInputObjectStructureFromFields = inferInputObjectStructureFromFields;
 
-const _require = require(`graphql`),
-      GraphQLInputObjectType = _require.GraphQLInputObjectType,
-      GraphQLBoolean = _require.GraphQLBoolean,
-      GraphQLString = _require.GraphQLString,
-      GraphQLFloat = _require.GraphQLFloat,
-      GraphQLInt = _require.GraphQLInt,
-      GraphQLID = _require.GraphQLID,
-      GraphQLList = _require.GraphQLList,
-      GraphQLEnumType = _require.GraphQLEnumType,
-      GraphQLNonNull = _require.GraphQLNonNull,
-      GraphQLScalarType = _require.GraphQLScalarType,
-      GraphQLObjectType = _require.GraphQLObjectType,
-      GraphQLInterfaceType = _require.GraphQLInterfaceType,
-      GraphQLUnionType = _require.GraphQLUnionType;
+const {
+  GraphQLInputObjectType,
+  GraphQLBoolean,
+  GraphQLString,
+  GraphQLFloat,
+  GraphQLInt,
+  GraphQLID,
+  GraphQLList,
+  GraphQLEnumType,
+  GraphQLNonNull,
+  GraphQLScalarType,
+  GraphQLObjectType,
+  GraphQLInterfaceType,
+  GraphQLUnionType
+} = require(`graphql`);
 
 const _ = require(`lodash`);
 
@@ -224,11 +225,11 @@ function convertToInputFilter(prefix, type) {
         }
       };
     } else {
-      fields = Object.assign({}, innerFields, {
+      fields = { ...innerFields,
         in: {
           type: new GraphQLList(innerType)
         }
-      });
+      };
     }
 
     return new GraphQLInputObjectType({
--- a/node_modules/gatsby/dist/schema/infer-graphql-input-fields-from-fields.js.map
+++ b/node_modules/gatsby/dist/schema/infer-graphql-input-fields-from-fields.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/schema/infer-graphql-input-fields-from-fields.js"],"names":["require","GraphQLInputObjectType","GraphQLBoolean","GraphQLString","GraphQLFloat","GraphQLInt","GraphQLID","GraphQLList","GraphQLEnumType","GraphQLNonNull","GraphQLScalarType","GraphQLObjectType","GraphQLInterfaceType","GraphQLUnionType","_","report","createTypeName","createKey","makeNullable","type","ofType","convertToInputType","typeMap","has","nextTypeMap","Set","Array","from","concat","fields","transform","getFields","out","fieldConfig","key","Object","keys","length","name","innerType","message","verbose","scalarFilterMap","Int","eq","ne","gt","gte","lt","lte","in","nin","Float","ID","String","regex","glob","Boolean","convertToInputFilter","prefix","upperFirst","innerFilter","innerFields","elemMatch","extractFieldNamesFromInputField","accu","push","each","inferInputObjectStructureFromFields","typeName","inferredFields","sort","inputType","inputFilter"],"mappings":"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","sourcesContent":["// @flow\n\nconst {\n  GraphQLInputObjectType,\n  GraphQLBoolean,\n  GraphQLString,\n  GraphQLFloat,\n  GraphQLInt,\n  GraphQLID,\n  GraphQLList,\n  GraphQLEnumType,\n  GraphQLNonNull,\n  GraphQLScalarType,\n  GraphQLObjectType,\n  GraphQLInterfaceType,\n  GraphQLUnionType,\n} = require(`graphql`)\n\nimport type { GraphQLInputType, GraphQLType } from \"graphql\"\n\nconst _ = require(`lodash`)\nconst report = require(`gatsby-cli/lib/reporter`)\nconst createTypeName = require(`./create-type-name`)\nconst createKey = require(`./create-key`)\n\ntype GraphQLNullableInputType<T> =\n  | GraphQLScalarType\n  | GraphQLEnumType\n  | GraphQLInputObjectType\n  | GraphQLList<T>\n\nfunction makeNullable(type: GraphQLInputType): GraphQLNullableInputType<any> {\n  if (type instanceof GraphQLNonNull) {\n    return type.ofType\n  }\n  return type\n}\n\nfunction convertToInputType(\n  type: GraphQLType,\n  typeMap: Set<GraphQLType>\n): ?GraphQLInputType {\n  // track types already processed in current tree, to avoid infinite recursion\n  if (typeMap.has(type)) {\n    return null\n  }\n  const nextTypeMap = new Set(Array.from(typeMap).concat([type]))\n\n  if (type instanceof GraphQLScalarType || type instanceof GraphQLEnumType) {\n    return type\n  } else if (type instanceof GraphQLObjectType) {\n    const fields = _.transform(type.getFields(), (out, fieldConfig, key) => {\n      const type = convertToInputType(fieldConfig.type, nextTypeMap)\n      if (type) out[key] = { type }\n    })\n    if (Object.keys(fields).length === 0) {\n      return null\n    }\n    return new GraphQLInputObjectType({\n      name: createTypeName(`${type.name}InputObject`),\n      fields,\n    })\n  } else if (type instanceof GraphQLList) {\n    let innerType = convertToInputType(type.ofType, nextTypeMap)\n    return innerType ? new GraphQLList(makeNullable(innerType)) : null\n  } else if (type instanceof GraphQLNonNull) {\n    let innerType = convertToInputType(type.ofType, nextTypeMap)\n    return innerType ? new GraphQLNonNull(makeNullable(innerType)) : null\n  } else {\n    let message = type ? `for type: ${type.name}` : ``\n    if (type instanceof GraphQLInterfaceType) {\n      message = `GraphQLInterfaceType not yet implemented ${message}`\n    } else if (type instanceof GraphQLUnionType) {\n      message = `GraphQLUnionType not yet implemented ${message}`\n    } else {\n      message = `Invalid input type ${message}`\n    }\n    report.verbose(message)\n  }\n\n  return null\n}\n\nconst scalarFilterMap = {\n  Int: {\n    eq: { type: GraphQLInt },\n    ne: { type: GraphQLInt },\n    gt: { type: GraphQLInt },\n    gte: { type: GraphQLInt },\n    lt: { type: GraphQLInt },\n    lte: { type: GraphQLInt },\n    in: { type: new GraphQLList(GraphQLInt) },\n    nin: { type: new GraphQLList(GraphQLInt) },\n  },\n  Float: {\n    eq: { type: GraphQLFloat },\n    ne: { type: GraphQLFloat },\n    gt: { type: GraphQLFloat },\n    gte: { type: GraphQLFloat },\n    lt: { type: GraphQLFloat },\n    lte: { type: GraphQLFloat },\n    in: { type: new GraphQLList(GraphQLFloat) },\n    nin: { type: new GraphQLList(GraphQLFloat) },\n  },\n  ID: {\n    eq: { type: GraphQLID },\n    ne: { type: GraphQLID },\n    in: { type: new GraphQLList(GraphQLID) },\n    nin: { type: new GraphQLList(GraphQLID) },\n  },\n  String: {\n    eq: { type: GraphQLString },\n    ne: { type: GraphQLString },\n    regex: { type: GraphQLString },\n    glob: { type: GraphQLString },\n    in: { type: new GraphQLList(GraphQLString) },\n    nin: { type: new GraphQLList(GraphQLString) },\n  },\n  Boolean: {\n    eq: { type: GraphQLBoolean },\n    ne: { type: GraphQLBoolean },\n    in: { type: new GraphQLList(GraphQLBoolean) },\n    nin: { type: new GraphQLList(GraphQLBoolean) },\n  },\n}\n\nfunction convertToInputFilter(\n  prefix: string,\n  type: GraphQLInputType\n): ?GraphQLInputObjectType {\n  if (type instanceof GraphQLScalarType) {\n    const name = type.name\n    const fields = scalarFilterMap[name]\n\n    if (fields == null) return null\n    return new GraphQLInputObjectType({\n      name: createTypeName(`${prefix}Query${name}`),\n      fields: fields,\n    })\n  } else if (type instanceof GraphQLInputObjectType) {\n    const fields = _.transform(type.getFields(), (out, fieldConfig, key) => {\n      const type = convertToInputFilter(\n        `${prefix}${_.upperFirst(key)}`,\n        fieldConfig.type\n      )\n      if (type) out[key] = { type }\n    })\n    if (Object.keys(fields).length === 0) {\n      return null\n    }\n    return new GraphQLInputObjectType({\n      name: createTypeName(`${prefix}{type.name}`),\n      fields: fields,\n    })\n  } else if (type instanceof GraphQLList) {\n    const innerType = type.ofType\n    const innerFilter = convertToInputFilter(`${prefix}ListElem`, innerType)\n    const innerFields = innerFilter ? innerFilter.getFields() : {}\n\n    let fields\n    if (innerType instanceof GraphQLInputObjectType) {\n      fields = {\n        elemMatch: { type: innerFilter },\n      }\n    } else {\n      fields = {\n        ...innerFields,\n        in: { type: new GraphQLList(innerType) },\n      }\n    }\n\n    return new GraphQLInputObjectType({\n      name: createTypeName(`${prefix}QueryList`),\n      fields,\n    })\n  } else if (type instanceof GraphQLNonNull) {\n    return convertToInputFilter(prefix, type.ofType)\n  }\n\n  return null\n}\n\nfunction extractFieldNamesFromInputField(\n  prefix: string,\n  type: GraphQLInputType,\n  accu: string[]\n) {\n  if (type instanceof GraphQLScalarType || type instanceof GraphQLList) {\n    accu.push(prefix)\n  } else if (type instanceof GraphQLInputObjectType) {\n    _.each(type.getFields(), (fieldConfig, key) => {\n      extractFieldNamesFromInputField(\n        `${prefix}___${key}`,\n        fieldConfig.type,\n        accu\n      )\n    })\n  } else if (type instanceof GraphQLNonNull) {\n    extractFieldNamesFromInputField(prefix, type.ofType, accu)\n  }\n}\n\n// convert output fields to output fields and a list of fields to sort on\nexport function inferInputObjectStructureFromFields({\n  fields,\n  typeName = ``,\n}: any) {\n  const inferredFields = {}\n  const sort = []\n\n  _.each(fields, (fieldConfig, key) => {\n    const inputType = convertToInputType(fieldConfig.type, new Set())\n    const inputFilter =\n      inputType && convertToInputFilter(_.upperFirst(key), inputType)\n\n    if (!inputFilter) return\n\n    inferredFields[createKey(key)] = { type: inputFilter }\n\n    // Add sorting (but only to the top level).\n    if (typeName) {\n      extractFieldNamesFromInputField(key, inputType, sort)\n    }\n  })\n\n  return { inferredFields, sort }\n}\n"],"file":"infer-graphql-input-fields-from-fields.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/schema/infer-graphql-input-fields-from-fields.js"],"names":["GraphQLInputObjectType","GraphQLBoolean","GraphQLString","GraphQLFloat","GraphQLInt","GraphQLID","GraphQLList","GraphQLEnumType","GraphQLNonNull","GraphQLScalarType","GraphQLObjectType","GraphQLInterfaceType","GraphQLUnionType","require","_","report","createTypeName","createKey","makeNullable","type","ofType","convertToInputType","typeMap","has","nextTypeMap","Set","Array","from","concat","fields","transform","getFields","out","fieldConfig","key","Object","keys","length","name","innerType","message","verbose","scalarFilterMap","Int","eq","ne","gt","gte","lt","lte","in","nin","Float","ID","String","regex","glob","Boolean","convertToInputFilter","prefix","upperFirst","innerFilter","innerFields","elemMatch","extractFieldNamesFromInputField","accu","push","each","inferInputObjectStructureFromFields","typeName","inferredFields","sort","inputType","inputFilter"],"mappings":"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","sourcesContent":["// @flow\n\nconst {\n  GraphQLInputObjectType,\n  GraphQLBoolean,\n  GraphQLString,\n  GraphQLFloat,\n  GraphQLInt,\n  GraphQLID,\n  GraphQLList,\n  GraphQLEnumType,\n  GraphQLNonNull,\n  GraphQLScalarType,\n  GraphQLObjectType,\n  GraphQLInterfaceType,\n  GraphQLUnionType,\n} = require(`graphql`)\n\nimport type { GraphQLInputType, GraphQLType } from \"graphql\"\n\nconst _ = require(`lodash`)\nconst report = require(`gatsby-cli/lib/reporter`)\nconst createTypeName = require(`./create-type-name`)\nconst createKey = require(`./create-key`)\n\ntype GraphQLNullableInputType<T> =\n  | GraphQLScalarType\n  | GraphQLEnumType\n  | GraphQLInputObjectType\n  | GraphQLList<T>\n\nfunction makeNullable(type: GraphQLInputType): GraphQLNullableInputType<any> {\n  if (type instanceof GraphQLNonNull) {\n    return type.ofType\n  }\n  return type\n}\n\nfunction convertToInputType(\n  type: GraphQLType,\n  typeMap: Set<GraphQLType>\n): ?GraphQLInputType {\n  // track types already processed in current tree, to avoid infinite recursion\n  if (typeMap.has(type)) {\n    return null\n  }\n  const nextTypeMap = new Set(Array.from(typeMap).concat([type]))\n\n  if (type instanceof GraphQLScalarType || type instanceof GraphQLEnumType) {\n    return type\n  } else if (type instanceof GraphQLObjectType) {\n    const fields = _.transform(type.getFields(), (out, fieldConfig, key) => {\n      const type = convertToInputType(fieldConfig.type, nextTypeMap)\n      if (type) out[key] = { type }\n    })\n    if (Object.keys(fields).length === 0) {\n      return null\n    }\n    return new GraphQLInputObjectType({\n      name: createTypeName(`${type.name}InputObject`),\n      fields,\n    })\n  } else if (type instanceof GraphQLList) {\n    let innerType = convertToInputType(type.ofType, nextTypeMap)\n    return innerType ? new GraphQLList(makeNullable(innerType)) : null\n  } else if (type instanceof GraphQLNonNull) {\n    let innerType = convertToInputType(type.ofType, nextTypeMap)\n    return innerType ? new GraphQLNonNull(makeNullable(innerType)) : null\n  } else {\n    let message = type ? `for type: ${type.name}` : ``\n    if (type instanceof GraphQLInterfaceType) {\n      message = `GraphQLInterfaceType not yet implemented ${message}`\n    } else if (type instanceof GraphQLUnionType) {\n      message = `GraphQLUnionType not yet implemented ${message}`\n    } else {\n      message = `Invalid input type ${message}`\n    }\n    report.verbose(message)\n  }\n\n  return null\n}\n\nconst scalarFilterMap = {\n  Int: {\n    eq: { type: GraphQLInt },\n    ne: { type: GraphQLInt },\n    gt: { type: GraphQLInt },\n    gte: { type: GraphQLInt },\n    lt: { type: GraphQLInt },\n    lte: { type: GraphQLInt },\n    in: { type: new GraphQLList(GraphQLInt) },\n    nin: { type: new GraphQLList(GraphQLInt) },\n  },\n  Float: {\n    eq: { type: GraphQLFloat },\n    ne: { type: GraphQLFloat },\n    gt: { type: GraphQLFloat },\n    gte: { type: GraphQLFloat },\n    lt: { type: GraphQLFloat },\n    lte: { type: GraphQLFloat },\n    in: { type: new GraphQLList(GraphQLFloat) },\n    nin: { type: new GraphQLList(GraphQLFloat) },\n  },\n  ID: {\n    eq: { type: GraphQLID },\n    ne: { type: GraphQLID },\n    in: { type: new GraphQLList(GraphQLID) },\n    nin: { type: new GraphQLList(GraphQLID) },\n  },\n  String: {\n    eq: { type: GraphQLString },\n    ne: { type: GraphQLString },\n    regex: { type: GraphQLString },\n    glob: { type: GraphQLString },\n    in: { type: new GraphQLList(GraphQLString) },\n    nin: { type: new GraphQLList(GraphQLString) },\n  },\n  Boolean: {\n    eq: { type: GraphQLBoolean },\n    ne: { type: GraphQLBoolean },\n    in: { type: new GraphQLList(GraphQLBoolean) },\n    nin: { type: new GraphQLList(GraphQLBoolean) },\n  },\n}\n\nfunction convertToInputFilter(\n  prefix: string,\n  type: GraphQLInputType\n): ?GraphQLInputObjectType {\n  if (type instanceof GraphQLScalarType) {\n    const name = type.name\n    const fields = scalarFilterMap[name]\n\n    if (fields == null) return null\n    return new GraphQLInputObjectType({\n      name: createTypeName(`${prefix}Query${name}`),\n      fields: fields,\n    })\n  } else if (type instanceof GraphQLInputObjectType) {\n    const fields = _.transform(type.getFields(), (out, fieldConfig, key) => {\n      const type = convertToInputFilter(\n        `${prefix}${_.upperFirst(key)}`,\n        fieldConfig.type\n      )\n      if (type) out[key] = { type }\n    })\n    if (Object.keys(fields).length === 0) {\n      return null\n    }\n    return new GraphQLInputObjectType({\n      name: createTypeName(`${prefix}{type.name}`),\n      fields: fields,\n    })\n  } else if (type instanceof GraphQLList) {\n    const innerType = type.ofType\n    const innerFilter = convertToInputFilter(`${prefix}ListElem`, innerType)\n    const innerFields = innerFilter ? innerFilter.getFields() : {}\n\n    let fields\n    if (innerType instanceof GraphQLInputObjectType) {\n      fields = {\n        elemMatch: { type: innerFilter },\n      }\n    } else {\n      fields = {\n        ...innerFields,\n        in: { type: new GraphQLList(innerType) },\n      }\n    }\n\n    return new GraphQLInputObjectType({\n      name: createTypeName(`${prefix}QueryList`),\n      fields,\n    })\n  } else if (type instanceof GraphQLNonNull) {\n    return convertToInputFilter(prefix, type.ofType)\n  }\n\n  return null\n}\n\nfunction extractFieldNamesFromInputField(\n  prefix: string,\n  type: GraphQLInputType,\n  accu: string[]\n) {\n  if (type instanceof GraphQLScalarType || type instanceof GraphQLList) {\n    accu.push(prefix)\n  } else if (type instanceof GraphQLInputObjectType) {\n    _.each(type.getFields(), (fieldConfig, key) => {\n      extractFieldNamesFromInputField(\n        `${prefix}___${key}`,\n        fieldConfig.type,\n        accu\n      )\n    })\n  } else if (type instanceof GraphQLNonNull) {\n    extractFieldNamesFromInputField(prefix, type.ofType, accu)\n  }\n}\n\n// convert output fields to output fields and a list of fields to sort on\nexport function inferInputObjectStructureFromFields({\n  fields,\n  typeName = ``,\n}: any) {\n  const inferredFields = {}\n  const sort = []\n\n  _.each(fields, (fieldConfig, key) => {\n    const inputType = convertToInputType(fieldConfig.type, new Set())\n    const inputFilter =\n      inputType && convertToInputFilter(_.upperFirst(key), inputType)\n\n    if (!inputFilter) return\n\n    inferredFields[createKey(key)] = { type: inputFilter }\n\n    // Add sorting (but only to the top level).\n    if (typeName) {\n      extractFieldNamesFromInputField(key, inputType, sort)\n    }\n  })\n\n  return { inferredFields, sort }\n}\n"],"file":"infer-graphql-input-fields-from-fields.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/schema/infer-graphql-input-fields.js
+++ b/node_modules/gatsby/dist/schema/infer-graphql-input-fields.js
@@ -3,16 +3,18 @@
 exports.__esModule = true;
 exports.inferInputObjectStructureFromNodes = inferInputObjectStructureFromNodes;
 
-const _require = require(`graphql`),
-      GraphQLInputObjectType = _require.GraphQLInputObjectType,
-      GraphQLBoolean = _require.GraphQLBoolean,
-      GraphQLString = _require.GraphQLString,
-      GraphQLFloat = _require.GraphQLFloat,
-      GraphQLInt = _require.GraphQLInt,
-      GraphQLList = _require.GraphQLList;
-
-const _require2 = require(`common-tags`),
-      oneLine = _require2.oneLine;
+const {
+  GraphQLInputObjectType,
+  GraphQLBoolean,
+  GraphQLString,
+  GraphQLFloat,
+  GraphQLInt,
+  GraphQLList
+} = require(`graphql`);
+
+const {
+  oneLine
+} = require(`common-tags`);
 
 const _ = require(`lodash`);
 
@@ -24,17 +26,20 @@ const createTypeName = require(`./create-type-name`);
 
 const createKey = require(`./create-key`);
 
-const _require3 = require(`./data-tree-utils`),
-      getExampleValues = _require3.getExampleValues,
-      extractFieldNames = _require3.extractFieldNames,
-      isEmptyObjectOrArray = _require3.isEmptyObjectOrArray,
-      INVALID_VALUE = _require3.INVALID_VALUE;
+const {
+  getExampleValues,
+  extractFieldNames,
+  isEmptyObjectOrArray,
+  INVALID_VALUE
+} = require(`./data-tree-utils`);
 
-const _require4 = require(`./infer-graphql-type`),
-      findLinkedNode = _require4.findLinkedNode;
+const {
+  findLinkedNode
+} = require(`./infer-graphql-type`);
 
-const _require5 = require(`../db/nodes`),
-      getNodesByType = _require5.getNodesByType;
+const {
+  getNodesByType
+} = require(`../db/nodes`);
 
 const is32BitInteger = require(`../utils/is-32-bit-integer`);
 
@@ -201,11 +206,11 @@ function inferGraphQLInputFields({
             }
           };
         } else {
-          fields = Object.assign({}, typeFields(headType), {
+          fields = { ...typeFields(headType),
             in: {
               type: new GraphQLList(inType)
             }
-          });
+          };
         }
 
         return {
@@ -367,10 +372,7 @@ function inferInputObjectStructureFromNodes({
       }
 
       ;
-
-      var _key$split = key.split(`___`);
-
-      key = _key$split[0];
+      [key] = key.split(`___`);
     }
 
     let field = inferGraphQLInputFields({
--- a/node_modules/gatsby/dist/schema/infer-graphql-input-fields.js.map
+++ b/node_modules/gatsby/dist/schema/infer-graphql-input-fields.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/schema/infer-graphql-input-fields.js"],"names":["require","GraphQLInputObjectType","GraphQLBoolean","GraphQLString","GraphQLFloat","GraphQLInt","GraphQLList","oneLine","_","invariant","typeOf","createTypeName","createKey","getExampleValues","extractFieldNames","isEmptyObjectOrArray","INVALID_VALUE","findLinkedNode","getNodesByType","is32BitInteger","typeFields","type","eq","ne","in","nin","regex","glob","gt","gte","lt","lte","inferGraphQLInputFields","value","nodes","prefix","headValue","headType","inType","inferredField","JSON","stringify","Object","keys","fields","elemMatch","name","inferInputObjectStructureFromNodes","exampleValue","inferredFields","isEmpty","EXCLUDE_KEYS","parent","children","recursiveOmitBy","fn","isObject","isPlainObject","omitBy","isArray","clone","each","v","k","linkedNodeCache","typeName","isRoot","internal","key","includes","nodeToFind","linkedNode","relatedNodes","_v","_k","split","field","upperFirst","sort"],"mappings":"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","sourcesContent":["// @flow\nconst {\n  GraphQLInputObjectType,\n  GraphQLBoolean,\n  GraphQLString,\n  GraphQLFloat,\n  GraphQLInt,\n  GraphQLList,\n} = require(`graphql`)\nconst { oneLine } = require(`common-tags`)\nconst _ = require(`lodash`)\nconst invariant = require(`invariant`)\nconst typeOf = require(`type-of`)\nconst createTypeName = require(`./create-type-name`)\nconst createKey = require(`./create-key`)\nconst {\n  getExampleValues,\n  extractFieldNames,\n  isEmptyObjectOrArray,\n  INVALID_VALUE,\n} = require(`./data-tree-utils`)\n\nconst { findLinkedNode } = require(`./infer-graphql-type`)\nconst { getNodesByType } = require(`../db/nodes`)\nconst is32BitInteger = require(`../utils/is-32-bit-integer`)\n\nimport type {\n  GraphQLInputFieldConfig,\n  GraphQLInputFieldConfigMap,\n} from \"graphql/type/definition\"\n\nfunction typeFields(type): GraphQLInputFieldConfigMap {\n  switch (type) {\n    case `boolean`:\n      return {\n        eq: { type: GraphQLBoolean },\n        ne: { type: GraphQLBoolean },\n        in: { type: new GraphQLList(GraphQLBoolean) },\n        nin: { type: new GraphQLList(GraphQLBoolean) },\n      }\n    case `string`:\n      return {\n        eq: { type: GraphQLString },\n        ne: { type: GraphQLString },\n        regex: { type: GraphQLString },\n        glob: { type: GraphQLString },\n        in: { type: new GraphQLList(GraphQLString) },\n        nin: { type: new GraphQLList(GraphQLString) },\n      }\n    case `int`:\n      return {\n        eq: { type: GraphQLInt },\n        ne: { type: GraphQLInt },\n        gt: { type: GraphQLInt },\n        gte: { type: GraphQLInt },\n        lt: { type: GraphQLInt },\n        lte: { type: GraphQLInt },\n        in: { type: new GraphQLList(GraphQLInt) },\n        nin: { type: new GraphQLList(GraphQLInt) },\n      }\n    case `float`:\n      return {\n        eq: { type: GraphQLFloat },\n        ne: { type: GraphQLFloat },\n        gt: { type: GraphQLFloat },\n        gte: { type: GraphQLFloat },\n        lt: { type: GraphQLFloat },\n        lte: { type: GraphQLFloat },\n        in: { type: new GraphQLList(GraphQLFloat) },\n        nin: { type: new GraphQLList(GraphQLFloat) },\n      }\n  }\n  return {}\n}\n\nfunction inferGraphQLInputFields({\n  value,\n  nodes,\n  prefix,\n}): ?GraphQLInputFieldConfig {\n  if (value == null || isEmptyObjectOrArray(value)) return null\n\n  switch (typeOf(value)) {\n    case `array`: {\n      const headValue = value[0]\n      let headType = typeOf(headValue)\n\n      if (headType === `number`)\n        headType = is32BitInteger(headValue) ? `int` : `float`\n\n      // Determine type for in operator.\n      let inType\n      switch (headType) {\n        case `int`:\n          inType = GraphQLInt\n          break\n        case `float`:\n          inType = GraphQLFloat\n          break\n        case `date`:\n        case `string`:\n          inType = GraphQLString\n          break\n        case `boolean`:\n          inType = GraphQLBoolean\n          break\n        case `array`:\n        case `object`: {\n          let inferredField = inferGraphQLInputFields({\n            value: headValue,\n            prefix,\n            nodes,\n          })\n          invariant(\n            inferredField,\n            `Could not infer graphQL type for value: ${JSON.stringify(\n              Object.keys(headValue)\n            )}`\n          )\n          inType = inferredField.type\n          break\n        }\n        default:\n          invariant(\n            false,\n            oneLine`\n              Could not infer an appropriate GraphQL input type\n              for value: ${headValue} of type ${headType} along path: ${prefix}\n            `\n          )\n      }\n\n      let fields\n      if (headType === `object`) {\n        fields = {\n          elemMatch: {\n            type: inType,\n          },\n        }\n      } else {\n        fields = {\n          ...typeFields(headType),\n          in: { type: new GraphQLList(inType) },\n        }\n      }\n\n      return {\n        type: new GraphQLInputObjectType({\n          name: createTypeName(`${prefix}QueryList`),\n          fields,\n        }),\n      }\n    }\n    case `boolean`: {\n      return {\n        type: new GraphQLInputObjectType({\n          name: createTypeName(`${prefix}QueryBoolean`),\n          fields: typeFields(`boolean`),\n        }),\n      }\n    }\n    case `date`:\n    case `string`: {\n      return {\n        type: new GraphQLInputObjectType({\n          name: createTypeName(`${prefix}QueryString`),\n          fields: typeFields(`string`),\n        }),\n      }\n    }\n    case `object`: {\n      const fields = inferInputObjectStructureFromNodes({\n        nodes,\n        prefix,\n        exampleValue: value,\n      }).inferredFields\n      if (!_.isEmpty(fields)) {\n        return {\n          type: new GraphQLInputObjectType({\n            name: createTypeName(`${prefix}InputObject`),\n            fields,\n          }),\n        }\n      } else {\n        return null\n      }\n    }\n    case `number`: {\n      if (is32BitInteger(value)) {\n        return {\n          type: new GraphQLInputObjectType({\n            name: createTypeName(`${prefix}QueryInteger`),\n            fields: typeFields(`int`),\n          }),\n        }\n      } else {\n        return {\n          type: new GraphQLInputObjectType({\n            name: createTypeName(`${prefix}QueryFloat`),\n            fields: typeFields(`float`),\n          }),\n        }\n      }\n    }\n    default:\n      return null\n  }\n}\n\nconst EXCLUDE_KEYS = {\n  parent: 1,\n  children: 1,\n}\n\ntype InferInputOptions = {\n  nodes: Object[],\n  typeName?: string,\n  prefix?: string,\n  exampleValue?: Object,\n}\n\nconst recursiveOmitBy = (value, fn) => {\n  if (_.isObject(value)) {\n    if (_.isPlainObject(value)) {\n      value = _.omitBy(value, fn)\n    } else if (_.isArray(value)) {\n      // don't mutate original value\n      value = _.clone(value)\n    }\n    _.each(value, (v, k) => {\n      value[k] = recursiveOmitBy(v, fn)\n    })\n    if (_.isEmpty(value)) {\n      // don't return empty objects - gatsby doesn't support these\n      return null\n    }\n  }\n  return value\n}\n\nconst linkedNodeCache = {}\n\nexport function inferInputObjectStructureFromNodes({\n  nodes,\n  typeName = ``,\n  prefix = ``,\n  exampleValue = null,\n}: InferInputOptions): Object {\n  const inferredFields = {}\n  const isRoot = !prefix\n\n  prefix = isRoot ? typeName : prefix\n  if (exampleValue === null) {\n    // typeName includes \"Connection\" string, which is not what we want,\n    // so extract type from first node\n    exampleValue = getExampleValues({\n      nodes,\n      typeName:\n        nodes && nodes[0] && nodes[0].internal && nodes[0].internal.type,\n    })\n  }\n\n  _.each(exampleValue, (v, k) => {\n    let value = v\n    let key = k\n    // Remove fields for traversing through nodes as we want to control\n    // setting traversing up not try to automatically infer them.\n    if (value === INVALID_VALUE || (isRoot && EXCLUDE_KEYS[key])) return\n\n    if (_.includes(key, `___NODE`)) {\n      // TODO: Union the objects in array\n      const isArray = _.isArray(value)\n      const nodeToFind = isArray ? value[0] : value\n      const linkedNode = findLinkedNode(nodeToFind)\n\n      // Fall back if the linked node can't be found. Prevents crashing, and is\n      // picked up in infer-graphql-type.js with an error that gives context to\n      // the user about which node is missing\n      if (!linkedNode) {\n        return\n      }\n\n      // Get from cache if found, else store into it\n      if (linkedNodeCache[linkedNode.internal.type]) {\n        value = linkedNodeCache[linkedNode.internal.type]\n      } else {\n        const relatedNodes = getNodesByType(linkedNode.internal.type)\n        value = getExampleValues({\n          nodes: relatedNodes,\n          typeName: linkedNode.internal.type,\n        })\n        value = recursiveOmitBy(value, (_v, _k) => _.includes(_k, `___NODE`))\n        linkedNodeCache[linkedNode.internal.type] = value\n      }\n\n      if (isArray) {\n        value = [value]\n      }\n\n      ;[key] = key.split(`___`)\n    }\n\n    let field = inferGraphQLInputFields({\n      nodes,\n      value,\n      prefix: `${prefix}${_.upperFirst(key)}`,\n    })\n\n    if (field === null) return\n    inferredFields[createKey(key)] = field\n  })\n\n  // Add sorting (but only to the top level).\n  let sort = []\n  if (typeName) {\n    sort = extractFieldNames(nodes)\n  }\n\n  return { inferredFields, sort }\n}\n"],"file":"infer-graphql-input-fields.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/schema/infer-graphql-input-fields.js"],"names":["GraphQLInputObjectType","GraphQLBoolean","GraphQLString","GraphQLFloat","GraphQLInt","GraphQLList","require","oneLine","_","invariant","typeOf","createTypeName","createKey","getExampleValues","extractFieldNames","isEmptyObjectOrArray","INVALID_VALUE","findLinkedNode","getNodesByType","is32BitInteger","typeFields","type","eq","ne","in","nin","regex","glob","gt","gte","lt","lte","inferGraphQLInputFields","value","nodes","prefix","headValue","headType","inType","inferredField","JSON","stringify","Object","keys","fields","elemMatch","name","inferInputObjectStructureFromNodes","exampleValue","inferredFields","isEmpty","EXCLUDE_KEYS","parent","children","recursiveOmitBy","fn","isObject","isPlainObject","omitBy","isArray","clone","each","v","k","linkedNodeCache","typeName","isRoot","internal","key","includes","nodeToFind","linkedNode","relatedNodes","_v","_k","split","field","upperFirst","sort"],"mappings":"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","sourcesContent":["// @flow\nconst {\n  GraphQLInputObjectType,\n  GraphQLBoolean,\n  GraphQLString,\n  GraphQLFloat,\n  GraphQLInt,\n  GraphQLList,\n} = require(`graphql`)\nconst { oneLine } = require(`common-tags`)\nconst _ = require(`lodash`)\nconst invariant = require(`invariant`)\nconst typeOf = require(`type-of`)\nconst createTypeName = require(`./create-type-name`)\nconst createKey = require(`./create-key`)\nconst {\n  getExampleValues,\n  extractFieldNames,\n  isEmptyObjectOrArray,\n  INVALID_VALUE,\n} = require(`./data-tree-utils`)\n\nconst { findLinkedNode } = require(`./infer-graphql-type`)\nconst { getNodesByType } = require(`../db/nodes`)\nconst is32BitInteger = require(`../utils/is-32-bit-integer`)\n\nimport type {\n  GraphQLInputFieldConfig,\n  GraphQLInputFieldConfigMap,\n} from \"graphql/type/definition\"\n\nfunction typeFields(type): GraphQLInputFieldConfigMap {\n  switch (type) {\n    case `boolean`:\n      return {\n        eq: { type: GraphQLBoolean },\n        ne: { type: GraphQLBoolean },\n        in: { type: new GraphQLList(GraphQLBoolean) },\n        nin: { type: new GraphQLList(GraphQLBoolean) },\n      }\n    case `string`:\n      return {\n        eq: { type: GraphQLString },\n        ne: { type: GraphQLString },\n        regex: { type: GraphQLString },\n        glob: { type: GraphQLString },\n        in: { type: new GraphQLList(GraphQLString) },\n        nin: { type: new GraphQLList(GraphQLString) },\n      }\n    case `int`:\n      return {\n        eq: { type: GraphQLInt },\n        ne: { type: GraphQLInt },\n        gt: { type: GraphQLInt },\n        gte: { type: GraphQLInt },\n        lt: { type: GraphQLInt },\n        lte: { type: GraphQLInt },\n        in: { type: new GraphQLList(GraphQLInt) },\n        nin: { type: new GraphQLList(GraphQLInt) },\n      }\n    case `float`:\n      return {\n        eq: { type: GraphQLFloat },\n        ne: { type: GraphQLFloat },\n        gt: { type: GraphQLFloat },\n        gte: { type: GraphQLFloat },\n        lt: { type: GraphQLFloat },\n        lte: { type: GraphQLFloat },\n        in: { type: new GraphQLList(GraphQLFloat) },\n        nin: { type: new GraphQLList(GraphQLFloat) },\n      }\n  }\n  return {}\n}\n\nfunction inferGraphQLInputFields({\n  value,\n  nodes,\n  prefix,\n}): ?GraphQLInputFieldConfig {\n  if (value == null || isEmptyObjectOrArray(value)) return null\n\n  switch (typeOf(value)) {\n    case `array`: {\n      const headValue = value[0]\n      let headType = typeOf(headValue)\n\n      if (headType === `number`)\n        headType = is32BitInteger(headValue) ? `int` : `float`\n\n      // Determine type for in operator.\n      let inType\n      switch (headType) {\n        case `int`:\n          inType = GraphQLInt\n          break\n        case `float`:\n          inType = GraphQLFloat\n          break\n        case `date`:\n        case `string`:\n          inType = GraphQLString\n          break\n        case `boolean`:\n          inType = GraphQLBoolean\n          break\n        case `array`:\n        case `object`: {\n          let inferredField = inferGraphQLInputFields({\n            value: headValue,\n            prefix,\n            nodes,\n          })\n          invariant(\n            inferredField,\n            `Could not infer graphQL type for value: ${JSON.stringify(\n              Object.keys(headValue)\n            )}`\n          )\n          inType = inferredField.type\n          break\n        }\n        default:\n          invariant(\n            false,\n            oneLine`\n              Could not infer an appropriate GraphQL input type\n              for value: ${headValue} of type ${headType} along path: ${prefix}\n            `\n          )\n      }\n\n      let fields\n      if (headType === `object`) {\n        fields = {\n          elemMatch: {\n            type: inType,\n          },\n        }\n      } else {\n        fields = {\n          ...typeFields(headType),\n          in: { type: new GraphQLList(inType) },\n        }\n      }\n\n      return {\n        type: new GraphQLInputObjectType({\n          name: createTypeName(`${prefix}QueryList`),\n          fields,\n        }),\n      }\n    }\n    case `boolean`: {\n      return {\n        type: new GraphQLInputObjectType({\n          name: createTypeName(`${prefix}QueryBoolean`),\n          fields: typeFields(`boolean`),\n        }),\n      }\n    }\n    case `date`:\n    case `string`: {\n      return {\n        type: new GraphQLInputObjectType({\n          name: createTypeName(`${prefix}QueryString`),\n          fields: typeFields(`string`),\n        }),\n      }\n    }\n    case `object`: {\n      const fields = inferInputObjectStructureFromNodes({\n        nodes,\n        prefix,\n        exampleValue: value,\n      }).inferredFields\n      if (!_.isEmpty(fields)) {\n        return {\n          type: new GraphQLInputObjectType({\n            name: createTypeName(`${prefix}InputObject`),\n            fields,\n          }),\n        }\n      } else {\n        return null\n      }\n    }\n    case `number`: {\n      if (is32BitInteger(value)) {\n        return {\n          type: new GraphQLInputObjectType({\n            name: createTypeName(`${prefix}QueryInteger`),\n            fields: typeFields(`int`),\n          }),\n        }\n      } else {\n        return {\n          type: new GraphQLInputObjectType({\n            name: createTypeName(`${prefix}QueryFloat`),\n            fields: typeFields(`float`),\n          }),\n        }\n      }\n    }\n    default:\n      return null\n  }\n}\n\nconst EXCLUDE_KEYS = {\n  parent: 1,\n  children: 1,\n}\n\ntype InferInputOptions = {\n  nodes: Object[],\n  typeName?: string,\n  prefix?: string,\n  exampleValue?: Object,\n}\n\nconst recursiveOmitBy = (value, fn) => {\n  if (_.isObject(value)) {\n    if (_.isPlainObject(value)) {\n      value = _.omitBy(value, fn)\n    } else if (_.isArray(value)) {\n      // don't mutate original value\n      value = _.clone(value)\n    }\n    _.each(value, (v, k) => {\n      value[k] = recursiveOmitBy(v, fn)\n    })\n    if (_.isEmpty(value)) {\n      // don't return empty objects - gatsby doesn't support these\n      return null\n    }\n  }\n  return value\n}\n\nconst linkedNodeCache = {}\n\nexport function inferInputObjectStructureFromNodes({\n  nodes,\n  typeName = ``,\n  prefix = ``,\n  exampleValue = null,\n}: InferInputOptions): Object {\n  const inferredFields = {}\n  const isRoot = !prefix\n\n  prefix = isRoot ? typeName : prefix\n  if (exampleValue === null) {\n    // typeName includes \"Connection\" string, which is not what we want,\n    // so extract type from first node\n    exampleValue = getExampleValues({\n      nodes,\n      typeName:\n        nodes && nodes[0] && nodes[0].internal && nodes[0].internal.type,\n    })\n  }\n\n  _.each(exampleValue, (v, k) => {\n    let value = v\n    let key = k\n    // Remove fields for traversing through nodes as we want to control\n    // setting traversing up not try to automatically infer them.\n    if (value === INVALID_VALUE || (isRoot && EXCLUDE_KEYS[key])) return\n\n    if (_.includes(key, `___NODE`)) {\n      // TODO: Union the objects in array\n      const isArray = _.isArray(value)\n      const nodeToFind = isArray ? value[0] : value\n      const linkedNode = findLinkedNode(nodeToFind)\n\n      // Fall back if the linked node can't be found. Prevents crashing, and is\n      // picked up in infer-graphql-type.js with an error that gives context to\n      // the user about which node is missing\n      if (!linkedNode) {\n        return\n      }\n\n      // Get from cache if found, else store into it\n      if (linkedNodeCache[linkedNode.internal.type]) {\n        value = linkedNodeCache[linkedNode.internal.type]\n      } else {\n        const relatedNodes = getNodesByType(linkedNode.internal.type)\n        value = getExampleValues({\n          nodes: relatedNodes,\n          typeName: linkedNode.internal.type,\n        })\n        value = recursiveOmitBy(value, (_v, _k) => _.includes(_k, `___NODE`))\n        linkedNodeCache[linkedNode.internal.type] = value\n      }\n\n      if (isArray) {\n        value = [value]\n      }\n\n      ;[key] = key.split(`___`)\n    }\n\n    let field = inferGraphQLInputFields({\n      nodes,\n      value,\n      prefix: `${prefix}${_.upperFirst(key)}`,\n    })\n\n    if (field === null) return\n    inferredFields[createKey(key)] = field\n  })\n\n  // Add sorting (but only to the top level).\n  let sort = []\n  if (typeName) {\n    sort = extractFieldNames(nodes)\n  }\n\n  return { inferredFields, sort }\n}\n"],"file":"infer-graphql-input-fields.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/schema/infer-graphql-type.js
+++ b/node_modules/gatsby/dist/schema/infer-graphql-type.js
@@ -1,37 +1,37 @@
 "use strict";
 
-var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
-
 exports.__esModule = true;
 exports.findLinkedNode = findLinkedNode;
 exports.inferObjectStructureFromNodes = inferObjectStructureFromNodes;
 exports.clearUnionTypes = clearUnionTypes;
 
-var _objectWithoutPropertiesLoose2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutPropertiesLoose"));
-
-const _require = require(`graphql`),
-      GraphQLObjectType = _require.GraphQLObjectType,
-      GraphQLBoolean = _require.GraphQLBoolean,
-      GraphQLString = _require.GraphQLString,
-      GraphQLFloat = _require.GraphQLFloat,
-      GraphQLInt = _require.GraphQLInt,
-      GraphQLList = _require.GraphQLList,
-      GraphQLUnionType = _require.GraphQLUnionType;
+const {
+  GraphQLObjectType,
+  GraphQLBoolean,
+  GraphQLString,
+  GraphQLFloat,
+  GraphQLInt,
+  GraphQLList,
+  GraphQLUnionType
+} = require(`graphql`);
 
 const _ = require(`lodash`);
 
 const invariant = require(`invariant`);
 
-const _require2 = require(`common-tags`),
-      oneLine = _require2.oneLine;
+const {
+  oneLine
+} = require(`common-tags`);
 
-const _require3 = require(`../redux`),
-      store = _require3.store;
+const {
+  store
+} = require(`../redux`);
 
-const _require4 = require(`../db/nodes`),
-      getNode = _require4.getNode,
-      getNodes = _require4.getNodes,
-      getNodesByType = _require4.getNodesByType;
+const {
+  getNode,
+  getNodes,
+  getNodesByType
+} = require(`../db/nodes`);
 
 const pageDependencyResolver = require(`./page-dependency-resolver`);
 
@@ -39,10 +39,11 @@ const createTypeName = require(`./create-type-name`);
 
 const createKey = require(`./create-key`);
 
-const _require5 = require(`./data-tree-utils`),
-      getExampleValues = _require5.getExampleValues,
-      isEmptyObjectOrArray = _require5.isEmptyObjectOrArray,
-      INVALID_VALUE = _require5.INVALID_VALUE;
+const {
+  getExampleValues,
+  isEmptyObjectOrArray,
+  INVALID_VALUE
+} = require(`./data-tree-utils`);
 
 const DateType = require(`./types/type-date`);
 
@@ -52,12 +53,13 @@ const is32BitInteger = require(`../utils/is-32-bit-integer`);
 
 const unionTypes = new Map();
 
-function inferGraphQLType(_ref) {
-  let exampleValue = _ref.exampleValue,
-      selector = _ref.selector,
-      nodes = _ref.nodes,
-      types = _ref.types,
-      otherArgs = (0, _objectWithoutPropertiesLoose2.default)(_ref, ["exampleValue", "selector", "nodes", "types"]);
+function inferGraphQLType({
+  exampleValue,
+  selector,
+  nodes,
+  types,
+  ...otherArgs
+}) {
   if (exampleValue == null || isEmptyObjectOrArray(exampleValue)) return null;
   let fieldName = selector.split(`.`).pop(); // Check this before checking for array as FileType has
   // builtin support for inferring array of files and inferred
@@ -71,18 +73,18 @@ function inferGraphQLType(_ref) {
   if (Array.isArray(exampleValue)) {
     exampleValue = exampleValue[0];
     if (exampleValue == null) return null;
-    let inferredType = inferGraphQLType(Object.assign({}, otherArgs, {
+    let inferredType = inferGraphQLType({ ...otherArgs,
       exampleValue,
       selector,
       nodes,
       types
-    }));
+    });
     invariant(inferredType, `Could not infer graphQL type for value: ${exampleValue}`);
-    const type = inferredType.type,
-          _inferredType$args = inferredType.args,
-          args = _inferredType$args === void 0 ? null : _inferredType$args,
-          _inferredType$resolve = inferredType.resolve,
-          resolve = _inferredType$resolve === void 0 ? null : _inferredType$resolve;
+    const {
+      type,
+      args = null,
+      resolve = null
+    } = inferredType;
     const listType = {
       type: new GraphQLList(type),
       args
@@ -129,11 +131,11 @@ function inferGraphQLType(_ref) {
       return {
         type: new GraphQLObjectType({
           name: createTypeName(fieldName),
-          fields: _inferObjectStructureFromNodes(Object.assign({}, otherArgs, {
+          fields: _inferObjectStructureFromNodes({ ...otherArgs,
             selector,
             nodes,
             types
-          }), exampleValue)
+          }, exampleValue)
         })
       };
 
@@ -220,9 +222,7 @@ function inferFromFieldName(value, selector, types) {
   }
 
   const key = selector.split(`.`).pop();
-
-  const _key$split = key.split(`___`),
-        linkedField = _key$split[2];
+  const [,, linkedField] = key.split(`___`);
 
   const validateLinkedNode = linkedNode => {
     invariant(linkedNode, oneLine`
@@ -311,9 +311,9 @@ function _inferObjectStructureFromNodes({
   const isRoot = !selector;
   const mapping = config && config.mapping; // Ensure nodes have internal key with object.
 
-  nodes = nodes.map(n => n.internal ? n : Object.assign({}, n, {
+  nodes = nodes.map(n => n.internal ? n : { ...n,
     internal: {}
-  }));
+  });
   const typeName = nodes[0].internal.type;
   let resolvedExample = exampleValue != null ? exampleValue : getExampleValues({
     nodes,
@@ -339,10 +339,7 @@ function _inferObjectStructureFromNodes({
       // (a node id) to find the node and use that node's type as the field
     } else if (key.includes(`___NODE`)) {
       ;
-
-      var _key$split2 = key.split(`___`);
-
-      fieldName = _key$split2[0];
+      [fieldName] = key.split(`___`);
       inferredField = inferFromFieldName(value, nextSelector, types);
     } // Replace unsupported values
 
@@ -367,9 +364,10 @@ function _inferObjectStructureFromNodes({
     // add resolve passthrough to reach value using original field name
 
     if (sanitizedFieldName !== fieldName) {
-      const _inferredField = inferredField,
-            fieldResolve = _inferredField.resolve,
-            inferredFieldWithoutResolve = (0, _objectWithoutPropertiesLoose2.default)(_inferredField, ["resolve"]); // Using copy if field as we sometimes have predefined frozen
+      const {
+        resolve: fieldResolve,
+        ...inferredFieldWithoutResolve
+      } = inferredField; // Using copy if field as we sometimes have predefined frozen
       // field definitions and we can't mutate them.
 
       inferredField = inferredFieldWithoutResolve;
@@ -377,9 +375,9 @@ function _inferObjectStructureFromNodes({
       if (fieldResolve) {
         // If field has resolver, call it with adjusted resolveInfo
         // that points to original field name
-        inferredField.resolve = (source, args, context, resolveInfo) => fieldResolve(source, args, context, Object.assign({}, resolveInfo, {
+        inferredField.resolve = (source, args, context, resolveInfo) => fieldResolve(source, args, context, { ...resolveInfo,
           fieldName: fieldName
-        }));
+        });
       } else {
         inferredField.resolve = source => source[fieldName];
       }
--- a/node_modules/gatsby/dist/schema/infer-graphql-type.js.map
+++ b/node_modules/gatsby/dist/schema/infer-graphql-type.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/schema/infer-graphql-type.js"],"names":["require","GraphQLObjectType","GraphQLBoolean","GraphQLString","GraphQLFloat","GraphQLInt","GraphQLList","GraphQLUnionType","_","invariant","oneLine","store","getNode","getNodes","getNodesByType","pageDependencyResolver","createTypeName","createKey","getExampleValues","isEmptyObjectOrArray","INVALID_VALUE","DateType","FileType","is32BitInteger","unionTypes","Map","inferGraphQLType","exampleValue","selector","nodes","types","otherArgs","fieldName","split","pop","shouldInfer","isArray","getListType","getType","Array","inferredType","type","args","resolve","listType","object","context","resolveInfo","fieldValue","map","value","name","fields","_inferObjectStructureFromNodes","inferFromMapping","mapping","fieldSelector","linkedType","linkedField","slice","length","matchedTypes","filter","isEmpty","console","log","findNode","find","n","get","nodeObjectType","node","a","b","path","findLinkedNodeByField","findLinkedNode","linkedNode","inferFromFieldName","uniqBy","v","internal","key","validateLinkedNode","validateField","field","findNodeType","linkedNodes","forEach","i","typeName","f","sort","join","has","description","resolveType","data","set","EXCLUDE_KEYS","id","parent","children","ignoreFields","config","getState","isRoot","resolvedExample","inferredFields","each","nextSelector","inferredField","includes","Object","keys","sanitizedFieldName","fieldResolve","inferredFieldWithoutResolve","source","inferObjectStructureFromNodes","options","clearUnionTypes","clear"],"mappings":"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","sourcesContent":["// @flow\nconst {\n  GraphQLObjectType,\n  GraphQLBoolean,\n  GraphQLString,\n  GraphQLFloat,\n  GraphQLInt,\n  GraphQLList,\n  GraphQLUnionType,\n} = require(`graphql`)\nconst _ = require(`lodash`)\nconst invariant = require(`invariant`)\nconst { oneLine } = require(`common-tags`)\n\nconst { store } = require(`../redux`)\nconst { getNode, getNodes, getNodesByType } = require(`../db/nodes`)\nconst pageDependencyResolver = require(`./page-dependency-resolver`)\nconst createTypeName = require(`./create-type-name`)\nconst createKey = require(`./create-key`)\nconst {\n  getExampleValues,\n  isEmptyObjectOrArray,\n  INVALID_VALUE,\n} = require(`./data-tree-utils`)\nconst DateType = require(`./types/type-date`)\nconst FileType = require(`./types/type-file`)\nconst is32BitInteger = require(`../utils/is-32-bit-integer`)\nconst unionTypes = new Map()\n\nimport type { GraphQLOutputType } from \"graphql\"\nimport type {\n  GraphQLFieldConfig,\n  GraphQLFieldConfigMap,\n} from \"graphql/type/definition\"\n\nexport type ProcessedNodeType = {\n  name: string,\n  nodes: any[],\n  node: GraphQLFieldConfig<*, *>,\n  fieldsFromPlugins: any,\n  nodeObjectType: GraphQLOutputType,\n}\n\nfunction inferGraphQLType({\n  exampleValue,\n  selector,\n  nodes,\n  types,\n  ...otherArgs\n}): ?GraphQLFieldConfig<*, *> {\n  if (exampleValue == null || isEmptyObjectOrArray(exampleValue)) return null\n  let fieldName = selector.split(`.`).pop()\n\n  // Check this before checking for array as FileType has\n  // builtin support for inferring array of files and inferred\n  // array type will have faster resolver than resolving array\n  // of files separately.\n  if (FileType.shouldInfer(nodes, selector, exampleValue)) {\n    return _.isArray(exampleValue) ? FileType.getListType() : FileType.getType()\n  }\n\n  if (Array.isArray(exampleValue)) {\n    exampleValue = exampleValue[0]\n\n    if (exampleValue == null) return null\n\n    let inferredType = inferGraphQLType({\n      ...otherArgs,\n      exampleValue,\n      selector,\n      nodes,\n      types,\n    })\n    invariant(\n      inferredType,\n      `Could not infer graphQL type for value: ${exampleValue}`\n    )\n\n    const { type, args = null, resolve = null } = inferredType\n\n    const listType = { type: new GraphQLList(type), args }\n\n    if (resolve) {\n      // If inferredType has resolve function wrap it with Array.map\n      listType.resolve = (object, args, context, resolveInfo) => {\n        const fieldValue = object[fieldName]\n        if (!fieldValue) {\n          return null\n        }\n\n        // Field resolver expects first parameter to be plain object\n        // containing key with name of field we want to resolve.\n        return fieldValue.map(value =>\n          resolve({ [fieldName]: value }, args, context, resolveInfo)\n        )\n      }\n    }\n\n    return listType\n  }\n\n  if (\n    // momentjs crashes when it encounters a Symbol,\n    // so check against that\n    typeof exampleValue !== `symbol` &&\n    DateType.shouldInfer(exampleValue)\n  ) {\n    return DateType.getType()\n  }\n\n  switch (typeof exampleValue) {\n    case `boolean`:\n      return { type: GraphQLBoolean }\n    case `string`:\n      return { type: GraphQLString }\n    case `object`:\n      return {\n        type: new GraphQLObjectType({\n          name: createTypeName(fieldName),\n          fields: _inferObjectStructureFromNodes(\n            {\n              ...otherArgs,\n              selector,\n              nodes,\n              types,\n            },\n            exampleValue\n          ),\n        }),\n      }\n    case `number`:\n      return is32BitInteger(exampleValue)\n        ? { type: GraphQLInt }\n        : { type: GraphQLFloat }\n    default:\n      return null\n  }\n}\n\nfunction inferFromMapping(\n  value,\n  mapping,\n  fieldSelector,\n  types\n): ?GraphQLFieldConfig<*, *> {\n  const linkedType = mapping[fieldSelector].split(`.`)[0]\n  const linkedField =\n    mapping[fieldSelector].slice(linkedType.length + 1) || `id`\n\n  const matchedTypes = types.filter(type => type.name === linkedType)\n  if (_.isEmpty(matchedTypes)) {\n    console.log(`Couldn't find a matching node type for \"${fieldSelector}\"`)\n    return null\n  }\n\n  const findNode = fieldValue =>\n    getNodesByType(linkedType).find(n => _.get(n, linkedField) === fieldValue)\n\n  if (_.isArray(value)) {\n    return {\n      type: new GraphQLList(matchedTypes[0].nodeObjectType),\n      resolve: pageDependencyResolver((node, a, b, { fieldName }) => {\n        const fieldValue = node[fieldName]\n        if (fieldValue) {\n          return fieldValue.map(findNode)\n        } else {\n          return null\n        }\n      }),\n    }\n  }\n\n  return {\n    type: matchedTypes[0].nodeObjectType,\n    resolve: (node, a, b, { fieldName }) => {\n      const fieldValue = node[fieldName]\n\n      if (fieldValue) {\n        return findNode(fieldValue, b.path)\n      } else {\n        return null\n      }\n    },\n  }\n}\n\nfunction findLinkedNodeByField(linkedField, value) {\n  getNodes().find(n => n[linkedField] === value)\n}\n\nexport function findLinkedNode(value, linkedField, path) {\n  let linkedNode\n  // If the field doesn't link to the id, use that for searching.\n  if (linkedField) {\n    linkedNode = findLinkedNodeByField(linkedField, value)\n    // Else the field is linking to the node's id, the default.\n  } else {\n    linkedNode = getNode(value)\n  }\n  return linkedNode\n}\n\nfunction inferFromFieldName(value, selector, types): GraphQLFieldConfig<*, *> {\n  let isArray = false\n  if (_.isArray(value)) {\n    isArray = true\n    // Reduce values to nodes with unique types.\n    value = _.uniqBy(value, v => getNode(v).internal.type)\n  }\n\n  const key = selector.split(`.`).pop()\n  const [, , linkedField] = key.split(`___`)\n\n  const validateLinkedNode = linkedNode => {\n    invariant(\n      linkedNode,\n      oneLine`\n        Encountered an error trying to infer a GraphQL type for: \"${selector}\".\n        There is no corresponding node with the ${linkedField || `id`}\n        field matching: \"${value}\"\n      `\n    )\n  }\n  const validateField = (linkedNode, field) => {\n    invariant(\n      field,\n      oneLine`\n        Encountered an error trying to infer a GraphQL type for: \"${selector}\".\n        There is no corresponding GraphQL type \"${\n          linkedNode.internal.type\n        }\" available\n        to link to this node.\n      `\n    )\n  }\n\n  const findNodeType = node =>\n    types.find(type => type.name === node.internal.type)\n\n  if (isArray) {\n    const linkedNodes = value.map(getNode)\n    linkedNodes.forEach(node => validateLinkedNode(node))\n    const fields = linkedNodes.map(node => findNodeType(node))\n    fields.forEach((field, i) => validateField(linkedNodes[i], field))\n\n    let type\n    // If there's more than one type, we'll create a union type.\n    if (fields.length > 1) {\n      const typeName = `Union_${key}_${fields\n        .map(f => f.name)\n        .sort()\n        .join(`__`)}`\n\n      if (unionTypes.has(typeName)) {\n        type = unionTypes.get(typeName)\n      }\n\n      if (!type) {\n        type = new GraphQLUnionType({\n          name: createTypeName(`Union_${key}`),\n          description: `Union interface for the field \"${key}\" for types [${fields\n            .map(f => f.name)\n            .sort()\n            .join(`, `)}]`,\n          types: fields.map(f => f.nodeObjectType),\n          resolveType: data =>\n            fields.find(f => f.name == data.internal.type).nodeObjectType,\n        })\n        unionTypes.set(typeName, type)\n      }\n    } else {\n      type = fields[0].nodeObjectType\n    }\n\n    return {\n      type: new GraphQLList(type),\n      resolve: (node, a, b = {}) => {\n        let fieldValue = node[key]\n        if (fieldValue) {\n          return fieldValue.map(value =>\n            findLinkedNode(value, linkedField, b.path)\n          )\n        } else {\n          return null\n        }\n      },\n    }\n  }\n\n  const linkedNode = findLinkedNode(value, linkedField)\n  validateLinkedNode(linkedNode)\n  const field = findNodeType(linkedNode)\n  validateField(linkedNode, field)\n  return {\n    type: field.nodeObjectType,\n    resolve: pageDependencyResolver(node =>\n      findLinkedNode(node[key], linkedField)\n    ),\n  }\n}\n\ntype inferTypeOptions = {\n  nodes: Object[],\n  types: ProcessedNodeType[],\n  ignoreFields?: string[],\n  selector?: string,\n}\n\nconst EXCLUDE_KEYS = {\n  id: 1,\n  parent: 1,\n  children: 1,\n}\n\n// Call this for the top level node + recursively for each sub-object.\n// E.g. This gets called for Markdown and then for its frontmatter subobject.\nfunction _inferObjectStructureFromNodes(\n  { nodes, types, selector, ignoreFields }: inferTypeOptions,\n  exampleValue: ?Object\n): GraphQLFieldConfigMap<*, *> {\n  const config = store.getState().config\n  const isRoot = !selector\n  const mapping = config && config.mapping\n\n  // Ensure nodes have internal key with object.\n  nodes = nodes.map(n => (n.internal ? n : { ...n, internal: {} }))\n\n  const typeName: string = nodes[0].internal.type\n\n  let resolvedExample: Object =\n    exampleValue != null\n      ? exampleValue\n      : getExampleValues({ nodes, typeName, ignoreFields })\n\n  const inferredFields = {}\n  _.each(resolvedExample, (value, key) => {\n    // Remove fields common to the top-level of all nodes.  We add these\n    // elsewhere so don't need to infer their type.\n    if (value === INVALID_VALUE || (isRoot && EXCLUDE_KEYS[key])) return\n\n    // Several checks to see if a field is pointing to custom type\n    // before we try automatic inference.\n    const nextSelector = selector ? `${selector}.${key}` : key\n    const fieldSelector = `${typeName}.${nextSelector}`\n\n    let fieldName = key\n    let inferredField\n\n    // First check for manual field => type mappings in the site's\n    // gatsby-config.js\n    if (mapping && _.includes(Object.keys(mapping), fieldSelector)) {\n      inferredField = inferFromMapping(value, mapping, fieldSelector, types)\n\n      // Second if the field has a suffix of ___node. We use then the value\n      // (a node id) to find the node and use that node's type as the field\n    } else if (key.includes(`___NODE`)) {\n      ;[fieldName] = key.split(`___`)\n      inferredField = inferFromFieldName(value, nextSelector, types)\n    }\n\n    // Replace unsupported values\n    const sanitizedFieldName = createKey(fieldName)\n\n    // If a pluging has already provided a type for this, don't infer it.\n    if (ignoreFields && ignoreFields.includes(sanitizedFieldName)) {\n      return\n    }\n\n    // Finally our automatic inference of field value type.\n    if (!inferredField) {\n      inferredField = inferGraphQLType({\n        nodes,\n        types,\n        exampleValue: value,\n        selector: nextSelector,\n      })\n    }\n\n    if (!inferredField) return\n\n    // If sanitized field name is different from original field name\n    // add resolve passthrough to reach value using original field name\n    if (sanitizedFieldName !== fieldName) {\n      const {\n        resolve: fieldResolve,\n        ...inferredFieldWithoutResolve\n      } = inferredField\n\n      // Using copy if field as we sometimes have predefined frozen\n      // field definitions and we can't mutate them.\n      inferredField = inferredFieldWithoutResolve\n\n      if (fieldResolve) {\n        // If field has resolver, call it with adjusted resolveInfo\n        // that points to original field name\n        inferredField.resolve = (source, args, context, resolveInfo) =>\n          fieldResolve(source, args, context, {\n            ...resolveInfo,\n            fieldName: fieldName,\n          })\n      } else {\n        inferredField.resolve = source => source[fieldName]\n      }\n    }\n\n    inferredFields[sanitizedFieldName] = inferredField\n  })\n\n  return inferredFields\n}\n\nexport function inferObjectStructureFromNodes(options: inferTypeOptions) {\n  return _inferObjectStructureFromNodes(options, null)\n}\n\nexport function clearUnionTypes() {\n  unionTypes.clear()\n}\n"],"file":"infer-graphql-type.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/schema/infer-graphql-type.js"],"names":["GraphQLObjectType","GraphQLBoolean","GraphQLString","GraphQLFloat","GraphQLInt","GraphQLList","GraphQLUnionType","require","_","invariant","oneLine","store","getNode","getNodes","getNodesByType","pageDependencyResolver","createTypeName","createKey","getExampleValues","isEmptyObjectOrArray","INVALID_VALUE","DateType","FileType","is32BitInteger","unionTypes","Map","inferGraphQLType","exampleValue","selector","nodes","types","otherArgs","fieldName","split","pop","shouldInfer","isArray","getListType","getType","Array","inferredType","type","args","resolve","listType","object","context","resolveInfo","fieldValue","map","value","name","fields","_inferObjectStructureFromNodes","inferFromMapping","mapping","fieldSelector","linkedType","linkedField","slice","length","matchedTypes","filter","isEmpty","console","log","findNode","find","n","get","nodeObjectType","node","a","b","path","findLinkedNodeByField","findLinkedNode","linkedNode","inferFromFieldName","uniqBy","v","internal","key","validateLinkedNode","validateField","field","findNodeType","linkedNodes","forEach","i","typeName","f","sort","join","has","description","resolveType","data","set","EXCLUDE_KEYS","id","parent","children","ignoreFields","config","getState","isRoot","resolvedExample","inferredFields","each","nextSelector","inferredField","includes","Object","keys","sanitizedFieldName","fieldResolve","inferredFieldWithoutResolve","source","inferObjectStructureFromNodes","options","clearUnionTypes","clear"],"mappings":"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","sourcesContent":["// @flow\nconst {\n  GraphQLObjectType,\n  GraphQLBoolean,\n  GraphQLString,\n  GraphQLFloat,\n  GraphQLInt,\n  GraphQLList,\n  GraphQLUnionType,\n} = require(`graphql`)\nconst _ = require(`lodash`)\nconst invariant = require(`invariant`)\nconst { oneLine } = require(`common-tags`)\n\nconst { store } = require(`../redux`)\nconst { getNode, getNodes, getNodesByType } = require(`../db/nodes`)\nconst pageDependencyResolver = require(`./page-dependency-resolver`)\nconst createTypeName = require(`./create-type-name`)\nconst createKey = require(`./create-key`)\nconst {\n  getExampleValues,\n  isEmptyObjectOrArray,\n  INVALID_VALUE,\n} = require(`./data-tree-utils`)\nconst DateType = require(`./types/type-date`)\nconst FileType = require(`./types/type-file`)\nconst is32BitInteger = require(`../utils/is-32-bit-integer`)\nconst unionTypes = new Map()\n\nimport type { GraphQLOutputType } from \"graphql\"\nimport type {\n  GraphQLFieldConfig,\n  GraphQLFieldConfigMap,\n} from \"graphql/type/definition\"\n\nexport type ProcessedNodeType = {\n  name: string,\n  nodes: any[],\n  node: GraphQLFieldConfig<*, *>,\n  fieldsFromPlugins: any,\n  nodeObjectType: GraphQLOutputType,\n}\n\nfunction inferGraphQLType({\n  exampleValue,\n  selector,\n  nodes,\n  types,\n  ...otherArgs\n}): ?GraphQLFieldConfig<*, *> {\n  if (exampleValue == null || isEmptyObjectOrArray(exampleValue)) return null\n  let fieldName = selector.split(`.`).pop()\n\n  // Check this before checking for array as FileType has\n  // builtin support for inferring array of files and inferred\n  // array type will have faster resolver than resolving array\n  // of files separately.\n  if (FileType.shouldInfer(nodes, selector, exampleValue)) {\n    return _.isArray(exampleValue) ? FileType.getListType() : FileType.getType()\n  }\n\n  if (Array.isArray(exampleValue)) {\n    exampleValue = exampleValue[0]\n\n    if (exampleValue == null) return null\n\n    let inferredType = inferGraphQLType({\n      ...otherArgs,\n      exampleValue,\n      selector,\n      nodes,\n      types,\n    })\n    invariant(\n      inferredType,\n      `Could not infer graphQL type for value: ${exampleValue}`\n    )\n\n    const { type, args = null, resolve = null } = inferredType\n\n    const listType = { type: new GraphQLList(type), args }\n\n    if (resolve) {\n      // If inferredType has resolve function wrap it with Array.map\n      listType.resolve = (object, args, context, resolveInfo) => {\n        const fieldValue = object[fieldName]\n        if (!fieldValue) {\n          return null\n        }\n\n        // Field resolver expects first parameter to be plain object\n        // containing key with name of field we want to resolve.\n        return fieldValue.map(value =>\n          resolve({ [fieldName]: value }, args, context, resolveInfo)\n        )\n      }\n    }\n\n    return listType\n  }\n\n  if (\n    // momentjs crashes when it encounters a Symbol,\n    // so check against that\n    typeof exampleValue !== `symbol` &&\n    DateType.shouldInfer(exampleValue)\n  ) {\n    return DateType.getType()\n  }\n\n  switch (typeof exampleValue) {\n    case `boolean`:\n      return { type: GraphQLBoolean }\n    case `string`:\n      return { type: GraphQLString }\n    case `object`:\n      return {\n        type: new GraphQLObjectType({\n          name: createTypeName(fieldName),\n          fields: _inferObjectStructureFromNodes(\n            {\n              ...otherArgs,\n              selector,\n              nodes,\n              types,\n            },\n            exampleValue\n          ),\n        }),\n      }\n    case `number`:\n      return is32BitInteger(exampleValue)\n        ? { type: GraphQLInt }\n        : { type: GraphQLFloat }\n    default:\n      return null\n  }\n}\n\nfunction inferFromMapping(\n  value,\n  mapping,\n  fieldSelector,\n  types\n): ?GraphQLFieldConfig<*, *> {\n  const linkedType = mapping[fieldSelector].split(`.`)[0]\n  const linkedField =\n    mapping[fieldSelector].slice(linkedType.length + 1) || `id`\n\n  const matchedTypes = types.filter(type => type.name === linkedType)\n  if (_.isEmpty(matchedTypes)) {\n    console.log(`Couldn't find a matching node type for \"${fieldSelector}\"`)\n    return null\n  }\n\n  const findNode = fieldValue =>\n    getNodesByType(linkedType).find(n => _.get(n, linkedField) === fieldValue)\n\n  if (_.isArray(value)) {\n    return {\n      type: new GraphQLList(matchedTypes[0].nodeObjectType),\n      resolve: pageDependencyResolver((node, a, b, { fieldName }) => {\n        const fieldValue = node[fieldName]\n        if (fieldValue) {\n          return fieldValue.map(findNode)\n        } else {\n          return null\n        }\n      }),\n    }\n  }\n\n  return {\n    type: matchedTypes[0].nodeObjectType,\n    resolve: (node, a, b, { fieldName }) => {\n      const fieldValue = node[fieldName]\n\n      if (fieldValue) {\n        return findNode(fieldValue, b.path)\n      } else {\n        return null\n      }\n    },\n  }\n}\n\nfunction findLinkedNodeByField(linkedField, value) {\n  getNodes().find(n => n[linkedField] === value)\n}\n\nexport function findLinkedNode(value, linkedField, path) {\n  let linkedNode\n  // If the field doesn't link to the id, use that for searching.\n  if (linkedField) {\n    linkedNode = findLinkedNodeByField(linkedField, value)\n    // Else the field is linking to the node's id, the default.\n  } else {\n    linkedNode = getNode(value)\n  }\n  return linkedNode\n}\n\nfunction inferFromFieldName(value, selector, types): GraphQLFieldConfig<*, *> {\n  let isArray = false\n  if (_.isArray(value)) {\n    isArray = true\n    // Reduce values to nodes with unique types.\n    value = _.uniqBy(value, v => getNode(v).internal.type)\n  }\n\n  const key = selector.split(`.`).pop()\n  const [, , linkedField] = key.split(`___`)\n\n  const validateLinkedNode = linkedNode => {\n    invariant(\n      linkedNode,\n      oneLine`\n        Encountered an error trying to infer a GraphQL type for: \"${selector}\".\n        There is no corresponding node with the ${linkedField || `id`}\n        field matching: \"${value}\"\n      `\n    )\n  }\n  const validateField = (linkedNode, field) => {\n    invariant(\n      field,\n      oneLine`\n        Encountered an error trying to infer a GraphQL type for: \"${selector}\".\n        There is no corresponding GraphQL type \"${\n          linkedNode.internal.type\n        }\" available\n        to link to this node.\n      `\n    )\n  }\n\n  const findNodeType = node =>\n    types.find(type => type.name === node.internal.type)\n\n  if (isArray) {\n    const linkedNodes = value.map(getNode)\n    linkedNodes.forEach(node => validateLinkedNode(node))\n    const fields = linkedNodes.map(node => findNodeType(node))\n    fields.forEach((field, i) => validateField(linkedNodes[i], field))\n\n    let type\n    // If there's more than one type, we'll create a union type.\n    if (fields.length > 1) {\n      const typeName = `Union_${key}_${fields\n        .map(f => f.name)\n        .sort()\n        .join(`__`)}`\n\n      if (unionTypes.has(typeName)) {\n        type = unionTypes.get(typeName)\n      }\n\n      if (!type) {\n        type = new GraphQLUnionType({\n          name: createTypeName(`Union_${key}`),\n          description: `Union interface for the field \"${key}\" for types [${fields\n            .map(f => f.name)\n            .sort()\n            .join(`, `)}]`,\n          types: fields.map(f => f.nodeObjectType),\n          resolveType: data =>\n            fields.find(f => f.name == data.internal.type).nodeObjectType,\n        })\n        unionTypes.set(typeName, type)\n      }\n    } else {\n      type = fields[0].nodeObjectType\n    }\n\n    return {\n      type: new GraphQLList(type),\n      resolve: (node, a, b = {}) => {\n        let fieldValue = node[key]\n        if (fieldValue) {\n          return fieldValue.map(value =>\n            findLinkedNode(value, linkedField, b.path)\n          )\n        } else {\n          return null\n        }\n      },\n    }\n  }\n\n  const linkedNode = findLinkedNode(value, linkedField)\n  validateLinkedNode(linkedNode)\n  const field = findNodeType(linkedNode)\n  validateField(linkedNode, field)\n  return {\n    type: field.nodeObjectType,\n    resolve: pageDependencyResolver(node =>\n      findLinkedNode(node[key], linkedField)\n    ),\n  }\n}\n\ntype inferTypeOptions = {\n  nodes: Object[],\n  types: ProcessedNodeType[],\n  ignoreFields?: string[],\n  selector?: string,\n}\n\nconst EXCLUDE_KEYS = {\n  id: 1,\n  parent: 1,\n  children: 1,\n}\n\n// Call this for the top level node + recursively for each sub-object.\n// E.g. This gets called for Markdown and then for its frontmatter subobject.\nfunction _inferObjectStructureFromNodes(\n  { nodes, types, selector, ignoreFields }: inferTypeOptions,\n  exampleValue: ?Object\n): GraphQLFieldConfigMap<*, *> {\n  const config = store.getState().config\n  const isRoot = !selector\n  const mapping = config && config.mapping\n\n  // Ensure nodes have internal key with object.\n  nodes = nodes.map(n => (n.internal ? n : { ...n, internal: {} }))\n\n  const typeName: string = nodes[0].internal.type\n\n  let resolvedExample: Object =\n    exampleValue != null\n      ? exampleValue\n      : getExampleValues({ nodes, typeName, ignoreFields })\n\n  const inferredFields = {}\n  _.each(resolvedExample, (value, key) => {\n    // Remove fields common to the top-level of all nodes.  We add these\n    // elsewhere so don't need to infer their type.\n    if (value === INVALID_VALUE || (isRoot && EXCLUDE_KEYS[key])) return\n\n    // Several checks to see if a field is pointing to custom type\n    // before we try automatic inference.\n    const nextSelector = selector ? `${selector}.${key}` : key\n    const fieldSelector = `${typeName}.${nextSelector}`\n\n    let fieldName = key\n    let inferredField\n\n    // First check for manual field => type mappings in the site's\n    // gatsby-config.js\n    if (mapping && _.includes(Object.keys(mapping), fieldSelector)) {\n      inferredField = inferFromMapping(value, mapping, fieldSelector, types)\n\n      // Second if the field has a suffix of ___node. We use then the value\n      // (a node id) to find the node and use that node's type as the field\n    } else if (key.includes(`___NODE`)) {\n      ;[fieldName] = key.split(`___`)\n      inferredField = inferFromFieldName(value, nextSelector, types)\n    }\n\n    // Replace unsupported values\n    const sanitizedFieldName = createKey(fieldName)\n\n    // If a pluging has already provided a type for this, don't infer it.\n    if (ignoreFields && ignoreFields.includes(sanitizedFieldName)) {\n      return\n    }\n\n    // Finally our automatic inference of field value type.\n    if (!inferredField) {\n      inferredField = inferGraphQLType({\n        nodes,\n        types,\n        exampleValue: value,\n        selector: nextSelector,\n      })\n    }\n\n    if (!inferredField) return\n\n    // If sanitized field name is different from original field name\n    // add resolve passthrough to reach value using original field name\n    if (sanitizedFieldName !== fieldName) {\n      const {\n        resolve: fieldResolve,\n        ...inferredFieldWithoutResolve\n      } = inferredField\n\n      // Using copy if field as we sometimes have predefined frozen\n      // field definitions and we can't mutate them.\n      inferredField = inferredFieldWithoutResolve\n\n      if (fieldResolve) {\n        // If field has resolver, call it with adjusted resolveInfo\n        // that points to original field name\n        inferredField.resolve = (source, args, context, resolveInfo) =>\n          fieldResolve(source, args, context, {\n            ...resolveInfo,\n            fieldName: fieldName,\n          })\n      } else {\n        inferredField.resolve = source => source[fieldName]\n      }\n    }\n\n    inferredFields[sanitizedFieldName] = inferredField\n  })\n\n  return inferredFields\n}\n\nexport function inferObjectStructureFromNodes(options: inferTypeOptions) {\n  return _inferObjectStructureFromNodes(options, null)\n}\n\nexport function clearUnionTypes() {\n  unionTypes.clear()\n}\n"],"file":"infer-graphql-type.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/schema/page-dependency-resolver.js
+++ b/node_modules/gatsby/dist/schema/page-dependency-resolver.js
@@ -1,9 +1,5 @@
 "use strict";
 
-var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
-
-var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
-
 const _ = require(`lodash`);
 
 const createPageDependency = require(`../redux/actions/add-page-dependency`);
@@ -18,49 +14,29 @@ const createPageDependency = require(`../redux/actions/add-page-dependency`);
 
 
 function pageDependencyResolver(resolver) {
-  return (
-    /*#__PURE__*/
-    function () {
-      var _ref = (0, _asyncToGenerator2.default)(function* (node, args, context = {}, info = {}) {
-        const path = context.path;
-        const result = yield resolver(node, args, context, info); // Call createPageDependency on each result
-
-        if (path) {
-          const asArray = _.isArray(result) ? result : [result];
-
-          for (var _iterator = asArray, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {
-            var _ref2;
-
-            if (_isArray) {
-              if (_i >= _iterator.length) break;
-              _ref2 = _iterator[_i++];
-            } else {
-              _i = _iterator.next();
-              if (_i.done) break;
-              _ref2 = _i.value;
-            }
-
-            const node = _ref2;
-
-            if (node) {
-              // using module.exports here so it can be mocked
-              createPageDependency({
-                path,
-                nodeId: node.id
-              });
-            }
-          }
-        } // Finally return the found node
-
-
-        return result;
-      });
-
-      return function (_x, _x2) {
-        return _ref.apply(this, arguments);
-      };
-    }()
-  );
+  return async (node, args, context = {}, info = {}) => {
+    const {
+      path
+    } = context;
+    const result = await resolver(node, args, context, info); // Call createPageDependency on each result
+
+    if (path) {
+      const asArray = _.isArray(result) ? result : [result];
+
+      for (const node of asArray) {
+        if (node) {
+          // using module.exports here so it can be mocked
+          createPageDependency({
+            path,
+            nodeId: node.id
+          });
+        }
+      }
+    } // Finally return the found node
+
+
+    return result;
+  };
 }
 
 module.exports = pageDependencyResolver;
--- a/node_modules/gatsby/dist/schema/page-dependency-resolver.js.map
+++ b/node_modules/gatsby/dist/schema/page-dependency-resolver.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/schema/page-dependency-resolver.js"],"names":["_","require","createPageDependency","pageDependencyResolver","resolver","node","args","context","info","path","result","asArray","isArray","nodeId","id","module","exports"],"mappings":";;;;;;AAAA,MAAMA,CAAC,GAAGC,OAAO,CAAE,QAAF,CAAjB;;AACA,MAAMC,oBAAoB,GAAGD,OAAO,CAAE,sCAAF,CAApC;AAEA;;;;;;;;;;AAQA,SAASE,sBAAT,CAAgCC,QAAhC,EAA0C;AACxC;AAAA;AAAA;AAAA,iDAAO,WAAOC,IAAP,EAAaC,IAAb,EAAmBC,OAAO,GAAG,EAA7B,EAAiCC,IAAI,GAAG,EAAxC,EAA+C;AAAA,cAC5CC,IAD4C,GACnCF,OADmC,CAC5CE,IAD4C;AAEpD,cAAMC,MAAM,SAASN,QAAQ,CAACC,IAAD,EAAOC,IAAP,EAAaC,OAAb,EAAsBC,IAAtB,CAA7B,CAFoD,CAIpD;;AACA,YAAIC,IAAJ,EAAU;AACR,gBAAME,OAAO,GAAGX,CAAC,CAACY,OAAF,CAAUF,MAAV,IAAoBA,MAApB,GAA6B,CAACA,MAAD,CAA7C;;AACA,+BAAmBC,OAAnB,kHAA4B;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA,kBAAjBN,IAAiB;;AAC1B,gBAAIA,IAAJ,EAAU;AACR;AACAH,cAAAA,oBAAoB,CAAC;AACnBO,gBAAAA,IADmB;AAEnBI,gBAAAA,MAAM,EAAER,IAAI,CAACS;AAFM,eAAD,CAApB;AAID;AACF;AACF,SAhBmD,CAkBpD;;;AACA,eAAOJ,MAAP;AACD,OApBD;;AAAA;AAAA;AAAA;AAAA;AAAA;AAqBD;;AAEDK,MAAM,CAACC,OAAP,GAAiBb,sBAAjB","sourcesContent":["const _ = require(`lodash`)\nconst createPageDependency = require(`../redux/actions/add-page-dependency`)\n\n/**\n * A Graphql resolver middleware that runs `resolver` and creates a\n * page dependency with the returned node.\n *\n * @param resolver A graphql resolver. A function that take arguments\n * (node, args, context, info) and return a node\n * @returns A new graphql resolver\n */\nfunction pageDependencyResolver(resolver) {\n  return async (node, args, context = {}, info = {}) => {\n    const { path } = context\n    const result = await resolver(node, args, context, info)\n\n    // Call createPageDependency on each result\n    if (path) {\n      const asArray = _.isArray(result) ? result : [result]\n      for (const node of asArray) {\n        if (node) {\n          // using module.exports here so it can be mocked\n          createPageDependency({\n            path,\n            nodeId: node.id,\n          })\n        }\n      }\n    }\n\n    // Finally return the found node\n    return result\n  }\n}\n\nmodule.exports = pageDependencyResolver\n"],"file":"page-dependency-resolver.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/schema/page-dependency-resolver.js"],"names":["_","require","createPageDependency","pageDependencyResolver","resolver","node","args","context","info","path","result","asArray","isArray","nodeId","id","module","exports"],"mappings":";;AAAA,MAAMA,CAAC,GAAGC,OAAO,CAAE,QAAF,CAAjB;;AACA,MAAMC,oBAAoB,GAAGD,OAAO,CAAE,sCAAF,CAApC;AAEA;;;;;;;;;;AAQA,SAASE,sBAAT,CAAgCC,QAAhC,EAA0C;AACxC,SAAO,OAAOC,IAAP,EAAaC,IAAb,EAAmBC,OAAO,GAAG,EAA7B,EAAiCC,IAAI,GAAG,EAAxC,KAA+C;AACpD,UAAM;AAAEC,MAAAA;AAAF,QAAWF,OAAjB;AACA,UAAMG,MAAM,GAAG,MAAMN,QAAQ,CAACC,IAAD,EAAOC,IAAP,EAAaC,OAAb,EAAsBC,IAAtB,CAA7B,CAFoD,CAIpD;;AACA,QAAIC,IAAJ,EAAU;AACR,YAAME,OAAO,GAAGX,CAAC,CAACY,OAAF,CAAUF,MAAV,IAAoBA,MAApB,GAA6B,CAACA,MAAD,CAA7C;;AACA,WAAK,MAAML,IAAX,IAAmBM,OAAnB,EAA4B;AAC1B,YAAIN,IAAJ,EAAU;AACR;AACAH,UAAAA,oBAAoB,CAAC;AACnBO,YAAAA,IADmB;AAEnBI,YAAAA,MAAM,EAAER,IAAI,CAACS;AAFM,WAAD,CAApB;AAID;AACF;AACF,KAhBmD,CAkBpD;;;AACA,WAAOJ,MAAP;AACD,GApBD;AAqBD;;AAEDK,MAAM,CAACC,OAAP,GAAiBb,sBAAjB","sourcesContent":["const _ = require(`lodash`)\nconst createPageDependency = require(`../redux/actions/add-page-dependency`)\n\n/**\n * A Graphql resolver middleware that runs `resolver` and creates a\n * page dependency with the returned node.\n *\n * @param resolver A graphql resolver. A function that take arguments\n * (node, args, context, info) and return a node\n * @returns A new graphql resolver\n */\nfunction pageDependencyResolver(resolver) {\n  return async (node, args, context = {}, info = {}) => {\n    const { path } = context\n    const result = await resolver(node, args, context, info)\n\n    // Call createPageDependency on each result\n    if (path) {\n      const asArray = _.isArray(result) ? result : [result]\n      for (const node of asArray) {\n        if (node) {\n          // using module.exports here so it can be mocked\n          createPageDependency({\n            path,\n            nodeId: node.id,\n          })\n        }\n      }\n    }\n\n    // Finally return the found node\n    return result\n  }\n}\n\nmodule.exports = pageDependencyResolver\n"],"file":"page-dependency-resolver.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/schema/type-conflict-reporter.js
+++ b/node_modules/gatsby/dist/schema/type-conflict-reporter.js
@@ -12,8 +12,9 @@ const typeOf = require(`type-of`);
 
 const util = require(`util`);
 
-const _require = require(`../db/node-tracking`),
-      findRootNodeAncestor = _require.findRootNodeAncestor;
+const {
+  findRootNodeAncestor
+} = require(`../db/node-tracking`);
 
 const isNodeWithDescription = node => node && node.internal && node.internal.description;
 
--- a/node_modules/gatsby/dist/schema/type-conflict-reporter.js.map
+++ b/node_modules/gatsby/dist/schema/type-conflict-reporter.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/schema/type-conflict-reporter.js"],"names":["_","require","report","typeOf","util","findRootNodeAncestor","isNodeWithDescription","node","internal","description","findNodeDescription","obj","formatValue","value","isArray","inspect","colors","depth","breakLength","Infinity","wasElipsisLast","usedTypes","output","forEach","item","type","indexOf","push","join","TypeConflictEntry","constructor","selector","types","Map","addExample","parent","set","printEntry","sortedByTypeName","sortBy","Array","from","entries","typeName","log","map","TypeConflictReporter","clearConflicts","clear","getEntryFromSelector","dataEntry","get","addConflict","examples","substring","entry","filter","example","printConflicts","size","warn","typeConflictReporter","module","exports"],"mappings":"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","sourcesContent":["// @flow\nconst _ = require(`lodash`)\nconst report = require(`gatsby-cli/lib/reporter`)\nconst typeOf = require(`type-of`)\nconst util = require(`util`)\nconst { findRootNodeAncestor } = require(`../db/node-tracking`)\n\nexport type TypeConflictExample = {\n  value: mixed,\n  parent: {},\n  type: string,\n  arrayTypes: string[],\n}\n\ntype TypeConflict = {\n  value: mixed,\n  description: string,\n}\n\nconst isNodeWithDescription = node =>\n  node && node.internal && node.internal.description\n\nconst findNodeDescription = obj => {\n  if (obj) {\n    const node = findRootNodeAncestor(obj, isNodeWithDescription)\n    if (isNodeWithDescription(node)) {\n      return node.internal.description\n    }\n  }\n  return ``\n}\n\nconst formatValue = value => {\n  if (!_.isArray(value)) {\n    return util.inspect(value, {\n      colors: true,\n      depth: 0,\n      breakLength: Infinity,\n    })\n  }\n\n  let wasElipsisLast = false\n  const usedTypes = []\n  const output = []\n\n  value.forEach(item => {\n    const type = typeOf(item)\n    if (usedTypes.indexOf(type) !== -1) {\n      if (!wasElipsisLast) {\n        output.push(`...`)\n        wasElipsisLast = true\n      }\n    } else {\n      output.push(formatValue(item))\n      wasElipsisLast = false\n      usedTypes.push(type)\n    }\n  })\n\n  return `[ ${output.join(`, `)} ]`\n}\n\nclass TypeConflictEntry {\n  selector: string\n  types: Map<string, TypeConflict>\n\n  constructor(selector: string) {\n    this.selector = selector\n    this.types = new Map()\n  }\n\n  addExample({ value, type, parent }: TypeConflictExample) {\n    this.types.set(type, {\n      value,\n      description: findNodeDescription(parent),\n    })\n  }\n\n  printEntry() {\n    const sortedByTypeName = _.sortBy(\n      Array.from(this.types.entries()),\n      ([typeName, value]) => typeName\n    )\n\n    report.log(\n      `${this.selector}:${sortedByTypeName\n        .map(\n          ([typeName, { value, description }]) =>\n            `\\n - type: ${typeName}\\n   value: ${formatValue(\n              value\n            )}${description && `\\n   source: ${description}`}`\n        )\n        .join(``)}`\n    )\n  }\n}\n\nclass TypeConflictReporter {\n  entries: Map<string, TypeConflictEntry>\n\n  constructor() {\n    this.entries = new Map()\n  }\n\n  clearConflicts() {\n    this.entries.clear()\n  }\n\n  getEntryFromSelector(selector: string): TypeConflictEntry {\n    let dataEntry = this.entries.get(selector)\n\n    if (!dataEntry) {\n      dataEntry = new TypeConflictEntry(selector)\n      this.entries.set(selector, dataEntry)\n    }\n\n    return dataEntry\n  }\n\n  addConflict(selector: string, examples: TypeConflictExample[]) {\n    if (selector.substring(0, 11) === `SitePlugin.`) {\n      // Don't store and print out type conflicts in plugins.\n      // This is out of user control so he can't do anything\n      // to hide those.\n      return\n    }\n\n    const entry = this.getEntryFromSelector(selector)\n    examples\n      .filter(example => example.value != null)\n      .forEach(example => entry.addExample(example))\n  }\n\n  printConflicts() {\n    if (this.entries.size > 0) {\n      report.warn(\n        `There are conflicting field types in your data. GraphQL schema will omit those fields.`\n      )\n      this.entries.forEach(entry => entry.printEntry())\n    }\n  }\n}\n\nconst typeConflictReporter = new TypeConflictReporter()\n\nconst printConflicts = () => {\n  typeConflictReporter.printConflicts()\n}\n\nmodule.exports = { typeConflictReporter, printConflicts, TypeConflictEntry }\n"],"file":"type-conflict-reporter.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/schema/type-conflict-reporter.js"],"names":["_","require","report","typeOf","util","findRootNodeAncestor","isNodeWithDescription","node","internal","description","findNodeDescription","obj","formatValue","value","isArray","inspect","colors","depth","breakLength","Infinity","wasElipsisLast","usedTypes","output","forEach","item","type","indexOf","push","join","TypeConflictEntry","constructor","selector","types","Map","addExample","parent","set","printEntry","sortedByTypeName","sortBy","Array","from","entries","typeName","log","map","TypeConflictReporter","clearConflicts","clear","getEntryFromSelector","dataEntry","get","addConflict","examples","substring","entry","filter","example","printConflicts","size","warn","typeConflictReporter","module","exports"],"mappings":"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","sourcesContent":["// @flow\nconst _ = require(`lodash`)\nconst report = require(`gatsby-cli/lib/reporter`)\nconst typeOf = require(`type-of`)\nconst util = require(`util`)\nconst { findRootNodeAncestor } = require(`../db/node-tracking`)\n\nexport type TypeConflictExample = {\n  value: mixed,\n  parent: {},\n  type: string,\n  arrayTypes: string[],\n}\n\ntype TypeConflict = {\n  value: mixed,\n  description: string,\n}\n\nconst isNodeWithDescription = node =>\n  node && node.internal && node.internal.description\n\nconst findNodeDescription = obj => {\n  if (obj) {\n    const node = findRootNodeAncestor(obj, isNodeWithDescription)\n    if (isNodeWithDescription(node)) {\n      return node.internal.description\n    }\n  }\n  return ``\n}\n\nconst formatValue = value => {\n  if (!_.isArray(value)) {\n    return util.inspect(value, {\n      colors: true,\n      depth: 0,\n      breakLength: Infinity,\n    })\n  }\n\n  let wasElipsisLast = false\n  const usedTypes = []\n  const output = []\n\n  value.forEach(item => {\n    const type = typeOf(item)\n    if (usedTypes.indexOf(type) !== -1) {\n      if (!wasElipsisLast) {\n        output.push(`...`)\n        wasElipsisLast = true\n      }\n    } else {\n      output.push(formatValue(item))\n      wasElipsisLast = false\n      usedTypes.push(type)\n    }\n  })\n\n  return `[ ${output.join(`, `)} ]`\n}\n\nclass TypeConflictEntry {\n  selector: string\n  types: Map<string, TypeConflict>\n\n  constructor(selector: string) {\n    this.selector = selector\n    this.types = new Map()\n  }\n\n  addExample({ value, type, parent }: TypeConflictExample) {\n    this.types.set(type, {\n      value,\n      description: findNodeDescription(parent),\n    })\n  }\n\n  printEntry() {\n    const sortedByTypeName = _.sortBy(\n      Array.from(this.types.entries()),\n      ([typeName, value]) => typeName\n    )\n\n    report.log(\n      `${this.selector}:${sortedByTypeName\n        .map(\n          ([typeName, { value, description }]) =>\n            `\\n - type: ${typeName}\\n   value: ${formatValue(\n              value\n            )}${description && `\\n   source: ${description}`}`\n        )\n        .join(``)}`\n    )\n  }\n}\n\nclass TypeConflictReporter {\n  entries: Map<string, TypeConflictEntry>\n\n  constructor() {\n    this.entries = new Map()\n  }\n\n  clearConflicts() {\n    this.entries.clear()\n  }\n\n  getEntryFromSelector(selector: string): TypeConflictEntry {\n    let dataEntry = this.entries.get(selector)\n\n    if (!dataEntry) {\n      dataEntry = new TypeConflictEntry(selector)\n      this.entries.set(selector, dataEntry)\n    }\n\n    return dataEntry\n  }\n\n  addConflict(selector: string, examples: TypeConflictExample[]) {\n    if (selector.substring(0, 11) === `SitePlugin.`) {\n      // Don't store and print out type conflicts in plugins.\n      // This is out of user control so he can't do anything\n      // to hide those.\n      return\n    }\n\n    const entry = this.getEntryFromSelector(selector)\n    examples\n      .filter(example => example.value != null)\n      .forEach(example => entry.addExample(example))\n  }\n\n  printConflicts() {\n    if (this.entries.size > 0) {\n      report.warn(\n        `There are conflicting field types in your data. GraphQL schema will omit those fields.`\n      )\n      this.entries.forEach(entry => entry.printEntry())\n    }\n  }\n}\n\nconst typeConflictReporter = new TypeConflictReporter()\n\nconst printConflicts = () => {\n  typeConflictReporter.printConflicts()\n}\n\nmodule.exports = { typeConflictReporter, printConflicts, TypeConflictEntry }\n"],"file":"type-conflict-reporter.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/schema/types/type-date.js
+++ b/node_modules/gatsby/dist/schema/types/type-date.js
@@ -7,16 +7,18 @@ exports.GraphQLDate = void 0;
 
 const moment = require(`moment`);
 
-const _require = require(`graphql`),
-      GraphQLString = _require.GraphQLString,
-      GraphQLBoolean = _require.GraphQLBoolean,
-      GraphQLScalarType = _require.GraphQLScalarType,
-      Kind = _require.Kind;
+const {
+  GraphQLString,
+  GraphQLBoolean,
+  GraphQLScalarType,
+  Kind
+} = require(`graphql`);
 
 const _ = require(`lodash`);
 
-const _require2 = require(`common-tags`),
-      oneLine = _require2.oneLine;
+const {
+  oneLine
+} = require(`common-tags`);
 
 const ISO_8601_FORMAT = [`YYYY`, `YYYY-MM`, `YYYY-MM-DD`, `YYYYMMDD`, // Local Time
 `YYYY-MM-DDTHH`, `YYYY-MM-DDTHH:mm`, `YYYY-MM-DDTHHmm`, `YYYY-MM-DDTHH:mm:ss`, `YYYY-MM-DDTHHmmss`, `YYYY-MM-DDTHH:mm:ss.SSS`, `YYYY-MM-DDTHHmmss.SSS`, // Coordinated Universal Time (UTC)
@@ -85,11 +87,12 @@ const type = Object.freeze({
     }
 
     if (_.isPlainObject(args)) {
-      const fromNow = args.fromNow,
-            difference = args.difference,
-            formatString = args.formatString,
-            _args$locale = args.locale,
-            locale = _args$locale === void 0 ? `en` : _args$locale;
+      const {
+        fromNow,
+        difference,
+        formatString,
+        locale = `en`
+      } = args;
 
       if (formatString) {
         return moment.utc(date, ISO_8601_FORMAT, true).locale(locale).format(formatString);
--- a/node_modules/gatsby/dist/schema/types/type-date.js.map
+++ b/node_modules/gatsby/dist/schema/types/type-date.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../../src/schema/types/type-date.js"],"names":["moment","require","GraphQLString","GraphQLBoolean","GraphQLScalarType","Kind","_","oneLine","ISO_8601_FORMAT","shouldInfer","value","momentDate","utc","isValid","GraphQLDate","name","description","serialize","String","parseValue","parseLiteral","ast","kind","STRING","undefined","type","Object","freeze","args","formatString","fromNow","difference","locale","resolve","source","context","fieldName","date","JSON","parse","stringify","isPlainObject","format","diff","getType"],"mappings":";;;;;;;AAAA,MAAMA,MAAM,GAAGC,OAAO,CAAE,QAAF,CAAtB;;iBAMIA,OAAO,CAAE,SAAF,C;MAJTC,a,YAAAA,a;MACAC,c,YAAAA,c;MACAC,iB,YAAAA,iB;MACAC,I,YAAAA,I;;AAEF,MAAMC,CAAC,GAAGL,OAAO,CAAE,QAAF,CAAjB;;kBACoBA,OAAO,CAAE,aAAF,C;MAAnBM,O,aAAAA,O;;AAER,MAAMC,eAAe,GAAG,CACrB,MADqB,EAErB,SAFqB,EAGrB,YAHqB,EAIrB,UAJqB,EAMtB;AACC,eAPqB,EAQrB,kBARqB,EASrB,iBATqB,EAUrB,qBAVqB,EAWrB,mBAXqB,EAYrB,yBAZqB,EAarB,uBAbqB,EAetB;AACC,gBAhBqB,EAiBrB,mBAjBqB,EAkBrB,kBAlBqB,EAmBrB,sBAnBqB,EAoBrB,oBApBqB,EAqBrB,0BArBqB,EAsBrB,wBAtBqB,EAwBrB,YAxBqB,EAyBrB,WAzBqB,EA0BrB,cA1BqB,EA2BrB,YA3BqB,EA4BrB,WA5BqB,EA6BrB,UA7BqB,CAAxB,C,CAgCA;AACA;;AACO,SAASC,WAAT,CAAqBC,KAArB,EAA4B;AACjC,QAAMC,UAAU,GAAGX,MAAM,CAACY,GAAP,CAAWF,KAAX,EAAkBF,eAAlB,EAAmC,IAAnC,CAAnB;AACA,SAAOG,UAAU,CAACE,OAAX,MAAwB,OAAOH,KAAP,KAAkB,QAAjD;AACD;;AAEM,MAAMI,WAAW,GAAG,IAAIV,iBAAJ,CAAsB;AAC/CW,EAAAA,IAAI,EAAG,MADwC;AAE/CC,EAAAA,WAAW,EAAET,OAAQ;;wEAF0B;AAK/CU,EAAAA,SAAS,EAAEC,MALoC;AAM/CC,EAAAA,UAAU,EAAED,MANmC;;AAO/CE,EAAAA,YAAY,CAACC,GAAD,EAAM;AAChB,WAAOA,GAAG,CAACC,IAAJ,KAAajB,IAAI,CAACkB,MAAlB,GAA2BF,GAAG,CAACX,KAA/B,GAAuCc,SAA9C;AACD;;AAT8C,CAAtB,CAApB;;AAYP,MAAMC,IAAI,GAAGC,MAAM,CAACC,MAAP,CAAc;AACzBF,EAAAA,IAAI,EAAEX,WADmB;AAEzBc,EAAAA,IAAI,EAAE;AACJC,IAAAA,YAAY,EAAE;AACZJ,MAAAA,IAAI,EAAEvB,aADM;AAEZc,MAAAA,WAAW,EAAET,OAAQ;;;;;AAFT,KADV;AASJuB,IAAAA,OAAO,EAAE;AACPL,MAAAA,IAAI,EAAEtB,cADC;AAEPa,MAAAA,WAAW,EAAET,OAAQ;;AAFd,KATL;AAcJwB,IAAAA,UAAU,EAAE;AACVN,MAAAA,IAAI,EAAEvB,aADI;AAEVc,MAAAA,WAAW,EAAET,OAAQ;;;;;AAFX,KAdR;AAsBJyB,IAAAA,MAAM,EAAE;AACNP,MAAAA,IAAI,EAAEvB,aADA;AAENc,MAAAA,WAAW,EAAET,OAAQ;;AAFf;AAtBJ,GAFmB;;AA8BzB0B,EAAAA,OAAO,CAACC,MAAD,EAASN,IAAT,EAAeO,OAAf,EAAwB;AAAEC,IAAAA;AAAF,GAAxB,EAAuC;AAC5C,QAAIC,IAAJ;;AACA,QAAIH,MAAM,CAACE,SAAD,CAAV,EAAuB;AACrBC,MAAAA,IAAI,GAAGC,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,SAAL,CAAeN,MAAM,CAACE,SAAD,CAArB,CAAX,CAAP;AACD,KAFD,MAEO;AACL,aAAO,IAAP;AACD;;AAED,QAAI9B,CAAC,CAACmC,aAAF,CAAgBb,IAAhB,CAAJ,EAA2B;AAAA,YACjBE,OADiB,GACoCF,IADpC,CACjBE,OADiB;AAAA,YACRC,UADQ,GACoCH,IADpC,CACRG,UADQ;AAAA,YACIF,YADJ,GACoCD,IADpC,CACIC,YADJ;AAAA,2BACoCD,IADpC,CACkBI,MADlB;AAAA,YACkBA,MADlB,6BAC4B,IAD5B;;AAEzB,UAAIH,YAAJ,EAAkB;AAChB,eAAO7B,MAAM,CACVY,GADI,CACAyB,IADA,EACM7B,eADN,EACuB,IADvB,EAEJwB,MAFI,CAEGA,MAFH,EAGJU,MAHI,CAGGb,YAHH,CAAP;AAID,OALD,MAKO,IAAIC,OAAJ,EAAa;AAClB,eAAO9B,MAAM,CACVY,GADI,CACAyB,IADA,EACM7B,eADN,EACuB,IADvB,EAEJwB,MAFI,CAEGA,MAFH,EAGJF,OAHI,EAAP;AAID,OALM,MAKA,IAAIC,UAAJ,EAAgB;AACrB,eAAO/B,MAAM,GAAG2C,IAAT,CACL3C,MAAM,CAACY,GAAP,CAAWyB,IAAX,EAAiB7B,eAAjB,EAAkC,IAAlC,EAAwCwB,MAAxC,CAA+CA,MAA/C,CADK,EAELD,UAFK,CAAP;AAID;AACF;;AAED,WAAOM,IAAP;AACD;;AA3DwB,CAAd,CAAb;;AA8DO,SAASO,OAAT,GAAmB;AACxB,SAAOnB,IAAP;AACD","sourcesContent":["const moment = require(`moment`)\nconst {\n  GraphQLString,\n  GraphQLBoolean,\n  GraphQLScalarType,\n  Kind,\n} = require(`graphql`)\nconst _ = require(`lodash`)\nconst { oneLine } = require(`common-tags`)\n\nconst ISO_8601_FORMAT = [\n  `YYYY`,\n  `YYYY-MM`,\n  `YYYY-MM-DD`,\n  `YYYYMMDD`,\n\n  // Local Time\n  `YYYY-MM-DDTHH`,\n  `YYYY-MM-DDTHH:mm`,\n  `YYYY-MM-DDTHHmm`,\n  `YYYY-MM-DDTHH:mm:ss`,\n  `YYYY-MM-DDTHHmmss`,\n  `YYYY-MM-DDTHH:mm:ss.SSS`,\n  `YYYY-MM-DDTHHmmss.SSS`,\n\n  // Coordinated Universal Time (UTC)\n  `YYYY-MM-DDTHHZ`,\n  `YYYY-MM-DDTHH:mmZ`,\n  `YYYY-MM-DDTHHmmZ`,\n  `YYYY-MM-DDTHH:mm:ssZ`,\n  `YYYY-MM-DDTHHmmssZ`,\n  `YYYY-MM-DDTHH:mm:ss.SSSZ`,\n  `YYYY-MM-DDTHHmmss.SSSZ`,\n\n  `YYYY-[W]WW`,\n  `YYYY[W]WW`,\n  `YYYY-[W]WW-E`,\n  `YYYY[W]WWE`,\n  `YYYY-DDDD`,\n  `YYYYDDDD`,\n]\n\n// Check if this is a date.\n// All the allowed ISO 8601 date-time formats used.\nexport function shouldInfer(value) {\n  const momentDate = moment.utc(value, ISO_8601_FORMAT, true)\n  return momentDate.isValid() && typeof value !== `number`\n}\n\nexport const GraphQLDate = new GraphQLScalarType({\n  name: `Date`,\n  description: oneLine`\n    A date string, such as 2007-12-03, compliant with the ISO 8601 standard \n    for representation of dates and times using the Gregorian calendar.`,\n  serialize: String,\n  parseValue: String,\n  parseLiteral(ast) {\n    return ast.kind === Kind.STRING ? ast.value : undefined\n  },\n})\n\nconst type = Object.freeze({\n  type: GraphQLDate,\n  args: {\n    formatString: {\n      type: GraphQLString,\n      description: oneLine`\n        Format the date using Moment.js' date tokens e.g.\n        \"date(formatString: \"YYYY MMMM DD)\"\n        See https://momentjs.com/docs/#/displaying/format/\n        for documentation for different tokens`,\n    },\n    fromNow: {\n      type: GraphQLBoolean,\n      description: oneLine`\n        Returns a string generated with Moment.js' fromNow function`,\n    },\n    difference: {\n      type: GraphQLString,\n      description: oneLine`\n        Returns the difference between this date and the current time.\n        Defaults to miliseconds but you can also pass in as the\n        measurement years, months, weeks, days, hours, minutes,\n        and seconds.`,\n    },\n    locale: {\n      type: GraphQLString,\n      description: oneLine`\n        Configures the locale Moment.js will use to format the date.`,\n    },\n  },\n  resolve(source, args, context, { fieldName }) {\n    let date\n    if (source[fieldName]) {\n      date = JSON.parse(JSON.stringify(source[fieldName]))\n    } else {\n      return null\n    }\n\n    if (_.isPlainObject(args)) {\n      const { fromNow, difference, formatString, locale = `en` } = args\n      if (formatString) {\n        return moment\n          .utc(date, ISO_8601_FORMAT, true)\n          .locale(locale)\n          .format(formatString)\n      } else if (fromNow) {\n        return moment\n          .utc(date, ISO_8601_FORMAT, true)\n          .locale(locale)\n          .fromNow()\n      } else if (difference) {\n        return moment().diff(\n          moment.utc(date, ISO_8601_FORMAT, true).locale(locale),\n          difference\n        )\n      }\n    }\n\n    return date\n  },\n})\n\nexport function getType() {\n  return type\n}\n"],"file":"type-date.js"}
\ No newline at end of file
+{"version":3,"sources":["../../../src/schema/types/type-date.js"],"names":["moment","require","GraphQLString","GraphQLBoolean","GraphQLScalarType","Kind","_","oneLine","ISO_8601_FORMAT","shouldInfer","value","momentDate","utc","isValid","GraphQLDate","name","description","serialize","String","parseValue","parseLiteral","ast","kind","STRING","undefined","type","Object","freeze","args","formatString","fromNow","difference","locale","resolve","source","context","fieldName","date","JSON","parse","stringify","isPlainObject","format","diff","getType"],"mappings":"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","sourcesContent":["const moment = require(`moment`)\nconst {\n  GraphQLString,\n  GraphQLBoolean,\n  GraphQLScalarType,\n  Kind,\n} = require(`graphql`)\nconst _ = require(`lodash`)\nconst { oneLine } = require(`common-tags`)\n\nconst ISO_8601_FORMAT = [\n  `YYYY`,\n  `YYYY-MM`,\n  `YYYY-MM-DD`,\n  `YYYYMMDD`,\n\n  // Local Time\n  `YYYY-MM-DDTHH`,\n  `YYYY-MM-DDTHH:mm`,\n  `YYYY-MM-DDTHHmm`,\n  `YYYY-MM-DDTHH:mm:ss`,\n  `YYYY-MM-DDTHHmmss`,\n  `YYYY-MM-DDTHH:mm:ss.SSS`,\n  `YYYY-MM-DDTHHmmss.SSS`,\n\n  // Coordinated Universal Time (UTC)\n  `YYYY-MM-DDTHHZ`,\n  `YYYY-MM-DDTHH:mmZ`,\n  `YYYY-MM-DDTHHmmZ`,\n  `YYYY-MM-DDTHH:mm:ssZ`,\n  `YYYY-MM-DDTHHmmssZ`,\n  `YYYY-MM-DDTHH:mm:ss.SSSZ`,\n  `YYYY-MM-DDTHHmmss.SSSZ`,\n\n  `YYYY-[W]WW`,\n  `YYYY[W]WW`,\n  `YYYY-[W]WW-E`,\n  `YYYY[W]WWE`,\n  `YYYY-DDDD`,\n  `YYYYDDDD`,\n]\n\n// Check if this is a date.\n// All the allowed ISO 8601 date-time formats used.\nexport function shouldInfer(value) {\n  const momentDate = moment.utc(value, ISO_8601_FORMAT, true)\n  return momentDate.isValid() && typeof value !== `number`\n}\n\nexport const GraphQLDate = new GraphQLScalarType({\n  name: `Date`,\n  description: oneLine`\n    A date string, such as 2007-12-03, compliant with the ISO 8601 standard \n    for representation of dates and times using the Gregorian calendar.`,\n  serialize: String,\n  parseValue: String,\n  parseLiteral(ast) {\n    return ast.kind === Kind.STRING ? ast.value : undefined\n  },\n})\n\nconst type = Object.freeze({\n  type: GraphQLDate,\n  args: {\n    formatString: {\n      type: GraphQLString,\n      description: oneLine`\n        Format the date using Moment.js' date tokens e.g.\n        \"date(formatString: \"YYYY MMMM DD)\"\n        See https://momentjs.com/docs/#/displaying/format/\n        for documentation for different tokens`,\n    },\n    fromNow: {\n      type: GraphQLBoolean,\n      description: oneLine`\n        Returns a string generated with Moment.js' fromNow function`,\n    },\n    difference: {\n      type: GraphQLString,\n      description: oneLine`\n        Returns the difference between this date and the current time.\n        Defaults to miliseconds but you can also pass in as the\n        measurement years, months, weeks, days, hours, minutes,\n        and seconds.`,\n    },\n    locale: {\n      type: GraphQLString,\n      description: oneLine`\n        Configures the locale Moment.js will use to format the date.`,\n    },\n  },\n  resolve(source, args, context, { fieldName }) {\n    let date\n    if (source[fieldName]) {\n      date = JSON.parse(JSON.stringify(source[fieldName]))\n    } else {\n      return null\n    }\n\n    if (_.isPlainObject(args)) {\n      const { fromNow, difference, formatString, locale = `en` } = args\n      if (formatString) {\n        return moment\n          .utc(date, ISO_8601_FORMAT, true)\n          .locale(locale)\n          .format(formatString)\n      } else if (fromNow) {\n        return moment\n          .utc(date, ISO_8601_FORMAT, true)\n          .locale(locale)\n          .fromNow()\n      } else if (difference) {\n        return moment().diff(\n          moment.utc(date, ISO_8601_FORMAT, true).locale(locale),\n          difference\n        )\n      }\n    }\n\n    return date\n  },\n})\n\nexport function getType() {\n  return type\n}\n"],"file":"type-date.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/schema/types/type-file.js
+++ b/node_modules/gatsby/dist/schema/types/type-file.js
@@ -6,8 +6,9 @@ exports.shouldInfer = shouldInfer;
 exports.getType = getType;
 exports.getListType = getListType;
 
-const _require = require(`graphql`),
-      GraphQLList = _require.GraphQLList;
+const {
+  GraphQLList
+} = require(`graphql`);
 
 const _ = require(`lodash`);
 
@@ -21,16 +22,19 @@ const normalize = require(`normalize-path`);
 
 const systemPath = require(`path`);
 
-const _require2 = require(`../../db/nodes`),
-      getNodesByType = _require2.getNodesByType;
+const {
+  getNodesByType
+} = require(`../../db/nodes`);
 
-const _require3 = require(`../../db/node-tracking`),
-      findRootNodeAncestor = _require3.findRootNodeAncestor;
+const {
+  findRootNodeAncestor
+} = require(`../../db/node-tracking`);
 
 const pageDependencyResolver = require(`../page-dependency-resolver`);
 
-const _require4 = require(`../../utils/path`),
-      joinPath = _require4.joinPath;
+const {
+  joinPath
+} = require(`../../utils/path`);
 
 let type, listType;
 
--- a/node_modules/gatsby/dist/schema/types/type-file.js.map
+++ b/node_modules/gatsby/dist/schema/types/type-file.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../../src/schema/types/type-file.js"],"names":["require","GraphQLList","_","mime","isRelative","isRelativeUrl","normalize","systemPath","getNodesByType","findRootNodeAncestor","pageDependencyResolver","joinPath","type","listType","setFileNodeRootType","fileNodeRootType","createType","pointsToFile","nodes","key","value","looksLikeFile","isString","getType","node","find","n","get","visit","current","selector","fn","i","keys","Object","length","undefined","concat","proceed","isNormalInteger","str","test","isMatch","v","k","parent","normalizedSelector","map","s","filter","fullSelector","join","rootNode","internal","pathToOtherNode","dir","otherFileExists","some","absolutePath","shouldInfer","isEmpty","isArray","freeze","resolve","args","context","fieldName","fieldValue","findLinkedFileNode","relativePath","fileLinkPath","parentFileNode","linkedFileNode","getListType"],"mappings":"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","sourcesContent":["const { GraphQLList } = require(`graphql`)\nconst _ = require(`lodash`)\nconst mime = require(`mime`)\nconst isRelative = require(`is-relative`)\nconst isRelativeUrl = require(`is-relative-url`)\nconst normalize = require(`normalize-path`)\nconst systemPath = require(`path`)\n\nconst { getNodesByType } = require(`../../db/nodes`)\nconst { findRootNodeAncestor } = require(`../../db/node-tracking`)\nconst pageDependencyResolver = require(`../page-dependency-resolver`)\nconst { joinPath } = require(`../../utils/path`)\n\nlet type, listType\n\nexport function setFileNodeRootType(fileNodeRootType) {\n  if (fileNodeRootType) {\n    type = createType(fileNodeRootType, false)\n    listType = createType(fileNodeRootType, true)\n  } else {\n    type = null\n    listType = null\n  }\n}\n\nfunction pointsToFile(nodes, key, value) {\n  const looksLikeFile =\n    _.isString(value) &&\n    mime.getType(value) !== null &&\n    // domains ending with .com\n    mime.getType(value) !== `application/x-msdownload` &&\n    isRelative(value) &&\n    isRelativeUrl(value)\n\n  if (!looksLikeFile) {\n    return false\n  }\n\n  // Find the node used for this example.\n  let node = nodes.find(n => _.get(n, key) === value)\n\n  if (!node) {\n    // Try another search as our \"key\" isn't always correct e.g.\n    // it doesn't support arrays so the right key could be \"a.b[0].c\" but\n    // this function will get \"a.b.c\".\n    //\n    // We loop through every value of nodes until we find\n    // a match.\n    const visit = (current, selector = [], fn) => {\n      for (let i = 0, keys = Object.keys(current); i < keys.length; i++) {\n        const key = keys[i]\n        const value = current[key]\n\n        if (value === undefined || value === null) continue\n\n        if (typeof value === `object` || typeof value === `function`) {\n          visit(current[key], selector.concat([key]), fn)\n          continue\n        }\n\n        let proceed = fn(current[key], key, selector, current)\n\n        if (proceed === false) {\n          break\n        }\n      }\n    }\n\n    const isNormalInteger = str => /^\\+?(0|[1-9]\\d*)$/.test(str)\n\n    node = nodes.find(n => {\n      let isMatch = false\n      visit(n, [], (v, k, selector, parent) => {\n        if (v === value) {\n          // Remove integers as they're for arrays, which our passed\n          // in object path doesn't have.\n          const normalizedSelector = selector\n            .map(s => (isNormalInteger(s) ? `` : s))\n            .filter(s => s !== ``)\n          const fullSelector = `${normalizedSelector.join(`.`)}.${k}`\n          if (fullSelector === key) {\n            isMatch = true\n            return false\n          }\n        }\n\n        // Not a match so we continue\n        return true\n      })\n\n      return isMatch\n    })\n\n    // Still no node.\n    if (!node) {\n      return false\n    }\n  }\n\n  const rootNode = findRootNodeAncestor(node)\n\n  // Only nodes transformed (ultimately) from a File\n  // can link to another File.\n  if (rootNode.internal.type !== `File`) {\n    return false\n  }\n\n  const pathToOtherNode = normalize(joinPath(rootNode.dir, value))\n  const otherFileExists = getNodesByType(`File`).some(\n    n => n.absolutePath === pathToOtherNode\n  )\n  return otherFileExists\n}\n\nexport function shouldInfer(nodes, selector, value) {\n  return (\n    nodes[0].internal.type !== `File` &&\n    ((_.isString(value) &&\n      !_.isEmpty(value) &&\n      pointsToFile(nodes, selector, value)) ||\n      (_.isArray(value) &&\n        _.isString(value[0]) &&\n        !_.isEmpty(value[0]) &&\n        pointsToFile(nodes, `${selector}[0]`, value[0])))\n  )\n}\n\nfunction createType(fileNodeRootType, isArray) {\n  if (!fileNodeRootType) return null\n\n  return Object.freeze({\n    type: isArray ? new GraphQLList(fileNodeRootType) : fileNodeRootType,\n    resolve: pageDependencyResolver((node, args, context, { fieldName }) => {\n      let fieldValue = node[fieldName]\n\n      if (!fieldValue) {\n        return null\n      }\n\n      const findLinkedFileNode = relativePath => {\n        // Use the parent File node to create the absolute path to\n        // the linked file.\n        const fileLinkPath = normalize(\n          systemPath.resolve(parentFileNode.dir, relativePath)\n        )\n\n        // Use that path to find the linked File node.\n        const linkedFileNode = _.find(\n          getNodesByType(`File`),\n          n => n.absolutePath === fileLinkPath\n        )\n        return linkedFileNode\n      }\n\n      // Find the File node for this node (we assume the node is something\n      // like markdown which would be a child node of a File node).\n      const parentFileNode = findRootNodeAncestor(node)\n\n      // Find the linked File node(s)\n      if (isArray) {\n        return fieldValue.map(findLinkedFileNode)\n      } else {\n        return findLinkedFileNode(fieldValue)\n      }\n    }),\n  })\n}\n\nexport function getType() {\n  return type\n}\n\nexport function getListType() {\n  return listType\n}\n"],"file":"type-file.js"}
\ No newline at end of file
+{"version":3,"sources":["../../../src/schema/types/type-file.js"],"names":["GraphQLList","require","_","mime","isRelative","isRelativeUrl","normalize","systemPath","getNodesByType","findRootNodeAncestor","pageDependencyResolver","joinPath","type","listType","setFileNodeRootType","fileNodeRootType","createType","pointsToFile","nodes","key","value","looksLikeFile","isString","getType","node","find","n","get","visit","current","selector","fn","i","keys","Object","length","undefined","concat","proceed","isNormalInteger","str","test","isMatch","v","k","parent","normalizedSelector","map","s","filter","fullSelector","join","rootNode","internal","pathToOtherNode","dir","otherFileExists","some","absolutePath","shouldInfer","isEmpty","isArray","freeze","resolve","args","context","fieldName","fieldValue","findLinkedFileNode","relativePath","fileLinkPath","parentFileNode","linkedFileNode","getListType"],"mappings":"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","sourcesContent":["const { GraphQLList } = require(`graphql`)\nconst _ = require(`lodash`)\nconst mime = require(`mime`)\nconst isRelative = require(`is-relative`)\nconst isRelativeUrl = require(`is-relative-url`)\nconst normalize = require(`normalize-path`)\nconst systemPath = require(`path`)\n\nconst { getNodesByType } = require(`../../db/nodes`)\nconst { findRootNodeAncestor } = require(`../../db/node-tracking`)\nconst pageDependencyResolver = require(`../page-dependency-resolver`)\nconst { joinPath } = require(`../../utils/path`)\n\nlet type, listType\n\nexport function setFileNodeRootType(fileNodeRootType) {\n  if (fileNodeRootType) {\n    type = createType(fileNodeRootType, false)\n    listType = createType(fileNodeRootType, true)\n  } else {\n    type = null\n    listType = null\n  }\n}\n\nfunction pointsToFile(nodes, key, value) {\n  const looksLikeFile =\n    _.isString(value) &&\n    mime.getType(value) !== null &&\n    // domains ending with .com\n    mime.getType(value) !== `application/x-msdownload` &&\n    isRelative(value) &&\n    isRelativeUrl(value)\n\n  if (!looksLikeFile) {\n    return false\n  }\n\n  // Find the node used for this example.\n  let node = nodes.find(n => _.get(n, key) === value)\n\n  if (!node) {\n    // Try another search as our \"key\" isn't always correct e.g.\n    // it doesn't support arrays so the right key could be \"a.b[0].c\" but\n    // this function will get \"a.b.c\".\n    //\n    // We loop through every value of nodes until we find\n    // a match.\n    const visit = (current, selector = [], fn) => {\n      for (let i = 0, keys = Object.keys(current); i < keys.length; i++) {\n        const key = keys[i]\n        const value = current[key]\n\n        if (value === undefined || value === null) continue\n\n        if (typeof value === `object` || typeof value === `function`) {\n          visit(current[key], selector.concat([key]), fn)\n          continue\n        }\n\n        let proceed = fn(current[key], key, selector, current)\n\n        if (proceed === false) {\n          break\n        }\n      }\n    }\n\n    const isNormalInteger = str => /^\\+?(0|[1-9]\\d*)$/.test(str)\n\n    node = nodes.find(n => {\n      let isMatch = false\n      visit(n, [], (v, k, selector, parent) => {\n        if (v === value) {\n          // Remove integers as they're for arrays, which our passed\n          // in object path doesn't have.\n          const normalizedSelector = selector\n            .map(s => (isNormalInteger(s) ? `` : s))\n            .filter(s => s !== ``)\n          const fullSelector = `${normalizedSelector.join(`.`)}.${k}`\n          if (fullSelector === key) {\n            isMatch = true\n            return false\n          }\n        }\n\n        // Not a match so we continue\n        return true\n      })\n\n      return isMatch\n    })\n\n    // Still no node.\n    if (!node) {\n      return false\n    }\n  }\n\n  const rootNode = findRootNodeAncestor(node)\n\n  // Only nodes transformed (ultimately) from a File\n  // can link to another File.\n  if (rootNode.internal.type !== `File`) {\n    return false\n  }\n\n  const pathToOtherNode = normalize(joinPath(rootNode.dir, value))\n  const otherFileExists = getNodesByType(`File`).some(\n    n => n.absolutePath === pathToOtherNode\n  )\n  return otherFileExists\n}\n\nexport function shouldInfer(nodes, selector, value) {\n  return (\n    nodes[0].internal.type !== `File` &&\n    ((_.isString(value) &&\n      !_.isEmpty(value) &&\n      pointsToFile(nodes, selector, value)) ||\n      (_.isArray(value) &&\n        _.isString(value[0]) &&\n        !_.isEmpty(value[0]) &&\n        pointsToFile(nodes, `${selector}[0]`, value[0])))\n  )\n}\n\nfunction createType(fileNodeRootType, isArray) {\n  if (!fileNodeRootType) return null\n\n  return Object.freeze({\n    type: isArray ? new GraphQLList(fileNodeRootType) : fileNodeRootType,\n    resolve: pageDependencyResolver((node, args, context, { fieldName }) => {\n      let fieldValue = node[fieldName]\n\n      if (!fieldValue) {\n        return null\n      }\n\n      const findLinkedFileNode = relativePath => {\n        // Use the parent File node to create the absolute path to\n        // the linked file.\n        const fileLinkPath = normalize(\n          systemPath.resolve(parentFileNode.dir, relativePath)\n        )\n\n        // Use that path to find the linked File node.\n        const linkedFileNode = _.find(\n          getNodesByType(`File`),\n          n => n.absolutePath === fileLinkPath\n        )\n        return linkedFileNode\n      }\n\n      // Find the File node for this node (we assume the node is something\n      // like markdown which would be a child node of a File node).\n      const parentFileNode = findRootNodeAncestor(node)\n\n      // Find the linked File node(s)\n      if (isArray) {\n        return fieldValue.map(findLinkedFileNode)\n      } else {\n        return findLinkedFileNode(fieldValue)\n      }\n    }),\n  })\n}\n\nexport function getType() {\n  return type\n}\n\nexport function getListType() {\n  return listType\n}\n"],"file":"type-file.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/utils/api-runner-node.js
+++ b/node_modules/gatsby/dist/utils/api-runner-node.js
@@ -1,9 +1,5 @@
 "use strict";
 
-var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
-
-var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
-
 const Promise = require(`bluebird`);
 
 const glob = require(`glob`);
@@ -28,7 +24,9 @@ let caches = new Map(); // Bind action creators per plugin so we can auto-add
 const boundPluginActionCreators = {};
 
 const doubleBind = (boundActionCreators, api, plugin, actionOptions) => {
-  const traceId = actionOptions.traceId;
+  const {
+    traceId
+  } = actionOptions;
 
   if (boundPluginActionCreators[plugin.name + api + traceId]) {
     return boundPluginActionCreators[plugin.name + api + traceId];
@@ -86,24 +84,27 @@ const runAPI = (plugin, api, args) => {
     pluginSpan.setTag(`plugin`, plugin.name);
     let pathPrefix = ``;
 
-    const _require = require(`../redux`),
-          store = _require.store,
-          emitter = _require.emitter;
+    const {
+      store,
+      emitter
+    } = require(`../redux`);
 
-    const _require2 = require(`../db/nodes`),
-          loadNodeContent = _require2.loadNodeContent,
-          getNodes = _require2.getNodes,
-          getNode = _require2.getNode,
-          getNodesByType = _require2.getNodesByType,
-          hasNodeChanged = _require2.hasNodeChanged,
-          getNodeAndSavePathDependency = _require2.getNodeAndSavePathDependency;
+    const {
+      loadNodeContent,
+      getNodes,
+      getNode,
+      getNodesByType,
+      hasNodeChanged,
+      getNodeAndSavePathDependency
+    } = require(`../db/nodes`);
 
-    const _require3 = require(`../redux/actions`),
-          boundActionCreators = _require3.boundActionCreators;
+    const {
+      boundActionCreators
+    } = require(`../redux/actions`);
 
-    const doubleBoundActionCreators = doubleBind(boundActionCreators, api, plugin, Object.assign({}, args, {
+    const doubleBoundActionCreators = doubleBind(boundActionCreators, api, plugin, { ...args,
       parentSpan: pluginSpan
-    }));
+    });
 
     if (store.getState().program.prefixPaths) {
       pathPrefix = store.getState().config.pathPrefix;
@@ -121,7 +122,7 @@ const runAPI = (plugin, api, args) => {
       caches.set(plugin.name, cache);
     }
 
-    const apiCallArgs = [Object.assign({}, args, {
+    const apiCallArgs = [{ ...args,
       pathPrefix,
       boundActionCreators: doubleBoundActionCreators,
       actions: doubleBoundActionCreators,
@@ -138,7 +139,7 @@ const runAPI = (plugin, api, args) => {
       createNodeId: namespacedCreateNodeId,
       createContentDigest,
       tracing
-    }), plugin.pluginOptions]; // If the plugin is using a callback use that otherwise
+    }, plugin.pluginOptions]; // If the plugin is using a callback use that otherwise
     // expect a Promise to be returned.
 
     if (gatsbyNode[api].length === 3) {
@@ -168,142 +169,136 @@ let apisRunningById = new Map();
 let apisRunningByTraceId = new Map();
 let waitingForCasacadeToFinish = [];
 
-module.exports =
-/*#__PURE__*/
-function () {
-  var _ref = (0, _asyncToGenerator2.default)(function* (api, args = {}, pluginSource) {
-    return new Promise(resolve => {
-      const parentSpan = args.parentSpan;
-      const apiSpanArgs = parentSpan ? {
-        childOf: parentSpan
-      } : {};
-      const apiSpan = tracer.startSpan(`run-api`, apiSpanArgs);
-      apiSpan.setTag(`api`, api);
+module.exports = async (api, args = {}, pluginSource) => new Promise(resolve => {
+  const {
+    parentSpan
+  } = args;
+  const apiSpanArgs = parentSpan ? {
+    childOf: parentSpan
+  } : {};
+  const apiSpan = tracer.startSpan(`run-api`, apiSpanArgs);
+  apiSpan.setTag(`api`, api);
 
-      _.forEach(args.traceTags, (value, key) => {
-        apiSpan.setTag(key, value);
-      }); // Check that the API is documented.
+  _.forEach(args.traceTags, (value, key) => {
+    apiSpan.setTag(key, value);
+  }); // Check that the API is documented.
 
 
-      if (!apiList[api]) {
-        reporter.panic(`api: "${api}" is not a valid Gatsby api`);
-      }
+  if (!apiList[api]) {
+    reporter.panic(`api: "${api}" is not a valid Gatsby api`);
+  }
 
-      const _require4 = require(`../redux`),
-            store = _require4.store;
+  const {
+    store
+  } = require(`../redux`);
 
-      const plugins = store.getState().flattenedPlugins; // Get the list of plugins that implement gatsby-node
+  const plugins = store.getState().flattenedPlugins; // Get the list of plugins that implement gatsby-node
 
-      if (!filteredPlugins) {
-        filteredPlugins = plugins.filter(plugin => hasAPIFile(plugin));
-      } // Break infinite loops.
-      // Sometimes a plugin will implement an API and call an
-      // action which will trigger the same API being called.
-      // "onCreatePage" is the only example right now.
-      // In these cases, we should avoid calling the originating plugin
-      // again.
+  if (!filteredPlugins) {
+    filteredPlugins = plugins.filter(plugin => hasAPIFile(plugin));
+  } // Break infinite loops.
+  // Sometimes a plugin will implement an API and call an
+  // action which will trigger the same API being called.
+  // "onCreatePage" is the only example right now.
+  // In these cases, we should avoid calling the originating plugin
+  // again.
 
 
-      let noSourcePluginPlugins = filteredPlugins;
+  let noSourcePluginPlugins = filteredPlugins;
 
-      if (pluginSource) {
-        noSourcePluginPlugins = filteredPlugins.filter(p => p.name !== pluginSource);
-      }
+  if (pluginSource) {
+    noSourcePluginPlugins = filteredPlugins.filter(p => p.name !== pluginSource);
+  }
 
-      const apiRunInstance = {
-        api,
-        args,
-        pluginSource,
-        resolve,
-        span: apiSpan,
-        startTime: new Date().toJSON(),
-        traceId: args.traceId // Generate IDs for api runs. Most IDs we generate from the args
-        // but some API calls can have very large argument objects so we
-        // have special ways of generating IDs for those to avoid stringifying
-        // large objects.
-
-      };
-      let id;
-
-      if (api === `setFieldsOnGraphQLNodeType`) {
-        id = `${api}${apiRunInstance.startTime}${args.type.name}${args.traceId}`;
-      } else if (api === `onCreateNode`) {
-        id = `${api}${apiRunInstance.startTime}${args.node.internal.contentDigest}${args.traceId}`;
-      } else if (api === `preprocessSource`) {
-        id = `${api}${apiRunInstance.startTime}${args.filename}${args.traceId}`;
-      } else if (api === `onCreatePage`) {
-        id = `${api}${apiRunInstance.startTime}${args.page.path}${args.traceId}`;
-      } else {
-        id = `${api}|${apiRunInstance.startTime}|${apiRunInstance.traceId}|${JSON.stringify(args)}`;
-      }
+  const apiRunInstance = {
+    api,
+    args,
+    pluginSource,
+    resolve,
+    span: apiSpan,
+    startTime: new Date().toJSON(),
+    traceId: args.traceId // Generate IDs for api runs. Most IDs we generate from the args
+    // but some API calls can have very large argument objects so we
+    // have special ways of generating IDs for those to avoid stringifying
+    // large objects.
 
-      apiRunInstance.id = id;
+  };
+  let id;
+
+  if (api === `setFieldsOnGraphQLNodeType`) {
+    id = `${api}${apiRunInstance.startTime}${args.type.name}${args.traceId}`;
+  } else if (api === `onCreateNode`) {
+    id = `${api}${apiRunInstance.startTime}${args.node.internal.contentDigest}${args.traceId}`;
+  } else if (api === `preprocessSource`) {
+    id = `${api}${apiRunInstance.startTime}${args.filename}${args.traceId}`;
+  } else if (api === `onCreatePage`) {
+    id = `${api}${apiRunInstance.startTime}${args.page.path}${args.traceId}`;
+  } else {
+    id = `${api}|${apiRunInstance.startTime}|${apiRunInstance.traceId}|${JSON.stringify(args)}`;
+  }
 
-      if (args.waitForCascadingActions) {
-        waitingForCasacadeToFinish.push(apiRunInstance);
-      }
+  apiRunInstance.id = id;
 
-      apisRunningById.set(apiRunInstance.id, apiRunInstance);
+  if (args.waitForCascadingActions) {
+    waitingForCasacadeToFinish.push(apiRunInstance);
+  }
+
+  apisRunningById.set(apiRunInstance.id, apiRunInstance);
+
+  if (apisRunningByTraceId.has(apiRunInstance.traceId)) {
+    const currentCount = apisRunningByTraceId.get(apiRunInstance.traceId);
+    apisRunningByTraceId.set(apiRunInstance.traceId, currentCount + 1);
+  } else {
+    apisRunningByTraceId.set(apiRunInstance.traceId, 1);
+  }
+
+  Promise.mapSeries(noSourcePluginPlugins, plugin => {
+    let pluginName = plugin.name === `default-site-plugin` ? `gatsby-node.js` : `Plugin ${plugin.name}`;
+    return new Promise(resolve => {
+      resolve(runAPI(plugin, api, { ...args,
+        parentSpan: apiSpan
+      }));
+    }).catch(err => {
+      reporter.panicOnBuild(`${pluginName} returned an error`, err);
+      return null;
+    });
+  }).then(results => {
+    // Remove runner instance
+    apisRunningById.delete(apiRunInstance.id);
+    const currentCount = apisRunningByTraceId.get(apiRunInstance.traceId);
+    apisRunningByTraceId.set(apiRunInstance.traceId, currentCount - 1);
+
+    if (apisRunningById.size === 0) {
+      const {
+        emitter
+      } = require(`../redux`);
+
+      emitter.emit(`API_RUNNING_QUEUE_EMPTY`);
+    } // Filter empty results
 
-      if (apisRunningByTraceId.has(apiRunInstance.traceId)) {
-        const currentCount = apisRunningByTraceId.get(apiRunInstance.traceId);
-        apisRunningByTraceId.set(apiRunInstance.traceId, currentCount + 1);
+
+    apiRunInstance.results = results.filter(result => !_.isEmpty(result)); // Filter out empty responses and return if the
+    // api caller isn't waiting for cascading actions to finish.
+
+    if (!args.waitForCascadingActions) {
+      apiSpan.finish();
+      resolve(apiRunInstance.results);
+    } // Check if any of our waiters are done.
+
+
+    waitingForCasacadeToFinish = waitingForCasacadeToFinish.filter(instance => {
+      // If none of its trace IDs are running, it's done.
+      const apisByTraceIdCount = apisRunningByTraceId.get(instance.traceId);
+
+      if (apisByTraceIdCount === 0) {
+        instance.span.finish();
+        instance.resolve(instance.results);
+        return false;
       } else {
-        apisRunningByTraceId.set(apiRunInstance.traceId, 1);
+        return true;
       }
-
-      Promise.mapSeries(noSourcePluginPlugins, plugin => {
-        let pluginName = plugin.name === `default-site-plugin` ? `gatsby-node.js` : `Plugin ${plugin.name}`;
-        return new Promise(resolve => {
-          resolve(runAPI(plugin, api, Object.assign({}, args, {
-            parentSpan: apiSpan
-          })));
-        }).catch(err => {
-          reporter.panicOnBuild(`${pluginName} returned an error`, err);
-          return null;
-        });
-      }).then(results => {
-        // Remove runner instance
-        apisRunningById.delete(apiRunInstance.id);
-        const currentCount = apisRunningByTraceId.get(apiRunInstance.traceId);
-        apisRunningByTraceId.set(apiRunInstance.traceId, currentCount - 1);
-
-        if (apisRunningById.size === 0) {
-          const _require5 = require(`../redux`),
-                emitter = _require5.emitter;
-
-          emitter.emit(`API_RUNNING_QUEUE_EMPTY`);
-        } // Filter empty results
-
-
-        apiRunInstance.results = results.filter(result => !_.isEmpty(result)); // Filter out empty responses and return if the
-        // api caller isn't waiting for cascading actions to finish.
-
-        if (!args.waitForCascadingActions) {
-          apiSpan.finish();
-          resolve(apiRunInstance.results);
-        } // Check if any of our waiters are done.
-
-
-        waitingForCasacadeToFinish = waitingForCasacadeToFinish.filter(instance => {
-          // If none of its trace IDs are running, it's done.
-          const apisByTraceIdCount = apisRunningByTraceId.get(instance.traceId);
-
-          if (apisByTraceIdCount === 0) {
-            instance.span.finish();
-            instance.resolve(instance.results);
-            return false;
-          } else {
-            return true;
-          }
-        });
-        return;
-      });
     });
+    return;
   });
-
-  return function (_x) {
-    return _ref.apply(this, arguments);
-  };
-}();
+});
 //# sourceMappingURL=api-runner-node.js.map
\ No newline at end of file
--- a/node_modules/gatsby/dist/utils/api-runner-node.js.map
+++ b/node_modules/gatsby/dist/utils/api-runner-node.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/utils/api-runner-node.js"],"names":["Promise","require","glob","_","tracer","globalTracer","reporter","Cache","apiList","createNodeId","createContentDigest","caches","Map","boundPluginActionCreators","doubleBind","boundActionCreators","api","plugin","actionOptions","traceId","name","keys","Object","doubleBoundActionCreators","i","length","key","boundActionCreator","args","initAPICallTracing","parentSpan","startSpan","spanName","spanArgs","defaultSpanArgs","childOf","merge","runAPI","gatsbyNode","resolve","spanOptions","pluginSpan","setTag","pathPrefix","store","emitter","loadNodeContent","getNodes","getNode","getNodesByType","hasNodeChanged","getNodeAndSavePathDependency","getState","program","prefixPaths","config","namespacedCreateNodeId","id","tracing","cache","get","init","set","apiCallArgs","actions","pluginOptions","fromCallback","callback","cb","err","val","finish","result","filteredPlugins","hasAPIFile","sync","apisRunningById","apisRunningByTraceId","waitingForCasacadeToFinish","module","exports","pluginSource","apiSpanArgs","apiSpan","forEach","traceTags","value","panic","plugins","flattenedPlugins","filter","noSourcePluginPlugins","p","apiRunInstance","span","startTime","Date","toJSON","type","node","internal","contentDigest","filename","page","path","JSON","stringify","waitForCascadingActions","push","has","currentCount","mapSeries","pluginName","catch","panicOnBuild","then","results","delete","size","emit","isEmpty","instance","apisByTraceIdCount"],"mappings":"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","sourcesContent":["const Promise = require(`bluebird`)\nconst glob = require(`glob`)\nconst _ = require(`lodash`)\n\nconst tracer = require(`opentracing`).globalTracer()\nconst reporter = require(`gatsby-cli/lib/reporter`)\nconst Cache = require(`./cache`)\nconst apiList = require(`./api-node-docs`)\nconst createNodeId = require(`./create-node-id`)\nconst createContentDigest = require(`./create-content-digest`)\n\nlet caches = new Map()\n\n// Bind action creators per plugin so we can auto-add\n// metadata to actions they create.\nconst boundPluginActionCreators = {}\nconst doubleBind = (boundActionCreators, api, plugin, actionOptions) => {\n  const { traceId } = actionOptions\n  if (boundPluginActionCreators[plugin.name + api + traceId]) {\n    return boundPluginActionCreators[plugin.name + api + traceId]\n  } else {\n    const keys = Object.keys(boundActionCreators)\n    const doubleBoundActionCreators = {}\n    for (let i = 0; i < keys.length; i++) {\n      const key = keys[i]\n      const boundActionCreator = boundActionCreators[key]\n      if (typeof boundActionCreator === `function`) {\n        doubleBoundActionCreators[key] = (...args) => {\n          // Let action callers override who the plugin is. Shouldn't be\n          // used that often.\n          if (args.length === 1) {\n            boundActionCreator(args[0], plugin, actionOptions)\n          } else if (args.length === 2) {\n            boundActionCreator(args[0], args[1], actionOptions)\n          }\n        }\n      }\n    }\n    boundPluginActionCreators[\n      plugin.name + api + traceId\n    ] = doubleBoundActionCreators\n    return doubleBoundActionCreators\n  }\n}\n\nconst initAPICallTracing = parentSpan => {\n  const startSpan = (spanName, spanArgs = {}) => {\n    const defaultSpanArgs = { childOf: parentSpan }\n\n    return tracer.startSpan(spanName, _.merge(defaultSpanArgs, spanArgs))\n  }\n\n  return {\n    tracer,\n    parentSpan,\n    startSpan,\n  }\n}\n\nconst runAPI = (plugin, api, args) => {\n  const gatsbyNode = require(`${plugin.resolve}/gatsby-node`)\n  if (gatsbyNode[api]) {\n    const parentSpan = args && args.parentSpan\n    const spanOptions = parentSpan ? { childOf: parentSpan } : {}\n    const pluginSpan = tracer.startSpan(`run-plugin`, spanOptions)\n\n    pluginSpan.setTag(`api`, api)\n    pluginSpan.setTag(`plugin`, plugin.name)\n\n    let pathPrefix = ``\n    const { store, emitter } = require(`../redux`)\n    const {\n      loadNodeContent,\n      getNodes,\n      getNode,\n      getNodesByType,\n      hasNodeChanged,\n      getNodeAndSavePathDependency,\n    } = require(`../db/nodes`)\n    const { boundActionCreators } = require(`../redux/actions`)\n\n    const doubleBoundActionCreators = doubleBind(\n      boundActionCreators,\n      api,\n      plugin,\n      { ...args, parentSpan: pluginSpan }\n    )\n\n    if (store.getState().program.prefixPaths) {\n      pathPrefix = store.getState().config.pathPrefix\n    }\n\n    const namespacedCreateNodeId = id => createNodeId(id, plugin.name)\n\n    const tracing = initAPICallTracing(pluginSpan)\n\n    let cache = caches.get(plugin.name)\n    if (!cache) {\n      cache = new Cache({ name: plugin.name }).init()\n      caches.set(plugin.name, cache)\n    }\n\n    const apiCallArgs = [\n      {\n        ...args,\n        pathPrefix,\n        boundActionCreators: doubleBoundActionCreators,\n        actions: doubleBoundActionCreators,\n        loadNodeContent,\n        store,\n        emitter,\n        getNodes,\n        getNode,\n        getNodesByType,\n        hasNodeChanged,\n        reporter,\n        getNodeAndSavePathDependency,\n        cache,\n        createNodeId: namespacedCreateNodeId,\n        createContentDigest,\n        tracing,\n      },\n      plugin.pluginOptions,\n    ]\n\n    // If the plugin is using a callback use that otherwise\n    // expect a Promise to be returned.\n    if (gatsbyNode[api].length === 3) {\n      return Promise.fromCallback(callback => {\n        const cb = (err, val) => {\n          pluginSpan.finish()\n          callback(err, val)\n        }\n        gatsbyNode[api](...apiCallArgs, cb)\n      })\n    } else {\n      const result = gatsbyNode[api](...apiCallArgs)\n      pluginSpan.finish()\n      return Promise.resolve(result)\n    }\n  }\n\n  return null\n}\n\nlet filteredPlugins\nconst hasAPIFile = plugin => glob.sync(`${plugin.resolve}/gatsby-node*`)[0]\n\nlet apisRunningById = new Map()\nlet apisRunningByTraceId = new Map()\nlet waitingForCasacadeToFinish = []\n\nmodule.exports = async (api, args = {}, pluginSource) =>\n  new Promise(resolve => {\n    const { parentSpan } = args\n    const apiSpanArgs = parentSpan ? { childOf: parentSpan } : {}\n    const apiSpan = tracer.startSpan(`run-api`, apiSpanArgs)\n\n    apiSpan.setTag(`api`, api)\n    _.forEach(args.traceTags, (value, key) => {\n      apiSpan.setTag(key, value)\n    })\n\n    // Check that the API is documented.\n    if (!apiList[api]) {\n      reporter.panic(`api: \"${api}\" is not a valid Gatsby api`)\n    }\n\n    const { store } = require(`../redux`)\n    const plugins = store.getState().flattenedPlugins\n    // Get the list of plugins that implement gatsby-node\n    if (!filteredPlugins) {\n      filteredPlugins = plugins.filter(plugin => hasAPIFile(plugin))\n    }\n\n    // Break infinite loops.\n    // Sometimes a plugin will implement an API and call an\n    // action which will trigger the same API being called.\n    // \"onCreatePage\" is the only example right now.\n    // In these cases, we should avoid calling the originating plugin\n    // again.\n    let noSourcePluginPlugins = filteredPlugins\n    if (pluginSource) {\n      noSourcePluginPlugins = filteredPlugins.filter(\n        p => p.name !== pluginSource\n      )\n    }\n\n    const apiRunInstance = {\n      api,\n      args,\n      pluginSource,\n      resolve,\n      span: apiSpan,\n      startTime: new Date().toJSON(),\n      traceId: args.traceId,\n    }\n\n    // Generate IDs for api runs. Most IDs we generate from the args\n    // but some API calls can have very large argument objects so we\n    // have special ways of generating IDs for those to avoid stringifying\n    // large objects.\n    let id\n    if (api === `setFieldsOnGraphQLNodeType`) {\n      id = `${api}${apiRunInstance.startTime}${args.type.name}${args.traceId}`\n    } else if (api === `onCreateNode`) {\n      id = `${api}${apiRunInstance.startTime}${\n        args.node.internal.contentDigest\n      }${args.traceId}`\n    } else if (api === `preprocessSource`) {\n      id = `${api}${apiRunInstance.startTime}${args.filename}${args.traceId}`\n    } else if (api === `onCreatePage`) {\n      id = `${api}${apiRunInstance.startTime}${args.page.path}${args.traceId}`\n    } else {\n      id = `${api}|${apiRunInstance.startTime}|${\n        apiRunInstance.traceId\n      }|${JSON.stringify(args)}`\n    }\n    apiRunInstance.id = id\n\n    if (args.waitForCascadingActions) {\n      waitingForCasacadeToFinish.push(apiRunInstance)\n    }\n\n    apisRunningById.set(apiRunInstance.id, apiRunInstance)\n    if (apisRunningByTraceId.has(apiRunInstance.traceId)) {\n      const currentCount = apisRunningByTraceId.get(apiRunInstance.traceId)\n      apisRunningByTraceId.set(apiRunInstance.traceId, currentCount + 1)\n    } else {\n      apisRunningByTraceId.set(apiRunInstance.traceId, 1)\n    }\n\n    Promise.mapSeries(noSourcePluginPlugins, plugin => {\n      let pluginName =\n        plugin.name === `default-site-plugin`\n          ? `gatsby-node.js`\n          : `Plugin ${plugin.name}`\n\n      return new Promise(resolve => {\n        resolve(runAPI(plugin, api, { ...args, parentSpan: apiSpan }))\n      }).catch(err => {\n        reporter.panicOnBuild(`${pluginName} returned an error`, err)\n        return null\n      })\n    }).then(results => {\n      // Remove runner instance\n      apisRunningById.delete(apiRunInstance.id)\n      const currentCount = apisRunningByTraceId.get(apiRunInstance.traceId)\n      apisRunningByTraceId.set(apiRunInstance.traceId, currentCount - 1)\n\n      if (apisRunningById.size === 0) {\n        const { emitter } = require(`../redux`)\n        emitter.emit(`API_RUNNING_QUEUE_EMPTY`)\n      }\n\n      // Filter empty results\n      apiRunInstance.results = results.filter(result => !_.isEmpty(result))\n\n      // Filter out empty responses and return if the\n      // api caller isn't waiting for cascading actions to finish.\n      if (!args.waitForCascadingActions) {\n        apiSpan.finish()\n        resolve(apiRunInstance.results)\n      }\n\n      // Check if any of our waiters are done.\n      waitingForCasacadeToFinish = waitingForCasacadeToFinish.filter(\n        instance => {\n          // If none of its trace IDs are running, it's done.\n          const apisByTraceIdCount = apisRunningByTraceId.get(instance.traceId)\n          if (apisByTraceIdCount === 0) {\n            instance.span.finish()\n            instance.resolve(instance.results)\n            return false\n          } else {\n            return true\n          }\n        }\n      )\n      return\n    })\n  })\n"],"file":"api-runner-node.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/utils/api-runner-node.js"],"names":["Promise","require","glob","_","tracer","globalTracer","reporter","Cache","apiList","createNodeId","createContentDigest","caches","Map","boundPluginActionCreators","doubleBind","boundActionCreators","api","plugin","actionOptions","traceId","name","keys","Object","doubleBoundActionCreators","i","length","key","boundActionCreator","args","initAPICallTracing","parentSpan","startSpan","spanName","spanArgs","defaultSpanArgs","childOf","merge","runAPI","gatsbyNode","resolve","spanOptions","pluginSpan","setTag","pathPrefix","store","emitter","loadNodeContent","getNodes","getNode","getNodesByType","hasNodeChanged","getNodeAndSavePathDependency","getState","program","prefixPaths","config","namespacedCreateNodeId","id","tracing","cache","get","init","set","apiCallArgs","actions","pluginOptions","fromCallback","callback","cb","err","val","finish","result","filteredPlugins","hasAPIFile","sync","apisRunningById","apisRunningByTraceId","waitingForCasacadeToFinish","module","exports","pluginSource","apiSpanArgs","apiSpan","forEach","traceTags","value","panic","plugins","flattenedPlugins","filter","noSourcePluginPlugins","p","apiRunInstance","span","startTime","Date","toJSON","type","node","internal","contentDigest","filename","page","path","JSON","stringify","waitForCascadingActions","push","has","currentCount","mapSeries","pluginName","catch","panicOnBuild","then","results","delete","size","emit","isEmpty","instance","apisByTraceIdCount"],"mappings":"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","sourcesContent":["const Promise = require(`bluebird`)\nconst glob = require(`glob`)\nconst _ = require(`lodash`)\n\nconst tracer = require(`opentracing`).globalTracer()\nconst reporter = require(`gatsby-cli/lib/reporter`)\nconst Cache = require(`./cache`)\nconst apiList = require(`./api-node-docs`)\nconst createNodeId = require(`./create-node-id`)\nconst createContentDigest = require(`./create-content-digest`)\n\nlet caches = new Map()\n\n// Bind action creators per plugin so we can auto-add\n// metadata to actions they create.\nconst boundPluginActionCreators = {}\nconst doubleBind = (boundActionCreators, api, plugin, actionOptions) => {\n  const { traceId } = actionOptions\n  if (boundPluginActionCreators[plugin.name + api + traceId]) {\n    return boundPluginActionCreators[plugin.name + api + traceId]\n  } else {\n    const keys = Object.keys(boundActionCreators)\n    const doubleBoundActionCreators = {}\n    for (let i = 0; i < keys.length; i++) {\n      const key = keys[i]\n      const boundActionCreator = boundActionCreators[key]\n      if (typeof boundActionCreator === `function`) {\n        doubleBoundActionCreators[key] = (...args) => {\n          // Let action callers override who the plugin is. Shouldn't be\n          // used that often.\n          if (args.length === 1) {\n            boundActionCreator(args[0], plugin, actionOptions)\n          } else if (args.length === 2) {\n            boundActionCreator(args[0], args[1], actionOptions)\n          }\n        }\n      }\n    }\n    boundPluginActionCreators[\n      plugin.name + api + traceId\n    ] = doubleBoundActionCreators\n    return doubleBoundActionCreators\n  }\n}\n\nconst initAPICallTracing = parentSpan => {\n  const startSpan = (spanName, spanArgs = {}) => {\n    const defaultSpanArgs = { childOf: parentSpan }\n\n    return tracer.startSpan(spanName, _.merge(defaultSpanArgs, spanArgs))\n  }\n\n  return {\n    tracer,\n    parentSpan,\n    startSpan,\n  }\n}\n\nconst runAPI = (plugin, api, args) => {\n  const gatsbyNode = require(`${plugin.resolve}/gatsby-node`)\n  if (gatsbyNode[api]) {\n    const parentSpan = args && args.parentSpan\n    const spanOptions = parentSpan ? { childOf: parentSpan } : {}\n    const pluginSpan = tracer.startSpan(`run-plugin`, spanOptions)\n\n    pluginSpan.setTag(`api`, api)\n    pluginSpan.setTag(`plugin`, plugin.name)\n\n    let pathPrefix = ``\n    const { store, emitter } = require(`../redux`)\n    const {\n      loadNodeContent,\n      getNodes,\n      getNode,\n      getNodesByType,\n      hasNodeChanged,\n      getNodeAndSavePathDependency,\n    } = require(`../db/nodes`)\n    const { boundActionCreators } = require(`../redux/actions`)\n\n    const doubleBoundActionCreators = doubleBind(\n      boundActionCreators,\n      api,\n      plugin,\n      { ...args, parentSpan: pluginSpan }\n    )\n\n    if (store.getState().program.prefixPaths) {\n      pathPrefix = store.getState().config.pathPrefix\n    }\n\n    const namespacedCreateNodeId = id => createNodeId(id, plugin.name)\n\n    const tracing = initAPICallTracing(pluginSpan)\n\n    let cache = caches.get(plugin.name)\n    if (!cache) {\n      cache = new Cache({ name: plugin.name }).init()\n      caches.set(plugin.name, cache)\n    }\n\n    const apiCallArgs = [\n      {\n        ...args,\n        pathPrefix,\n        boundActionCreators: doubleBoundActionCreators,\n        actions: doubleBoundActionCreators,\n        loadNodeContent,\n        store,\n        emitter,\n        getNodes,\n        getNode,\n        getNodesByType,\n        hasNodeChanged,\n        reporter,\n        getNodeAndSavePathDependency,\n        cache,\n        createNodeId: namespacedCreateNodeId,\n        createContentDigest,\n        tracing,\n      },\n      plugin.pluginOptions,\n    ]\n\n    // If the plugin is using a callback use that otherwise\n    // expect a Promise to be returned.\n    if (gatsbyNode[api].length === 3) {\n      return Promise.fromCallback(callback => {\n        const cb = (err, val) => {\n          pluginSpan.finish()\n          callback(err, val)\n        }\n        gatsbyNode[api](...apiCallArgs, cb)\n      })\n    } else {\n      const result = gatsbyNode[api](...apiCallArgs)\n      pluginSpan.finish()\n      return Promise.resolve(result)\n    }\n  }\n\n  return null\n}\n\nlet filteredPlugins\nconst hasAPIFile = plugin => glob.sync(`${plugin.resolve}/gatsby-node*`)[0]\n\nlet apisRunningById = new Map()\nlet apisRunningByTraceId = new Map()\nlet waitingForCasacadeToFinish = []\n\nmodule.exports = async (api, args = {}, pluginSource) =>\n  new Promise(resolve => {\n    const { parentSpan } = args\n    const apiSpanArgs = parentSpan ? { childOf: parentSpan } : {}\n    const apiSpan = tracer.startSpan(`run-api`, apiSpanArgs)\n\n    apiSpan.setTag(`api`, api)\n    _.forEach(args.traceTags, (value, key) => {\n      apiSpan.setTag(key, value)\n    })\n\n    // Check that the API is documented.\n    if (!apiList[api]) {\n      reporter.panic(`api: \"${api}\" is not a valid Gatsby api`)\n    }\n\n    const { store } = require(`../redux`)\n    const plugins = store.getState().flattenedPlugins\n    // Get the list of plugins that implement gatsby-node\n    if (!filteredPlugins) {\n      filteredPlugins = plugins.filter(plugin => hasAPIFile(plugin))\n    }\n\n    // Break infinite loops.\n    // Sometimes a plugin will implement an API and call an\n    // action which will trigger the same API being called.\n    // \"onCreatePage\" is the only example right now.\n    // In these cases, we should avoid calling the originating plugin\n    // again.\n    let noSourcePluginPlugins = filteredPlugins\n    if (pluginSource) {\n      noSourcePluginPlugins = filteredPlugins.filter(\n        p => p.name !== pluginSource\n      )\n    }\n\n    const apiRunInstance = {\n      api,\n      args,\n      pluginSource,\n      resolve,\n      span: apiSpan,\n      startTime: new Date().toJSON(),\n      traceId: args.traceId,\n    }\n\n    // Generate IDs for api runs. Most IDs we generate from the args\n    // but some API calls can have very large argument objects so we\n    // have special ways of generating IDs for those to avoid stringifying\n    // large objects.\n    let id\n    if (api === `setFieldsOnGraphQLNodeType`) {\n      id = `${api}${apiRunInstance.startTime}${args.type.name}${args.traceId}`\n    } else if (api === `onCreateNode`) {\n      id = `${api}${apiRunInstance.startTime}${\n        args.node.internal.contentDigest\n      }${args.traceId}`\n    } else if (api === `preprocessSource`) {\n      id = `${api}${apiRunInstance.startTime}${args.filename}${args.traceId}`\n    } else if (api === `onCreatePage`) {\n      id = `${api}${apiRunInstance.startTime}${args.page.path}${args.traceId}`\n    } else {\n      id = `${api}|${apiRunInstance.startTime}|${\n        apiRunInstance.traceId\n      }|${JSON.stringify(args)}`\n    }\n    apiRunInstance.id = id\n\n    if (args.waitForCascadingActions) {\n      waitingForCasacadeToFinish.push(apiRunInstance)\n    }\n\n    apisRunningById.set(apiRunInstance.id, apiRunInstance)\n    if (apisRunningByTraceId.has(apiRunInstance.traceId)) {\n      const currentCount = apisRunningByTraceId.get(apiRunInstance.traceId)\n      apisRunningByTraceId.set(apiRunInstance.traceId, currentCount + 1)\n    } else {\n      apisRunningByTraceId.set(apiRunInstance.traceId, 1)\n    }\n\n    Promise.mapSeries(noSourcePluginPlugins, plugin => {\n      let pluginName =\n        plugin.name === `default-site-plugin`\n          ? `gatsby-node.js`\n          : `Plugin ${plugin.name}`\n\n      return new Promise(resolve => {\n        resolve(runAPI(plugin, api, { ...args, parentSpan: apiSpan }))\n      }).catch(err => {\n        reporter.panicOnBuild(`${pluginName} returned an error`, err)\n        return null\n      })\n    }).then(results => {\n      // Remove runner instance\n      apisRunningById.delete(apiRunInstance.id)\n      const currentCount = apisRunningByTraceId.get(apiRunInstance.traceId)\n      apisRunningByTraceId.set(apiRunInstance.traceId, currentCount - 1)\n\n      if (apisRunningById.size === 0) {\n        const { emitter } = require(`../redux`)\n        emitter.emit(`API_RUNNING_QUEUE_EMPTY`)\n      }\n\n      // Filter empty results\n      apiRunInstance.results = results.filter(result => !_.isEmpty(result))\n\n      // Filter out empty responses and return if the\n      // api caller isn't waiting for cascading actions to finish.\n      if (!args.waitForCascadingActions) {\n        apiSpan.finish()\n        resolve(apiRunInstance.results)\n      }\n\n      // Check if any of our waiters are done.\n      waitingForCasacadeToFinish = waitingForCasacadeToFinish.filter(\n        instance => {\n          // If none of its trace IDs are running, it's done.\n          const apisByTraceIdCount = apisRunningByTraceId.get(instance.traceId)\n          if (apisByTraceIdCount === 0) {\n            instance.span.finish()\n            instance.resolve(instance.results)\n            return false\n          } else {\n            return true\n          }\n        }\n      )\n      return\n    })\n  })\n"],"file":"api-runner-node.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/utils/babel-loader.js
+++ b/node_modules/gatsby/dist/utils/babel-loader.js
@@ -2,10 +2,11 @@
 
 const babelLoader = require(`babel-loader`);
 
-const _require = require(`./babel-loader-helpers`),
-      prepareOptions = _require.prepareOptions,
-      getCustomOptions = _require.getCustomOptions,
-      mergeConfigItemOptions = _require.mergeConfigItemOptions;
+const {
+  prepareOptions,
+  getCustomOptions,
+  mergeConfigItemOptions
+} = require(`./babel-loader-helpers`);
 /**
  * Gatsby's custom loader for webpack & babel
  *
@@ -28,37 +29,34 @@ module.exports = babelLoader.custom(babel => {
     // Passed the loader options.
     customOptions(options) {
       return {
-        loader: Object.assign({
+        loader: {
           cacheDirectory: true,
-          sourceType: `unambiguous`
-        }, getCustomOptions(), options)
+          sourceType: `unambiguous`,
+          ...getCustomOptions(),
+          ...options
+        }
       };
     },
 
     // Passed Babel's 'PartialConfig' object.
     config(partialConfig) {
-      let options = partialConfig.options;
-
-      const _prepareOptions = prepareOptions(babel),
-            reduxPresets = _prepareOptions[0],
-            reduxPlugins = _prepareOptions[1],
-            requiredPresets = _prepareOptions[2],
-            requiredPlugins = _prepareOptions[3],
-            fallbackPresets = _prepareOptions[4]; // If there is no filesystem babel config present, add our fallback
+      let {
+        options
+      } = partialConfig;
+      const [reduxPresets, reduxPlugins, requiredPresets, requiredPlugins, fallbackPresets] = prepareOptions(babel); // If there is no filesystem babel config present, add our fallback
       // presets/plugins.
 
-
       if (!partialConfig.hasFilesystemConfig()) {
-        options = Object.assign({}, options, {
+        options = { ...options,
           plugins: requiredPlugins,
           presets: [...fallbackPresets, ...requiredPresets]
-        });
+        };
       } else {
         // With a babelrc present, only add our required plugins/presets
-        options = Object.assign({}, options, {
+        options = { ...options,
           plugins: [...options.plugins, ...requiredPlugins],
           presets: [...options.presets, ...requiredPresets]
-        });
+        };
       } // Merge in presets/plugins added from gatsby plugins.
 
 
--- a/node_modules/gatsby/dist/utils/babel-loader.js.map
+++ b/node_modules/gatsby/dist/utils/babel-loader.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/utils/babel-loader.js"],"names":["babelLoader","require","prepareOptions","getCustomOptions","mergeConfigItemOptions","module","exports","custom","babel","toReturn","customOptions","options","loader","cacheDirectory","sourceType","config","partialConfig","reduxPresets","reduxPlugins","requiredPresets","requiredPlugins","fallbackPresets","hasFilesystemConfig","plugins","presets","forEach","preset","items","itemToMerge","type","plugin"],"mappings":";;AAAA,MAAMA,WAAW,GAAGC,OAAO,CAAE,cAAF,CAA3B;;iBAMIA,OAAO,CAAE,wBAAF,C;MAHTC,c,YAAAA,c;MACAC,gB,YAAAA,gB;MACAC,sB,YAAAA,sB;AAGF;;;;;;;;;;;;;;;;;AAeAC,MAAM,CAACC,OAAP,GAAiBN,WAAW,CAACO,MAAZ,CAAmBC,KAAK,IAAI;AAC3C,QAAMC,QAAQ,GAAG;AACf;AACAC,IAAAA,aAAa,CAACC,OAAD,EAAU;AACrB,aAAO;AACLC,QAAAA,MAAM;AACJC,UAAAA,cAAc,EAAE,IADZ;AAEJC,UAAAA,UAAU,EAAG;AAFT,WAGDX,gBAAgB,EAHf,EAIDQ,OAJC;AADD,OAAP;AAQD,KAXc;;AAaf;AACAI,IAAAA,MAAM,CAACC,aAAD,EAAgB;AAAA,UACdL,OADc,GACFK,aADE,CACdL,OADc;;AAAA,8BAQhBT,cAAc,CAACM,KAAD,CARE;AAAA,YAGlBS,YAHkB;AAAA,YAIlBC,YAJkB;AAAA,YAKlBC,eALkB;AAAA,YAMlBC,eANkB;AAAA,YAOlBC,eAPkB,uBAUpB;AACA;;;AACA,UAAI,CAACL,aAAa,CAACM,mBAAd,EAAL,EAA0C;AACxCX,QAAAA,OAAO,qBACFA,OADE;AAELY,UAAAA,OAAO,EAAEH,eAFJ;AAGLI,UAAAA,OAAO,EAAE,CAAC,GAAGH,eAAJ,EAAqB,GAAGF,eAAxB;AAHJ,UAAP;AAKD,OAND,MAMO;AACL;AACAR,QAAAA,OAAO,qBACFA,OADE;AAELY,UAAAA,OAAO,EAAE,CAAC,GAAGZ,OAAO,CAACY,OAAZ,EAAqB,GAAGH,eAAxB,CAFJ;AAGLI,UAAAA,OAAO,EAAE,CAAC,GAAGb,OAAO,CAACa,OAAZ,EAAqB,GAAGL,eAAxB;AAHJ,UAAP;AAKD,OAzBmB,CA2BpB;;;AACAF,MAAAA,YAAY,CAACQ,OAAb,CAAqBC,MAAM,IAAI;AAC7Bf,QAAAA,OAAO,CAACa,OAAR,GAAkBpB,sBAAsB,CAAC;AACvCuB,UAAAA,KAAK,EAAEhB,OAAO,CAACa,OADwB;AAEvCI,UAAAA,WAAW,EAAEF,MAF0B;AAGvCG,UAAAA,IAAI,EAAG,QAHgC;AAIvCrB,UAAAA;AAJuC,SAAD,CAAxC;AAMD,OAPD;AASAU,MAAAA,YAAY,CAACO,OAAb,CAAqBK,MAAM,IAAI;AAC7BnB,QAAAA,OAAO,CAACY,OAAR,GAAkBnB,sBAAsB,CAAC;AACvCuB,UAAAA,KAAK,EAAEhB,OAAO,CAACY,OADwB;AAEvCK,UAAAA,WAAW,EAAEE,MAF0B;AAGvCD,UAAAA,IAAI,EAAG,QAHgC;AAIvCrB,UAAAA;AAJuC,SAAD,CAAxC;AAMD,OAPD;AASA,aAAOG,OAAP;AACD;;AA7Dc,GAAjB;AAgEA,SAAOF,QAAP;AACD,CAlEgB,CAAjB","sourcesContent":["const babelLoader = require(`babel-loader`)\n\nconst {\n  prepareOptions,\n  getCustomOptions,\n  mergeConfigItemOptions,\n} = require(`./babel-loader-helpers`)\n\n/**\n * Gatsby's custom loader for webpack & babel\n *\n * Gatsby allows sites to either use our Babel setup (the default)\n * or to add a .babelrc to take control.\n *\n * Our default setup is defined in the fallbackPlugins/fallbackPresets arrays\n * below.\n *\n * After using either the fallback or user supplied setup, we add on a handful\n * of required plugins and finally merge in any presets/plugins supplied\n * by Gatsby plugins.\n *\n * You can find documentation for the custom loader here: https://babeljs.io/docs/en/next/babel-core.html#loadpartialconfig\n */\nmodule.exports = babelLoader.custom(babel => {\n  const toReturn = {\n    // Passed the loader options.\n    customOptions(options) {\n      return {\n        loader: {\n          cacheDirectory: true,\n          sourceType: `unambiguous`,\n          ...getCustomOptions(),\n          ...options,\n        },\n      }\n    },\n\n    // Passed Babel's 'PartialConfig' object.\n    config(partialConfig) {\n      let { options } = partialConfig\n      const [\n        reduxPresets,\n        reduxPlugins,\n        requiredPresets,\n        requiredPlugins,\n        fallbackPresets,\n      ] = prepareOptions(babel)\n\n      // If there is no filesystem babel config present, add our fallback\n      // presets/plugins.\n      if (!partialConfig.hasFilesystemConfig()) {\n        options = {\n          ...options,\n          plugins: requiredPlugins,\n          presets: [...fallbackPresets, ...requiredPresets],\n        }\n      } else {\n        // With a babelrc present, only add our required plugins/presets\n        options = {\n          ...options,\n          plugins: [...options.plugins, ...requiredPlugins],\n          presets: [...options.presets, ...requiredPresets],\n        }\n      }\n\n      // Merge in presets/plugins added from gatsby plugins.\n      reduxPresets.forEach(preset => {\n        options.presets = mergeConfigItemOptions({\n          items: options.presets,\n          itemToMerge: preset,\n          type: `preset`,\n          babel,\n        })\n      })\n\n      reduxPlugins.forEach(plugin => {\n        options.plugins = mergeConfigItemOptions({\n          items: options.plugins,\n          itemToMerge: plugin,\n          type: `plugin`,\n          babel,\n        })\n      })\n\n      return options\n    },\n  }\n\n  return toReturn\n})\n"],"file":"babel-loader.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/utils/babel-loader.js"],"names":["babelLoader","require","prepareOptions","getCustomOptions","mergeConfigItemOptions","module","exports","custom","babel","toReturn","customOptions","options","loader","cacheDirectory","sourceType","config","partialConfig","reduxPresets","reduxPlugins","requiredPresets","requiredPlugins","fallbackPresets","hasFilesystemConfig","plugins","presets","forEach","preset","items","itemToMerge","type","plugin"],"mappings":";;AAAA,MAAMA,WAAW,GAAGC,OAAO,CAAE,cAAF,CAA3B;;AAEA,MAAM;AACJC,EAAAA,cADI;AAEJC,EAAAA,gBAFI;AAGJC,EAAAA;AAHI,IAIFH,OAAO,CAAE,wBAAF,CAJX;AAMA;;;;;;;;;;;;;;;;;AAeAI,MAAM,CAACC,OAAP,GAAiBN,WAAW,CAACO,MAAZ,CAAmBC,KAAK,IAAI;AAC3C,QAAMC,QAAQ,GAAG;AACf;AACAC,IAAAA,aAAa,CAACC,OAAD,EAAU;AACrB,aAAO;AACLC,QAAAA,MAAM,EAAE;AACNC,UAAAA,cAAc,EAAE,IADV;AAENC,UAAAA,UAAU,EAAG,aAFP;AAGN,aAAGX,gBAAgB,EAHb;AAIN,aAAGQ;AAJG;AADH,OAAP;AAQD,KAXc;;AAaf;AACAI,IAAAA,MAAM,CAACC,aAAD,EAAgB;AACpB,UAAI;AAAEL,QAAAA;AAAF,UAAcK,aAAlB;AACA,YAAM,CACJC,YADI,EAEJC,YAFI,EAGJC,eAHI,EAIJC,eAJI,EAKJC,eALI,IAMFnB,cAAc,CAACM,KAAD,CANlB,CAFoB,CAUpB;AACA;;AACA,UAAI,CAACQ,aAAa,CAACM,mBAAd,EAAL,EAA0C;AACxCX,QAAAA,OAAO,GAAG,EACR,GAAGA,OADK;AAERY,UAAAA,OAAO,EAAEH,eAFD;AAGRI,UAAAA,OAAO,EAAE,CAAC,GAAGH,eAAJ,EAAqB,GAAGF,eAAxB;AAHD,SAAV;AAKD,OAND,MAMO;AACL;AACAR,QAAAA,OAAO,GAAG,EACR,GAAGA,OADK;AAERY,UAAAA,OAAO,EAAE,CAAC,GAAGZ,OAAO,CAACY,OAAZ,EAAqB,GAAGH,eAAxB,CAFD;AAGRI,UAAAA,OAAO,EAAE,CAAC,GAAGb,OAAO,CAACa,OAAZ,EAAqB,GAAGL,eAAxB;AAHD,SAAV;AAKD,OAzBmB,CA2BpB;;;AACAF,MAAAA,YAAY,CAACQ,OAAb,CAAqBC,MAAM,IAAI;AAC7Bf,QAAAA,OAAO,CAACa,OAAR,GAAkBpB,sBAAsB,CAAC;AACvCuB,UAAAA,KAAK,EAAEhB,OAAO,CAACa,OADwB;AAEvCI,UAAAA,WAAW,EAAEF,MAF0B;AAGvCG,UAAAA,IAAI,EAAG,QAHgC;AAIvCrB,UAAAA;AAJuC,SAAD,CAAxC;AAMD,OAPD;AASAU,MAAAA,YAAY,CAACO,OAAb,CAAqBK,MAAM,IAAI;AAC7BnB,QAAAA,OAAO,CAACY,OAAR,GAAkBnB,sBAAsB,CAAC;AACvCuB,UAAAA,KAAK,EAAEhB,OAAO,CAACY,OADwB;AAEvCK,UAAAA,WAAW,EAAEE,MAF0B;AAGvCD,UAAAA,IAAI,EAAG,QAHgC;AAIvCrB,UAAAA;AAJuC,SAAD,CAAxC;AAMD,OAPD;AASA,aAAOG,OAAP;AACD;;AA7Dc,GAAjB;AAgEA,SAAOF,QAAP;AACD,CAlEgB,CAAjB","sourcesContent":["const babelLoader = require(`babel-loader`)\n\nconst {\n  prepareOptions,\n  getCustomOptions,\n  mergeConfigItemOptions,\n} = require(`./babel-loader-helpers`)\n\n/**\n * Gatsby's custom loader for webpack & babel\n *\n * Gatsby allows sites to either use our Babel setup (the default)\n * or to add a .babelrc to take control.\n *\n * Our default setup is defined in the fallbackPlugins/fallbackPresets arrays\n * below.\n *\n * After using either the fallback or user supplied setup, we add on a handful\n * of required plugins and finally merge in any presets/plugins supplied\n * by Gatsby plugins.\n *\n * You can find documentation for the custom loader here: https://babeljs.io/docs/en/next/babel-core.html#loadpartialconfig\n */\nmodule.exports = babelLoader.custom(babel => {\n  const toReturn = {\n    // Passed the loader options.\n    customOptions(options) {\n      return {\n        loader: {\n          cacheDirectory: true,\n          sourceType: `unambiguous`,\n          ...getCustomOptions(),\n          ...options,\n        },\n      }\n    },\n\n    // Passed Babel's 'PartialConfig' object.\n    config(partialConfig) {\n      let { options } = partialConfig\n      const [\n        reduxPresets,\n        reduxPlugins,\n        requiredPresets,\n        requiredPlugins,\n        fallbackPresets,\n      ] = prepareOptions(babel)\n\n      // If there is no filesystem babel config present, add our fallback\n      // presets/plugins.\n      if (!partialConfig.hasFilesystemConfig()) {\n        options = {\n          ...options,\n          plugins: requiredPlugins,\n          presets: [...fallbackPresets, ...requiredPresets],\n        }\n      } else {\n        // With a babelrc present, only add our required plugins/presets\n        options = {\n          ...options,\n          plugins: [...options.plugins, ...requiredPlugins],\n          presets: [...options.presets, ...requiredPresets],\n        }\n      }\n\n      // Merge in presets/plugins added from gatsby plugins.\n      reduxPresets.forEach(preset => {\n        options.presets = mergeConfigItemOptions({\n          items: options.presets,\n          itemToMerge: preset,\n          type: `preset`,\n          babel,\n        })\n      })\n\n      reduxPlugins.forEach(plugin => {\n        options.plugins = mergeConfigItemOptions({\n          items: options.plugins,\n          itemToMerge: plugin,\n          type: `plugin`,\n          babel,\n        })\n      })\n\n      return options\n    },\n  }\n\n  return toReturn\n})\n"],"file":"babel-loader.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/utils/babel-parse-to-ast.js
+++ b/node_modules/gatsby/dist/utils/babel-parse-to-ast.js
@@ -22,10 +22,12 @@ const PARSER_OPTIONS = {
 function getBabelParserOptions(filePath) {
   // Flow and typescript plugins can't be enabled simultaneously
   if (/\.tsx?/.test(filePath)) {
-    const plugins = PARSER_OPTIONS.plugins;
-    return Object.assign({}, PARSER_OPTIONS, {
+    const {
+      plugins
+    } = PARSER_OPTIONS;
+    return { ...PARSER_OPTIONS,
       plugins: plugins.map(plugin => plugin === `flow` ? `typescript` : plugin)
-    });
+    };
   }
 
   return PARSER_OPTIONS;
--- a/node_modules/gatsby/dist/utils/babel-parse-to-ast.js.map
+++ b/node_modules/gatsby/dist/utils/babel-parse-to-ast.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/utils/babel-parse-to-ast.js"],"names":["parser","require","PARSER_OPTIONS","allowImportExportEverywhere","allowReturnOutsideFunction","allowSuperOutsideMethod","sourceType","sourceFilename","plugins","decoratorsBeforeExport","proposal","getBabelParserOptions","filePath","test","map","plugin","babelParseToAst","contents","parse"],"mappings":";;;;;;AACA,MAAMA,MAAM,GAAGC,OAAO,CAAE,eAAF,CAAtB;;AAEA,MAAMC,cAAc,GAAG;AACrBC,EAAAA,2BAA2B,EAAE,IADR;AAErBC,EAAAA,0BAA0B,EAAE,IAFP;AAGrBC,EAAAA,uBAAuB,EAAE,IAHJ;AAIrBC,EAAAA,UAAU,EAAG,aAJQ;AAKrBC,EAAAA,cAAc,EAAE,IALK;AAMrBC,EAAAA,OAAO,EAAE,CACN,KADM,EAEN,MAFM,EAGN,eAHM,EAIN,kBAJM,EAKP,CACG,YADH,EAEE;AACEC,IAAAA,sBAAsB,EAAE;AAD1B,GAFF,CALO,EAWN,iBAXM,EAYN,wBAZM,EAaN,qBAbM,EAcN,mBAdM,EAeN,qBAfM,EAgBN,iBAhBM,EAiBN,cAjBM,EAkBN,cAlBM,EAmBN,eAnBM,EAoBN,kBApBM,EAqBN,kBArBM,EAsBN,YAtBM,EAuBN,QAvBM,EAwBN,sBAxBM,EAyBN,kBAzBM,EA0BP,CACG,kBADH,EAEE;AACEC,IAAAA,QAAQ,EAAG;AADb,GAFF,CA1BO,EAgCN,2BAhCM;AANY,CAAvB;;AA0CO,SAASC,qBAAT,CAA+BC,QAA/B,EAAiD;AACtD;AACA,MAAI,SAASC,IAAT,CAAcD,QAAd,CAAJ,EAA6B;AAAA,UACnBJ,OADmB,GACPN,cADO,CACnBM,OADmB;AAE3B,6BACKN,cADL;AAEEM,MAAAA,OAAO,EAAEA,OAAO,CAACM,GAAR,CACPC,MAAM,IAAKA,MAAM,KAAM,MAAZ,GAAqB,YAArB,GAAmCA,MADvC;AAFX;AAMD;;AACD,SAAOb,cAAP;AACD;;AAEM,SAASc,eAAT,CAAyBC,QAAzB,EAA2CL,QAA3C,EAA6D;AAClE,SAAOZ,MAAM,CAACkB,KAAP,CAAaD,QAAb,EAAuBN,qBAAqB,CAACC,QAAD,CAA5C,CAAP;AACD","sourcesContent":["/* @flow */\nconst parser = require(`@babel/parser`)\n\nconst PARSER_OPTIONS = {\n  allowImportExportEverywhere: true,\n  allowReturnOutsideFunction: true,\n  allowSuperOutsideMethod: true,\n  sourceType: `unambigious`,\n  sourceFilename: true,\n  plugins: [\n    `jsx`,\n    `flow`,\n    `doExpressions`,\n    `objectRestSpread`,\n    [\n      `decorators`,\n      {\n        decoratorsBeforeExport: true,\n      },\n    ],\n    `classProperties`,\n    `classPrivateProperties`,\n    `classPrivateMethods`,\n    `exportDefaultFrom`,\n    `exportNamespaceFrom`,\n    `asyncGenerators`,\n    `functionBind`,\n    `functionSent`,\n    `dynamicImport`,\n    `numericSeparator`,\n    `optionalChaining`,\n    `importMeta`,\n    `bigInt`,\n    `optionalCatchBinding`,\n    `throwExpressions`,\n    [\n      `pipelineOperator`,\n      {\n        proposal: `minimal`,\n      },\n    ],\n    `nullishCoalescingOperator`,\n  ],\n}\n\nexport function getBabelParserOptions(filePath: string) {\n  // Flow and typescript plugins can't be enabled simultaneously\n  if (/\\.tsx?/.test(filePath)) {\n    const { plugins } = PARSER_OPTIONS\n    return {\n      ...PARSER_OPTIONS,\n      plugins: plugins.map(\n        plugin => (plugin === `flow` ? `typescript` : plugin)\n      ),\n    }\n  }\n  return PARSER_OPTIONS\n}\n\nexport function babelParseToAst(contents: string, filePath: string) {\n  return parser.parse(contents, getBabelParserOptions(filePath))\n}\n"],"file":"babel-parse-to-ast.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/utils/babel-parse-to-ast.js"],"names":["parser","require","PARSER_OPTIONS","allowImportExportEverywhere","allowReturnOutsideFunction","allowSuperOutsideMethod","sourceType","sourceFilename","plugins","decoratorsBeforeExport","proposal","getBabelParserOptions","filePath","test","map","plugin","babelParseToAst","contents","parse"],"mappings":";;;;;;AACA,MAAMA,MAAM,GAAGC,OAAO,CAAE,eAAF,CAAtB;;AAEA,MAAMC,cAAc,GAAG;AACrBC,EAAAA,2BAA2B,EAAE,IADR;AAErBC,EAAAA,0BAA0B,EAAE,IAFP;AAGrBC,EAAAA,uBAAuB,EAAE,IAHJ;AAIrBC,EAAAA,UAAU,EAAG,aAJQ;AAKrBC,EAAAA,cAAc,EAAE,IALK;AAMrBC,EAAAA,OAAO,EAAE,CACN,KADM,EAEN,MAFM,EAGN,eAHM,EAIN,kBAJM,EAKP,CACG,YADH,EAEE;AACEC,IAAAA,sBAAsB,EAAE;AAD1B,GAFF,CALO,EAWN,iBAXM,EAYN,wBAZM,EAaN,qBAbM,EAcN,mBAdM,EAeN,qBAfM,EAgBN,iBAhBM,EAiBN,cAjBM,EAkBN,cAlBM,EAmBN,eAnBM,EAoBN,kBApBM,EAqBN,kBArBM,EAsBN,YAtBM,EAuBN,QAvBM,EAwBN,sBAxBM,EAyBN,kBAzBM,EA0BP,CACG,kBADH,EAEE;AACEC,IAAAA,QAAQ,EAAG;AADb,GAFF,CA1BO,EAgCN,2BAhCM;AANY,CAAvB;;AA0CO,SAASC,qBAAT,CAA+BC,QAA/B,EAAiD;AACtD;AACA,MAAI,SAASC,IAAT,CAAcD,QAAd,CAAJ,EAA6B;AAC3B,UAAM;AAAEJ,MAAAA;AAAF,QAAcN,cAApB;AACA,WAAO,EACL,GAAGA,cADE;AAELM,MAAAA,OAAO,EAAEA,OAAO,CAACM,GAAR,CACPC,MAAM,IAAKA,MAAM,KAAM,MAAZ,GAAqB,YAArB,GAAmCA,MADvC;AAFJ,KAAP;AAMD;;AACD,SAAOb,cAAP;AACD;;AAEM,SAASc,eAAT,CAAyBC,QAAzB,EAA2CL,QAA3C,EAA6D;AAClE,SAAOZ,MAAM,CAACkB,KAAP,CAAaD,QAAb,EAAuBN,qBAAqB,CAACC,QAAD,CAA5C,CAAP;AACD","sourcesContent":["/* @flow */\nconst parser = require(`@babel/parser`)\n\nconst PARSER_OPTIONS = {\n  allowImportExportEverywhere: true,\n  allowReturnOutsideFunction: true,\n  allowSuperOutsideMethod: true,\n  sourceType: `unambigious`,\n  sourceFilename: true,\n  plugins: [\n    `jsx`,\n    `flow`,\n    `doExpressions`,\n    `objectRestSpread`,\n    [\n      `decorators`,\n      {\n        decoratorsBeforeExport: true,\n      },\n    ],\n    `classProperties`,\n    `classPrivateProperties`,\n    `classPrivateMethods`,\n    `exportDefaultFrom`,\n    `exportNamespaceFrom`,\n    `asyncGenerators`,\n    `functionBind`,\n    `functionSent`,\n    `dynamicImport`,\n    `numericSeparator`,\n    `optionalChaining`,\n    `importMeta`,\n    `bigInt`,\n    `optionalCatchBinding`,\n    `throwExpressions`,\n    [\n      `pipelineOperator`,\n      {\n        proposal: `minimal`,\n      },\n    ],\n    `nullishCoalescingOperator`,\n  ],\n}\n\nexport function getBabelParserOptions(filePath: string) {\n  // Flow and typescript plugins can't be enabled simultaneously\n  if (/\\.tsx?/.test(filePath)) {\n    const { plugins } = PARSER_OPTIONS\n    return {\n      ...PARSER_OPTIONS,\n      plugins: plugins.map(\n        plugin => (plugin === `flow` ? `typescript` : plugin)\n      ),\n    }\n  }\n  return PARSER_OPTIONS\n}\n\nexport function babelParseToAst(contents: string, filePath: string) {\n  return parser.parse(contents, getBabelParserOptions(filePath))\n}\n"],"file":"babel-parse-to-ast.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/utils/browserslist.js
+++ b/node_modules/gatsby/dist/utils/browserslist.js
@@ -6,8 +6,9 @@ const browserslist = require(`browserslist/node`);
 
 function installedGatsbyVersion(directory) {
   try {
-    const _require = require(path.join(directory, `node_modules`, `gatsby`, `package.json`)),
-          version = _require.version;
+    const {
+      version
+    } = require(path.join(directory, `node_modules`, `gatsby`, `package.json`));
 
     return parseInt(version.split(`.`)[0], 10);
   } catch (e) {
--- a/node_modules/gatsby/dist/utils/browserslist.js.map
+++ b/node_modules/gatsby/dist/utils/browserslist.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/utils/browserslist.js"],"names":["path","require","browserslist","installedGatsbyVersion","directory","join","version","parseInt","split","e","undefined","module","exports","getBrowsersList","fallback","config","findConfig","defaults"],"mappings":";;AAAA,MAAMA,IAAI,GAAGC,OAAO,CAAE,MAAF,CAApB;;AACA,MAAMC,YAAY,GAAGD,OAAO,CAAE,mBAAF,CAA5B;;AAEA,SAASE,sBAAT,CAAgCC,SAAhC,EAA2C;AACzC,MAAI;AAAA,qBACkBH,OAAO,CAACD,IAAI,CAACK,IAAL,CAC1BD,SAD0B,EAEzB,cAFyB,EAGzB,QAHyB,EAIzB,cAJyB,CAAD,CADzB;AAAA,UACME,OADN,YACMA,OADN;;AAOF,WAAOC,QAAQ,CAACD,OAAO,CAACE,KAAR,CAAe,GAAf,EAAmB,CAAnB,CAAD,EAAwB,EAAxB,CAAf;AACD,GARD,CAQE,OAAOC,CAAP,EAAU;AACV,WAAOC,SAAP;AACD;AACF;;AAEDC,MAAM,CAACC,OAAP,GAAiB,SAASC,eAAT,CAAyBT,SAAzB,EAAoC;AACnD,QAAMU,QAAQ,GACZX,sBAAsB,CAACC,SAAD,CAAtB,KAAsC,CAAtC,GACI,CAAE,KAAF,EAAS,iBAAT,EAA4B,SAA5B,CADJ,GAEI,CAAE,QAAF,EAAY,UAAZ,CAHN;AAKA,QAAMW,MAAM,GAAGb,YAAY,CAACc,UAAb,CAAwBZ,SAAxB,CAAf;;AAEA,MAAIW,MAAM,IAAIA,MAAM,CAACE,QAArB,EAA+B;AAC7B,WAAOF,MAAM,CAACE,QAAd;AACD;;AAED,SAAOH,QAAP;AACD,CAbD","sourcesContent":["const path = require(`path`)\nconst browserslist = require(`browserslist/node`)\n\nfunction installedGatsbyVersion(directory) {\n  try {\n    const { version } = require(path.join(\n      directory,\n      `node_modules`,\n      `gatsby`,\n      `package.json`\n    ))\n    return parseInt(version.split(`.`)[0], 10)\n  } catch (e) {\n    return undefined\n  }\n}\n\nmodule.exports = function getBrowsersList(directory) {\n  const fallback =\n    installedGatsbyVersion(directory) === 1\n      ? [`>1%`, `last 2 versions`, `IE >= 9`]\n      : [`>0.25%`, `not dead`]\n\n  const config = browserslist.findConfig(directory)\n\n  if (config && config.defaults) {\n    return config.defaults\n  }\n\n  return fallback\n}\n"],"file":"browserslist.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/utils/browserslist.js"],"names":["path","require","browserslist","installedGatsbyVersion","directory","version","join","parseInt","split","e","undefined","module","exports","getBrowsersList","fallback","config","findConfig","defaults"],"mappings":";;AAAA,MAAMA,IAAI,GAAGC,OAAO,CAAE,MAAF,CAApB;;AACA,MAAMC,YAAY,GAAGD,OAAO,CAAE,mBAAF,CAA5B;;AAEA,SAASE,sBAAT,CAAgCC,SAAhC,EAA2C;AACzC,MAAI;AACF,UAAM;AAAEC,MAAAA;AAAF,QAAcJ,OAAO,CAACD,IAAI,CAACM,IAAL,CAC1BF,SAD0B,EAEzB,cAFyB,EAGzB,QAHyB,EAIzB,cAJyB,CAAD,CAA3B;;AAMA,WAAOG,QAAQ,CAACF,OAAO,CAACG,KAAR,CAAe,GAAf,EAAmB,CAAnB,CAAD,EAAwB,EAAxB,CAAf;AACD,GARD,CAQE,OAAOC,CAAP,EAAU;AACV,WAAOC,SAAP;AACD;AACF;;AAEDC,MAAM,CAACC,OAAP,GAAiB,SAASC,eAAT,CAAyBT,SAAzB,EAAoC;AACnD,QAAMU,QAAQ,GACZX,sBAAsB,CAACC,SAAD,CAAtB,KAAsC,CAAtC,GACI,CAAE,KAAF,EAAS,iBAAT,EAA4B,SAA5B,CADJ,GAEI,CAAE,QAAF,EAAY,UAAZ,CAHN;AAKA,QAAMW,MAAM,GAAGb,YAAY,CAACc,UAAb,CAAwBZ,SAAxB,CAAf;;AAEA,MAAIW,MAAM,IAAIA,MAAM,CAACE,QAArB,EAA+B;AAC7B,WAAOF,MAAM,CAACE,QAAd;AACD;;AAED,SAAOH,QAAP;AACD,CAbD","sourcesContent":["const path = require(`path`)\nconst browserslist = require(`browserslist/node`)\n\nfunction installedGatsbyVersion(directory) {\n  try {\n    const { version } = require(path.join(\n      directory,\n      `node_modules`,\n      `gatsby`,\n      `package.json`\n    ))\n    return parseInt(version.split(`.`)[0], 10)\n  } catch (e) {\n    return undefined\n  }\n}\n\nmodule.exports = function getBrowsersList(directory) {\n  const fallback =\n    installedGatsbyVersion(directory) === 1\n      ? [`>1%`, `last 2 versions`, `IE >= 9`]\n      : [`>0.25%`, `not dead`]\n\n  const config = browserslist.findConfig(directory)\n\n  if (config && config.defaults) {\n    return config.defaults\n  }\n\n  return fallback\n}\n"],"file":"browserslist.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/utils/checkpoints-promise.js
+++ b/node_modules/gatsby/dist/utils/checkpoints-promise.js
@@ -5,8 +5,9 @@ const Promise = require(`bluebird`);
 
 const _ = require(`lodash`);
 
-const _require = require(`../redux`),
-      emitter = _require.emitter;
+const {
+  emitter
+} = require(`../redux`);
 
 let waiters = [];
 emitter.on(`BOOTSTRAP_STAGE`, action => {
--- a/node_modules/gatsby/dist/utils/checkpoints-promise.js.map
+++ b/node_modules/gatsby/dist/utils/checkpoints-promise.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/utils/checkpoints-promise.js"],"names":["Promise","require","_","emitter","waiters","on","action","stage","payload","map","w","newWaiter","resolve","events","difference","length","undefined","filter","module","exports","push"],"mappings":";;AAAA;AACA,MAAMA,OAAO,GAAGC,OAAO,CAAE,UAAF,CAAvB;;AACA,MAAMC,CAAC,GAAGD,OAAO,CAAE,QAAF,CAAjB;;iBAEoBA,OAAO,CAAE,UAAF,C;MAAnBE,O,YAAAA,O;;AAER,IAAIC,OAAO,GAAG,EAAd;AACAD,OAAO,CAACE,EAAR,CAAY,iBAAZ,EAA8BC,MAAM,IAAI;AACtC,QAAMC,KAAK,GAAGD,MAAM,CAACE,OAAP,CAAeD,KAA7B,CADsC,CAEtC;;AACAH,EAAAA,OAAO,GAAGA,OAAO,CAACK,GAAR,CAAYC,CAAC,IAAI;AACzB,UAAMC,SAAS,GAAG;AAChBC,MAAAA,OAAO,EAAEF,CAAC,CAACE,OADK;AAEhBC,MAAAA,MAAM,EAAEX,CAAC,CAACY,UAAF,CAAaJ,CAAC,CAACG,MAAf,EAAuB,CAACN,KAAD,CAAvB;AAFQ,KAAlB;;AAKA,QAAII,SAAS,CAACE,MAAV,CAAiBE,MAAjB,KAA4B,CAAhC,EAAmC;AACjC;AACAJ,MAAAA,SAAS,CAACC,OAAV;AACA,aAAOI,SAAP;AACD,KAJD,MAIO;AACL,aAAOL,SAAP;AACD;AACF,GAbS,CAAV,CAHsC,CAkBtC;;AACAP,EAAAA,OAAO,GAAGF,CAAC,CAACe,MAAF,CAASb,OAAT,CAAV;AACD,CApBD;;AAsBAc,MAAM,CAACC,OAAP,GAAiB,CAAC;AAAEN,EAAAA;AAAF,CAAD,KACf,IAAIb,OAAJ,CAAYY,OAAO,IAAI;AACrBR,EAAAA,OAAO,CAACgB,IAAR,CAAa;AACXR,IAAAA,OADW;AAEXC,IAAAA;AAFW,GAAb;AAID,CALD,CADF","sourcesContent":["// Wait for things to happen before continuing.\nconst Promise = require(`bluebird`)\nconst _ = require(`lodash`)\n\nconst { emitter } = require(`../redux`)\n\nlet waiters = []\nemitter.on(`BOOTSTRAP_STAGE`, action => {\n  const stage = action.payload.stage\n  // Remove this stage from the waiters\n  waiters = waiters.map(w => {\n    const newWaiter = {\n      resolve: w.resolve,\n      events: _.difference(w.events, [stage]),\n    }\n\n    if (newWaiter.events.length === 0) {\n      // Call resolve function then remove by returning undefined.\n      newWaiter.resolve()\n      return undefined\n    } else {\n      return newWaiter\n    }\n  })\n\n  // Cleanup null entries\n  waiters = _.filter(waiters)\n})\n\nmodule.exports = ({ events }) =>\n  new Promise(resolve => {\n    waiters.push({\n      resolve,\n      events,\n    })\n  })\n"],"file":"checkpoints-promise.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/utils/checkpoints-promise.js"],"names":["Promise","require","_","emitter","waiters","on","action","stage","payload","map","w","newWaiter","resolve","events","difference","length","undefined","filter","module","exports","push"],"mappings":";;AAAA;AACA,MAAMA,OAAO,GAAGC,OAAO,CAAE,UAAF,CAAvB;;AACA,MAAMC,CAAC,GAAGD,OAAO,CAAE,QAAF,CAAjB;;AAEA,MAAM;AAAEE,EAAAA;AAAF,IAAcF,OAAO,CAAE,UAAF,CAA3B;;AAEA,IAAIG,OAAO,GAAG,EAAd;AACAD,OAAO,CAACE,EAAR,CAAY,iBAAZ,EAA8BC,MAAM,IAAI;AACtC,QAAMC,KAAK,GAAGD,MAAM,CAACE,OAAP,CAAeD,KAA7B,CADsC,CAEtC;;AACAH,EAAAA,OAAO,GAAGA,OAAO,CAACK,GAAR,CAAYC,CAAC,IAAI;AACzB,UAAMC,SAAS,GAAG;AAChBC,MAAAA,OAAO,EAAEF,CAAC,CAACE,OADK;AAEhBC,MAAAA,MAAM,EAAEX,CAAC,CAACY,UAAF,CAAaJ,CAAC,CAACG,MAAf,EAAuB,CAACN,KAAD,CAAvB;AAFQ,KAAlB;;AAKA,QAAII,SAAS,CAACE,MAAV,CAAiBE,MAAjB,KAA4B,CAAhC,EAAmC;AACjC;AACAJ,MAAAA,SAAS,CAACC,OAAV;AACA,aAAOI,SAAP;AACD,KAJD,MAIO;AACL,aAAOL,SAAP;AACD;AACF,GAbS,CAAV,CAHsC,CAkBtC;;AACAP,EAAAA,OAAO,GAAGF,CAAC,CAACe,MAAF,CAASb,OAAT,CAAV;AACD,CApBD;;AAsBAc,MAAM,CAACC,OAAP,GAAiB,CAAC;AAAEN,EAAAA;AAAF,CAAD,KACf,IAAIb,OAAJ,CAAYY,OAAO,IAAI;AACrBR,EAAAA,OAAO,CAACgB,IAAR,CAAa;AACXR,IAAAA,OADW;AAEXC,IAAAA;AAFW,GAAb;AAID,CALD,CADF","sourcesContent":["// Wait for things to happen before continuing.\nconst Promise = require(`bluebird`)\nconst _ = require(`lodash`)\n\nconst { emitter } = require(`../redux`)\n\nlet waiters = []\nemitter.on(`BOOTSTRAP_STAGE`, action => {\n  const stage = action.payload.stage\n  // Remove this stage from the waiters\n  waiters = waiters.map(w => {\n    const newWaiter = {\n      resolve: w.resolve,\n      events: _.difference(w.events, [stage]),\n    }\n\n    if (newWaiter.events.length === 0) {\n      // Call resolve function then remove by returning undefined.\n      newWaiter.resolve()\n      return undefined\n    } else {\n      return newWaiter\n    }\n  })\n\n  // Cleanup null entries\n  waiters = _.filter(waiters)\n})\n\nmodule.exports = ({ events }) =>\n  new Promise(resolve => {\n    waiters.push({\n      resolve,\n      events,\n    })\n  })\n"],"file":"checkpoints-promise.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/utils/get-ssl-cert.js
+++ b/node_modules/gatsby/dist/utils/get-ssl-cert.js
@@ -1,9 +1,5 @@
 "use strict";
 
-var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
-
-var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
-
 const getDevelopmentCertificate = require(`devcert-san`).default;
 
 const report = require(`gatsby-cli/lib/reporter`);
@@ -12,47 +8,39 @@ const fs = require(`fs`);
 
 const path = require(`path`);
 
-module.exports =
-/*#__PURE__*/
-function () {
-  var _ref = (0, _asyncToGenerator2.default)(function* ({
-    name,
-    certFile,
-    keyFile,
-    directory
-  }) {
-    // check that cert file and key file are both true or both false, if they are both
-    // false, it defaults to the automatic ssl
-    if (certFile ? !keyFile : keyFile) {
-      report.panic(`for custom ssl --https, --cert-file, and --key-file must be used together`);
-    }
-
-    if (certFile && keyFile) {
-      const keyPath = path.join(directory, keyFile);
-      const certPath = path.join(directory, certFile);
-      return yield {
-        keyPath,
-        certPath,
-        key: fs.readFileSync(keyPath),
-        cert: fs.readFileSync(certPath)
-      };
-    }
-
-    report.info(`setting up automatic SSL certificate (may require sudo)\n`);
-
-    try {
-      return yield getDevelopmentCertificate(name, {
-        installCertutil: true
-      });
-    } catch (err) {
-      report.panic(`\nFailed to generate dev SSL certificate`, err);
-    }
-
-    return false;
-  });
-
-  return function (_x) {
-    return _ref.apply(this, arguments);
-  };
-}();
+module.exports = async ({
+  name,
+  certFile,
+  keyFile,
+  directory
+}) => {
+  // check that cert file and key file are both true or both false, if they are both
+  // false, it defaults to the automatic ssl
+  if (certFile ? !keyFile : keyFile) {
+    report.panic(`for custom ssl --https, --cert-file, and --key-file must be used together`);
+  }
+
+  if (certFile && keyFile) {
+    const keyPath = path.join(directory, keyFile);
+    const certPath = path.join(directory, certFile);
+    return await {
+      keyPath,
+      certPath,
+      key: fs.readFileSync(keyPath),
+      cert: fs.readFileSync(certPath)
+    };
+  }
+
+  report.info(`setting up automatic SSL certificate (may require sudo)\n`);
+
+  try {
+    return await getDevelopmentCertificate(name, {
+      installCertutil: true
+    });
+  } catch (err) {
+    report.panic(`\nFailed to generate dev SSL certificate`, err);
+  }
+
+  return false;
+};
 //# sourceMappingURL=get-ssl-cert.js.map
\ No newline at end of file
--- a/node_modules/gatsby/dist/utils/get-ssl-cert.js.map
+++ b/node_modules/gatsby/dist/utils/get-ssl-cert.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/utils/get-ssl-cert.js"],"names":["getDevelopmentCertificate","require","default","report","fs","path","module","exports","name","certFile","keyFile","directory","panic","keyPath","join","certPath","key","readFileSync","cert","info","installCertutil","err"],"mappings":";;;;;;AAAA,MAAMA,yBAAyB,GAAGC,OAAO,CAAE,aAAF,CAAP,CAAuBC,OAAzD;;AACA,MAAMC,MAAM,GAAGF,OAAO,CAAE,yBAAF,CAAtB;;AACA,MAAMG,EAAE,GAAGH,OAAO,CAAE,IAAF,CAAlB;;AACA,MAAMI,IAAI,GAAGJ,OAAO,CAAE,MAAF,CAApB;;AAEAK,MAAM,CAACC,OAAP;AAAA;AAAA;AAAA,6CAAiB,WAAO;AAAEC,IAAAA,IAAF;AAAQC,IAAAA,QAAR;AAAkBC,IAAAA,OAAlB;AAA2BC,IAAAA;AAA3B,GAAP,EAAkD;AACjE;AACA;AACA,QAAIF,QAAQ,GAAG,CAACC,OAAJ,GAAcA,OAA1B,EAAmC;AACjCP,MAAAA,MAAM,CAACS,KAAP,CACG,2EADH;AAGD;;AAED,QAAIH,QAAQ,IAAIC,OAAhB,EAAyB;AACvB,YAAMG,OAAO,GAAGR,IAAI,CAACS,IAAL,CAAUH,SAAV,EAAqBD,OAArB,CAAhB;AACA,YAAMK,QAAQ,GAAGV,IAAI,CAACS,IAAL,CAAUH,SAAV,EAAqBF,QAArB,CAAjB;AAEA,mBAAa;AACXI,QAAAA,OADW;AAEXE,QAAAA,QAFW;AAGXC,QAAAA,GAAG,EAAEZ,EAAE,CAACa,YAAH,CAAgBJ,OAAhB,CAHM;AAIXK,QAAAA,IAAI,EAAEd,EAAE,CAACa,YAAH,CAAgBF,QAAhB;AAJK,OAAb;AAMD;;AAEDZ,IAAAA,MAAM,CAACgB,IAAP,CAAa,2DAAb;;AACA,QAAI;AACF,mBAAanB,yBAAyB,CAACQ,IAAD,EAAO;AAC3CY,QAAAA,eAAe,EAAE;AAD0B,OAAP,CAAtC;AAGD,KAJD,CAIE,OAAOC,GAAP,EAAY;AACZlB,MAAAA,MAAM,CAACS,KAAP,CAAc,0CAAd,EAAyDS,GAAzD;AACD;;AAED,WAAO,KAAP;AACD,GA/BD;;AAAA;AAAA;AAAA;AAAA","sourcesContent":["const getDevelopmentCertificate = require(`devcert-san`).default\nconst report = require(`gatsby-cli/lib/reporter`)\nconst fs = require(`fs`)\nconst path = require(`path`)\n\nmodule.exports = async ({ name, certFile, keyFile, directory }) => {\n  // check that cert file and key file are both true or both false, if they are both\n  // false, it defaults to the automatic ssl\n  if (certFile ? !keyFile : keyFile) {\n    report.panic(\n      `for custom ssl --https, --cert-file, and --key-file must be used together`\n    )\n  }\n\n  if (certFile && keyFile) {\n    const keyPath = path.join(directory, keyFile)\n    const certPath = path.join(directory, certFile)\n\n    return await {\n      keyPath,\n      certPath,\n      key: fs.readFileSync(keyPath),\n      cert: fs.readFileSync(certPath),\n    }\n  }\n\n  report.info(`setting up automatic SSL certificate (may require sudo)\\n`)\n  try {\n    return await getDevelopmentCertificate(name, {\n      installCertutil: true,\n    })\n  } catch (err) {\n    report.panic(`\\nFailed to generate dev SSL certificate`, err)\n  }\n\n  return false\n}\n"],"file":"get-ssl-cert.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/utils/get-ssl-cert.js"],"names":["getDevelopmentCertificate","require","default","report","fs","path","module","exports","name","certFile","keyFile","directory","panic","keyPath","join","certPath","key","readFileSync","cert","info","installCertutil","err"],"mappings":";;AAAA,MAAMA,yBAAyB,GAAGC,OAAO,CAAE,aAAF,CAAP,CAAuBC,OAAzD;;AACA,MAAMC,MAAM,GAAGF,OAAO,CAAE,yBAAF,CAAtB;;AACA,MAAMG,EAAE,GAAGH,OAAO,CAAE,IAAF,CAAlB;;AACA,MAAMI,IAAI,GAAGJ,OAAO,CAAE,MAAF,CAApB;;AAEAK,MAAM,CAACC,OAAP,GAAiB,OAAO;AAAEC,EAAAA,IAAF;AAAQC,EAAAA,QAAR;AAAkBC,EAAAA,OAAlB;AAA2BC,EAAAA;AAA3B,CAAP,KAAkD;AACjE;AACA;AACA,MAAIF,QAAQ,GAAG,CAACC,OAAJ,GAAcA,OAA1B,EAAmC;AACjCP,IAAAA,MAAM,CAACS,KAAP,CACG,2EADH;AAGD;;AAED,MAAIH,QAAQ,IAAIC,OAAhB,EAAyB;AACvB,UAAMG,OAAO,GAAGR,IAAI,CAACS,IAAL,CAAUH,SAAV,EAAqBD,OAArB,CAAhB;AACA,UAAMK,QAAQ,GAAGV,IAAI,CAACS,IAAL,CAAUH,SAAV,EAAqBF,QAArB,CAAjB;AAEA,WAAO,MAAM;AACXI,MAAAA,OADW;AAEXE,MAAAA,QAFW;AAGXC,MAAAA,GAAG,EAAEZ,EAAE,CAACa,YAAH,CAAgBJ,OAAhB,CAHM;AAIXK,MAAAA,IAAI,EAAEd,EAAE,CAACa,YAAH,CAAgBF,QAAhB;AAJK,KAAb;AAMD;;AAEDZ,EAAAA,MAAM,CAACgB,IAAP,CAAa,2DAAb;;AACA,MAAI;AACF,WAAO,MAAMnB,yBAAyB,CAACQ,IAAD,EAAO;AAC3CY,MAAAA,eAAe,EAAE;AAD0B,KAAP,CAAtC;AAGD,GAJD,CAIE,OAAOC,GAAP,EAAY;AACZlB,IAAAA,MAAM,CAACS,KAAP,CAAc,0CAAd,EAAyDS,GAAzD;AACD;;AAED,SAAO,KAAP;AACD,CA/BD","sourcesContent":["const getDevelopmentCertificate = require(`devcert-san`).default\nconst report = require(`gatsby-cli/lib/reporter`)\nconst fs = require(`fs`)\nconst path = require(`path`)\n\nmodule.exports = async ({ name, certFile, keyFile, directory }) => {\n  // check that cert file and key file are both true or both false, if they are both\n  // false, it defaults to the automatic ssl\n  if (certFile ? !keyFile : keyFile) {\n    report.panic(\n      `for custom ssl --https, --cert-file, and --key-file must be used together`\n    )\n  }\n\n  if (certFile && keyFile) {\n    const keyPath = path.join(directory, keyFile)\n    const certPath = path.join(directory, certFile)\n\n    return await {\n      keyPath,\n      certPath,\n      key: fs.readFileSync(keyPath),\n      cert: fs.readFileSync(certPath),\n    }\n  }\n\n  report.info(`setting up automatic SSL certificate (may require sudo)\\n`)\n  try {\n    return await getDevelopmentCertificate(name, {\n      installCertutil: true,\n    })\n  } catch (err) {\n    report.panic(`\\nFailed to generate dev SSL certificate`, err)\n  }\n\n  return false\n}\n"],"file":"get-ssl-cert.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/utils/html-renderer-queue.js
+++ b/node_modules/gatsby/dist/utils/html-renderer-queue.js
@@ -8,15 +8,34 @@ const Worker = require(`jest-worker`).default;
 
 const numWorkers = require(`physical-cpu-count`) || 1;
 
-const _require = require(`lodash`),
-      chunk = _require.chunk;
+const {
+  chunk
+} = require(`lodash`);
+
+const {
+  store
+} = require(`../redux`);
+
+const fs = require(`fs-extra`);
+
+const path = require(`path`);
 
 const workerPool = new Worker(require.resolve(`./worker`), {
   numWorkers,
   forkOptions: {
     silent: false
   }
-});
+}); // copied from https://github.com/markdalgleish/static-site-generator-webpack-plugin/blob/master/index.js#L161
+
+const generatePathToOutput = outputPath => {
+  let outputFileName = outputPath.replace(/^(\/|\\)/, ``); // Remove leading slashes for webpack-dev-server
+
+  if (!/\.(html?)$/i.test(outputFileName)) {
+    outputFileName = path.join(outputFileName, `index.html`);
+  }
+
+  return path.join(process.cwd(), `public`, outputFileName);
+};
 
 module.exports = (htmlComponentRendererPath, pages, activity) => new Promise((resolve, reject) => {
   // We need to only pass env vars that are set programatically in gatsby-cli
@@ -33,7 +52,29 @@ module.exports = (htmlComponentRendererPath, pages, activity) => new Promise((re
     workerPool.renderHTML({
       htmlComponentRendererPath,
       paths: pageSegment,
-      envVars
+      envVars,
+      store
+    }).then(async results => {
+      await Promise.all(results.map(async ({
+        path: outputPath,
+        html,
+        renderData
+      }) => {
+        await fs.outputFile(generatePathToOutput(outputPath), html);
+        const {
+          program,
+          pages,
+          jsonDataPaths
+        } = store.getState();
+        const page = pages.get(outputPath);
+        const jsonDataPath = jsonDataPaths[page.jsonName];
+        const resultPath = path.join(program.directory, `public`, `static`, `d`, `${jsonDataPath}.json`);
+        const jsonData = await fs.readJson(resultPath);
+        const newJsonData = { ...jsonData,
+          render: renderData || {}
+        };
+        await fs.writeJson(resultPath, newJsonData);
+      }));
     }).then(() => {
       finished += pageSegment.length;
 
--- a/node_modules/gatsby/dist/utils/html-renderer-queue.js.map
+++ b/node_modules/gatsby/dist/utils/html-renderer-queue.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/utils/html-renderer-queue.js"],"names":["Promise","require","convertHrtime","Worker","default","numWorkers","chunk","workerPool","resolve","forkOptions","silent","module","exports","htmlComponentRendererPath","pages","activity","reject","envVars","Object","entries","NODE_ENV","process","env","gatsby_executing_command","gatsby_log_level","start","hrtime","segments","finished","map","pageSegment","renderHTML","paths","then","length","setStatus","seconds","toFixed","catch"],"mappings":";;AAAA,MAAMA,OAAO,GAAGC,OAAO,CAAE,UAAF,CAAvB;;AACA,MAAMC,aAAa,GAAGD,OAAO,CAAE,gBAAF,CAA7B;;AACA,MAAME,MAAM,GAAGF,OAAO,CAAE,aAAF,CAAP,CAAuBG,OAAtC;;AACA,MAAMC,UAAU,GAAGJ,OAAO,CAAE,oBAAF,CAAP,IAAiC,CAApD;;iBACkBA,OAAO,CAAE,QAAF,C;MAAjBK,K,YAAAA,K;;AAER,MAAMC,UAAU,GAAG,IAAIJ,MAAJ,CAAWF,OAAO,CAACO,OAAR,CAAiB,UAAjB,CAAX,EAAwC;AACzDH,EAAAA,UADyD;AAEzDI,EAAAA,WAAW,EAAE;AACXC,IAAAA,MAAM,EAAE;AADG;AAF4C,CAAxC,CAAnB;;AAOAC,MAAM,CAACC,OAAP,GAAiB,CAACC,yBAAD,EAA4BC,KAA5B,EAAmCC,QAAnC,KACf,IAAIf,OAAJ,CAAY,CAACQ,OAAD,EAAUQ,MAAV,KAAqB;AAC/B;AACA;AACA,QAAMC,OAAO,GAAGC,MAAM,CAACC,OAAP,CAAe;AAC7BC,IAAAA,QAAQ,EAAEC,OAAO,CAACC,GAAR,CAAYF,QADO;AAE7BG,IAAAA,wBAAwB,EAAEF,OAAO,CAACC,GAAR,CAAYC,wBAFT;AAG7BC,IAAAA,gBAAgB,EAAEH,OAAO,CAACC,GAAR,CAAYE;AAHD,GAAf,CAAhB;AAMA,QAAMC,KAAK,GAAGJ,OAAO,CAACK,MAAR,EAAd;AACA,QAAMC,QAAQ,GAAGrB,KAAK,CAACQ,KAAD,EAAQ,EAAR,CAAtB;AACA,MAAIc,QAAQ,GAAG,CAAf;AAEA5B,EAAAA,OAAO,CAAC6B,GAAR,CACEF,QADF,EAEEG,WAAW,IACT,IAAI9B,OAAJ,CAAY,CAACQ,OAAD,EAAUQ,MAAV,KAAqB;AAC/BT,IAAAA,UAAU,CACPwB,UADH,CACc;AACVlB,MAAAA,yBADU;AAEVmB,MAAAA,KAAK,EAAEF,WAFG;AAGVb,MAAAA;AAHU,KADd,EAMGgB,IANH,CAMQ,MAAM;AACVL,MAAAA,QAAQ,IAAIE,WAAW,CAACI,MAAxB;;AACA,UAAInB,QAAJ,EAAc;AACZA,QAAAA,QAAQ,CAACoB,SAAT,CACG,GAAEP,QAAS,IAAGd,KAAK,CAACoB,MAAO,IAAG,CAC7BN,QAAQ,GAAG1B,aAAa,CAACmB,OAAO,CAACK,MAAR,CAAeD,KAAf,CAAD,CAAb,CAAqCW,OADnB,EAE7BC,OAF6B,CAErB,CAFqB,CAElB,eAHf;AAKD;;AACD7B,MAAAA,OAAO;AACR,KAhBH,EAiBG8B,KAjBH,CAiBStB,MAjBT;AAkBD,GAnBD,CAHJ,EAwBGiB,IAxBH,CAwBQzB,OAxBR,EAyBG8B,KAzBH,CAyBStB,MAzBT;AA0BD,CAvCD,CADF","sourcesContent":["const Promise = require(`bluebird`)\nconst convertHrtime = require(`convert-hrtime`)\nconst Worker = require(`jest-worker`).default\nconst numWorkers = require(`physical-cpu-count`) || 1\nconst { chunk } = require(`lodash`)\n\nconst workerPool = new Worker(require.resolve(`./worker`), {\n  numWorkers,\n  forkOptions: {\n    silent: false,\n  },\n})\n\nmodule.exports = (htmlComponentRendererPath, pages, activity) =>\n  new Promise((resolve, reject) => {\n    // We need to only pass env vars that are set programatically in gatsby-cli\n    // to child process. Other vars will be picked up from environment.\n    const envVars = Object.entries({\n      NODE_ENV: process.env.NODE_ENV,\n      gatsby_executing_command: process.env.gatsby_executing_command,\n      gatsby_log_level: process.env.gatsby_log_level,\n    })\n\n    const start = process.hrtime()\n    const segments = chunk(pages, 50)\n    let finished = 0\n\n    Promise.map(\n      segments,\n      pageSegment =>\n        new Promise((resolve, reject) => {\n          workerPool\n            .renderHTML({\n              htmlComponentRendererPath,\n              paths: pageSegment,\n              envVars,\n            })\n            .then(() => {\n              finished += pageSegment.length\n              if (activity) {\n                activity.setStatus(\n                  `${finished}/${pages.length} ${(\n                    finished / convertHrtime(process.hrtime(start)).seconds\n                  ).toFixed(2)} pages/second`\n                )\n              }\n              resolve()\n            })\n            .catch(reject)\n        })\n    )\n      .then(resolve)\n      .catch(reject)\n  })\n"],"file":"html-renderer-queue.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/utils/html-renderer-queue.js"],"names":["Promise","require","convertHrtime","Worker","default","numWorkers","chunk","store","fs","path","workerPool","resolve","forkOptions","silent","generatePathToOutput","outputPath","outputFileName","replace","test","join","process","cwd","module","exports","htmlComponentRendererPath","pages","activity","reject","envVars","Object","entries","NODE_ENV","env","gatsby_executing_command","gatsby_log_level","start","hrtime","segments","finished","map","pageSegment","renderHTML","paths","then","results","all","html","renderData","outputFile","program","jsonDataPaths","getState","page","get","jsonDataPath","jsonName","resultPath","directory","jsonData","readJson","newJsonData","render","writeJson","length","setStatus","seconds","toFixed","catch"],"mappings":"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","sourcesContent":["const Promise = require(`bluebird`)\nconst convertHrtime = require(`convert-hrtime`)\nconst Worker = require(`jest-worker`).default\nconst numWorkers = require(`physical-cpu-count`) || 1\nconst { chunk } = require(`lodash`)\nconst { store } = require(`../redux`)\nconst fs = require(`fs-extra`)\nconst path = require(`path`)\n\nconst workerPool = new Worker(require.resolve(`./worker`), {\n  numWorkers,\n  forkOptions: {\n    silent: false,\n  },\n})\n\n// copied from https://github.com/markdalgleish/static-site-generator-webpack-plugin/blob/master/index.js#L161\nconst generatePathToOutput = outputPath => {\n  let outputFileName = outputPath.replace(/^(\\/|\\\\)/, ``) // Remove leading slashes for webpack-dev-server\n\n  if (!/\\.(html?)$/i.test(outputFileName)) {\n    outputFileName = path.join(outputFileName, `index.html`)\n  }\n\n  return path.join(process.cwd(), `public`, outputFileName)\n}\n\nmodule.exports = (htmlComponentRendererPath, pages, activity) =>\n  new Promise((resolve, reject) => {\n    // We need to only pass env vars that are set programatically in gatsby-cli\n    // to child process. Other vars will be picked up from environment.\n    const envVars = Object.entries({\n      NODE_ENV: process.env.NODE_ENV,\n      gatsby_executing_command: process.env.gatsby_executing_command,\n      gatsby_log_level: process.env.gatsby_log_level,\n    })\n\n    const start = process.hrtime()\n    const segments = chunk(pages, 50)\n    let finished = 0\n\n    Promise.map(\n      segments,\n      pageSegment =>\n        new Promise((resolve, reject) => {\n          workerPool\n            .renderHTML({\n              htmlComponentRendererPath,\n              paths: pageSegment,\n              envVars,\n              store,\n            })\n            .then(async results => {\n              await Promise.all(\n                results.map(async ({ path: outputPath, html, renderData }) => {\n                  await fs.outputFile(generatePathToOutput(outputPath), html)\n\n                  const { program, pages, jsonDataPaths } = store.getState()\n                  const page = pages.get(outputPath)\n                  const jsonDataPath = jsonDataPaths[page.jsonName]\n\n                  const resultPath = path.join(\n                    program.directory,\n                    `public`,\n                    `static`,\n                    `d`,\n                    `${jsonDataPath}.json`\n                  )\n                  const jsonData = await fs.readJson(resultPath)\n                  const newJsonData = {\n                    ...jsonData,\n                    render: renderData || {},\n                  }\n                  await fs.writeJson(resultPath, newJsonData)\n                })\n              )\n            })\n            .then(() => {\n              finished += pageSegment.length\n              if (activity) {\n                activity.setStatus(\n                  `${finished}/${pages.length} ${(\n                    finished / convertHrtime(process.hrtime(start)).seconds\n                  ).toFixed(2)} pages/second`\n                )\n              }\n              resolve()\n            })\n            .catch(reject)\n        })\n    )\n      .then(resolve)\n      .catch(reject)\n  })\n"],"file":"html-renderer-queue.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/utils/js-chunk-names.js
+++ b/node_modules/gatsby/dist/utils/js-chunk-names.js
@@ -8,8 +8,9 @@ const path = require(`path`);
 
 const kebabHash = require(`kebab-hash`);
 
-const _require = require(`../redux`),
-      store = _require.store;
+const {
+  store
+} = require(`../redux`);
 
 const generatePathChunkName = path => {
   const name = path === `/` ? `index` : kebabHash(path);
--- a/node_modules/gatsby/dist/utils/js-chunk-names.js.map
+++ b/node_modules/gatsby/dist/utils/js-chunk-names.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/utils/js-chunk-names.js"],"names":["path","require","kebabHash","store","generatePathChunkName","name","generateComponentChunkName","componentPath","program","getState","directory","relative","_","kebabCase","exports"],"mappings":";;;;AAAA;;AACA,MAAMA,IAAI,GAAGC,OAAO,CAAE,MAAF,CAApB;;AACA,MAAMC,SAAS,GAAGD,OAAO,CAAE,YAAF,CAAzB;;iBACkBA,OAAO,CAAE,UAAF,C;MAAjBE,K,YAAAA,K;;AAER,MAAMC,qBAAqB,GAAGJ,IAAI,IAAI;AACpC,QAAMK,IAAI,GAAGL,IAAI,KAAM,GAAV,GAAgB,OAAhB,GAAyBE,SAAS,CAACF,IAAD,CAA/C;AACA,SAAQ,UAASK,IAAK,EAAtB;AACD,CAHD;;AAKA,MAAMC,0BAA0B,GAAGC,aAAa,IAAI;AAClD,QAAMC,OAAO,GAAGL,KAAK,CAACM,QAAN,GAAiBD,OAAjC;AACA,MAAIE,SAAS,GAAI,GAAjB;;AACA,MAAIF,OAAO,IAAIA,OAAO,CAACE,SAAvB,EAAkC;AAChCA,IAAAA,SAAS,GAAGF,OAAO,CAACE,SAApB;AACD;;AACD,QAAML,IAAI,GAAGL,IAAI,CAACW,QAAL,CAAcD,SAAd,EAAyBH,aAAzB,CAAb;AACA,SAAQ,eAAcK,gBAAEC,SAAF,CAAYR,IAAZ,CAAkB,EAAxC;AACD,CARD;;AAUAS,OAAO,CAACV,qBAAR,GAAgCA,qBAAhC;AACAU,OAAO,CAACR,0BAAR,GAAqCA,0BAArC","sourcesContent":["import _ from \"lodash\"\nconst path = require(`path`)\nconst kebabHash = require(`kebab-hash`)\nconst { store } = require(`../redux`)\n\nconst generatePathChunkName = path => {\n  const name = path === `/` ? `index` : kebabHash(path)\n  return `path---${name}`\n}\n\nconst generateComponentChunkName = componentPath => {\n  const program = store.getState().program\n  let directory = `/`\n  if (program && program.directory) {\n    directory = program.directory\n  }\n  const name = path.relative(directory, componentPath)\n  return `component---${_.kebabCase(name)}`\n}\n\nexports.generatePathChunkName = generatePathChunkName\nexports.generateComponentChunkName = generateComponentChunkName\n"],"file":"js-chunk-names.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/utils/js-chunk-names.js"],"names":["path","require","kebabHash","store","generatePathChunkName","name","generateComponentChunkName","componentPath","program","getState","directory","relative","_","kebabCase","exports"],"mappings":";;;;AAAA;;AACA,MAAMA,IAAI,GAAGC,OAAO,CAAE,MAAF,CAApB;;AACA,MAAMC,SAAS,GAAGD,OAAO,CAAE,YAAF,CAAzB;;AACA,MAAM;AAAEE,EAAAA;AAAF,IAAYF,OAAO,CAAE,UAAF,CAAzB;;AAEA,MAAMG,qBAAqB,GAAGJ,IAAI,IAAI;AACpC,QAAMK,IAAI,GAAGL,IAAI,KAAM,GAAV,GAAgB,OAAhB,GAAyBE,SAAS,CAACF,IAAD,CAA/C;AACA,SAAQ,UAASK,IAAK,EAAtB;AACD,CAHD;;AAKA,MAAMC,0BAA0B,GAAGC,aAAa,IAAI;AAClD,QAAMC,OAAO,GAAGL,KAAK,CAACM,QAAN,GAAiBD,OAAjC;AACA,MAAIE,SAAS,GAAI,GAAjB;;AACA,MAAIF,OAAO,IAAIA,OAAO,CAACE,SAAvB,EAAkC;AAChCA,IAAAA,SAAS,GAAGF,OAAO,CAACE,SAApB;AACD;;AACD,QAAML,IAAI,GAAGL,IAAI,CAACW,QAAL,CAAcD,SAAd,EAAyBH,aAAzB,CAAb;AACA,SAAQ,eAAcK,gBAAEC,SAAF,CAAYR,IAAZ,CAAkB,EAAxC;AACD,CARD;;AAUAS,OAAO,CAACV,qBAAR,GAAgCA,qBAAhC;AACAU,OAAO,CAACR,0BAAR,GAAqCA,0BAArC","sourcesContent":["import _ from \"lodash\"\nconst path = require(`path`)\nconst kebabHash = require(`kebab-hash`)\nconst { store } = require(`../redux`)\n\nconst generatePathChunkName = path => {\n  const name = path === `/` ? `index` : kebabHash(path)\n  return `path---${name}`\n}\n\nconst generateComponentChunkName = componentPath => {\n  const program = store.getState().program\n  let directory = `/`\n  if (program && program.directory) {\n    directory = program.directory\n  }\n  const name = path.relative(directory, componentPath)\n  return `component---${_.kebabCase(name)}`\n}\n\nexports.generatePathChunkName = generatePathChunkName\nexports.generateComponentChunkName = generateComponentChunkName\n"],"file":"js-chunk-names.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/utils/merge-gatsby-config.js
+++ b/node_modules/gatsby/dist/utils/merge-gatsby-config.js
@@ -15,9 +15,9 @@ module.exports = (a, b) => {
     // choose a merge function for the config key if there's one defined,
     // otherwise use the default value merge function
     const mergeFn = howToMerge[gatsbyConfigKey] || howToMerge.byDefault;
-    return Object.assign({}, config, {
+    return { ...config,
       [gatsbyConfigKey]: mergeFn(a[gatsbyConfigKey], b[gatsbyConfigKey])
-    });
+    };
   }, {}); // return the fully merged config
 
   return mergedConfig;
--- a/node_modules/gatsby/dist/utils/merge-gatsby-config.js.map
+++ b/node_modules/gatsby/dist/utils/merge-gatsby-config.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/utils/merge-gatsby-config.js"],"names":["_","require","module","exports","a","b","allGatsbyConfigKeysWithAValue","uniq","Object","keys","concat","mergedConfig","reduce","config","gatsbyConfigKey","mergeFn","howToMerge","byDefault","siteMetadata","objA","objB","merge","plugins","uniqWith","isEqual","mapping"],"mappings":";;AAAA,MAAMA,CAAC,GAAGC,OAAO,CAAE,QAAF,CAAjB;AACA;;;;;AAGAC,MAAM,CAACC,OAAP,GAAiB,CAACC,CAAD,EAAIC,CAAJ,KAAU;AACzB;AACA,QAAMC,6BAA6B,GAAGN,CAAC,CAACO,IAAF,CACpCC,MAAM,CAACC,IAAP,CAAYL,CAAZ,EAAeM,MAAf,CAAsBF,MAAM,CAACC,IAAP,CAAYJ,CAAZ,CAAtB,CADoC,CAAtC,CAFyB,CAMzB;;;AACA,QAAMM,YAAY,GAAGL,6BAA6B,CAACM,MAA9B,CACnB,CAACC,MAAD,EAASC,eAAT,KAA6B;AAC3B;AACA;AACA,UAAMC,OAAO,GAAGC,UAAU,CAACF,eAAD,CAAV,IAA+BE,UAAU,CAACC,SAA1D;AACA,6BACKJ,MADL;AAEE,OAACC,eAAD,GAAmBC,OAAO,CAACX,CAAC,CAACU,eAAD,CAAF,EAAqBT,CAAC,CAACS,eAAD,CAAtB;AAF5B;AAID,GATkB,EAUnB,EAVmB,CAArB,CAPyB,CAoBzB;;AACA,SAAOH,YAAP;AACD,CAtBD;;AAuBA,MAAMK,UAAU,GAAG;AACjB;;;;;AAKAC,EAAAA,SAAS,EAAE,CAACb,CAAD,EAAIC,CAAJ,KAAUA,CAAC,IAAID,CANT;AAOjBc,EAAAA,YAAY,EAAE,CAACC,IAAD,EAAOC,IAAP,KAAgBpB,CAAC,CAACqB,KAAF,CAAQ,EAAR,EAAYF,IAAZ,EAAkBC,IAAlB,CAPb;AAQjB;AACAE,EAAAA,OAAO,EAAE,CAAClB,CAAC,GAAG,EAAL,EAASC,CAAC,GAAG,EAAb,KAAoBL,CAAC,CAACuB,QAAF,CAAWnB,CAAC,CAACM,MAAF,CAASL,CAAT,CAAX,EAAwBL,CAAC,CAACwB,OAA1B,CATZ;AAUjBC,EAAAA,OAAO,EAAE,CAACN,IAAD,EAAOC,IAAP,KAAgBpB,CAAC,CAACqB,KAAF,CAAQ,EAAR,EAAYF,IAAZ,EAAkBC,IAAlB;AAVR,CAAnB","sourcesContent":["const _ = require(`lodash`)\n/**\n * Defines how a theme object is merged with the user's config\n */\nmodule.exports = (a, b) => {\n  // a and b are gatsby configs, If they have keys, that means there are values to merge\n  const allGatsbyConfigKeysWithAValue = _.uniq(\n    Object.keys(a).concat(Object.keys(b))\n  )\n\n  // reduce the array of mergable keys into a single gatsby config object\n  const mergedConfig = allGatsbyConfigKeysWithAValue.reduce(\n    (config, gatsbyConfigKey) => {\n      // choose a merge function for the config key if there's one defined,\n      // otherwise use the default value merge function\n      const mergeFn = howToMerge[gatsbyConfigKey] || howToMerge.byDefault\n      return {\n        ...config,\n        [gatsbyConfigKey]: mergeFn(a[gatsbyConfigKey], b[gatsbyConfigKey]),\n      }\n    },\n    {}\n  )\n\n  // return the fully merged config\n  return mergedConfig\n}\nconst howToMerge = {\n  /**\n   * pick a truthy value by default.\n   * This makes sure that if a single value is defined, that one it used.\n   * We prefer the \"right\" value, because the user's config will be \"on the right\"\n   */\n  byDefault: (a, b) => b || a,\n  siteMetadata: (objA, objB) => _.merge({}, objA, objB),\n  // plugins are concatenated and uniq'd, so we don't get two of the same plugin value\n  plugins: (a = [], b = []) => _.uniqWith(a.concat(b), _.isEqual),\n  mapping: (objA, objB) => _.merge({}, objA, objB),\n}\n"],"file":"merge-gatsby-config.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/utils/merge-gatsby-config.js"],"names":["_","require","module","exports","a","b","allGatsbyConfigKeysWithAValue","uniq","Object","keys","concat","mergedConfig","reduce","config","gatsbyConfigKey","mergeFn","howToMerge","byDefault","siteMetadata","objA","objB","merge","plugins","uniqWith","isEqual","mapping"],"mappings":";;AAAA,MAAMA,CAAC,GAAGC,OAAO,CAAE,QAAF,CAAjB;AACA;;;;;AAGAC,MAAM,CAACC,OAAP,GAAiB,CAACC,CAAD,EAAIC,CAAJ,KAAU;AACzB;AACA,QAAMC,6BAA6B,GAAGN,CAAC,CAACO,IAAF,CACpCC,MAAM,CAACC,IAAP,CAAYL,CAAZ,EAAeM,MAAf,CAAsBF,MAAM,CAACC,IAAP,CAAYJ,CAAZ,CAAtB,CADoC,CAAtC,CAFyB,CAMzB;;;AACA,QAAMM,YAAY,GAAGL,6BAA6B,CAACM,MAA9B,CACnB,CAACC,MAAD,EAASC,eAAT,KAA6B;AAC3B;AACA;AACA,UAAMC,OAAO,GAAGC,UAAU,CAACF,eAAD,CAAV,IAA+BE,UAAU,CAACC,SAA1D;AACA,WAAO,EACL,GAAGJ,MADE;AAEL,OAACC,eAAD,GAAmBC,OAAO,CAACX,CAAC,CAACU,eAAD,CAAF,EAAqBT,CAAC,CAACS,eAAD,CAAtB;AAFrB,KAAP;AAID,GATkB,EAUnB,EAVmB,CAArB,CAPyB,CAoBzB;;AACA,SAAOH,YAAP;AACD,CAtBD;;AAuBA,MAAMK,UAAU,GAAG;AACjB;;;;;AAKAC,EAAAA,SAAS,EAAE,CAACb,CAAD,EAAIC,CAAJ,KAAUA,CAAC,IAAID,CANT;AAOjBc,EAAAA,YAAY,EAAE,CAACC,IAAD,EAAOC,IAAP,KAAgBpB,CAAC,CAACqB,KAAF,CAAQ,EAAR,EAAYF,IAAZ,EAAkBC,IAAlB,CAPb;AAQjB;AACAE,EAAAA,OAAO,EAAE,CAAClB,CAAC,GAAG,EAAL,EAASC,CAAC,GAAG,EAAb,KAAoBL,CAAC,CAACuB,QAAF,CAAWnB,CAAC,CAACM,MAAF,CAASL,CAAT,CAAX,EAAwBL,CAAC,CAACwB,OAA1B,CATZ;AAUjBC,EAAAA,OAAO,EAAE,CAACN,IAAD,EAAOC,IAAP,KAAgBpB,CAAC,CAACqB,KAAF,CAAQ,EAAR,EAAYF,IAAZ,EAAkBC,IAAlB;AAVR,CAAnB","sourcesContent":["const _ = require(`lodash`)\n/**\n * Defines how a theme object is merged with the user's config\n */\nmodule.exports = (a, b) => {\n  // a and b are gatsby configs, If they have keys, that means there are values to merge\n  const allGatsbyConfigKeysWithAValue = _.uniq(\n    Object.keys(a).concat(Object.keys(b))\n  )\n\n  // reduce the array of mergable keys into a single gatsby config object\n  const mergedConfig = allGatsbyConfigKeysWithAValue.reduce(\n    (config, gatsbyConfigKey) => {\n      // choose a merge function for the config key if there's one defined,\n      // otherwise use the default value merge function\n      const mergeFn = howToMerge[gatsbyConfigKey] || howToMerge.byDefault\n      return {\n        ...config,\n        [gatsbyConfigKey]: mergeFn(a[gatsbyConfigKey], b[gatsbyConfigKey]),\n      }\n    },\n    {}\n  )\n\n  // return the fully merged config\n  return mergedConfig\n}\nconst howToMerge = {\n  /**\n   * pick a truthy value by default.\n   * This makes sure that if a single value is defined, that one it used.\n   * We prefer the \"right\" value, because the user's config will be \"on the right\"\n   */\n  byDefault: (a, b) => b || a,\n  siteMetadata: (objA, objB) => _.merge({}, objA, objB),\n  // plugins are concatenated and uniq'd, so we don't get two of the same plugin value\n  plugins: (a = [], b = []) => _.uniqWith(a.concat(b), _.isEqual),\n  mapping: (objA, objB) => _.merge({}, objA, objB),\n}\n"],"file":"merge-gatsby-config.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/utils/source-nodes.js
+++ b/node_modules/gatsby/dist/utils/source-nodes.js
@@ -1,26 +1,27 @@
 "use strict";
 
-var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
-
-var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
-
 const _ = require(`lodash`);
 
 const report = require(`gatsby-cli/lib/reporter`);
 
 const apiRunner = require(`./api-runner-node`);
 
-const _require = require(`../redux`),
-      store = _require.store;
+const {
+  store
+} = require(`../redux`);
 
-const _require2 = require(`../db/nodes`),
-      getNode = _require2.getNode,
-      getNodes = _require2.getNodes;
+const {
+  getNode,
+  getNodes
+} = require(`../db/nodes`);
 
-const _require3 = require(`../redux/actions`),
-      boundActionCreators = _require3.boundActionCreators;
+const {
+  boundActionCreators
+} = require(`../redux/actions`);
 
-const deleteNode = boundActionCreators.deleteNode;
+const {
+  deleteNode
+} = boundActionCreators;
 /**
  * Finds the name of all plugins which implement Gatsby APIs that
  * may create nodes, but which have not actually created any nodes.
@@ -39,49 +40,41 @@ function discoverPluginsWithoutNodes(storeState) {
   return _.difference(nodeCreationPlugins, nodeOwners);
 }
 
-module.exports =
-/*#__PURE__*/
-function () {
-  var _ref = (0, _asyncToGenerator2.default)(function* ({
-    parentSpan
-  } = {}) {
-    yield apiRunner(`sourceNodes`, {
-      traceId: `initial-sourceNodes`,
-      waitForCascadingActions: true,
-      parentSpan: parentSpan
-    });
-    const state = store.getState(); // Warn about plugins that should have created nodes but didn't.
-
-    const pluginsWithNoNodes = discoverPluginsWithoutNodes(state);
-    pluginsWithNoNodes.map(name => report.warn(`The ${name} plugin has generated no Gatsby nodes. Do you need it?`)); // Garbage collect stale data nodes
-
-    const touchedNodes = Object.keys(state.nodesTouched);
-    const staleNodes = Array.from(getNodes()).filter(node => {
-      // Find the root node.
-      let rootNode = node;
-      let whileCount = 0;
-
-      while (rootNode.parent && getNode(rootNode.parent) !== undefined && whileCount < 101) {
-        rootNode = getNode(rootNode.parent);
-        whileCount += 1;
-
-        if (whileCount > 100) {
-          console.log(`It looks like you have a node that's set its parent as itself`, rootNode);
-        }
-      }
+module.exports = async ({
+  parentSpan
+} = {}) => {
+  await apiRunner(`sourceNodes`, {
+    traceId: `initial-sourceNodes`,
+    waitForCascadingActions: true,
+    parentSpan: parentSpan
+  });
+  const state = store.getState(); // Warn about plugins that should have created nodes but didn't.
 
-      return !_.includes(touchedNodes, rootNode.id);
-    });
+  const pluginsWithNoNodes = discoverPluginsWithoutNodes(state);
+  pluginsWithNoNodes.map(name => report.warn(`The ${name} plugin has generated no Gatsby nodes. Do you need it?`)); // Garbage collect stale data nodes
 
-    if (staleNodes.length > 0) {
-      staleNodes.forEach(node => deleteNode({
-        node
-      }));
+  const touchedNodes = Object.keys(state.nodesTouched);
+  const staleNodes = Array.from(getNodes()).filter(node => {
+    // Find the root node.
+    let rootNode = node;
+    let whileCount = 0;
+
+    while (rootNode.parent && getNode(rootNode.parent) !== undefined && whileCount < 101) {
+      rootNode = getNode(rootNode.parent);
+      whileCount += 1;
+
+      if (whileCount > 100) {
+        console.log(`It looks like you have a node that's set its parent as itself`, rootNode);
+      }
     }
+
+    return !_.includes(touchedNodes, rootNode.id);
   });
 
-  return function () {
-    return _ref.apply(this, arguments);
-  };
-}();
+  if (staleNodes.length > 0) {
+    staleNodes.forEach(node => deleteNode({
+      node
+    }));
+  }
+};
 //# sourceMappingURL=source-nodes.js.map
\ No newline at end of file
--- a/node_modules/gatsby/dist/utils/source-nodes.js.map
+++ b/node_modules/gatsby/dist/utils/source-nodes.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/utils/source-nodes.js"],"names":["_","require","report","apiRunner","store","getNode","getNodes","boundActionCreators","deleteNode","discoverPluginsWithoutNodes","storeState","nodeCreationPlugins","without","union","apiToPlugins","sourceNodes","nodeOwners","uniq","Array","from","reduce","acc","node","push","internal","owner","difference","module","exports","parentSpan","traceId","waitForCascadingActions","state","getState","pluginsWithNoNodes","map","name","warn","touchedNodes","Object","keys","nodesTouched","staleNodes","filter","rootNode","whileCount","parent","undefined","console","log","includes","id","length","forEach"],"mappings":"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","sourcesContent":["const _ = require(`lodash`)\nconst report = require(`gatsby-cli/lib/reporter`)\n\nconst apiRunner = require(`./api-runner-node`)\nconst { store } = require(`../redux`)\nconst { getNode, getNodes } = require(`../db/nodes`)\nconst { boundActionCreators } = require(`../redux/actions`)\nconst { deleteNode } = boundActionCreators\n\n/**\n * Finds the name of all plugins which implement Gatsby APIs that\n * may create nodes, but which have not actually created any nodes.\n */\nfunction discoverPluginsWithoutNodes(storeState) {\n  // Discover which plugins implement APIs which may create nodes\n  const nodeCreationPlugins = _.without(\n    _.union(storeState.apiToPlugins.sourceNodes),\n    `default-site-plugin`\n  )\n  // Find out which plugins own already created nodes\n  const nodeOwners = _.uniq(\n    Array.from(getNodes()).reduce((acc, node) => {\n      acc.push(node.internal.owner)\n      return acc\n    }, [])\n  )\n  return _.difference(nodeCreationPlugins, nodeOwners)\n}\n\nmodule.exports = async ({ parentSpan } = {}) => {\n  await apiRunner(`sourceNodes`, {\n    traceId: `initial-sourceNodes`,\n    waitForCascadingActions: true,\n    parentSpan: parentSpan,\n  })\n\n  const state = store.getState()\n\n  // Warn about plugins that should have created nodes but didn't.\n  const pluginsWithNoNodes = discoverPluginsWithoutNodes(state)\n  pluginsWithNoNodes.map(name =>\n    report.warn(\n      `The ${name} plugin has generated no Gatsby nodes. Do you need it?`\n    )\n  )\n\n  // Garbage collect stale data nodes\n  const touchedNodes = Object.keys(state.nodesTouched)\n  const staleNodes = Array.from(getNodes()).filter(node => {\n    // Find the root node.\n    let rootNode = node\n    let whileCount = 0\n    while (\n      rootNode.parent &&\n      getNode(rootNode.parent) !== undefined &&\n      whileCount < 101\n    ) {\n      rootNode = getNode(rootNode.parent)\n      whileCount += 1\n      if (whileCount > 100) {\n        console.log(\n          `It looks like you have a node that's set its parent as itself`,\n          rootNode\n        )\n      }\n    }\n\n    return !_.includes(touchedNodes, rootNode.id)\n  })\n\n  if (staleNodes.length > 0) {\n    staleNodes.forEach(node => deleteNode({ node }))\n  }\n}\n"],"file":"source-nodes.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/utils/source-nodes.js"],"names":["_","require","report","apiRunner","store","getNode","getNodes","boundActionCreators","deleteNode","discoverPluginsWithoutNodes","storeState","nodeCreationPlugins","without","union","apiToPlugins","sourceNodes","nodeOwners","uniq","Array","from","reduce","acc","node","push","internal","owner","difference","module","exports","parentSpan","traceId","waitForCascadingActions","state","getState","pluginsWithNoNodes","map","name","warn","touchedNodes","Object","keys","nodesTouched","staleNodes","filter","rootNode","whileCount","parent","undefined","console","log","includes","id","length","forEach"],"mappings":"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","sourcesContent":["const _ = require(`lodash`)\nconst report = require(`gatsby-cli/lib/reporter`)\n\nconst apiRunner = require(`./api-runner-node`)\nconst { store } = require(`../redux`)\nconst { getNode, getNodes } = require(`../db/nodes`)\nconst { boundActionCreators } = require(`../redux/actions`)\nconst { deleteNode } = boundActionCreators\n\n/**\n * Finds the name of all plugins which implement Gatsby APIs that\n * may create nodes, but which have not actually created any nodes.\n */\nfunction discoverPluginsWithoutNodes(storeState) {\n  // Discover which plugins implement APIs which may create nodes\n  const nodeCreationPlugins = _.without(\n    _.union(storeState.apiToPlugins.sourceNodes),\n    `default-site-plugin`\n  )\n  // Find out which plugins own already created nodes\n  const nodeOwners = _.uniq(\n    Array.from(getNodes()).reduce((acc, node) => {\n      acc.push(node.internal.owner)\n      return acc\n    }, [])\n  )\n  return _.difference(nodeCreationPlugins, nodeOwners)\n}\n\nmodule.exports = async ({ parentSpan } = {}) => {\n  await apiRunner(`sourceNodes`, {\n    traceId: `initial-sourceNodes`,\n    waitForCascadingActions: true,\n    parentSpan: parentSpan,\n  })\n\n  const state = store.getState()\n\n  // Warn about plugins that should have created nodes but didn't.\n  const pluginsWithNoNodes = discoverPluginsWithoutNodes(state)\n  pluginsWithNoNodes.map(name =>\n    report.warn(\n      `The ${name} plugin has generated no Gatsby nodes. Do you need it?`\n    )\n  )\n\n  // Garbage collect stale data nodes\n  const touchedNodes = Object.keys(state.nodesTouched)\n  const staleNodes = Array.from(getNodes()).filter(node => {\n    // Find the root node.\n    let rootNode = node\n    let whileCount = 0\n    while (\n      rootNode.parent &&\n      getNode(rootNode.parent) !== undefined &&\n      whileCount < 101\n    ) {\n      rootNode = getNode(rootNode.parent)\n      whileCount += 1\n      if (whileCount > 100) {\n        console.log(\n          `It looks like you have a node that's set its parent as itself`,\n          rootNode\n        )\n      }\n    }\n\n    return !_.includes(touchedNodes, rootNode.id)\n  })\n\n  if (staleNodes.length > 0) {\n    staleNodes.forEach(node => deleteNode({ node }))\n  }\n}\n"],"file":"source-nodes.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/utils/tracer/index.js
+++ b/node_modules/gatsby/dist/utils/tracer/index.js
@@ -1,9 +1,5 @@
 "use strict";
 
-var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
-
-var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
-
 const slash = require(`slash`);
 
 const path = require(`path`);
@@ -36,17 +32,10 @@ function initTracer(tracerFile) {
   return tracer;
 }
 
-function stopTracer() {
-  return _stopTracer.apply(this, arguments);
-}
-
-function _stopTracer() {
-  _stopTracer = (0, _asyncToGenerator2.default)(function* () {
-    if (tracerProvider && tracerProvider.stop) {
-      yield tracerProvider.stop();
-    }
-  });
-  return _stopTracer.apply(this, arguments);
+async function stopTracer() {
+  if (tracerProvider && tracerProvider.stop) {
+    await tracerProvider.stop();
+  }
 }
 
 module.exports = {
--- a/node_modules/gatsby/dist/utils/tracer/index.js.map
+++ b/node_modules/gatsby/dist/utils/tracer/index.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../../src/utils/tracer/index.js"],"names":["slash","require","path","opentracing","tracerProvider","initTracer","tracerFile","tracer","resolvedPath","resolve","create","Tracer","initGlobalTracer","stopTracer","stop","module","exports"],"mappings":";;;;;;AAAA,MAAMA,KAAK,GAAGC,OAAO,CAAE,OAAF,CAArB;;AACA,MAAMC,IAAI,GAAGD,OAAO,CAAE,MAAF,CAApB;;AACA,MAAME,WAAW,GAAGF,OAAO,CAAE,aAAF,CAA3B;;AAEA,IAAIG,cAAJ;AAEA;;;;;;;;;;AASA,SAASC,UAAT,CAAoBC,UAApB,EAAgC;AAC9B,MAAIC,MAAJ;;AACA,MAAID,UAAJ,EAAgB;AACd,UAAME,YAAY,GAAGR,KAAK,CAACE,IAAI,CAACO,OAAL,CAAaH,UAAb,CAAD,CAA1B;AACAF,IAAAA,cAAc,GAAGH,OAAO,CAACO,YAAD,CAAxB;AACAD,IAAAA,MAAM,GAAGH,cAAc,CAACM,MAAf,EAAT;AACD,GAJD,MAIO;AACLH,IAAAA,MAAM,GAAG,IAAIJ,WAAW,CAACQ,MAAhB,EAAT,CADK,CAC6B;AACnC;;AAEDR,EAAAA,WAAW,CAACS,gBAAZ,CAA6BL,MAA7B;AAEA,SAAOA,MAAP;AACD;;SAEcM,U;;;;;gDAAf,aAA4B;AAC1B,QAAIT,cAAc,IAAIA,cAAc,CAACU,IAArC,EAA2C;AACzC,YAAMV,cAAc,CAACU,IAAf,EAAN;AACD;AACF,G;;;;AAEDC,MAAM,CAACC,OAAP,GAAiB;AACfX,EAAAA,UADe;AAEfQ,EAAAA;AAFe,CAAjB","sourcesContent":["const slash = require(`slash`)\nconst path = require(`path`)\nconst opentracing = require(`opentracing`)\n\nlet tracerProvider\n\n/**\n * tracerFile should be a js file that exports two functions.\n *\n * `create` - Create and return an open-tracing compatible tracer. See\n * https://github.com/opentracing/opentracing-javascript/blob/master/src/tracer.ts\n *\n * `stop` - Run any tracer cleanup required before the node.js process\n * exits\n */\nfunction initTracer(tracerFile) {\n  let tracer\n  if (tracerFile) {\n    const resolvedPath = slash(path.resolve(tracerFile))\n    tracerProvider = require(resolvedPath)\n    tracer = tracerProvider.create()\n  } else {\n    tracer = new opentracing.Tracer() // Noop\n  }\n\n  opentracing.initGlobalTracer(tracer)\n\n  return tracer\n}\n\nasync function stopTracer() {\n  if (tracerProvider && tracerProvider.stop) {\n    await tracerProvider.stop()\n  }\n}\n\nmodule.exports = {\n  initTracer,\n  stopTracer,\n}\n"],"file":"index.js"}
\ No newline at end of file
+{"version":3,"sources":["../../../src/utils/tracer/index.js"],"names":["slash","require","path","opentracing","tracerProvider","initTracer","tracerFile","tracer","resolvedPath","resolve","create","Tracer","initGlobalTracer","stopTracer","stop","module","exports"],"mappings":";;AAAA,MAAMA,KAAK,GAAGC,OAAO,CAAE,OAAF,CAArB;;AACA,MAAMC,IAAI,GAAGD,OAAO,CAAE,MAAF,CAApB;;AACA,MAAME,WAAW,GAAGF,OAAO,CAAE,aAAF,CAA3B;;AAEA,IAAIG,cAAJ;AAEA;;;;;;;;;;AASA,SAASC,UAAT,CAAoBC,UAApB,EAAgC;AAC9B,MAAIC,MAAJ;;AACA,MAAID,UAAJ,EAAgB;AACd,UAAME,YAAY,GAAGR,KAAK,CAACE,IAAI,CAACO,OAAL,CAAaH,UAAb,CAAD,CAA1B;AACAF,IAAAA,cAAc,GAAGH,OAAO,CAACO,YAAD,CAAxB;AACAD,IAAAA,MAAM,GAAGH,cAAc,CAACM,MAAf,EAAT;AACD,GAJD,MAIO;AACLH,IAAAA,MAAM,GAAG,IAAIJ,WAAW,CAACQ,MAAhB,EAAT,CADK,CAC6B;AACnC;;AAEDR,EAAAA,WAAW,CAACS,gBAAZ,CAA6BL,MAA7B;AAEA,SAAOA,MAAP;AACD;;AAED,eAAeM,UAAf,GAA4B;AAC1B,MAAIT,cAAc,IAAIA,cAAc,CAACU,IAArC,EAA2C;AACzC,UAAMV,cAAc,CAACU,IAAf,EAAN;AACD;AACF;;AAEDC,MAAM,CAACC,OAAP,GAAiB;AACfX,EAAAA,UADe;AAEfQ,EAAAA;AAFe,CAAjB","sourcesContent":["const slash = require(`slash`)\nconst path = require(`path`)\nconst opentracing = require(`opentracing`)\n\nlet tracerProvider\n\n/**\n * tracerFile should be a js file that exports two functions.\n *\n * `create` - Create and return an open-tracing compatible tracer. See\n * https://github.com/opentracing/opentracing-javascript/blob/master/src/tracer.ts\n *\n * `stop` - Run any tracer cleanup required before the node.js process\n * exits\n */\nfunction initTracer(tracerFile) {\n  let tracer\n  if (tracerFile) {\n    const resolvedPath = slash(path.resolve(tracerFile))\n    tracerProvider = require(resolvedPath)\n    tracer = tracerProvider.create()\n  } else {\n    tracer = new opentracing.Tracer() // Noop\n  }\n\n  opentracing.initGlobalTracer(tracer)\n\n  return tracer\n}\n\nasync function stopTracer() {\n  if (tracerProvider && tracerProvider.stop) {\n    await tracerProvider.stop()\n  }\n}\n\nmodule.exports = {\n  initTracer,\n  stopTracer,\n}\n"],"file":"index.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/utils/tracer/zipkin-local.js
+++ b/node_modules/gatsby/dist/utils/tracer/zipkin-local.js
@@ -1,13 +1,10 @@
 "use strict";
 
-var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
-
-var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
-
 const zipkin = require(`zipkin`);
 
-const _require = require(`zipkin-transport-http`),
-      HttpLogger = _require.HttpLogger;
+const {
+  HttpLogger
+} = require(`zipkin-transport-http`);
 
 const ZipkinTracer = require(`zipkin-javascript-opentracing`);
 
@@ -53,57 +50,43 @@ function create() {
  */
 
 
-function stop() {
-  return _stop.apply(this, arguments);
+async function stop() {
+  // First, write all partial spans to the http logger
+  recorder.partialSpans.forEach((span, id) => {
+    if (recorder._timedOut(span)) {
+      recorder._writeSpan(id);
+    }
+  }); // Then tell http logger to process all spans in its queue
+
+  return await _processQueue();
 } // Workaround for issue in Zipkin HTTP Logger where Spans are not
 // cleared off their processing queue before the node.js process
 // exits. Code is mostly the same as the zipkin processQueue
 // implementation.
 
 
-function _stop() {
-  _stop = (0, _asyncToGenerator2.default)(function* () {
-    // First, write all partial spans to the http logger
-    recorder.partialSpans.forEach((span, id) => {
-      if (recorder._timedOut(span)) {
-        recorder._writeSpan(id);
+async function _processQueue() {
+  const self = logger;
+
+  if (self.queue.length > 0) {
+    const postBody = `[${self.queue.join(`,`)}]`;
+    return await fetch(self.endpoint, {
+      method: `POST`,
+      body: postBody,
+      headers: self.headers,
+      timeout: self.timeout
+    }).then(response => {
+      if (response.status !== 202) {
+        const err = `Unexpected response while sending Zipkin data, status:` + `${response.status}, body: ${postBody}`;
+        if (self.errorListenerSet) self.emit(`error`, new Error(err));else console.error(err);
       }
-    }); // Then tell http logger to process all spans in its queue
-
-    return yield _processQueue();
-  });
-  return _stop.apply(this, arguments);
-}
+    }).catch(error => {
+      const err = `Error sending Zipkin data ${error}`;
+      if (self.errorListenerSet) this.emit(`error`, new Error(err));else console.error(err);
+    });
+  }
 
-function _processQueue() {
-  return _processQueue2.apply(this, arguments);
-}
-
-function _processQueue2() {
-  _processQueue2 = (0, _asyncToGenerator2.default)(function* () {
-    const self = logger;
-
-    if (self.queue.length > 0) {
-      const postBody = `[${self.queue.join(`,`)}]`;
-      return yield fetch(self.endpoint, {
-        method: `POST`,
-        body: postBody,
-        headers: self.headers,
-        timeout: self.timeout
-      }).then(response => {
-        if (response.status !== 202) {
-          const err = `Unexpected response while sending Zipkin data, status:` + `${response.status}, body: ${postBody}`;
-          if (self.errorListenerSet) self.emit(`error`, new Error(err));else console.error(err);
-        }
-      }).catch(error => {
-        const err = `Error sending Zipkin data ${error}`;
-        if (self.errorListenerSet) this.emit(`error`, new Error(err));else console.error(err);
-      });
-    }
-
-    return true;
-  });
-  return _processQueue2.apply(this, arguments);
+  return true;
 }
 
 module.exports = {
--- a/node_modules/gatsby/dist/utils/tracer/zipkin-local.js.map
+++ b/node_modules/gatsby/dist/utils/tracer/zipkin-local.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../../src/utils/tracer/zipkin-local.js"],"names":["zipkin","require","HttpLogger","ZipkinTracer","fetch","logger","recorder","create","endpoint","BatchRecorder","timeout","tracer","localServiceName","serviceName","sampler","CountingSampler","traceId128Bit","kind","stop","partialSpans","forEach","span","id","_timedOut","_writeSpan","_processQueue","self","queue","length","postBody","join","method","body","headers","then","response","status","err","errorListenerSet","emit","Error","console","error","catch","module","exports"],"mappings":"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","sourcesContent":["const zipkin = require(`zipkin`)\nconst { HttpLogger } = require(`zipkin-transport-http`)\nconst ZipkinTracer = require(`zipkin-javascript-opentracing`)\nconst fetch = require(`node-fetch`)\n\nlet logger\nlet recorder\n\n/**\n * Create and return an open-tracing compatible tracer. See\n * https://github.com/opentracing/opentracing-javascript/blob/master/src/tracer.ts\n */\nfunction create() {\n  logger = new HttpLogger({\n    // endpoint of local docker zipkin instance\n    endpoint: `http://localhost:9411/api/v1/spans`,\n  })\n\n  recorder = new zipkin.BatchRecorder({\n    logger,\n    // timeout = 60 hours, must be longer than site's build time\n    timeout: 60 * 60 * 60 * 1000000,\n  })\n\n  const tracer = new ZipkinTracer({\n    localServiceName: `gatsby`,\n    serviceName: `gatsby`,\n    // Sample 1 out of 1 spans (100%). When tracing production\n    // services, it is normal to sample 1 out of 10 requests so that\n    // tracing information doesn't impact site performance. But Gatsby\n    // is a build tool and only has \"1\" request (the\n    // build). Therefore, we must set this to 100% so that spans\n    // aren't missing\n    sampler: new zipkin.sampler.CountingSampler(1),\n    traceId128Bit: true,\n    recorder,\n    kind: `client`,\n  })\n\n  return tracer\n}\n\n/**\n * Run any tracer cleanup required before the node.js process\n * exits. For Zipkin HTTP, we must manually process any spans still on\n * the queue\n */\nasync function stop() {\n  // First, write all partial spans to the http logger\n  recorder.partialSpans.forEach((span, id) => {\n    if (recorder._timedOut(span)) {\n      recorder._writeSpan(id)\n    }\n  })\n\n  // Then tell http logger to process all spans in its queue\n  return await _processQueue()\n}\n\n// Workaround for issue in Zipkin HTTP Logger where Spans are not\n// cleared off their processing queue before the node.js process\n// exits. Code is mostly the same as the zipkin processQueue\n// implementation.\nasync function _processQueue() {\n  const self = logger\n  if (self.queue.length > 0) {\n    const postBody = `[${self.queue.join(`,`)}]`\n    return await fetch(self.endpoint, {\n      method: `POST`,\n      body: postBody,\n      headers: self.headers,\n      timeout: self.timeout,\n    })\n      .then(response => {\n        if (response.status !== 202) {\n          const err =\n            `Unexpected response while sending Zipkin data, status:` +\n            `${response.status}, body: ${postBody}`\n\n          if (self.errorListenerSet) self.emit(`error`, new Error(err))\n          else console.error(err)\n        }\n      })\n      .catch(error => {\n        const err = `Error sending Zipkin data ${error}`\n        if (self.errorListenerSet) this.emit(`error`, new Error(err))\n        else console.error(err)\n      })\n  }\n  return true\n}\n\nmodule.exports = {\n  create,\n  stop,\n}\n"],"file":"zipkin-local.js"}
\ No newline at end of file
+{"version":3,"sources":["../../../src/utils/tracer/zipkin-local.js"],"names":["zipkin","require","HttpLogger","ZipkinTracer","fetch","logger","recorder","create","endpoint","BatchRecorder","timeout","tracer","localServiceName","serviceName","sampler","CountingSampler","traceId128Bit","kind","stop","partialSpans","forEach","span","id","_timedOut","_writeSpan","_processQueue","self","queue","length","postBody","join","method","body","headers","then","response","status","err","errorListenerSet","emit","Error","console","error","catch","module","exports"],"mappings":"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","sourcesContent":["const zipkin = require(`zipkin`)\nconst { HttpLogger } = require(`zipkin-transport-http`)\nconst ZipkinTracer = require(`zipkin-javascript-opentracing`)\nconst fetch = require(`node-fetch`)\n\nlet logger\nlet recorder\n\n/**\n * Create and return an open-tracing compatible tracer. See\n * https://github.com/opentracing/opentracing-javascript/blob/master/src/tracer.ts\n */\nfunction create() {\n  logger = new HttpLogger({\n    // endpoint of local docker zipkin instance\n    endpoint: `http://localhost:9411/api/v1/spans`,\n  })\n\n  recorder = new zipkin.BatchRecorder({\n    logger,\n    // timeout = 60 hours, must be longer than site's build time\n    timeout: 60 * 60 * 60 * 1000000,\n  })\n\n  const tracer = new ZipkinTracer({\n    localServiceName: `gatsby`,\n    serviceName: `gatsby`,\n    // Sample 1 out of 1 spans (100%). When tracing production\n    // services, it is normal to sample 1 out of 10 requests so that\n    // tracing information doesn't impact site performance. But Gatsby\n    // is a build tool and only has \"1\" request (the\n    // build). Therefore, we must set this to 100% so that spans\n    // aren't missing\n    sampler: new zipkin.sampler.CountingSampler(1),\n    traceId128Bit: true,\n    recorder,\n    kind: `client`,\n  })\n\n  return tracer\n}\n\n/**\n * Run any tracer cleanup required before the node.js process\n * exits. For Zipkin HTTP, we must manually process any spans still on\n * the queue\n */\nasync function stop() {\n  // First, write all partial spans to the http logger\n  recorder.partialSpans.forEach((span, id) => {\n    if (recorder._timedOut(span)) {\n      recorder._writeSpan(id)\n    }\n  })\n\n  // Then tell http logger to process all spans in its queue\n  return await _processQueue()\n}\n\n// Workaround for issue in Zipkin HTTP Logger where Spans are not\n// cleared off their processing queue before the node.js process\n// exits. Code is mostly the same as the zipkin processQueue\n// implementation.\nasync function _processQueue() {\n  const self = logger\n  if (self.queue.length > 0) {\n    const postBody = `[${self.queue.join(`,`)}]`\n    return await fetch(self.endpoint, {\n      method: `POST`,\n      body: postBody,\n      headers: self.headers,\n      timeout: self.timeout,\n    })\n      .then(response => {\n        if (response.status !== 202) {\n          const err =\n            `Unexpected response while sending Zipkin data, status:` +\n            `${response.status}, body: ${postBody}`\n\n          if (self.errorListenerSet) self.emit(`error`, new Error(err))\n          else console.error(err)\n        }\n      })\n      .catch(error => {\n        const err = `Error sending Zipkin data ${error}`\n        if (self.errorListenerSet) this.emit(`error`, new Error(err))\n        else console.error(err)\n      })\n  }\n  return true\n}\n\nmodule.exports = {\n  create,\n  stop,\n}\n"],"file":"zipkin-local.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/utils/webpack-utils.js
+++ b/node_modules/gatsby/dist/utils/webpack-utils.js
@@ -1,11 +1,5 @@
 "use strict";
 
-var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
-
-var _objectWithoutPropertiesLoose2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutPropertiesLoose"));
-
-var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
-
 const autoprefixer = require(`autoprefixer`);
 
 const flexbugs = require(`postcss-flexbugs-fixes`);
@@ -23,365 +17,367 @@ const eslintConfig = require(`./eslint-config`);
 /**
  * A factory method that produces an atoms namespace
  */
-module.exports =
-/*#__PURE__*/
-function () {
-  var _ref = (0, _asyncToGenerator2.default)(function* ({
-    stage,
-    program
-  }) {
-    const assetRelativeRoot = `static/`;
-    const vendorRegex = /(node_modules|bower_components)/;
-    const supportedBrowsers = program.browserslist;
-    const PRODUCTION = !stage.includes(`develop`);
-    const isSSR = stage.includes(`html`);
-
-    const makeExternalOnly = original => (options = {}) => {
-      let rule = original(options);
-      rule.include = vendorRegex;
-      return rule;
-    };
-
-    const makeInternalOnly = original => (options = {}) => {
-      let rule = original(options);
-      rule.exclude = vendorRegex;
-      return rule;
-    };
-
-    let ident = 0;
-    const loaders = {
-      json: (options = {}) => {
-        return {
-          options,
-          loader: require.resolve(`json-loader`)
-        };
-      },
-      yaml: (options = {}) => {
-        return {
-          options,
-          loader: require.resolve(`yaml-loader`)
-        };
-      },
-      null: (options = {}) => {
-        return {
-          options,
-          loader: require.resolve(`null-loader`)
-        };
-      },
-      raw: (options = {}) => {
-        return {
-          options,
-          loader: require.resolve(`raw-loader`)
-        };
-      },
-      style: (options = {}) => {
-        return {
-          options,
-          loader: require.resolve(`style-loader`)
-        };
-      },
-      miniCssExtract: (options = {}) => {
-        return {
-          options,
-          // use MiniCssExtractPlugin only on production builds
-          loader: PRODUCTION ? MiniCssExtractPlugin.loader : require.resolve(`style-loader`)
-        };
-      },
-      css: (options = {}) => {
-        return {
-          loader: isSSR ? require.resolve(`css-loader/locals`) : require.resolve(`css-loader`),
-          options: Object.assign({
-            sourceMap: !PRODUCTION,
-            camelCase: `dashesOnly`,
-            // https://github.com/webpack-contrib/css-loader/issues/406
-            localIdentName: `[name]--[local]--[hash:base64:5]`
-          }, options)
-        };
-      },
-      postcss: (options = {}) => {
-        let _plugins = options.plugins,
-            _options$browsers = options.browsers,
-            browsers = _options$browsers === void 0 ? supportedBrowsers : _options$browsers,
-            postcssOpts = (0, _objectWithoutPropertiesLoose2.default)(options, ["plugins", "browsers"]);
-        return {
-          loader: require.resolve(`postcss-loader`),
-          options: Object.assign({
-            ident: `postcss-${++ident}`,
-            sourceMap: !PRODUCTION,
-            plugins: loader => {
-              _plugins = (typeof _plugins === `function` ? _plugins(loader) : _plugins) || [];
-              return [flexbugs, autoprefixer({
-                browsers,
-                flexbox: `no-2009`
-              }), ..._plugins];
-            }
-          }, postcssOpts)
-        };
-      },
-      file: (options = {}) => {
-        return {
-          loader: require.resolve(`file-loader`),
-          options: Object.assign({
-            name: `${assetRelativeRoot}[name]-[hash].[ext]`
-          }, options)
-        };
-      },
-      url: (options = {}) => {
-        return {
-          loader: require.resolve(`url-loader`),
-          options: Object.assign({
-            limit: 10000,
-            name: `${assetRelativeRoot}[name]-[hash].[ext]`
-          }, options)
-        };
-      },
-      js: options => {
-        return {
-          options,
-          loader: require.resolve(`./babel-loader`)
-        };
-      },
-      eslint: (schema = ``) => {
-        const options = eslintConfig(schema);
-        return {
-          options,
-          loader: require.resolve(`eslint-loader`)
-        };
-      },
-      imports: (options = {}) => {
-        return {
-          options,
-          loader: require.resolve(`imports-loader`)
-        };
-      },
-      exports: (options = {}) => {
-        return {
-          options,
-          loader: require.resolve(`exports-loader`)
-        };
-      }
-      /**
-       * Rules
-       */
+module.exports = async ({
+  stage,
+  program
+}) => {
+  const assetRelativeRoot = `static/`;
+  const vendorRegex = /(node_modules|bower_components)/;
+  const supportedBrowsers = program.browserslist;
+  const PRODUCTION = !stage.includes(`develop`);
+  const isSSR = stage.includes(`html`);
+
+  const makeExternalOnly = original => (options = {}) => {
+    let rule = original(options);
+    rule.include = vendorRegex;
+    return rule;
+  };
 
-    };
-    const rules = {};
-    /**
-     * JavaScript loader via babel, excludes node_modules
-     */
+  const makeInternalOnly = original => (options = {}) => {
+    let rule = original(options);
+    rule.exclude = vendorRegex;
+    return rule;
+  };
 
-    {
-      let js = (options = {}) => {
-        return {
-          test: /\.jsx?$/,
-          exclude: vendorRegex,
-          use: [loaders.js(options)]
-        };
+  let ident = 0;
+  const loaders = {
+    json: (options = {}) => {
+      return {
+        options,
+        loader: require.resolve(`json-loader`)
       };
-
-      rules.js = js;
-    }
-    /**
-     * mjs loader:
-     * webpack 4 has issues automatically dealing with
-     * the .mjs extension, thus we need to explicitly
-     * add this rule to use the default webpack js loader
-     */
-
-    {
-      let mjs = (options = {}) => {
-        return Object.assign({
-          test: /\.mjs$/,
-          include: /node_modules/,
-          type: `javascript/auto`
-        }, options);
+    },
+    yaml: (options = {}) => {
+      return {
+        options,
+        loader: require.resolve(`yaml-loader`)
       };
-
-      rules.mjs = mjs;
-    }
-    {
-      let eslint = schema => {
-        return {
-          enforce: `pre`,
-          test: /\.jsx?$/,
-          exclude: vendorRegex,
-          use: [loaders.eslint(schema)]
-        };
+    },
+    null: (options = {}) => {
+      return {
+        options,
+        loader: require.resolve(`null-loader`)
       };
-
-      rules.eslint = eslint;
-    }
-
-    rules.yaml = () => {
+    },
+    raw: (options = {}) => {
       return {
-        test: /\.ya?ml/,
-        use: [loaders.json(), loaders.yaml()]
+        options,
+        loader: require.resolve(`raw-loader`)
       };
-    };
-    /**
-     * Font loader
-     */
-
-
-    rules.fonts = () => {
+    },
+    style: (options = {}) => {
       return {
-        use: [loaders.url()],
-        test: /\.(eot|otf|ttf|woff(2)?)(\?.*)?$/
+        options,
+        loader: require.resolve(`style-loader`)
       };
-    };
+    },
+    miniCssExtract: (options = {}) => {
+      return {
+        options,
+        // use MiniCssExtractPlugin only on production builds
+        loader: PRODUCTION ? MiniCssExtractPlugin.loader : require.resolve(`style-loader`)
+      };
+    },
+    css: (options = {}) => {
+      return {
+        loader: isSSR ? require.resolve(`css-loader/locals`) : require.resolve(`css-loader`),
+        options: {
+          sourceMap: !PRODUCTION,
+          camelCase: `dashesOnly`,
+          // https://github.com/webpack-contrib/css-loader/issues/406
+          localIdentName: `[name]--[local]--[hash:base64:5]`,
+          ...options
+        }
+      };
+    },
+    postcss: (options = {}) => {
+      let {
+        plugins,
+        browsers = supportedBrowsers,
+        ...postcssOpts
+      } = options;
+      return {
+        loader: require.resolve(`postcss-loader`),
+        options: {
+          ident: `postcss-${++ident}`,
+          sourceMap: !PRODUCTION,
+          plugins: loader => {
+            plugins = (typeof plugins === `function` ? plugins(loader) : plugins) || [];
+            return [flexbugs, autoprefixer({
+              browsers,
+              flexbox: `no-2009`
+            }), ...plugins];
+          },
+          ...postcssOpts
+        }
+      };
+    },
+    file: (options = {}) => {
+      return {
+        loader: require.resolve(`file-loader`),
+        options: {
+          name: `${assetRelativeRoot}[name]-[hash].[ext]`,
+          ...options
+        }
+      };
+    },
+    url: (options = {}) => {
+      return {
+        loader: require.resolve(`url-loader`),
+        options: {
+          limit: 10000,
+          name: `${assetRelativeRoot}[name]-[hash].[ext]`,
+          ...options
+        }
+      };
+    },
+    js: options => {
+      return {
+        options,
+        loader: require.resolve(`./babel-loader`)
+      };
+    },
+    eslint: (schema = ``) => {
+      const options = eslintConfig(schema);
+      return {
+        options,
+        loader: require.resolve(`eslint-loader`)
+      };
+    },
+    imports: (options = {}) => {
+      return {
+        options,
+        loader: require.resolve(`imports-loader`)
+      };
+    },
+    exports: (options = {}) => {
+      return {
+        options,
+        loader: require.resolve(`exports-loader`)
+      };
+    }
     /**
-     * Loads image assets, inlines images via a data URI if they are below
-     * the size threshold
+     * Rules
      */
 
+  };
+  const rules = {};
+  /**
+   * JavaScript loader via babel, excludes node_modules
+   */
 
-    rules.images = () => {
+  {
+    let js = (options = {}) => {
       return {
-        use: [loaders.url()],
-        test: /\.(ico|svg|jpg|jpeg|png|gif|webp)(\?.*)?$/
+        test: /\.jsx?$/,
+        exclude: vendorRegex,
+        use: [loaders.js(options)]
       };
     };
-    /**
-     * Loads audio and video and inlines them via a data URI if they are below
-     * the size threshold
-     */
-
 
-    rules.media = () => {
+    rules.js = js;
+  }
+  /**
+   * mjs loader:
+   * webpack 4 has issues automatically dealing with
+   * the .mjs extension, thus we need to explicitly
+   * add this rule to use the default webpack js loader
+   */
+
+  {
+    let mjs = (options = {}) => {
       return {
-        use: [loaders.url()],
-        test: /\.(mp4|webm|wav|mp3|m4a|aac|oga|flac)$/
+        test: /\.mjs$/,
+        include: /node_modules/,
+        type: `javascript/auto`,
+        ...options
       };
     };
-    /**
-     * Loads assets without inlining
-     */
 
-
-    rules.miscAssets = () => {
+    rules.mjs = mjs;
+  }
+  {
+    let eslint = schema => {
       return {
-        use: [loaders.file()],
-        test: /\.pdf$/
+        enforce: `pre`,
+        test: /\.jsx?$/,
+        exclude: vendorRegex,
+        use: [loaders.eslint(schema)]
       };
     };
-    /**
-     * CSS style loader.
-     */
 
+    rules.eslint = eslint;
+  }
 
-    {
-      const css = (_ref2 = {}) => {
-        let browsers = _ref2.browsers,
-            options = (0, _objectWithoutPropertiesLoose2.default)(_ref2, ["browsers"]);
-        const use = [loaders.css(Object.assign({}, options, {
-          importLoaders: 1
-        })), loaders.postcss({
-          browsers
-        })];
-        if (!isSSR) use.unshift(loaders.miniCssExtract());
-        return {
-          use,
-          test: /\.css$/
-        };
-      };
-      /**
-       * CSS style loader, _excludes_ node_modules.
-       */
+  rules.yaml = () => {
+    return {
+      test: /\.ya?ml/,
+      use: [loaders.json(), loaders.yaml()]
+    };
+  };
+  /**
+   * Font loader
+   */
 
 
-      css.internal = makeInternalOnly(css);
-      css.external = makeExternalOnly(css);
+  rules.fonts = () => {
+    return {
+      use: [loaders.url()],
+      test: /\.(eot|otf|ttf|woff(2)?)(\?.*)?$/
+    };
+  };
+  /**
+   * Loads image assets, inlines images via a data URI if they are below
+   * the size threshold
+   */
 
-      const cssModules = options => {
-        const rule = css(Object.assign({}, options, {
-          modules: true
-        }));
-        delete rule.exclude;
-        rule.test = /\.module\.css$/;
-        return rule;
-      };
 
-      rules.css = css;
-      rules.cssModules = cssModules;
-    }
-    /**
-     * PostCSS loader.
-     */
+  rules.images = () => {
+    return {
+      use: [loaders.url()],
+      test: /\.(ico|svg|jpg|jpeg|png|gif|webp)(\?.*)?$/
+    };
+  };
+  /**
+   * Loads audio and video and inlines them via a data URI if they are below
+   * the size threshold
+   */
 
-    {
-      const postcss = options => {
-        return {
-          test: /\.css$/,
-          use: [loaders.css({
-            importLoaders: 1
-          }), loaders.postcss(options)]
-        };
-      };
-      /**
-       * PostCSS loader, _excludes_ node_modules.
-       */
 
+  rules.media = () => {
+    return {
+      use: [loaders.url()],
+      test: /\.(mp4|webm|wav|mp3|m4a|aac|oga|flac)$/
+    };
+  };
+  /**
+   * Loads assets without inlining
+   */
 
-      postcss.internal = makeInternalOnly(postcss);
-      postcss.external = makeExternalOnly(postcss);
-      rules.postcss = postcss;
-    }
-    /**
-     * Plugins
-     */
 
-    const plugins = Object.assign({}, builtinPlugins);
+  rules.miscAssets = () => {
+    return {
+      use: [loaders.file()],
+      test: /\.pdf$/
+    };
+  };
+  /**
+   * CSS style loader.
+   */
+
+
+  {
+    const css = ({
+      browsers,
+      ...options
+    } = {}) => {
+      const use = [loaders.css({ ...options,
+        importLoaders: 1
+      }), loaders.postcss({
+        browsers
+      })];
+      if (!isSSR) use.unshift(loaders.miniCssExtract());
+      return {
+        use,
+        test: /\.css$/
+      };
+    };
     /**
-     * Minify JavaScript code without regard for IE8. Attempts
-     * to parallelize the work to save time. Generally only add in Production
+     * CSS style loader, _excludes_ node_modules.
      */
 
-    plugins.minifyJs = (_ref3 = {}) => {
-      let terserOptions = _ref3.terserOptions,
-          options = (0, _objectWithoutPropertiesLoose2.default)(_ref3, ["terserOptions"]);
-      return new TerserPlugin(Object.assign({
-        cache: true,
-        parallel: true,
-        exclude: /\.min\.js/,
-        sourceMap: true,
-        terserOptions: Object.assign({
-          ie8: false,
-          parse: {
-            ecma: 8
-          },
-          compress: {
-            ecma: 5
-          },
-          output: {
-            ecma: 5
-          }
-        }, terserOptions)
-      }, options));
+
+    css.internal = makeInternalOnly(css);
+    css.external = makeExternalOnly(css);
+
+    const cssModules = options => {
+      const rule = css({ ...options,
+        modules: true
+      });
+      delete rule.exclude;
+      rule.test = /\.module\.css$/;
+      return rule;
     };
 
-    plugins.minifyCss = (options = {}) => new OptimizeCssAssetsPlugin(options);
+    rules.css = css;
+    rules.cssModules = cssModules;
+  }
+  /**
+   * PostCSS loader.
+   */
+
+  {
+    const postcss = options => {
+      return {
+        test: /\.css$/,
+        use: [loaders.css({
+          importLoaders: 1
+        }), loaders.postcss(options)]
+      };
+    };
     /**
-     * Extracts css requires into a single file;
-     * includes some reasonable defaults
+     * PostCSS loader, _excludes_ node_modules.
      */
 
 
-    plugins.extractText = options => new MiniCssExtractPlugin(Object.assign({
-      filename: `[name].[contenthash].css`,
-      chunkFilename: `[name].[contenthash].css`
-    }, options));
+    postcss.internal = makeInternalOnly(postcss);
+    postcss.external = makeExternalOnly(postcss);
+    rules.postcss = postcss;
+  }
+  /**
+   * Plugins
+   */
 
-    plugins.moment = () => plugins.ignore(/^\.\/locale$/, /moment$/);
+  const plugins = { ...builtinPlugins
+  };
+  /**
+   * Minify JavaScript code without regard for IE8. Attempts
+   * to parallelize the work to save time. Generally only add in Production
+   */
+
+  plugins.minifyJs = ({
+    terserOptions,
+    ...options
+  } = {}) => new TerserPlugin({
+    cache: true,
+    parallel: true,
+    exclude: /\.min\.js/,
+    sourceMap: true,
+    terserOptions: {
+      ie8: false,
+      parse: {
+        ecma: 8
+      },
+      compress: {
+        ecma: 5
+      },
+      output: {
+        ecma: 5
+      },
+      ...terserOptions
+    },
+    ...options
+  });
 
-    return {
-      loaders,
-      rules: rules,
-      plugins: plugins
-    };
+  plugins.minifyCss = (options = {}) => new OptimizeCssAssetsPlugin(options);
+  /**
+   * Extracts css requires into a single file;
+   * includes some reasonable defaults
+   */
+
+
+  plugins.extractText = options => new MiniCssExtractPlugin({
+    filename: `[name].[contenthash].css`,
+    chunkFilename: `[name].[contenthash].css`,
+    ...options
   });
 
-  return function (_x) {
-    return _ref.apply(this, arguments);
+  plugins.moment = () => plugins.ignore(/^\.\/locale$/, /moment$/);
+
+  return {
+    loaders,
+    rules: rules,
+    plugins: plugins
   };
-}();
+};
 //# sourceMappingURL=webpack-utils.js.map
\ No newline at end of file
--- a/node_modules/gatsby/dist/utils/webpack-utils.js.map
+++ b/node_modules/gatsby/dist/utils/webpack-utils.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/utils/webpack-utils.js"],"names":["autoprefixer","require","flexbugs","TerserPlugin","MiniCssExtractPlugin","OptimizeCssAssetsPlugin","builtinPlugins","eslintConfig","module","exports","stage","program","assetRelativeRoot","vendorRegex","supportedBrowsers","browserslist","PRODUCTION","includes","isSSR","makeExternalOnly","original","options","rule","include","makeInternalOnly","exclude","ident","loaders","json","loader","resolve","yaml","null","raw","style","miniCssExtract","css","sourceMap","camelCase","localIdentName","postcss","plugins","browsers","postcssOpts","flexbox","file","name","url","limit","js","eslint","schema","imports","rules","test","use","mjs","type","enforce","fonts","images","media","miscAssets","importLoaders","unshift","internal","external","cssModules","modules","minifyJs","terserOptions","cache","parallel","ie8","parse","ecma","compress","output","minifyCss","extractText","filename","chunkFilename","moment","ignore"],"mappings":"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","sourcesContent":["// @flow\n\nconst autoprefixer = require(`autoprefixer`)\nconst flexbugs = require(`postcss-flexbugs-fixes`)\nconst TerserPlugin = require(`terser-webpack-plugin`)\nconst MiniCssExtractPlugin = require(`mini-css-extract-plugin`)\nconst OptimizeCssAssetsPlugin = require(`optimize-css-assets-webpack-plugin`)\n\nconst builtinPlugins = require(`./webpack-plugins`)\nconst eslintConfig = require(`./eslint-config`)\n\ntype LoaderSpec = string | { loader: string, options?: Object }\ntype LoaderResolver<T: Object> = (options?: T) => LoaderSpec\n\ntype Condition = string | RegExp | RegExp[]\n\ntype Rule = {\n  test?: Condition,\n  use: LoaderSpec[],\n  exclude?: Condition,\n  include?: Condition,\n}\n\ntype RuleFactory<T: Object> = (options?: T) => Rule\n\ntype ContextualRuleFactory = RuleFactory<*> & {\n  internal: RuleFactory<*>,\n  external: RuleFactory<*>,\n}\n\ntype PluginInstance = any\ntype PluginFactory = (...args?: any) => PluginInstance\n\ntype BuiltinPlugins = typeof builtinPlugins\n\ntype Stage = \"develop\" | \"develop-html\" | \"build-javascript\" | \"build-html\"\n\n/**\n * Configuration options for `createUtils`\n */\nexport type WebpackUtilsOptions = { stage: Stage, program: any }\n\n/**\n * Utils that produce webpack `loader` objects\n */\nexport type LoaderUtils = {\n  json: LoaderResolver<*>,\n  yaml: LoaderResolver<*>,\n  null: LoaderResolver<*>,\n  raw: LoaderResolver<*>,\n\n  style: LoaderResolver<*>,\n  css: LoaderResolver<*>,\n  postcss: LoaderResolver<{\n    browsers?: string[],\n    plugins?: Array<any> | ((loader: any) => Array<any>),\n  }>,\n\n  file: LoaderResolver<*>,\n  url: LoaderResolver<*>,\n  js: LoaderResolver<*>,\n\n  miniCssExtract: LoaderResolver<*>,\n  imports: LoaderResolver<*>,\n  exports: LoaderResolver<*>,\n\n  eslint: LoaderResolver<*>,\n}\n\n/**\n * Utils that produce webpack rule objects\n */\nexport type RuleUtils = {\n  /**\n   * Handles JavaScript compilation via babel\n   */\n  js: RuleFactory<*>,\n  yaml: RuleFactory<*>,\n  fonts: RuleFactory<*>,\n  images: RuleFactory<*>,\n  miscAssets: RuleFactory<*>,\n\n  css: ContextualRuleFactory,\n  cssModules: RuleFactory<*>,\n  postcss: ContextualRuleFactory,\n\n  eslint: RuleFactory<*>,\n}\n\nexport type PluginUtils = BuiltinPlugins & {\n  extractText: PluginFactory,\n  uglify: PluginFactory,\n  moment: PluginFactory,\n}\n\n/**\n * webpack atoms namespace\n */\nexport type WebpackUtils = {\n  loaders: LoaderUtils,\n\n  rules: RuleUtils,\n\n  plugins: PluginUtils,\n}\n\n/**\n * A factory method that produces an atoms namespace\n */\nmodule.exports = async ({\n  stage,\n  program,\n}: {\n  stage: Stage,\n  program: any,\n}): Promise<WebpackUtilsOptions> => {\n  const assetRelativeRoot = `static/`\n  const vendorRegex = /(node_modules|bower_components)/\n  const supportedBrowsers = program.browserslist\n\n  const PRODUCTION = !stage.includes(`develop`)\n\n  const isSSR = stage.includes(`html`)\n\n  const makeExternalOnly = (original: RuleFactory<*>) => (\n    options = {}\n  ): Rule => {\n    let rule = original(options)\n    rule.include = vendorRegex\n    return rule\n  }\n\n  const makeInternalOnly = (original: RuleFactory<*>) => (\n    options = {}\n  ): Rule => {\n    let rule = original(options)\n    rule.exclude = vendorRegex\n    return rule\n  }\n\n  let ident = 0\n\n  const loaders: LoaderUtils = {\n    json: (options = {}) => {\n      return {\n        options,\n        loader: require.resolve(`json-loader`),\n      }\n    },\n\n    yaml: (options = {}) => {\n      return {\n        options,\n        loader: require.resolve(`yaml-loader`),\n      }\n    },\n\n    null: (options = {}) => {\n      return {\n        options,\n        loader: require.resolve(`null-loader`),\n      }\n    },\n\n    raw: (options = {}) => {\n      return {\n        options,\n        loader: require.resolve(`raw-loader`),\n      }\n    },\n\n    style: (options = {}) => {\n      return {\n        options,\n        loader: require.resolve(`style-loader`),\n      }\n    },\n\n    miniCssExtract: (options = {}) => {\n      return {\n        options,\n        // use MiniCssExtractPlugin only on production builds\n        loader: PRODUCTION\n          ? MiniCssExtractPlugin.loader\n          : require.resolve(`style-loader`),\n      }\n    },\n\n    css: (options = {}) => {\n      return {\n        loader: isSSR\n          ? require.resolve(`css-loader/locals`)\n          : require.resolve(`css-loader`),\n        options: {\n          sourceMap: !PRODUCTION,\n          camelCase: `dashesOnly`,\n          // https://github.com/webpack-contrib/css-loader/issues/406\n          localIdentName: `[name]--[local]--[hash:base64:5]`,\n          ...options,\n        },\n      }\n    },\n\n    postcss: (options = {}) => {\n      let { plugins, browsers = supportedBrowsers, ...postcssOpts } = options\n\n      return {\n        loader: require.resolve(`postcss-loader`),\n        options: {\n          ident: `postcss-${++ident}`,\n          sourceMap: !PRODUCTION,\n          plugins: loader => {\n            plugins =\n              (typeof plugins === `function` ? plugins(loader) : plugins) || []\n\n            return [\n              flexbugs,\n              autoprefixer({ browsers, flexbox: `no-2009` }),\n              ...plugins,\n            ]\n          },\n          ...postcssOpts,\n        },\n      }\n    },\n\n    file: (options = {}) => {\n      return {\n        loader: require.resolve(`file-loader`),\n        options: {\n          name: `${assetRelativeRoot}[name]-[hash].[ext]`,\n          ...options,\n        },\n      }\n    },\n\n    url: (options = {}) => {\n      return {\n        loader: require.resolve(`url-loader`),\n        options: {\n          limit: 10000,\n          name: `${assetRelativeRoot}[name]-[hash].[ext]`,\n          ...options,\n        },\n      }\n    },\n\n    js: options => {\n      return {\n        options,\n        loader: require.resolve(`./babel-loader`),\n      }\n    },\n\n    eslint: (schema = ``) => {\n      const options = eslintConfig(schema)\n\n      return {\n        options,\n        loader: require.resolve(`eslint-loader`),\n      }\n    },\n\n    imports: (options = {}) => {\n      return {\n        options,\n        loader: require.resolve(`imports-loader`),\n      }\n    },\n\n    exports: (options = {}) => {\n      return {\n        options,\n        loader: require.resolve(`exports-loader`),\n      }\n    },\n  }\n\n  /**\n   * Rules\n   */\n  const rules = {}\n\n  /**\n   * JavaScript loader via babel, excludes node_modules\n   */\n  {\n    let js = (options = {}) => {\n      return {\n        test: /\\.jsx?$/,\n        exclude: vendorRegex,\n        use: [loaders.js(options)],\n      }\n    }\n\n    rules.js = js\n  }\n\n  /**\n   * mjs loader:\n   * webpack 4 has issues automatically dealing with\n   * the .mjs extension, thus we need to explicitly\n   * add this rule to use the default webpack js loader\n   */\n  {\n    let mjs = (options = {}) => {\n      return {\n        test: /\\.mjs$/,\n        include: /node_modules/,\n        type: `javascript/auto`,\n        ...options,\n      }\n    }\n\n    rules.mjs = mjs\n  }\n\n  {\n    let eslint = schema => {\n      return {\n        enforce: `pre`,\n        test: /\\.jsx?$/,\n        exclude: vendorRegex,\n        use: [loaders.eslint(schema)],\n      }\n    }\n\n    rules.eslint = eslint\n  }\n\n  rules.yaml = () => {\n    return {\n      test: /\\.ya?ml/,\n      use: [loaders.json(), loaders.yaml()],\n    }\n  }\n\n  /**\n   * Font loader\n   */\n  rules.fonts = () => {\n    return {\n      use: [loaders.url()],\n      test: /\\.(eot|otf|ttf|woff(2)?)(\\?.*)?$/,\n    }\n  }\n\n  /**\n   * Loads image assets, inlines images via a data URI if they are below\n   * the size threshold\n   */\n  rules.images = () => {\n    return {\n      use: [loaders.url()],\n      test: /\\.(ico|svg|jpg|jpeg|png|gif|webp)(\\?.*)?$/,\n    }\n  }\n\n  /**\n   * Loads audio and video and inlines them via a data URI if they are below\n   * the size threshold\n   */\n  rules.media = () => {\n    return {\n      use: [loaders.url()],\n      test: /\\.(mp4|webm|wav|mp3|m4a|aac|oga|flac)$/,\n    }\n  }\n\n  /**\n   * Loads assets without inlining\n   */\n  rules.miscAssets = () => {\n    return {\n      use: [loaders.file()],\n      test: /\\.pdf$/,\n    }\n  }\n\n  /**\n   * CSS style loader.\n   */\n  {\n    const css = ({ browsers, ...options } = {}) => {\n      const use = [\n        loaders.css({ ...options, importLoaders: 1 }),\n        loaders.postcss({ browsers }),\n      ]\n      if (!isSSR) use.unshift(loaders.miniCssExtract())\n\n      return {\n        use,\n        test: /\\.css$/,\n      }\n    }\n\n    /**\n     * CSS style loader, _excludes_ node_modules.\n     */\n    css.internal = makeInternalOnly(css)\n    css.external = makeExternalOnly(css)\n\n    const cssModules = options => {\n      const rule = css({ ...options, modules: true })\n      delete rule.exclude\n      rule.test = /\\.module\\.css$/\n      return rule\n    }\n\n    rules.css = css\n    rules.cssModules = cssModules\n  }\n\n  /**\n   * PostCSS loader.\n   */\n  {\n    const postcss = options => {\n      return {\n        test: /\\.css$/,\n        use: [loaders.css({ importLoaders: 1 }), loaders.postcss(options)],\n      }\n    }\n\n    /**\n     * PostCSS loader, _excludes_ node_modules.\n     */\n    postcss.internal = makeInternalOnly(postcss)\n    postcss.external = makeExternalOnly(postcss)\n    rules.postcss = postcss\n  }\n  /**\n   * Plugins\n   */\n  const plugins = { ...builtinPlugins }\n\n  /**\n   * Minify JavaScript code without regard for IE8. Attempts\n   * to parallelize the work to save time. Generally only add in Production\n   */\n  plugins.minifyJs = ({ terserOptions, ...options } = {}) =>\n    new TerserPlugin({\n      cache: true,\n      parallel: true,\n      exclude: /\\.min\\.js/,\n      sourceMap: true,\n      terserOptions: {\n        ie8: false,\n        parse: {\n          ecma: 8,\n        },\n        compress: {\n          ecma: 5,\n        },\n        output: {\n          ecma: 5,\n        },\n        ...terserOptions,\n      },\n      ...options,\n    })\n\n  plugins.minifyCss = (options = {}) => new OptimizeCssAssetsPlugin(options)\n\n  /**\n   * Extracts css requires into a single file;\n   * includes some reasonable defaults\n   */\n  plugins.extractText = options =>\n    new MiniCssExtractPlugin({\n      filename: `[name].[contenthash].css`,\n      chunkFilename: `[name].[contenthash].css`,\n      ...options,\n    })\n\n  plugins.moment = () => plugins.ignore(/^\\.\\/locale$/, /moment$/)\n\n  return {\n    loaders,\n    rules: (rules: RuleUtils),\n    plugins: (plugins: PluginUtils),\n  }\n}\n"],"file":"webpack-utils.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/utils/webpack-utils.js"],"names":["autoprefixer","require","flexbugs","TerserPlugin","MiniCssExtractPlugin","OptimizeCssAssetsPlugin","builtinPlugins","eslintConfig","module","exports","stage","program","assetRelativeRoot","vendorRegex","supportedBrowsers","browserslist","PRODUCTION","includes","isSSR","makeExternalOnly","original","options","rule","include","makeInternalOnly","exclude","ident","loaders","json","loader","resolve","yaml","null","raw","style","miniCssExtract","css","sourceMap","camelCase","localIdentName","postcss","plugins","browsers","postcssOpts","flexbox","file","name","url","limit","js","eslint","schema","imports","rules","test","use","mjs","type","enforce","fonts","images","media","miscAssets","importLoaders","unshift","internal","external","cssModules","modules","minifyJs","terserOptions","cache","parallel","ie8","parse","ecma","compress","output","minifyCss","extractText","filename","chunkFilename","moment","ignore"],"mappings":";;AAEA,MAAMA,YAAY,GAAGC,OAAO,CAAE,cAAF,CAA5B;;AACA,MAAMC,QAAQ,GAAGD,OAAO,CAAE,wBAAF,CAAxB;;AACA,MAAME,YAAY,GAAGF,OAAO,CAAE,uBAAF,CAA5B;;AACA,MAAMG,oBAAoB,GAAGH,OAAO,CAAE,yBAAF,CAApC;;AACA,MAAMI,uBAAuB,GAAGJ,OAAO,CAAE,oCAAF,CAAvC;;AAEA,MAAMK,cAAc,GAAGL,OAAO,CAAE,mBAAF,CAA9B;;AACA,MAAMM,YAAY,GAAGN,OAAO,CAAE,iBAAF,CAA5B;;AAiGA;;;AAGAO,MAAM,CAACC,OAAP,GAAiB,OAAO;AACtBC,EAAAA,KADsB;AAEtBC,EAAAA;AAFsB,CAAP,KAMmB;AAClC,QAAMC,iBAAiB,GAAI,SAA3B;AACA,QAAMC,WAAW,GAAG,iCAApB;AACA,QAAMC,iBAAiB,GAAGH,OAAO,CAACI,YAAlC;AAEA,QAAMC,UAAU,GAAG,CAACN,KAAK,CAACO,QAAN,CAAgB,SAAhB,CAApB;AAEA,QAAMC,KAAK,GAAGR,KAAK,CAACO,QAAN,CAAgB,MAAhB,CAAd;;AAEA,QAAME,gBAAgB,GAAIC,QAAD,IAA8B,CACrDC,OAAO,GAAG,EAD2C,KAE5C;AACT,QAAIC,IAAI,GAAGF,QAAQ,CAACC,OAAD,CAAnB;AACAC,IAAAA,IAAI,CAACC,OAAL,GAAeV,WAAf;AACA,WAAOS,IAAP;AACD,GAND;;AAQA,QAAME,gBAAgB,GAAIJ,QAAD,IAA8B,CACrDC,OAAO,GAAG,EAD2C,KAE5C;AACT,QAAIC,IAAI,GAAGF,QAAQ,CAACC,OAAD,CAAnB;AACAC,IAAAA,IAAI,CAACG,OAAL,GAAeZ,WAAf;AACA,WAAOS,IAAP;AACD,GAND;;AAQA,MAAII,KAAK,GAAG,CAAZ;AAEA,QAAMC,OAAoB,GAAG;AAC3BC,IAAAA,IAAI,EAAE,CAACP,OAAO,GAAG,EAAX,KAAkB;AACtB,aAAO;AACLA,QAAAA,OADK;AAELQ,QAAAA,MAAM,EAAE5B,OAAO,CAAC6B,OAAR,CAAiB,aAAjB;AAFH,OAAP;AAID,KAN0B;AAQ3BC,IAAAA,IAAI,EAAE,CAACV,OAAO,GAAG,EAAX,KAAkB;AACtB,aAAO;AACLA,QAAAA,OADK;AAELQ,QAAAA,MAAM,EAAE5B,OAAO,CAAC6B,OAAR,CAAiB,aAAjB;AAFH,OAAP;AAID,KAb0B;AAe3BE,IAAAA,IAAI,EAAE,CAACX,OAAO,GAAG,EAAX,KAAkB;AACtB,aAAO;AACLA,QAAAA,OADK;AAELQ,QAAAA,MAAM,EAAE5B,OAAO,CAAC6B,OAAR,CAAiB,aAAjB;AAFH,OAAP;AAID,KApB0B;AAsB3BG,IAAAA,GAAG,EAAE,CAACZ,OAAO,GAAG,EAAX,KAAkB;AACrB,aAAO;AACLA,QAAAA,OADK;AAELQ,QAAAA,MAAM,EAAE5B,OAAO,CAAC6B,OAAR,CAAiB,YAAjB;AAFH,OAAP;AAID,KA3B0B;AA6B3BI,IAAAA,KAAK,EAAE,CAACb,OAAO,GAAG,EAAX,KAAkB;AACvB,aAAO;AACLA,QAAAA,OADK;AAELQ,QAAAA,MAAM,EAAE5B,OAAO,CAAC6B,OAAR,CAAiB,cAAjB;AAFH,OAAP;AAID,KAlC0B;AAoC3BK,IAAAA,cAAc,EAAE,CAACd,OAAO,GAAG,EAAX,KAAkB;AAChC,aAAO;AACLA,QAAAA,OADK;AAEL;AACAQ,QAAAA,MAAM,EAAEb,UAAU,GACdZ,oBAAoB,CAACyB,MADP,GAEd5B,OAAO,CAAC6B,OAAR,CAAiB,cAAjB;AALC,OAAP;AAOD,KA5C0B;AA8C3BM,IAAAA,GAAG,EAAE,CAACf,OAAO,GAAG,EAAX,KAAkB;AACrB,aAAO;AACLQ,QAAAA,MAAM,EAAEX,KAAK,GACTjB,OAAO,CAAC6B,OAAR,CAAiB,mBAAjB,CADS,GAET7B,OAAO,CAAC6B,OAAR,CAAiB,YAAjB,CAHC;AAILT,QAAAA,OAAO,EAAE;AACPgB,UAAAA,SAAS,EAAE,CAACrB,UADL;AAEPsB,UAAAA,SAAS,EAAG,YAFL;AAGP;AACAC,UAAAA,cAAc,EAAG,kCAJV;AAKP,aAAGlB;AALI;AAJJ,OAAP;AAYD,KA3D0B;AA6D3BmB,IAAAA,OAAO,EAAE,CAACnB,OAAO,GAAG,EAAX,KAAkB;AACzB,UAAI;AAAEoB,QAAAA,OAAF;AAAWC,QAAAA,QAAQ,GAAG5B,iBAAtB;AAAyC,WAAG6B;AAA5C,UAA4DtB,OAAhE;AAEA,aAAO;AACLQ,QAAAA,MAAM,EAAE5B,OAAO,CAAC6B,OAAR,CAAiB,gBAAjB,CADH;AAELT,QAAAA,OAAO,EAAE;AACPK,UAAAA,KAAK,EAAG,WAAU,EAAEA,KAAM,EADnB;AAEPW,UAAAA,SAAS,EAAE,CAACrB,UAFL;AAGPyB,UAAAA,OAAO,EAAEZ,MAAM,IAAI;AACjBY,YAAAA,OAAO,GACL,CAAC,OAAOA,OAAP,KAAoB,UAApB,GAAgCA,OAAO,CAACZ,MAAD,CAAvC,GAAkDY,OAAnD,KAA+D,EADjE;AAGA,mBAAO,CACLvC,QADK,EAELF,YAAY,CAAC;AAAE0C,cAAAA,QAAF;AAAYE,cAAAA,OAAO,EAAG;AAAtB,aAAD,CAFP,EAGL,GAAGH,OAHE,CAAP;AAKD,WAZM;AAaP,aAAGE;AAbI;AAFJ,OAAP;AAkBD,KAlF0B;AAoF3BE,IAAAA,IAAI,EAAE,CAACxB,OAAO,GAAG,EAAX,KAAkB;AACtB,aAAO;AACLQ,QAAAA,MAAM,EAAE5B,OAAO,CAAC6B,OAAR,CAAiB,aAAjB,CADH;AAELT,QAAAA,OAAO,EAAE;AACPyB,UAAAA,IAAI,EAAG,GAAElC,iBAAkB,qBADpB;AAEP,aAAGS;AAFI;AAFJ,OAAP;AAOD,KA5F0B;AA8F3B0B,IAAAA,GAAG,EAAE,CAAC1B,OAAO,GAAG,EAAX,KAAkB;AACrB,aAAO;AACLQ,QAAAA,MAAM,EAAE5B,OAAO,CAAC6B,OAAR,CAAiB,YAAjB,CADH;AAELT,QAAAA,OAAO,EAAE;AACP2B,UAAAA,KAAK,EAAE,KADA;AAEPF,UAAAA,IAAI,EAAG,GAAElC,iBAAkB,qBAFpB;AAGP,aAAGS;AAHI;AAFJ,OAAP;AAQD,KAvG0B;AAyG3B4B,IAAAA,EAAE,EAAE5B,OAAO,IAAI;AACb,aAAO;AACLA,QAAAA,OADK;AAELQ,QAAAA,MAAM,EAAE5B,OAAO,CAAC6B,OAAR,CAAiB,gBAAjB;AAFH,OAAP;AAID,KA9G0B;AAgH3BoB,IAAAA,MAAM,EAAE,CAACC,MAAM,GAAI,EAAX,KAAiB;AACvB,YAAM9B,OAAO,GAAGd,YAAY,CAAC4C,MAAD,CAA5B;AAEA,aAAO;AACL9B,QAAAA,OADK;AAELQ,QAAAA,MAAM,EAAE5B,OAAO,CAAC6B,OAAR,CAAiB,eAAjB;AAFH,OAAP;AAID,KAvH0B;AAyH3BsB,IAAAA,OAAO,EAAE,CAAC/B,OAAO,GAAG,EAAX,KAAkB;AACzB,aAAO;AACLA,QAAAA,OADK;AAELQ,QAAAA,MAAM,EAAE5B,OAAO,CAAC6B,OAAR,CAAiB,gBAAjB;AAFH,OAAP;AAID,KA9H0B;AAgI3BrB,IAAAA,OAAO,EAAE,CAACY,OAAO,GAAG,EAAX,KAAkB;AACzB,aAAO;AACLA,QAAAA,OADK;AAELQ,QAAAA,MAAM,EAAE5B,OAAO,CAAC6B,OAAR,CAAiB,gBAAjB;AAFH,OAAP;AAID;AAGH;;;;AAxI6B,GAA7B;AA2IA,QAAMuB,KAAK,GAAG,EAAd;AAEA;;;;AAGA;AACE,QAAIJ,EAAE,GAAG,CAAC5B,OAAO,GAAG,EAAX,KAAkB;AACzB,aAAO;AACLiC,QAAAA,IAAI,EAAE,SADD;AAEL7B,QAAAA,OAAO,EAAEZ,WAFJ;AAGL0C,QAAAA,GAAG,EAAE,CAAC5B,OAAO,CAACsB,EAAR,CAAW5B,OAAX,CAAD;AAHA,OAAP;AAKD,KAND;;AAQAgC,IAAAA,KAAK,CAACJ,EAAN,GAAWA,EAAX;AACD;AAED;;;;;;;AAMA;AACE,QAAIO,GAAG,GAAG,CAACnC,OAAO,GAAG,EAAX,KAAkB;AAC1B,aAAO;AACLiC,QAAAA,IAAI,EAAE,QADD;AAEL/B,QAAAA,OAAO,EAAE,cAFJ;AAGLkC,QAAAA,IAAI,EAAG,iBAHF;AAIL,WAAGpC;AAJE,OAAP;AAMD,KAPD;;AASAgC,IAAAA,KAAK,CAACG,GAAN,GAAYA,GAAZ;AACD;AAED;AACE,QAAIN,MAAM,GAAGC,MAAM,IAAI;AACrB,aAAO;AACLO,QAAAA,OAAO,EAAG,KADL;AAELJ,QAAAA,IAAI,EAAE,SAFD;AAGL7B,QAAAA,OAAO,EAAEZ,WAHJ;AAIL0C,QAAAA,GAAG,EAAE,CAAC5B,OAAO,CAACuB,MAAR,CAAeC,MAAf,CAAD;AAJA,OAAP;AAMD,KAPD;;AASAE,IAAAA,KAAK,CAACH,MAAN,GAAeA,MAAf;AACD;;AAEDG,EAAAA,KAAK,CAACtB,IAAN,GAAa,MAAM;AACjB,WAAO;AACLuB,MAAAA,IAAI,EAAE,SADD;AAELC,MAAAA,GAAG,EAAE,CAAC5B,OAAO,CAACC,IAAR,EAAD,EAAiBD,OAAO,CAACI,IAAR,EAAjB;AAFA,KAAP;AAID,GALD;AAOA;;;;;AAGAsB,EAAAA,KAAK,CAACM,KAAN,GAAc,MAAM;AAClB,WAAO;AACLJ,MAAAA,GAAG,EAAE,CAAC5B,OAAO,CAACoB,GAAR,EAAD,CADA;AAELO,MAAAA,IAAI,EAAE;AAFD,KAAP;AAID,GALD;AAOA;;;;;;AAIAD,EAAAA,KAAK,CAACO,MAAN,GAAe,MAAM;AACnB,WAAO;AACLL,MAAAA,GAAG,EAAE,CAAC5B,OAAO,CAACoB,GAAR,EAAD,CADA;AAELO,MAAAA,IAAI,EAAE;AAFD,KAAP;AAID,GALD;AAOA;;;;;;AAIAD,EAAAA,KAAK,CAACQ,KAAN,GAAc,MAAM;AAClB,WAAO;AACLN,MAAAA,GAAG,EAAE,CAAC5B,OAAO,CAACoB,GAAR,EAAD,CADA;AAELO,MAAAA,IAAI,EAAE;AAFD,KAAP;AAID,GALD;AAOA;;;;;AAGAD,EAAAA,KAAK,CAACS,UAAN,GAAmB,MAAM;AACvB,WAAO;AACLP,MAAAA,GAAG,EAAE,CAAC5B,OAAO,CAACkB,IAAR,EAAD,CADA;AAELS,MAAAA,IAAI,EAAE;AAFD,KAAP;AAID,GALD;AAOA;;;;;AAGA;AACE,UAAMlB,GAAG,GAAG,CAAC;AAAEM,MAAAA,QAAF;AAAY,SAAGrB;AAAf,QAA2B,EAA5B,KAAmC;AAC7C,YAAMkC,GAAG,GAAG,CACV5B,OAAO,CAACS,GAAR,CAAY,EAAE,GAAGf,OAAL;AAAc0C,QAAAA,aAAa,EAAE;AAA7B,OAAZ,CADU,EAEVpC,OAAO,CAACa,OAAR,CAAgB;AAAEE,QAAAA;AAAF,OAAhB,CAFU,CAAZ;AAIA,UAAI,CAACxB,KAAL,EAAYqC,GAAG,CAACS,OAAJ,CAAYrC,OAAO,CAACQ,cAAR,EAAZ;AAEZ,aAAO;AACLoB,QAAAA,GADK;AAELD,QAAAA,IAAI,EAAE;AAFD,OAAP;AAID,KAXD;AAaA;;;;;AAGAlB,IAAAA,GAAG,CAAC6B,QAAJ,GAAezC,gBAAgB,CAACY,GAAD,CAA/B;AACAA,IAAAA,GAAG,CAAC8B,QAAJ,GAAe/C,gBAAgB,CAACiB,GAAD,CAA/B;;AAEA,UAAM+B,UAAU,GAAG9C,OAAO,IAAI;AAC5B,YAAMC,IAAI,GAAGc,GAAG,CAAC,EAAE,GAAGf,OAAL;AAAc+C,QAAAA,OAAO,EAAE;AAAvB,OAAD,CAAhB;AACA,aAAO9C,IAAI,CAACG,OAAZ;AACAH,MAAAA,IAAI,CAACgC,IAAL,GAAY,gBAAZ;AACA,aAAOhC,IAAP;AACD,KALD;;AAOA+B,IAAAA,KAAK,CAACjB,GAAN,GAAYA,GAAZ;AACAiB,IAAAA,KAAK,CAACc,UAAN,GAAmBA,UAAnB;AACD;AAED;;;;AAGA;AACE,UAAM3B,OAAO,GAAGnB,OAAO,IAAI;AACzB,aAAO;AACLiC,QAAAA,IAAI,EAAE,QADD;AAELC,QAAAA,GAAG,EAAE,CAAC5B,OAAO,CAACS,GAAR,CAAY;AAAE2B,UAAAA,aAAa,EAAE;AAAjB,SAAZ,CAAD,EAAoCpC,OAAO,CAACa,OAAR,CAAgBnB,OAAhB,CAApC;AAFA,OAAP;AAID,KALD;AAOA;;;;;AAGAmB,IAAAA,OAAO,CAACyB,QAAR,GAAmBzC,gBAAgB,CAACgB,OAAD,CAAnC;AACAA,IAAAA,OAAO,CAAC0B,QAAR,GAAmB/C,gBAAgB,CAACqB,OAAD,CAAnC;AACAa,IAAAA,KAAK,CAACb,OAAN,GAAgBA,OAAhB;AACD;AACD;;;;AAGA,QAAMC,OAAO,GAAG,EAAE,GAAGnC;AAAL,GAAhB;AAEA;;;;;AAIAmC,EAAAA,OAAO,CAAC4B,QAAR,GAAmB,CAAC;AAAEC,IAAAA,aAAF;AAAiB,OAAGjD;AAApB,MAAgC,EAAjC,KACjB,IAAIlB,YAAJ,CAAiB;AACfoE,IAAAA,KAAK,EAAE,IADQ;AAEfC,IAAAA,QAAQ,EAAE,IAFK;AAGf/C,IAAAA,OAAO,EAAE,WAHM;AAIfY,IAAAA,SAAS,EAAE,IAJI;AAKfiC,IAAAA,aAAa,EAAE;AACbG,MAAAA,GAAG,EAAE,KADQ;AAEbC,MAAAA,KAAK,EAAE;AACLC,QAAAA,IAAI,EAAE;AADD,OAFM;AAKbC,MAAAA,QAAQ,EAAE;AACRD,QAAAA,IAAI,EAAE;AADE,OALG;AAQbE,MAAAA,MAAM,EAAE;AACNF,QAAAA,IAAI,EAAE;AADA,OARK;AAWb,SAAGL;AAXU,KALA;AAkBf,OAAGjD;AAlBY,GAAjB,CADF;;AAsBAoB,EAAAA,OAAO,CAACqC,SAAR,GAAoB,CAACzD,OAAO,GAAG,EAAX,KAAkB,IAAIhB,uBAAJ,CAA4BgB,OAA5B,CAAtC;AAEA;;;;;;AAIAoB,EAAAA,OAAO,CAACsC,WAAR,GAAsB1D,OAAO,IAC3B,IAAIjB,oBAAJ,CAAyB;AACvB4E,IAAAA,QAAQ,EAAG,0BADY;AAEvBC,IAAAA,aAAa,EAAG,0BAFO;AAGvB,OAAG5D;AAHoB,GAAzB,CADF;;AAOAoB,EAAAA,OAAO,CAACyC,MAAR,GAAiB,MAAMzC,OAAO,CAAC0C,MAAR,CAAe,cAAf,EAA+B,SAA/B,CAAvB;;AAEA,SAAO;AACLxD,IAAAA,OADK;AAEL0B,IAAAA,KAAK,EAAGA,KAFH;AAGLZ,IAAAA,OAAO,EAAGA;AAHL,GAAP;AAKD,CArXD","sourcesContent":["// @flow\n\nconst autoprefixer = require(`autoprefixer`)\nconst flexbugs = require(`postcss-flexbugs-fixes`)\nconst TerserPlugin = require(`terser-webpack-plugin`)\nconst MiniCssExtractPlugin = require(`mini-css-extract-plugin`)\nconst OptimizeCssAssetsPlugin = require(`optimize-css-assets-webpack-plugin`)\n\nconst builtinPlugins = require(`./webpack-plugins`)\nconst eslintConfig = require(`./eslint-config`)\n\ntype LoaderSpec = string | { loader: string, options?: Object }\ntype LoaderResolver<T: Object> = (options?: T) => LoaderSpec\n\ntype Condition = string | RegExp | RegExp[]\n\ntype Rule = {\n  test?: Condition,\n  use: LoaderSpec[],\n  exclude?: Condition,\n  include?: Condition,\n}\n\ntype RuleFactory<T: Object> = (options?: T) => Rule\n\ntype ContextualRuleFactory = RuleFactory<*> & {\n  internal: RuleFactory<*>,\n  external: RuleFactory<*>,\n}\n\ntype PluginInstance = any\ntype PluginFactory = (...args?: any) => PluginInstance\n\ntype BuiltinPlugins = typeof builtinPlugins\n\ntype Stage = \"develop\" | \"develop-html\" | \"build-javascript\" | \"build-html\"\n\n/**\n * Configuration options for `createUtils`\n */\nexport type WebpackUtilsOptions = { stage: Stage, program: any }\n\n/**\n * Utils that produce webpack `loader` objects\n */\nexport type LoaderUtils = {\n  json: LoaderResolver<*>,\n  yaml: LoaderResolver<*>,\n  null: LoaderResolver<*>,\n  raw: LoaderResolver<*>,\n\n  style: LoaderResolver<*>,\n  css: LoaderResolver<*>,\n  postcss: LoaderResolver<{\n    browsers?: string[],\n    plugins?: Array<any> | ((loader: any) => Array<any>),\n  }>,\n\n  file: LoaderResolver<*>,\n  url: LoaderResolver<*>,\n  js: LoaderResolver<*>,\n\n  miniCssExtract: LoaderResolver<*>,\n  imports: LoaderResolver<*>,\n  exports: LoaderResolver<*>,\n\n  eslint: LoaderResolver<*>,\n}\n\n/**\n * Utils that produce webpack rule objects\n */\nexport type RuleUtils = {\n  /**\n   * Handles JavaScript compilation via babel\n   */\n  js: RuleFactory<*>,\n  yaml: RuleFactory<*>,\n  fonts: RuleFactory<*>,\n  images: RuleFactory<*>,\n  miscAssets: RuleFactory<*>,\n\n  css: ContextualRuleFactory,\n  cssModules: RuleFactory<*>,\n  postcss: ContextualRuleFactory,\n\n  eslint: RuleFactory<*>,\n}\n\nexport type PluginUtils = BuiltinPlugins & {\n  extractText: PluginFactory,\n  uglify: PluginFactory,\n  moment: PluginFactory,\n}\n\n/**\n * webpack atoms namespace\n */\nexport type WebpackUtils = {\n  loaders: LoaderUtils,\n\n  rules: RuleUtils,\n\n  plugins: PluginUtils,\n}\n\n/**\n * A factory method that produces an atoms namespace\n */\nmodule.exports = async ({\n  stage,\n  program,\n}: {\n  stage: Stage,\n  program: any,\n}): Promise<WebpackUtilsOptions> => {\n  const assetRelativeRoot = `static/`\n  const vendorRegex = /(node_modules|bower_components)/\n  const supportedBrowsers = program.browserslist\n\n  const PRODUCTION = !stage.includes(`develop`)\n\n  const isSSR = stage.includes(`html`)\n\n  const makeExternalOnly = (original: RuleFactory<*>) => (\n    options = {}\n  ): Rule => {\n    let rule = original(options)\n    rule.include = vendorRegex\n    return rule\n  }\n\n  const makeInternalOnly = (original: RuleFactory<*>) => (\n    options = {}\n  ): Rule => {\n    let rule = original(options)\n    rule.exclude = vendorRegex\n    return rule\n  }\n\n  let ident = 0\n\n  const loaders: LoaderUtils = {\n    json: (options = {}) => {\n      return {\n        options,\n        loader: require.resolve(`json-loader`),\n      }\n    },\n\n    yaml: (options = {}) => {\n      return {\n        options,\n        loader: require.resolve(`yaml-loader`),\n      }\n    },\n\n    null: (options = {}) => {\n      return {\n        options,\n        loader: require.resolve(`null-loader`),\n      }\n    },\n\n    raw: (options = {}) => {\n      return {\n        options,\n        loader: require.resolve(`raw-loader`),\n      }\n    },\n\n    style: (options = {}) => {\n      return {\n        options,\n        loader: require.resolve(`style-loader`),\n      }\n    },\n\n    miniCssExtract: (options = {}) => {\n      return {\n        options,\n        // use MiniCssExtractPlugin only on production builds\n        loader: PRODUCTION\n          ? MiniCssExtractPlugin.loader\n          : require.resolve(`style-loader`),\n      }\n    },\n\n    css: (options = {}) => {\n      return {\n        loader: isSSR\n          ? require.resolve(`css-loader/locals`)\n          : require.resolve(`css-loader`),\n        options: {\n          sourceMap: !PRODUCTION,\n          camelCase: `dashesOnly`,\n          // https://github.com/webpack-contrib/css-loader/issues/406\n          localIdentName: `[name]--[local]--[hash:base64:5]`,\n          ...options,\n        },\n      }\n    },\n\n    postcss: (options = {}) => {\n      let { plugins, browsers = supportedBrowsers, ...postcssOpts } = options\n\n      return {\n        loader: require.resolve(`postcss-loader`),\n        options: {\n          ident: `postcss-${++ident}`,\n          sourceMap: !PRODUCTION,\n          plugins: loader => {\n            plugins =\n              (typeof plugins === `function` ? plugins(loader) : plugins) || []\n\n            return [\n              flexbugs,\n              autoprefixer({ browsers, flexbox: `no-2009` }),\n              ...plugins,\n            ]\n          },\n          ...postcssOpts,\n        },\n      }\n    },\n\n    file: (options = {}) => {\n      return {\n        loader: require.resolve(`file-loader`),\n        options: {\n          name: `${assetRelativeRoot}[name]-[hash].[ext]`,\n          ...options,\n        },\n      }\n    },\n\n    url: (options = {}) => {\n      return {\n        loader: require.resolve(`url-loader`),\n        options: {\n          limit: 10000,\n          name: `${assetRelativeRoot}[name]-[hash].[ext]`,\n          ...options,\n        },\n      }\n    },\n\n    js: options => {\n      return {\n        options,\n        loader: require.resolve(`./babel-loader`),\n      }\n    },\n\n    eslint: (schema = ``) => {\n      const options = eslintConfig(schema)\n\n      return {\n        options,\n        loader: require.resolve(`eslint-loader`),\n      }\n    },\n\n    imports: (options = {}) => {\n      return {\n        options,\n        loader: require.resolve(`imports-loader`),\n      }\n    },\n\n    exports: (options = {}) => {\n      return {\n        options,\n        loader: require.resolve(`exports-loader`),\n      }\n    },\n  }\n\n  /**\n   * Rules\n   */\n  const rules = {}\n\n  /**\n   * JavaScript loader via babel, excludes node_modules\n   */\n  {\n    let js = (options = {}) => {\n      return {\n        test: /\\.jsx?$/,\n        exclude: vendorRegex,\n        use: [loaders.js(options)],\n      }\n    }\n\n    rules.js = js\n  }\n\n  /**\n   * mjs loader:\n   * webpack 4 has issues automatically dealing with\n   * the .mjs extension, thus we need to explicitly\n   * add this rule to use the default webpack js loader\n   */\n  {\n    let mjs = (options = {}) => {\n      return {\n        test: /\\.mjs$/,\n        include: /node_modules/,\n        type: `javascript/auto`,\n        ...options,\n      }\n    }\n\n    rules.mjs = mjs\n  }\n\n  {\n    let eslint = schema => {\n      return {\n        enforce: `pre`,\n        test: /\\.jsx?$/,\n        exclude: vendorRegex,\n        use: [loaders.eslint(schema)],\n      }\n    }\n\n    rules.eslint = eslint\n  }\n\n  rules.yaml = () => {\n    return {\n      test: /\\.ya?ml/,\n      use: [loaders.json(), loaders.yaml()],\n    }\n  }\n\n  /**\n   * Font loader\n   */\n  rules.fonts = () => {\n    return {\n      use: [loaders.url()],\n      test: /\\.(eot|otf|ttf|woff(2)?)(\\?.*)?$/,\n    }\n  }\n\n  /**\n   * Loads image assets, inlines images via a data URI if they are below\n   * the size threshold\n   */\n  rules.images = () => {\n    return {\n      use: [loaders.url()],\n      test: /\\.(ico|svg|jpg|jpeg|png|gif|webp)(\\?.*)?$/,\n    }\n  }\n\n  /**\n   * Loads audio and video and inlines them via a data URI if they are below\n   * the size threshold\n   */\n  rules.media = () => {\n    return {\n      use: [loaders.url()],\n      test: /\\.(mp4|webm|wav|mp3|m4a|aac|oga|flac)$/,\n    }\n  }\n\n  /**\n   * Loads assets without inlining\n   */\n  rules.miscAssets = () => {\n    return {\n      use: [loaders.file()],\n      test: /\\.pdf$/,\n    }\n  }\n\n  /**\n   * CSS style loader.\n   */\n  {\n    const css = ({ browsers, ...options } = {}) => {\n      const use = [\n        loaders.css({ ...options, importLoaders: 1 }),\n        loaders.postcss({ browsers }),\n      ]\n      if (!isSSR) use.unshift(loaders.miniCssExtract())\n\n      return {\n        use,\n        test: /\\.css$/,\n      }\n    }\n\n    /**\n     * CSS style loader, _excludes_ node_modules.\n     */\n    css.internal = makeInternalOnly(css)\n    css.external = makeExternalOnly(css)\n\n    const cssModules = options => {\n      const rule = css({ ...options, modules: true })\n      delete rule.exclude\n      rule.test = /\\.module\\.css$/\n      return rule\n    }\n\n    rules.css = css\n    rules.cssModules = cssModules\n  }\n\n  /**\n   * PostCSS loader.\n   */\n  {\n    const postcss = options => {\n      return {\n        test: /\\.css$/,\n        use: [loaders.css({ importLoaders: 1 }), loaders.postcss(options)],\n      }\n    }\n\n    /**\n     * PostCSS loader, _excludes_ node_modules.\n     */\n    postcss.internal = makeInternalOnly(postcss)\n    postcss.external = makeExternalOnly(postcss)\n    rules.postcss = postcss\n  }\n  /**\n   * Plugins\n   */\n  const plugins = { ...builtinPlugins }\n\n  /**\n   * Minify JavaScript code without regard for IE8. Attempts\n   * to parallelize the work to save time. Generally only add in Production\n   */\n  plugins.minifyJs = ({ terserOptions, ...options } = {}) =>\n    new TerserPlugin({\n      cache: true,\n      parallel: true,\n      exclude: /\\.min\\.js/,\n      sourceMap: true,\n      terserOptions: {\n        ie8: false,\n        parse: {\n          ecma: 8,\n        },\n        compress: {\n          ecma: 5,\n        },\n        output: {\n          ecma: 5,\n        },\n        ...terserOptions,\n      },\n      ...options,\n    })\n\n  plugins.minifyCss = (options = {}) => new OptimizeCssAssetsPlugin(options)\n\n  /**\n   * Extracts css requires into a single file;\n   * includes some reasonable defaults\n   */\n  plugins.extractText = options =>\n    new MiniCssExtractPlugin({\n      filename: `[name].[contenthash].css`,\n      chunkFilename: `[name].[contenthash].css`,\n      ...options,\n    })\n\n  plugins.moment = () => plugins.ignore(/^\\.\\/locale$/, /moment$/)\n\n  return {\n    loaders,\n    rules: (rules: RuleUtils),\n    plugins: (plugins: PluginUtils),\n  }\n}\n"],"file":"webpack-utils.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/utils/webpack.config.js
+++ b/node_modules/gatsby/dist/utils/webpack.config.js
@@ -1,9 +1,5 @@
 "use strict";
 
-var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
-
-var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
-
 require(`v8-compile-cache`);
 
 const fs = require(`fs-extra`);
@@ -14,18 +10,21 @@ const dotenv = require(`dotenv`);
 
 const FriendlyErrorsWebpackPlugin = require(`friendly-errors-webpack-plugin`);
 
-const _require = require(`../redux`),
-      store = _require.store;
+const {
+  store
+} = require(`../redux`);
 
-const _require2 = require(`../redux/actions`),
-      actions = _require2.actions;
+const {
+  actions
+} = require(`../redux/actions`);
 
 const debug = require(`debug`)(`gatsby:webpack-config`);
 
 const report = require(`gatsby-cli/lib/reporter`);
 
-const _require3 = require(`./path`),
-      withBasePath = _require3.withBasePath;
+const {
+  withBasePath
+} = require(`./path`);
 
 const apiRunnerNode = require(`./api-runner-node`);
 
@@ -38,443 +37,410 @@ const hasLocalEslint = require(`./local-eslint-config-finder`); // Four stages o
 //   4) build-html: build all HTML files
 
 
-module.exports =
-/*#__PURE__*/
-function () {
-  var _ref = (0, _asyncToGenerator2.default)(function* (program, directory, suppliedStage, webpackPort = 1500) {
-    const directoryPath = withBasePath(directory);
-    process.env.GATSBY_BUILD_STAGE = suppliedStage; // We combine develop & develop-html stages for purposes of generating the
-    // webpack config.
+module.exports = async (program, directory, suppliedStage, webpackPort = 1500) => {
+  const directoryPath = withBasePath(directory);
+  process.env.GATSBY_BUILD_STAGE = suppliedStage; // We combine develop & develop-html stages for purposes of generating the
+  // webpack config.
 
-    const stage = suppliedStage;
+  const stage = suppliedStage;
+  const {
+    rules,
+    loaders,
+    plugins
+  } = await createUtils({
+    stage,
+    program
+  });
 
-    const _ref2 = yield createUtils({
-      stage,
-      program
-    }),
-          rules = _ref2.rules,
-          loaders = _ref2.loaders,
-          plugins = _ref2.plugins;
-
-    function processEnv(stage, defaultNodeEnv) {
-      debug(`Building env for "${stage}"`);
-      const env = process.env.NODE_ENV ? process.env.NODE_ENV : `${defaultNodeEnv}`;
-      const envFile = path.join(process.cwd(), `./.env.${env}`);
-      let parsed = {};
-
-      try {
-        parsed = dotenv.parse(fs.readFileSync(envFile, {
-          encoding: `utf8`
-        }));
-      } catch (err) {
-        if (err.code !== `ENOENT`) {
-          report.error(`There was a problem processing the .env file`, err);
-        }
+  function processEnv(stage, defaultNodeEnv) {
+    debug(`Building env for "${stage}"`);
+    const env = process.env.NODE_ENV ? process.env.NODE_ENV : `${defaultNodeEnv}`;
+    const envFile = path.join(process.cwd(), `./.env.${env}`);
+    let parsed = {};
+
+    try {
+      parsed = dotenv.parse(fs.readFileSync(envFile, {
+        encoding: `utf8`
+      }));
+    } catch (err) {
+      if (err.code !== `ENOENT`) {
+        report.error(`There was a problem processing the .env file`, err);
       }
-
-      const envObject = Object.keys(parsed).reduce((acc, key) => {
-        acc[key] = JSON.stringify(parsed[key]);
-        return acc;
-      }, {});
-      const gatsbyVarObject = Object.keys(process.env).reduce((acc, key) => {
-        if (key.match(/^GATSBY_/)) {
-          acc[key] = JSON.stringify(process.env[key]);
-        }
-
-        return acc;
-      }, {}); // Don't allow overwriting of NODE_ENV, PUBLIC_DIR as to not break gatsby things
-
-      envObject.NODE_ENV = JSON.stringify(env);
-      envObject.PUBLIC_DIR = JSON.stringify(`${process.cwd()}/public`);
-      envObject.BUILD_STAGE = JSON.stringify(stage);
-      const mergedEnvVars = Object.assign(envObject, gatsbyVarObject);
-      return Object.keys(mergedEnvVars).reduce((acc, key) => {
-        acc[`process.env.${key}`] = mergedEnvVars[key];
-        return acc;
-      }, {
-        "process.env": JSON.stringify({})
-      });
     }
 
-    function getHmrPath() {
-      // ref: https://github.com/gatsbyjs/gatsby/issues/8348
-      let hmrBasePath = `/`;
-      const hmrSuffix = `__webpack_hmr&reload=true&overlay=false`;
+    const envObject = Object.keys(parsed).reduce((acc, key) => {
+      acc[key] = JSON.stringify(parsed[key]);
+      return acc;
+    }, {});
+    const gatsbyVarObject = Object.keys(process.env).reduce((acc, key) => {
+      if (key.match(/^GATSBY_/)) {
+        acc[key] = JSON.stringify(process.env[key]);
+      }
 
-      if (process.env.GATSBY_WEBPACK_PUBLICPATH) {
-        const pubPath = process.env.GATSBY_WEBPACK_PUBLICPATH;
+      return acc;
+    }, {}); // Don't allow overwriting of NODE_ENV, PUBLIC_DIR as to not break gatsby things
+
+    envObject.NODE_ENV = JSON.stringify(env);
+    envObject.PUBLIC_DIR = JSON.stringify(`${process.cwd()}/public`);
+    envObject.BUILD_STAGE = JSON.stringify(stage);
+    const mergedEnvVars = Object.assign(envObject, gatsbyVarObject);
+    return Object.keys(mergedEnvVars).reduce((acc, key) => {
+      acc[`process.env.${key}`] = mergedEnvVars[key];
+      return acc;
+    }, {
+      "process.env": JSON.stringify({})
+    });
+  }
 
-        if (pubPath.substr(-1) === `/`) {
-          hmrBasePath = pubPath;
-        } else {
-          hmrBasePath = `${pubPath}/`;
-        }
-      }
+  function getHmrPath() {
+    // ref: https://github.com/gatsbyjs/gatsby/issues/8348
+    let hmrBasePath = `/`;
+    const hmrSuffix = `__webpack_hmr&reload=true&overlay=false`;
 
-      return hmrBasePath + hmrSuffix;
-    }
+    if (process.env.GATSBY_WEBPACK_PUBLICPATH) {
+      const pubPath = process.env.GATSBY_WEBPACK_PUBLICPATH;
 
-    debug(`Loading webpack config for stage "${stage}"`);
-
-    function getOutput() {
-      switch (stage) {
-        case `develop`:
-          return {
-            path: directory,
-            filename: `[name].js`,
-            // Add /* filename */ comments to generated require()s in the output.
-            pathinfo: true,
-            // Point sourcemap entries to original disk location (format as URL on Windows)
-            publicPath: process.env.GATSBY_WEBPACK_PUBLICPATH || `${program.ssl ? `https` : `http`}://${program.host}:${webpackPort}/`,
-            devtoolModuleFilenameTemplate: info => path.resolve(info.absoluteResourcePath).replace(/\\/g, `/`),
-            // Avoid React cross-origin errors
-            // See https://reactjs.org/docs/cross-origin-errors.html
-            crossOriginLoading: `anonymous`
-          };
-
-        case `build-html`:
-        case `develop-html`:
-          // A temp file required by static-site-generator-plugin. See plugins() below.
-          // Deleted by build-html.js, since it's not needed for production.
-          return {
-            path: directoryPath(`public`),
-            filename: `render-page.js`,
-            libraryTarget: `umd`,
-            library: `lib`,
-            umdNamedDefine: true,
-            globalObject: `this`,
-            publicPath: program.prefixPaths ? `${store.getState().config.pathPrefix}/` : `/`
-          };
-
-        case `build-javascript`:
-          return {
-            filename: `[name]-[contenthash].js`,
-            chunkFilename: `[name]-[contenthash].js`,
-            path: directoryPath(`public`),
-            publicPath: program.prefixPaths ? `${store.getState().config.pathPrefix}/` : `/`
-          };
-
-        default:
-          throw new Error(`The state requested ${stage} doesn't exist.`);
+      if (pubPath.substr(-1) === `/`) {
+        hmrBasePath = pubPath;
+      } else {
+        hmrBasePath = `${pubPath}/`;
       }
     }
 
-    function getEntry() {
-      switch (stage) {
-        case `develop`:
-          return {
-            commons: [`${require.resolve(`webpack-hot-middleware/client`)}?path=${getHmrPath()}`, directoryPath(`.cache/app`)]
-          };
-
-        case `develop-html`:
-          return {
-            main: directoryPath(`.cache/develop-static-entry`)
-          };
-
-        case `build-html`:
-          return {
-            main: directoryPath(`.cache/static-entry`)
-          };
-
-        case `build-javascript`:
-          return {
-            app: directoryPath(`.cache/production-app`)
-          };
-
-        default:
-          throw new Error(`The state requested ${stage} doesn't exist.`);
-      }
+    return hmrBasePath + hmrSuffix;
+  }
+
+  debug(`Loading webpack config for stage "${stage}"`);
+
+  function getOutput() {
+    switch (stage) {
+      case `develop`:
+        return {
+          path: directory,
+          filename: `[name].js`,
+          // Add /* filename */ comments to generated require()s in the output.
+          pathinfo: true,
+          // Point sourcemap entries to original disk location (format as URL on Windows)
+          publicPath: process.env.GATSBY_WEBPACK_PUBLICPATH || `${program.ssl ? `https` : `http`}://${program.host}:${webpackPort}/`,
+          devtoolModuleFilenameTemplate: info => path.resolve(info.absoluteResourcePath).replace(/\\/g, `/`),
+          // Avoid React cross-origin errors
+          // See https://reactjs.org/docs/cross-origin-errors.html
+          crossOriginLoading: `anonymous`
+        };
+
+      case `build-html`:
+      case `develop-html`:
+        // A temp file required by static-site-generator-plugin. See plugins() below.
+        // Deleted by build-html.js, since it's not needed for production.
+        return {
+          path: directoryPath(`public`),
+          filename: `render-page.js`,
+          libraryTarget: `umd`,
+          library: `lib`,
+          umdNamedDefine: true,
+          globalObject: `this`,
+          publicPath: program.prefixPaths ? `${store.getState().config.pathPrefix}/` : `/`
+        };
+
+      case `build-javascript`:
+        return {
+          filename: `[name]-[contenthash].js`,
+          chunkFilename: `[name]-[contenthash].js`,
+          path: directoryPath(`public`),
+          publicPath: program.prefixPaths ? `${store.getState().config.pathPrefix}/` : `/`
+        };
+
+      default:
+        throw new Error(`The state requested ${stage} doesn't exist.`);
     }
-
-    function getPlugins() {
-      let configPlugins = [plugins.moment(), // Add a few global variables. Set NODE_ENV to production (enables
-      // optimizations for React) and what the link prefix is (__PATH_PREFIX__).
-      plugins.define(Object.assign({}, processEnv(stage, `development`), {
-        __PATH_PREFIX__: JSON.stringify(program.prefixPaths ? store.getState().config.pathPrefix : ``)
-      }))];
-
-      switch (stage) {
-        case `develop`:
-          configPlugins = configPlugins.concat([plugins.hotModuleReplacement(), plugins.noEmitOnErrors(), new FriendlyErrorsWebpackPlugin({
-            clearConsole: false
-          })]);
-          break;
-
-        case `build-javascript`:
+  }
+
+  function getEntry() {
+    switch (stage) {
+      case `develop`:
+        return {
+          commons: [`${require.resolve(`webpack-hot-middleware/client`)}?path=${getHmrPath()}`, directoryPath(`.cache/app`)]
+        };
+
+      case `develop-html`:
+        return {
+          main: directoryPath(`.cache/develop-static-entry`)
+        };
+
+      case `build-html`:
+        return {
+          main: directoryPath(`.cache/static-entry`)
+        };
+
+      case `build-javascript`:
+        return {
+          app: directoryPath(`.cache/production-app`)
+        };
+
+      default:
+        throw new Error(`The state requested ${stage} doesn't exist.`);
+    }
+  }
+
+  function getPlugins() {
+    let configPlugins = [plugins.moment(), // Add a few global variables. Set NODE_ENV to production (enables
+    // optimizations for React) and what the link prefix is (__PATH_PREFIX__).
+    plugins.define({ ...processEnv(stage, `development`),
+      __PATH_PREFIX__: JSON.stringify(program.prefixPaths ? store.getState().config.pathPrefix : ``)
+    })];
+
+    switch (stage) {
+      case `develop`:
+        configPlugins = configPlugins.concat([plugins.hotModuleReplacement(), plugins.noEmitOnErrors(), new FriendlyErrorsWebpackPlugin({
+          clearConsole: false
+        })]);
+        break;
+
+      case `build-javascript`:
+        {
+          configPlugins = configPlugins.concat([plugins.extractText(), // Write out stats object mapping named dynamic imports (aka page
+          // components) to all their async chunks.
           {
-            configPlugins = configPlugins.concat([plugins.extractText(), // Write out stats object mapping named dynamic imports (aka page
-            // components) to all their async chunks.
-            {
-              apply: function apply(compiler) {
-                compiler.hooks.done.tapAsync(`gatsby-webpack-stats-extractor`, (stats, done) => {
-                  let assets = {};
-                  let assetsMap = {};
-
-                  for (var _iterator = stats.compilation.chunkGroups, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {
-                    var _ref3;
-
-                    if (_isArray) {
-                      if (_i >= _iterator.length) break;
-                      _ref3 = _iterator[_i++];
-                    } else {
-                      _i = _iterator.next();
-                      if (_i.done) break;
-                      _ref3 = _i.value;
-                    }
-
-                    let chunkGroup = _ref3;
-
-                    if (chunkGroup.name) {
-                      let files = [];
-
-                      for (var _iterator2 = chunkGroup.chunks, _isArray2 = Array.isArray(_iterator2), _i2 = 0, _iterator2 = _isArray2 ? _iterator2 : _iterator2[Symbol.iterator]();;) {
-                        var _ref4;
-
-                        if (_isArray2) {
-                          if (_i2 >= _iterator2.length) break;
-                          _ref4 = _iterator2[_i2++];
-                        } else {
-                          _i2 = _iterator2.next();
-                          if (_i2.done) break;
-                          _ref4 = _i2.value;
-                        }
+            apply: function (compiler) {
+              compiler.hooks.done.tapAsync(`gatsby-webpack-stats-extractor`, (stats, done) => {
+                let assets = {};
+                let assetsMap = {};
 
-                        let chunk = _ref4;
-                        files.push(...chunk.files);
-                      }
+                for (let chunkGroup of stats.compilation.chunkGroups) {
+                  if (chunkGroup.name) {
+                    let files = [];
 
-                      assets[chunkGroup.name] = files.filter(f => f.slice(-4) !== `.map`);
-                      assetsMap[chunkGroup.name] = files.filter(f => f.slice(-4) !== `.map` && f.slice(0, chunkGroup.name.length) === chunkGroup.name).map(filename => `/${filename}`);
+                    for (let chunk of chunkGroup.chunks) {
+                      files.push(...chunk.files);
                     }
+
+                    assets[chunkGroup.name] = files.filter(f => f.slice(-4) !== `.map`);
+                    assetsMap[chunkGroup.name] = files.filter(f => f.slice(-4) !== `.map` && f.slice(0, chunkGroup.name.length) === chunkGroup.name).map(filename => `/${filename}`);
                   }
+                }
 
-                  const webpackStats = Object.assign({}, stats.toJson({
+                const webpackStats = { ...stats.toJson({
                     all: false,
                     chunkGroups: true
-                  }), {
-                    assetsByChunkName: assets
-                  });
-                  fs.writeFile(path.join(`public`, `chunk-map.json`), JSON.stringify(assetsMap), () => {
-                    fs.writeFile(path.join(`public`, `webpack.stats.json`), JSON.stringify(webpackStats), done);
-                  });
+                  }),
+                  assetsByChunkName: assets
+                };
+                fs.writeFile(path.join(`public`, `chunk-map.json`), JSON.stringify(assetsMap), () => {
+                  fs.writeFile(path.join(`public`, `webpack.stats.json`), JSON.stringify(webpackStats), done);
                 });
-              }
-            }]);
-            break;
-          }
-      }
-
-      return configPlugins;
+              });
+            }
+          }]);
+          break;
+        }
     }
 
-    function getDevtool() {
-      switch (stage) {
-        case `develop`:
-          return `cheap-module-source-map`;
-        // use a normal `source-map` for the html phases since
-        // it gives better line and column numbers
+    return configPlugins;
+  }
 
-        case `develop-html`:
-        case `build-html`:
-        case `build-javascript`:
-          return `source-map`;
+  function getDevtool() {
+    switch (stage) {
+      case `develop`:
+        return `cheap-module-source-map`;
+      // use a normal `source-map` for the html phases since
+      // it gives better line and column numbers
 
-        default:
-          return false;
-      }
-    }
-
-    function getMode() {
-      switch (stage) {
-        case `build-javascript`:
-          return `production`;
+      case `develop-html`:
+      case `build-html`:
+      case `build-javascript`:
+        return `source-map`;
 
-        case `develop`:
-        case `develop-html`:
-        case `build-html`:
-          return `development`;
-        // So we don't uglify the html bundle
-
-        default:
-          return `production`;
-      }
+      default:
+        return false;
     }
+  }
 
-    function getModule(config) {
-      // Common config for every env.
-      // prettier-ignore
-      let configRules = [rules.mjs(), rules.js(), rules.yaml(), rules.fonts(), rules.images(), rules.media(), rules.miscAssets()];
-
-      switch (stage) {
-        case `develop`:
-          {
-            // get schema to pass to eslint config and program for directory
-            const _store$getState = store.getState(),
-                  schema = _store$getState.schema,
-                  program = _store$getState.program; // if no local eslint config, then add gatsby config
+  function getMode() {
+    switch (stage) {
+      case `build-javascript`:
+        return `production`;
 
+      case `develop`:
+      case `develop-html`:
+      case `build-html`:
+        return `development`;
+      // So we don't uglify the html bundle
 
-            if (!hasLocalEslint(program.directory)) {
-              configRules = configRules.concat([rules.eslint(schema)]);
-            }
-
-            configRules = configRules.concat([{
-              oneOf: [rules.cssModules(), rules.css()]
-            }]);
-            break;
+      default:
+        return `production`;
+    }
+  }
+
+  function getModule(config) {
+    // Common config for every env.
+    // prettier-ignore
+    let configRules = [rules.mjs(), rules.js(), rules.yaml(), rules.fonts(), rules.images(), rules.media(), rules.miscAssets()];
+
+    switch (stage) {
+      case `develop`:
+        {
+          // get schema to pass to eslint config and program for directory
+          const {
+            schema,
+            program
+          } = store.getState(); // if no local eslint config, then add gatsby config
+
+          if (!hasLocalEslint(program.directory)) {
+            configRules = configRules.concat([rules.eslint(schema)]);
           }
 
-        case `build-html`:
-        case `develop-html`:
-          // We don't deal with CSS at all when building the HTML.
-          // The 'null' loader is used to prevent 'module not found' errors.
-          // On the other hand CSS modules loaders are necessary.
-          // prettier-ignore
-          configRules = configRules.concat([{
-            oneOf: [rules.cssModules(), Object.assign({}, rules.css(), {
-              use: [loaders.null()]
-            })]
-          }]);
-          break;
-
-        case `build-javascript`:
-          // We don't deal with CSS at all when building JavaScript but we still
-          // need to process the CSS so offline-plugin knows about the various
-          // assets referenced in your CSS.
-          //
-          // It's also necessary to process CSS Modules so your JS knows the
-          // classNames to use.
           configRules = configRules.concat([{
             oneOf: [rules.cssModules(), rules.css()]
           }]);
           break;
-      }
-
-      return {
-        rules: configRules
-      };
-    }
-
-    function getResolve() {
-      const _store$getState2 = store.getState(),
-            program = _store$getState2.program;
-
-      return {
-        // Use the program's extension list (generated via the
-        // 'resolvableExtensions' API hook).
-        extensions: [...program.extensions],
-        // Default to using the site's node_modules directory to look for
-        // modules. But also make it possible to install modules within the src
-        // directory if you need to install a specific version of a module for a
-        // part of your site.
-        modules: [directoryPath(path.join(`node_modules`)), `node_modules`],
-        alias: {
-          gatsby$: directoryPath(path.join(`.cache`, `gatsby-browser-entry.js`)),
-          // Using directories for module resolution is mandatory because
-          // relative path imports are used sometimes
-          // See https://stackoverflow.com/a/49455609/6420957 for more details
-          "@babel/runtime": path.dirname(require.resolve(`@babel/runtime/package.json`)),
-          "core-js": path.dirname(require.resolve(`core-js/package.json`)),
-          "react-hot-loader": path.dirname(require.resolve(`react-hot-loader/package.json`)),
-          "react-lifecycles-compat": directoryPath(`.cache/react-lifecycles-compat.js`),
-          "create-react-context": directoryPath(`.cache/create-react-context.js`)
         }
-      };
+
+      case `build-html`:
+      case `develop-html`:
+        // We don't deal with CSS at all when building the HTML.
+        // The 'null' loader is used to prevent 'module not found' errors.
+        // On the other hand CSS modules loaders are necessary.
+        // prettier-ignore
+        configRules = configRules.concat([{
+          oneOf: [rules.cssModules(), { ...rules.css(),
+            use: [loaders.null()]
+          }]
+        }]);
+        break;
+
+      case `build-javascript`:
+        // We don't deal with CSS at all when building JavaScript but we still
+        // need to process the CSS so offline-plugin knows about the various
+        // assets referenced in your CSS.
+        //
+        // It's also necessary to process CSS Modules so your JS knows the
+        // classNames to use.
+        configRules = configRules.concat([{
+          oneOf: [rules.cssModules(), rules.css()]
+        }]);
+        break;
     }
 
-    function getResolveLoader() {
-      const root = [path.resolve(directory, `node_modules`)];
-      const userLoaderDirectoryPath = path.resolve(directory, `loaders`);
+    return {
+      rules: configRules
+    };
+  }
 
-      try {
-        if (fs.statSync(userLoaderDirectoryPath).isDirectory()) {
-          root.push(userLoaderDirectoryPath);
-        }
-      } catch (err) {
-        debug(`Error resolving user loaders directory`, err);
+  function getResolve() {
+    const {
+      program
+    } = store.getState();
+    return {
+      // Use the program's extension list (generated via the
+      // 'resolvableExtensions' API hook).
+      extensions: [...program.extensions],
+      // Default to using the site's node_modules directory to look for
+      // modules. But also make it possible to install modules within the src
+      // directory if you need to install a specific version of a module for a
+      // part of your site.
+      modules: [directoryPath(path.join(`node_modules`)), `node_modules`],
+      alias: {
+        gatsby$: directoryPath(path.join(`.cache`, `gatsby-browser-entry.js`)),
+        // Using directories for module resolution is mandatory because
+        // relative path imports are used sometimes
+        // See https://stackoverflow.com/a/49455609/6420957 for more details
+        "@babel/runtime": path.dirname(require.resolve(`@babel/runtime/package.json`)),
+        "core-js": path.dirname(require.resolve(`core-js/package.json`)),
+        "react-hot-loader": path.dirname(require.resolve(`react-hot-loader/package.json`)),
+        "react-lifecycles-compat": directoryPath(`.cache/react-lifecycles-compat.js`),
+        "create-react-context": directoryPath(`.cache/create-react-context.js`)
       }
+    };
+  }
 
-      return {
-        modules: [...root, path.join(__dirname, `../loaders`), `node_modules`]
-      };
-    }
+  function getResolveLoader() {
+    const root = [path.resolve(directory, `node_modules`)];
+    const userLoaderDirectoryPath = path.resolve(directory, `loaders`);
 
-    const config = {
-      // Context is the base directory for resolving the entry option.
-      context: directory,
-      entry: getEntry(),
-      output: getOutput(),
-      module: getModule(),
-      plugins: getPlugins(),
-      // Certain "isomorphic" packages have different entry points for browser
-      // and server (see
-      // https://github.com/defunctzombie/package-browser-field-spec); setting
-      // the target tells webpack which file to include, ie. browser vs main.
-      target: stage === `build-html` || stage === `develop-html` ? `node` : `web`,
-      devtool: getDevtool(),
-      // Turn off performance hints as we (for now) don't want to show the normal
-      // webpack output anywhere.
-      performance: {
-        hints: false
-      },
-      mode: getMode(),
-      resolveLoader: getResolveLoader(),
-      resolve: getResolve(),
-      node: {
-        __filename: true
+    try {
+      if (fs.statSync(userLoaderDirectoryPath).isDirectory()) {
+        root.push(userLoaderDirectoryPath);
       }
-    };
-
-    if (stage === `build-javascript`) {
-      config.optimization = {
-        runtimeChunk: {
-          name: `webpack-runtime`
-        },
-        splitChunks: {
-          name: false
-        },
-        minimizer: [// TODO: maybe this option should be noMinimize?
-        !program.noUglify && plugins.minifyJs(), plugins.minifyCss()].filter(Boolean)
-      };
+    } catch (err) {
+      debug(`Error resolving user loaders directory`, err);
     }
 
-    if (stage === `build-html` || stage === `develop-html`) {
-      const externalList = [// match `lodash` and `lodash/foo`
-      // but not things like `lodash-es`
-      `lodash`, /^lodash\//, `react`, /^react-dom\//, `pify`, `@reach/router`, `@reach/router/lib/history`, `common-tags`, `path`, `semver`, `react-helmet`, `minimatch`, `fs`, /^core-js\//, `es6-promise`, `crypto`, `zlib`, `http`, `https`, `debug`];
-      config.externals = [function (context, request, callback) {
-        if (externalList.some(item => {
-          if (typeof item === `string` && item === request) {
-            return true;
-          } else if (item instanceof RegExp && item.test(request)) {
-            return true;
-          }
+    return {
+      modules: [...root, path.join(__dirname, `../loaders`), `node_modules`]
+    };
+  }
+
+  const config = {
+    // Context is the base directory for resolving the entry option.
+    context: directory,
+    entry: getEntry(),
+    output: getOutput(),
+    module: getModule(),
+    plugins: getPlugins(),
+    // Certain "isomorphic" packages have different entry points for browser
+    // and server (see
+    // https://github.com/defunctzombie/package-browser-field-spec); setting
+    // the target tells webpack which file to include, ie. browser vs main.
+    target: stage === `build-html` || stage === `develop-html` ? `node` : `web`,
+    devtool: getDevtool(),
+    // Turn off performance hints as we (for now) don't want to show the normal
+    // webpack output anywhere.
+    performance: {
+      hints: false
+    },
+    mode: getMode(),
+    resolveLoader: getResolveLoader(),
+    resolve: getResolve(),
+    node: {
+      __filename: true
+    }
+  };
 
-          return false;
-        })) {
-          return callback(null, `umd ${request}`);
+  if (stage === `build-javascript`) {
+    config.optimization = {
+      runtimeChunk: {
+        name: `webpack-runtime`
+      },
+      splitChunks: {
+        name: false
+      },
+      minimizer: [// TODO: maybe this option should be noMinimize?
+      !program.noUglify && plugins.minifyJs(), plugins.minifyCss()].filter(Boolean)
+    };
+  }
+
+  if (stage === `build-html` || stage === `develop-html`) {
+    const externalList = [// match `lodash` and `lodash/foo`
+    // but not things like `lodash-es`
+    `lodash`, /^lodash\//, `react`, /^react-dom\//, `pify`, `@reach/router`, `@reach/router/lib/history`, `common-tags`, `path`, `semver`, `react-helmet`, `minimatch`, `fs`, /^core-js\//, `es6-promise`, `crypto`, `zlib`, `http`, `https`, `debug`];
+    config.externals = [function (context, request, callback) {
+      if (externalList.some(item => {
+        if (typeof item === `string` && item === request) {
+          return true;
+        } else if (item instanceof RegExp && item.test(request)) {
+          return true;
         }
 
-        return callback();
-      }];
-    }
+        return false;
+      })) {
+        return callback(null, `umd ${request}`);
+      }
 
-    store.dispatch(actions.replaceWebpackConfig(config));
+      return callback();
+    }];
+  }
 
-    const getConfig = () => store.getState().webpack;
+  store.dispatch(actions.replaceWebpackConfig(config));
 
-    yield apiRunnerNode(`onCreateWebpackConfig`, {
-      getConfig,
-      stage,
-      rules,
-      loaders,
-      plugins
-    });
-    return getConfig();
-  });
+  const getConfig = () => store.getState().webpack;
 
-  return function (_x, _x2, _x3) {
-    return _ref.apply(this, arguments);
-  };
-}();
+  await apiRunnerNode(`onCreateWebpackConfig`, {
+    getConfig,
+    stage,
+    rules,
+    loaders,
+    plugins
+  });
+  return getConfig();
+};
 //# sourceMappingURL=webpack.config.js.map
\ No newline at end of file
--- a/node_modules/gatsby/dist/utils/webpack.config.js.map
+++ b/node_modules/gatsby/dist/utils/webpack.config.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/utils/webpack.config.js"],"names":["require","fs","path","dotenv","FriendlyErrorsWebpackPlugin","store","actions","debug","report","withBasePath","apiRunnerNode","createUtils","hasLocalEslint","module","exports","program","directory","suppliedStage","webpackPort","directoryPath","process","env","GATSBY_BUILD_STAGE","stage","rules","loaders","plugins","processEnv","defaultNodeEnv","NODE_ENV","envFile","join","cwd","parsed","parse","readFileSync","encoding","err","code","error","envObject","Object","keys","reduce","acc","key","JSON","stringify","gatsbyVarObject","match","PUBLIC_DIR","BUILD_STAGE","mergedEnvVars","assign","getHmrPath","hmrBasePath","hmrSuffix","GATSBY_WEBPACK_PUBLICPATH","pubPath","substr","getOutput","filename","pathinfo","publicPath","ssl","host","devtoolModuleFilenameTemplate","info","resolve","absoluteResourcePath","replace","crossOriginLoading","libraryTarget","library","umdNamedDefine","globalObject","prefixPaths","getState","config","pathPrefix","chunkFilename","Error","getEntry","commons","main","app","getPlugins","configPlugins","moment","define","__PATH_PREFIX__","concat","hotModuleReplacement","noEmitOnErrors","clearConsole","extractText","apply","compiler","hooks","done","tapAsync","stats","assets","assetsMap","compilation","chunkGroups","chunkGroup","name","files","chunks","chunk","push","filter","f","slice","length","map","webpackStats","toJson","all","assetsByChunkName","writeFile","getDevtool","getMode","getModule","configRules","mjs","js","yaml","fonts","images","media","miscAssets","schema","eslint","oneOf","cssModules","css","use","null","getResolve","extensions","modules","alias","gatsby$","dirname","getResolveLoader","root","userLoaderDirectoryPath","statSync","isDirectory","__dirname","context","entry","output","target","devtool","performance","hints","mode","resolveLoader","node","__filename","optimization","runtimeChunk","splitChunks","minimizer","noUglify","minifyJs","minifyCss","Boolean","externalList","externals","request","callback","some","item","RegExp","test","dispatch","replaceWebpackConfig","getConfig","webpack"],"mappings":"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","sourcesContent":["require(`v8-compile-cache`)\n\nconst fs = require(`fs-extra`)\nconst path = require(`path`)\nconst dotenv = require(`dotenv`)\nconst FriendlyErrorsWebpackPlugin = require(`friendly-errors-webpack-plugin`)\nconst { store } = require(`../redux`)\nconst { actions } = require(`../redux/actions`)\nconst debug = require(`debug`)(`gatsby:webpack-config`)\nconst report = require(`gatsby-cli/lib/reporter`)\nconst { withBasePath } = require(`./path`)\n\nconst apiRunnerNode = require(`./api-runner-node`)\nconst createUtils = require(`./webpack-utils`)\nconst hasLocalEslint = require(`./local-eslint-config-finder`)\n\n// Four stages or modes:\n//   1) develop: for `gatsby develop` command, hot reload and CSS injection into page\n//   2) develop-html: same as develop without react-hmre in the babel config for html renderer\n//   3) build-javascript: Build JS and CSS chunks for production\n//   4) build-html: build all HTML files\n\nmodule.exports = async (\n  program,\n  directory,\n  suppliedStage,\n  webpackPort = 1500\n) => {\n  const directoryPath = withBasePath(directory)\n\n  process.env.GATSBY_BUILD_STAGE = suppliedStage\n\n  // We combine develop & develop-html stages for purposes of generating the\n  // webpack config.\n  const stage = suppliedStage\n  const { rules, loaders, plugins } = await createUtils({ stage, program })\n\n  function processEnv(stage, defaultNodeEnv) {\n    debug(`Building env for \"${stage}\"`)\n    const env = process.env.NODE_ENV\n      ? process.env.NODE_ENV\n      : `${defaultNodeEnv}`\n    const envFile = path.join(process.cwd(), `./.env.${env}`)\n    let parsed = {}\n    try {\n      parsed = dotenv.parse(fs.readFileSync(envFile, { encoding: `utf8` }))\n    } catch (err) {\n      if (err.code !== `ENOENT`) {\n        report.error(`There was a problem processing the .env file`, err)\n      }\n    }\n\n    const envObject = Object.keys(parsed).reduce((acc, key) => {\n      acc[key] = JSON.stringify(parsed[key])\n      return acc\n    }, {})\n\n    const gatsbyVarObject = Object.keys(process.env).reduce((acc, key) => {\n      if (key.match(/^GATSBY_/)) {\n        acc[key] = JSON.stringify(process.env[key])\n      }\n      return acc\n    }, {})\n\n    // Don't allow overwriting of NODE_ENV, PUBLIC_DIR as to not break gatsby things\n    envObject.NODE_ENV = JSON.stringify(env)\n    envObject.PUBLIC_DIR = JSON.stringify(`${process.cwd()}/public`)\n    envObject.BUILD_STAGE = JSON.stringify(stage)\n\n    const mergedEnvVars = Object.assign(envObject, gatsbyVarObject)\n\n    return Object.keys(mergedEnvVars).reduce(\n      (acc, key) => {\n        acc[`process.env.${key}`] = mergedEnvVars[key]\n        return acc\n      },\n      {\n        \"process.env\": JSON.stringify({}),\n      }\n    )\n  }\n\n  function getHmrPath() {\n    // ref: https://github.com/gatsbyjs/gatsby/issues/8348\n    let hmrBasePath = `/`\n    const hmrSuffix = `__webpack_hmr&reload=true&overlay=false`\n\n    if (process.env.GATSBY_WEBPACK_PUBLICPATH) {\n      const pubPath = process.env.GATSBY_WEBPACK_PUBLICPATH\n      if (pubPath.substr(-1) === `/`) {\n        hmrBasePath = pubPath\n      } else {\n        hmrBasePath = `${pubPath}/`\n      }\n    }\n\n    return hmrBasePath + hmrSuffix\n  }\n\n  debug(`Loading webpack config for stage \"${stage}\"`)\n  function getOutput() {\n    switch (stage) {\n      case `develop`:\n        return {\n          path: directory,\n          filename: `[name].js`,\n          // Add /* filename */ comments to generated require()s in the output.\n          pathinfo: true,\n          // Point sourcemap entries to original disk location (format as URL on Windows)\n          publicPath:\n            process.env.GATSBY_WEBPACK_PUBLICPATH ||\n            `${program.ssl ? `https` : `http`}://${\n              program.host\n            }:${webpackPort}/`,\n          devtoolModuleFilenameTemplate: info =>\n            path.resolve(info.absoluteResourcePath).replace(/\\\\/g, `/`),\n          // Avoid React cross-origin errors\n          // See https://reactjs.org/docs/cross-origin-errors.html\n          crossOriginLoading: `anonymous`,\n        }\n      case `build-html`:\n      case `develop-html`:\n        // A temp file required by static-site-generator-plugin. See plugins() below.\n        // Deleted by build-html.js, since it's not needed for production.\n        return {\n          path: directoryPath(`public`),\n          filename: `render-page.js`,\n          libraryTarget: `umd`,\n          library: `lib`,\n          umdNamedDefine: true,\n          globalObject: `this`,\n          publicPath: program.prefixPaths\n            ? `${store.getState().config.pathPrefix}/`\n            : `/`,\n        }\n      case `build-javascript`:\n        return {\n          filename: `[name]-[contenthash].js`,\n          chunkFilename: `[name]-[contenthash].js`,\n          path: directoryPath(`public`),\n          publicPath: program.prefixPaths\n            ? `${store.getState().config.pathPrefix}/`\n            : `/`,\n        }\n      default:\n        throw new Error(`The state requested ${stage} doesn't exist.`)\n    }\n  }\n\n  function getEntry() {\n    switch (stage) {\n      case `develop`:\n        return {\n          commons: [\n            `${require.resolve(\n              `webpack-hot-middleware/client`\n            )}?path=${getHmrPath()}`,\n            directoryPath(`.cache/app`),\n          ],\n        }\n      case `develop-html`:\n        return {\n          main: directoryPath(`.cache/develop-static-entry`),\n        }\n      case `build-html`:\n        return {\n          main: directoryPath(`.cache/static-entry`),\n        }\n      case `build-javascript`:\n        return {\n          app: directoryPath(`.cache/production-app`),\n        }\n      default:\n        throw new Error(`The state requested ${stage} doesn't exist.`)\n    }\n  }\n\n  function getPlugins() {\n    let configPlugins = [\n      plugins.moment(),\n\n      // Add a few global variables. Set NODE_ENV to production (enables\n      // optimizations for React) and what the link prefix is (__PATH_PREFIX__).\n      plugins.define({\n        ...processEnv(stage, `development`),\n        __PATH_PREFIX__: JSON.stringify(\n          program.prefixPaths ? store.getState().config.pathPrefix : ``\n        ),\n      }),\n    ]\n\n    switch (stage) {\n      case `develop`:\n        configPlugins = configPlugins.concat([\n          plugins.hotModuleReplacement(),\n          plugins.noEmitOnErrors(),\n\n          new FriendlyErrorsWebpackPlugin({\n            clearConsole: false,\n          }),\n        ])\n        break\n      case `build-javascript`: {\n        configPlugins = configPlugins.concat([\n          plugins.extractText(),\n          // Write out stats object mapping named dynamic imports (aka page\n          // components) to all their async chunks.\n          {\n            apply: function(compiler) {\n              compiler.hooks.done.tapAsync(\n                `gatsby-webpack-stats-extractor`,\n                (stats, done) => {\n                  let assets = {}\n                  let assetsMap = {}\n                  for (let chunkGroup of stats.compilation.chunkGroups) {\n                    if (chunkGroup.name) {\n                      let files = []\n                      for (let chunk of chunkGroup.chunks) {\n                        files.push(...chunk.files)\n                      }\n                      assets[chunkGroup.name] = files.filter(\n                        f => f.slice(-4) !== `.map`\n                      )\n                      assetsMap[chunkGroup.name] = files\n                        .filter(\n                          f =>\n                            f.slice(-4) !== `.map` &&\n                            f.slice(0, chunkGroup.name.length) ===\n                              chunkGroup.name\n                        )\n                        .map(filename => `/${filename}`)\n                    }\n                  }\n\n                  const webpackStats = {\n                    ...stats.toJson({ all: false, chunkGroups: true }),\n                    assetsByChunkName: assets,\n                  }\n\n                  fs.writeFile(\n                    path.join(`public`, `chunk-map.json`),\n                    JSON.stringify(assetsMap),\n                    () => {\n                      fs.writeFile(\n                        path.join(`public`, `webpack.stats.json`),\n                        JSON.stringify(webpackStats),\n                        done\n                      )\n                    }\n                  )\n                }\n              )\n            },\n          },\n        ])\n        break\n      }\n    }\n\n    return configPlugins\n  }\n\n  function getDevtool() {\n    switch (stage) {\n      case `develop`:\n        return `cheap-module-source-map`\n      // use a normal `source-map` for the html phases since\n      // it gives better line and column numbers\n      case `develop-html`:\n      case `build-html`:\n      case `build-javascript`:\n        return `source-map`\n      default:\n        return false\n    }\n  }\n\n  function getMode() {\n    switch (stage) {\n      case `build-javascript`:\n        return `production`\n      case `develop`:\n      case `develop-html`:\n      case `build-html`:\n        return `development` // So we don't uglify the html bundle\n      default:\n        return `production`\n    }\n  }\n\n  function getModule(config) {\n    // Common config for every env.\n    // prettier-ignore\n    let configRules = [\n      rules.mjs(),\n      rules.js(),\n      rules.yaml(),\n      rules.fonts(),\n      rules.images(),\n      rules.media(),\n      rules.miscAssets(),\n    ]\n    switch (stage) {\n      case `develop`: {\n        // get schema to pass to eslint config and program for directory\n        const { schema, program } = store.getState()\n\n        // if no local eslint config, then add gatsby config\n        if (!hasLocalEslint(program.directory)) {\n          configRules = configRules.concat([rules.eslint(schema)])\n        }\n\n        configRules = configRules.concat([\n          {\n            oneOf: [rules.cssModules(), rules.css()],\n          },\n        ])\n\n        break\n      }\n      case `build-html`:\n      case `develop-html`:\n        // We don't deal with CSS at all when building the HTML.\n        // The 'null' loader is used to prevent 'module not found' errors.\n        // On the other hand CSS modules loaders are necessary.\n\n        // prettier-ignore\n        configRules = configRules.concat([\n          {\n            oneOf: [\n              rules.cssModules(),\n              {\n                ...rules.css(),\n                use: [loaders.null()],\n              },\n            ],\n          },\n        ])\n        break\n\n      case `build-javascript`:\n        // We don't deal with CSS at all when building JavaScript but we still\n        // need to process the CSS so offline-plugin knows about the various\n        // assets referenced in your CSS.\n        //\n        // It's also necessary to process CSS Modules so your JS knows the\n        // classNames to use.\n        configRules = configRules.concat([\n          {\n            oneOf: [rules.cssModules(), rules.css()],\n          },\n        ])\n\n        break\n    }\n\n    return { rules: configRules }\n  }\n\n  function getResolve() {\n    const { program } = store.getState()\n    return {\n      // Use the program's extension list (generated via the\n      // 'resolvableExtensions' API hook).\n      extensions: [...program.extensions],\n      // Default to using the site's node_modules directory to look for\n      // modules. But also make it possible to install modules within the src\n      // directory if you need to install a specific version of a module for a\n      // part of your site.\n      modules: [directoryPath(path.join(`node_modules`)), `node_modules`],\n      alias: {\n        gatsby$: directoryPath(path.join(`.cache`, `gatsby-browser-entry.js`)),\n        // Using directories for module resolution is mandatory because\n        // relative path imports are used sometimes\n        // See https://stackoverflow.com/a/49455609/6420957 for more details\n        \"@babel/runtime\": path.dirname(\n          require.resolve(`@babel/runtime/package.json`)\n        ),\n        \"core-js\": path.dirname(require.resolve(`core-js/package.json`)),\n        \"react-hot-loader\": path.dirname(\n          require.resolve(`react-hot-loader/package.json`)\n        ),\n        \"react-lifecycles-compat\": directoryPath(\n          `.cache/react-lifecycles-compat.js`\n        ),\n        \"create-react-context\": directoryPath(`.cache/create-react-context.js`),\n      },\n    }\n  }\n\n  function getResolveLoader() {\n    const root = [path.resolve(directory, `node_modules`)]\n\n    const userLoaderDirectoryPath = path.resolve(directory, `loaders`)\n\n    try {\n      if (fs.statSync(userLoaderDirectoryPath).isDirectory()) {\n        root.push(userLoaderDirectoryPath)\n      }\n    } catch (err) {\n      debug(`Error resolving user loaders directory`, err)\n    }\n\n    return {\n      modules: [...root, path.join(__dirname, `../loaders`), `node_modules`],\n    }\n  }\n\n  const config = {\n    // Context is the base directory for resolving the entry option.\n    context: directory,\n    entry: getEntry(),\n    output: getOutput(),\n\n    module: getModule(),\n    plugins: getPlugins(),\n\n    // Certain \"isomorphic\" packages have different entry points for browser\n    // and server (see\n    // https://github.com/defunctzombie/package-browser-field-spec); setting\n    // the target tells webpack which file to include, ie. browser vs main.\n    target: stage === `build-html` || stage === `develop-html` ? `node` : `web`,\n\n    devtool: getDevtool(),\n    // Turn off performance hints as we (for now) don't want to show the normal\n    // webpack output anywhere.\n    performance: {\n      hints: false,\n    },\n    mode: getMode(),\n\n    resolveLoader: getResolveLoader(),\n    resolve: getResolve(),\n\n    node: {\n      __filename: true,\n    },\n  }\n\n  if (stage === `build-javascript`) {\n    config.optimization = {\n      runtimeChunk: {\n        name: `webpack-runtime`,\n      },\n      splitChunks: {\n        name: false,\n      },\n      minimizer: [\n        // TODO: maybe this option should be noMinimize?\n        !program.noUglify && plugins.minifyJs(),\n        plugins.minifyCss(),\n      ].filter(Boolean),\n    }\n  }\n\n  if (stage === `build-html` || stage === `develop-html`) {\n    const externalList = [\n      // match `lodash` and `lodash/foo`\n      // but not things like `lodash-es`\n      `lodash`,\n      /^lodash\\//,\n      `react`,\n      /^react-dom\\//,\n      `pify`,\n      `@reach/router`,\n      `@reach/router/lib/history`,\n      `common-tags`,\n      `path`,\n      `semver`,\n      `react-helmet`,\n      `minimatch`,\n      `fs`,\n      /^core-js\\//,\n      `es6-promise`,\n      `crypto`,\n      `zlib`,\n      `http`,\n      `https`,\n      `debug`,\n    ]\n\n    config.externals = [\n      function(context, request, callback) {\n        if (\n          externalList.some(item => {\n            if (typeof item === `string` && item === request) {\n              return true\n            } else if (item instanceof RegExp && item.test(request)) {\n              return true\n            }\n\n            return false\n          })\n        ) {\n          return callback(null, `umd ${request}`)\n        }\n        return callback()\n      },\n    ]\n  }\n\n  store.dispatch(actions.replaceWebpackConfig(config))\n  const getConfig = () => store.getState().webpack\n\n  await apiRunnerNode(`onCreateWebpackConfig`, {\n    getConfig,\n    stage,\n    rules,\n    loaders,\n    plugins,\n  })\n\n  return getConfig()\n}\n"],"file":"webpack.config.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/utils/webpack.config.js"],"names":["require","fs","path","dotenv","FriendlyErrorsWebpackPlugin","store","actions","debug","report","withBasePath","apiRunnerNode","createUtils","hasLocalEslint","module","exports","program","directory","suppliedStage","webpackPort","directoryPath","process","env","GATSBY_BUILD_STAGE","stage","rules","loaders","plugins","processEnv","defaultNodeEnv","NODE_ENV","envFile","join","cwd","parsed","parse","readFileSync","encoding","err","code","error","envObject","Object","keys","reduce","acc","key","JSON","stringify","gatsbyVarObject","match","PUBLIC_DIR","BUILD_STAGE","mergedEnvVars","assign","getHmrPath","hmrBasePath","hmrSuffix","GATSBY_WEBPACK_PUBLICPATH","pubPath","substr","getOutput","filename","pathinfo","publicPath","ssl","host","devtoolModuleFilenameTemplate","info","resolve","absoluteResourcePath","replace","crossOriginLoading","libraryTarget","library","umdNamedDefine","globalObject","prefixPaths","getState","config","pathPrefix","chunkFilename","Error","getEntry","commons","main","app","getPlugins","configPlugins","moment","define","__PATH_PREFIX__","concat","hotModuleReplacement","noEmitOnErrors","clearConsole","extractText","apply","compiler","hooks","done","tapAsync","stats","assets","assetsMap","chunkGroup","compilation","chunkGroups","name","files","chunk","chunks","push","filter","f","slice","length","map","webpackStats","toJson","all","assetsByChunkName","writeFile","getDevtool","getMode","getModule","configRules","mjs","js","yaml","fonts","images","media","miscAssets","schema","eslint","oneOf","cssModules","css","use","null","getResolve","extensions","modules","alias","gatsby$","dirname","getResolveLoader","root","userLoaderDirectoryPath","statSync","isDirectory","__dirname","context","entry","output","target","devtool","performance","hints","mode","resolveLoader","node","__filename","optimization","runtimeChunk","splitChunks","minimizer","noUglify","minifyJs","minifyCss","Boolean","externalList","externals","request","callback","some","item","RegExp","test","dispatch","replaceWebpackConfig","getConfig","webpack"],"mappings":"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","sourcesContent":["require(`v8-compile-cache`)\n\nconst fs = require(`fs-extra`)\nconst path = require(`path`)\nconst dotenv = require(`dotenv`)\nconst FriendlyErrorsWebpackPlugin = require(`friendly-errors-webpack-plugin`)\nconst { store } = require(`../redux`)\nconst { actions } = require(`../redux/actions`)\nconst debug = require(`debug`)(`gatsby:webpack-config`)\nconst report = require(`gatsby-cli/lib/reporter`)\nconst { withBasePath } = require(`./path`)\n\nconst apiRunnerNode = require(`./api-runner-node`)\nconst createUtils = require(`./webpack-utils`)\nconst hasLocalEslint = require(`./local-eslint-config-finder`)\n\n// Four stages or modes:\n//   1) develop: for `gatsby develop` command, hot reload and CSS injection into page\n//   2) develop-html: same as develop without react-hmre in the babel config for html renderer\n//   3) build-javascript: Build JS and CSS chunks for production\n//   4) build-html: build all HTML files\n\nmodule.exports = async (\n  program,\n  directory,\n  suppliedStage,\n  webpackPort = 1500\n) => {\n  const directoryPath = withBasePath(directory)\n\n  process.env.GATSBY_BUILD_STAGE = suppliedStage\n\n  // We combine develop & develop-html stages for purposes of generating the\n  // webpack config.\n  const stage = suppliedStage\n  const { rules, loaders, plugins } = await createUtils({ stage, program })\n\n  function processEnv(stage, defaultNodeEnv) {\n    debug(`Building env for \"${stage}\"`)\n    const env = process.env.NODE_ENV\n      ? process.env.NODE_ENV\n      : `${defaultNodeEnv}`\n    const envFile = path.join(process.cwd(), `./.env.${env}`)\n    let parsed = {}\n    try {\n      parsed = dotenv.parse(fs.readFileSync(envFile, { encoding: `utf8` }))\n    } catch (err) {\n      if (err.code !== `ENOENT`) {\n        report.error(`There was a problem processing the .env file`, err)\n      }\n    }\n\n    const envObject = Object.keys(parsed).reduce((acc, key) => {\n      acc[key] = JSON.stringify(parsed[key])\n      return acc\n    }, {})\n\n    const gatsbyVarObject = Object.keys(process.env).reduce((acc, key) => {\n      if (key.match(/^GATSBY_/)) {\n        acc[key] = JSON.stringify(process.env[key])\n      }\n      return acc\n    }, {})\n\n    // Don't allow overwriting of NODE_ENV, PUBLIC_DIR as to not break gatsby things\n    envObject.NODE_ENV = JSON.stringify(env)\n    envObject.PUBLIC_DIR = JSON.stringify(`${process.cwd()}/public`)\n    envObject.BUILD_STAGE = JSON.stringify(stage)\n\n    const mergedEnvVars = Object.assign(envObject, gatsbyVarObject)\n\n    return Object.keys(mergedEnvVars).reduce(\n      (acc, key) => {\n        acc[`process.env.${key}`] = mergedEnvVars[key]\n        return acc\n      },\n      {\n        \"process.env\": JSON.stringify({}),\n      }\n    )\n  }\n\n  function getHmrPath() {\n    // ref: https://github.com/gatsbyjs/gatsby/issues/8348\n    let hmrBasePath = `/`\n    const hmrSuffix = `__webpack_hmr&reload=true&overlay=false`\n\n    if (process.env.GATSBY_WEBPACK_PUBLICPATH) {\n      const pubPath = process.env.GATSBY_WEBPACK_PUBLICPATH\n      if (pubPath.substr(-1) === `/`) {\n        hmrBasePath = pubPath\n      } else {\n        hmrBasePath = `${pubPath}/`\n      }\n    }\n\n    return hmrBasePath + hmrSuffix\n  }\n\n  debug(`Loading webpack config for stage \"${stage}\"`)\n  function getOutput() {\n    switch (stage) {\n      case `develop`:\n        return {\n          path: directory,\n          filename: `[name].js`,\n          // Add /* filename */ comments to generated require()s in the output.\n          pathinfo: true,\n          // Point sourcemap entries to original disk location (format as URL on Windows)\n          publicPath:\n            process.env.GATSBY_WEBPACK_PUBLICPATH ||\n            `${program.ssl ? `https` : `http`}://${\n              program.host\n            }:${webpackPort}/`,\n          devtoolModuleFilenameTemplate: info =>\n            path.resolve(info.absoluteResourcePath).replace(/\\\\/g, `/`),\n          // Avoid React cross-origin errors\n          // See https://reactjs.org/docs/cross-origin-errors.html\n          crossOriginLoading: `anonymous`,\n        }\n      case `build-html`:\n      case `develop-html`:\n        // A temp file required by static-site-generator-plugin. See plugins() below.\n        // Deleted by build-html.js, since it's not needed for production.\n        return {\n          path: directoryPath(`public`),\n          filename: `render-page.js`,\n          libraryTarget: `umd`,\n          library: `lib`,\n          umdNamedDefine: true,\n          globalObject: `this`,\n          publicPath: program.prefixPaths\n            ? `${store.getState().config.pathPrefix}/`\n            : `/`,\n        }\n      case `build-javascript`:\n        return {\n          filename: `[name]-[contenthash].js`,\n          chunkFilename: `[name]-[contenthash].js`,\n          path: directoryPath(`public`),\n          publicPath: program.prefixPaths\n            ? `${store.getState().config.pathPrefix}/`\n            : `/`,\n        }\n      default:\n        throw new Error(`The state requested ${stage} doesn't exist.`)\n    }\n  }\n\n  function getEntry() {\n    switch (stage) {\n      case `develop`:\n        return {\n          commons: [\n            `${require.resolve(\n              `webpack-hot-middleware/client`\n            )}?path=${getHmrPath()}`,\n            directoryPath(`.cache/app`),\n          ],\n        }\n      case `develop-html`:\n        return {\n          main: directoryPath(`.cache/develop-static-entry`),\n        }\n      case `build-html`:\n        return {\n          main: directoryPath(`.cache/static-entry`),\n        }\n      case `build-javascript`:\n        return {\n          app: directoryPath(`.cache/production-app`),\n        }\n      default:\n        throw new Error(`The state requested ${stage} doesn't exist.`)\n    }\n  }\n\n  function getPlugins() {\n    let configPlugins = [\n      plugins.moment(),\n\n      // Add a few global variables. Set NODE_ENV to production (enables\n      // optimizations for React) and what the link prefix is (__PATH_PREFIX__).\n      plugins.define({\n        ...processEnv(stage, `development`),\n        __PATH_PREFIX__: JSON.stringify(\n          program.prefixPaths ? store.getState().config.pathPrefix : ``\n        ),\n      }),\n    ]\n\n    switch (stage) {\n      case `develop`:\n        configPlugins = configPlugins.concat([\n          plugins.hotModuleReplacement(),\n          plugins.noEmitOnErrors(),\n\n          new FriendlyErrorsWebpackPlugin({\n            clearConsole: false,\n          }),\n        ])\n        break\n      case `build-javascript`: {\n        configPlugins = configPlugins.concat([\n          plugins.extractText(),\n          // Write out stats object mapping named dynamic imports (aka page\n          // components) to all their async chunks.\n          {\n            apply: function(compiler) {\n              compiler.hooks.done.tapAsync(\n                `gatsby-webpack-stats-extractor`,\n                (stats, done) => {\n                  let assets = {}\n                  let assetsMap = {}\n                  for (let chunkGroup of stats.compilation.chunkGroups) {\n                    if (chunkGroup.name) {\n                      let files = []\n                      for (let chunk of chunkGroup.chunks) {\n                        files.push(...chunk.files)\n                      }\n                      assets[chunkGroup.name] = files.filter(\n                        f => f.slice(-4) !== `.map`\n                      )\n                      assetsMap[chunkGroup.name] = files\n                        .filter(\n                          f =>\n                            f.slice(-4) !== `.map` &&\n                            f.slice(0, chunkGroup.name.length) ===\n                              chunkGroup.name\n                        )\n                        .map(filename => `/${filename}`)\n                    }\n                  }\n\n                  const webpackStats = {\n                    ...stats.toJson({ all: false, chunkGroups: true }),\n                    assetsByChunkName: assets,\n                  }\n\n                  fs.writeFile(\n                    path.join(`public`, `chunk-map.json`),\n                    JSON.stringify(assetsMap),\n                    () => {\n                      fs.writeFile(\n                        path.join(`public`, `webpack.stats.json`),\n                        JSON.stringify(webpackStats),\n                        done\n                      )\n                    }\n                  )\n                }\n              )\n            },\n          },\n        ])\n        break\n      }\n    }\n\n    return configPlugins\n  }\n\n  function getDevtool() {\n    switch (stage) {\n      case `develop`:\n        return `cheap-module-source-map`\n      // use a normal `source-map` for the html phases since\n      // it gives better line and column numbers\n      case `develop-html`:\n      case `build-html`:\n      case `build-javascript`:\n        return `source-map`\n      default:\n        return false\n    }\n  }\n\n  function getMode() {\n    switch (stage) {\n      case `build-javascript`:\n        return `production`\n      case `develop`:\n      case `develop-html`:\n      case `build-html`:\n        return `development` // So we don't uglify the html bundle\n      default:\n        return `production`\n    }\n  }\n\n  function getModule(config) {\n    // Common config for every env.\n    // prettier-ignore\n    let configRules = [\n      rules.mjs(),\n      rules.js(),\n      rules.yaml(),\n      rules.fonts(),\n      rules.images(),\n      rules.media(),\n      rules.miscAssets(),\n    ]\n    switch (stage) {\n      case `develop`: {\n        // get schema to pass to eslint config and program for directory\n        const { schema, program } = store.getState()\n\n        // if no local eslint config, then add gatsby config\n        if (!hasLocalEslint(program.directory)) {\n          configRules = configRules.concat([rules.eslint(schema)])\n        }\n\n        configRules = configRules.concat([\n          {\n            oneOf: [rules.cssModules(), rules.css()],\n          },\n        ])\n\n        break\n      }\n      case `build-html`:\n      case `develop-html`:\n        // We don't deal with CSS at all when building the HTML.\n        // The 'null' loader is used to prevent 'module not found' errors.\n        // On the other hand CSS modules loaders are necessary.\n\n        // prettier-ignore\n        configRules = configRules.concat([\n          {\n            oneOf: [\n              rules.cssModules(),\n              {\n                ...rules.css(),\n                use: [loaders.null()],\n              },\n            ],\n          },\n        ])\n        break\n\n      case `build-javascript`:\n        // We don't deal with CSS at all when building JavaScript but we still\n        // need to process the CSS so offline-plugin knows about the various\n        // assets referenced in your CSS.\n        //\n        // It's also necessary to process CSS Modules so your JS knows the\n        // classNames to use.\n        configRules = configRules.concat([\n          {\n            oneOf: [rules.cssModules(), rules.css()],\n          },\n        ])\n\n        break\n    }\n\n    return { rules: configRules }\n  }\n\n  function getResolve() {\n    const { program } = store.getState()\n    return {\n      // Use the program's extension list (generated via the\n      // 'resolvableExtensions' API hook).\n      extensions: [...program.extensions],\n      // Default to using the site's node_modules directory to look for\n      // modules. But also make it possible to install modules within the src\n      // directory if you need to install a specific version of a module for a\n      // part of your site.\n      modules: [directoryPath(path.join(`node_modules`)), `node_modules`],\n      alias: {\n        gatsby$: directoryPath(path.join(`.cache`, `gatsby-browser-entry.js`)),\n        // Using directories for module resolution is mandatory because\n        // relative path imports are used sometimes\n        // See https://stackoverflow.com/a/49455609/6420957 for more details\n        \"@babel/runtime\": path.dirname(\n          require.resolve(`@babel/runtime/package.json`)\n        ),\n        \"core-js\": path.dirname(require.resolve(`core-js/package.json`)),\n        \"react-hot-loader\": path.dirname(\n          require.resolve(`react-hot-loader/package.json`)\n        ),\n        \"react-lifecycles-compat\": directoryPath(\n          `.cache/react-lifecycles-compat.js`\n        ),\n        \"create-react-context\": directoryPath(`.cache/create-react-context.js`),\n      },\n    }\n  }\n\n  function getResolveLoader() {\n    const root = [path.resolve(directory, `node_modules`)]\n\n    const userLoaderDirectoryPath = path.resolve(directory, `loaders`)\n\n    try {\n      if (fs.statSync(userLoaderDirectoryPath).isDirectory()) {\n        root.push(userLoaderDirectoryPath)\n      }\n    } catch (err) {\n      debug(`Error resolving user loaders directory`, err)\n    }\n\n    return {\n      modules: [...root, path.join(__dirname, `../loaders`), `node_modules`],\n    }\n  }\n\n  const config = {\n    // Context is the base directory for resolving the entry option.\n    context: directory,\n    entry: getEntry(),\n    output: getOutput(),\n\n    module: getModule(),\n    plugins: getPlugins(),\n\n    // Certain \"isomorphic\" packages have different entry points for browser\n    // and server (see\n    // https://github.com/defunctzombie/package-browser-field-spec); setting\n    // the target tells webpack which file to include, ie. browser vs main.\n    target: stage === `build-html` || stage === `develop-html` ? `node` : `web`,\n\n    devtool: getDevtool(),\n    // Turn off performance hints as we (for now) don't want to show the normal\n    // webpack output anywhere.\n    performance: {\n      hints: false,\n    },\n    mode: getMode(),\n\n    resolveLoader: getResolveLoader(),\n    resolve: getResolve(),\n\n    node: {\n      __filename: true,\n    },\n  }\n\n  if (stage === `build-javascript`) {\n    config.optimization = {\n      runtimeChunk: {\n        name: `webpack-runtime`,\n      },\n      splitChunks: {\n        name: false,\n      },\n      minimizer: [\n        // TODO: maybe this option should be noMinimize?\n        !program.noUglify && plugins.minifyJs(),\n        plugins.minifyCss(),\n      ].filter(Boolean),\n    }\n  }\n\n  if (stage === `build-html` || stage === `develop-html`) {\n    const externalList = [\n      // match `lodash` and `lodash/foo`\n      // but not things like `lodash-es`\n      `lodash`,\n      /^lodash\\//,\n      `react`,\n      /^react-dom\\//,\n      `pify`,\n      `@reach/router`,\n      `@reach/router/lib/history`,\n      `common-tags`,\n      `path`,\n      `semver`,\n      `react-helmet`,\n      `minimatch`,\n      `fs`,\n      /^core-js\\//,\n      `es6-promise`,\n      `crypto`,\n      `zlib`,\n      `http`,\n      `https`,\n      `debug`,\n    ]\n\n    config.externals = [\n      function(context, request, callback) {\n        if (\n          externalList.some(item => {\n            if (typeof item === `string` && item === request) {\n              return true\n            } else if (item instanceof RegExp && item.test(request)) {\n              return true\n            }\n\n            return false\n          })\n        ) {\n          return callback(null, `umd ${request}`)\n        }\n        return callback()\n      },\n    ]\n  }\n\n  store.dispatch(actions.replaceWebpackConfig(config))\n  const getConfig = () => store.getState().webpack\n\n  await apiRunnerNode(`onCreateWebpackConfig`, {\n    getConfig,\n    stage,\n    rules,\n    loaders,\n    plugins,\n  })\n\n  return getConfig()\n}\n"],"file":"webpack.config.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/utils/websocket-manager.js
+++ b/node_modules/gatsby/dist/utils/websocket-manager.js
@@ -6,8 +6,9 @@ var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/de
 
 const path = require(`path`);
 
-const _require = require(`../redux`),
-      store = _require.store;
+const {
+  store
+} = require(`../redux`);
 
 const fs = require(`fs`);
 
@@ -28,10 +29,10 @@ const readCachedResults = (dataFileName, directory) => {
 
 
 const getCachedPageData = (pagePath, directory) => {
-  const _store$getState = store.getState(),
-        jsonDataPaths = _store$getState.jsonDataPaths,
-        pages = _store$getState.pages;
-
+  const {
+    jsonDataPaths,
+    pages
+  } = store.getState();
   const page = pages.get(pagePath);
 
   if (!page) {
@@ -59,11 +60,10 @@ const getCachedPageData = (pagePath, directory) => {
 
 const getCachedStaticQueryResults = (resultsMap, directory) => {
   const cachedStaticQueryResults = new Map();
-
-  const _store$getState2 = store.getState(),
-        staticQueryComponents = _store$getState2.staticQueryComponents,
-        jsonDataPaths = _store$getState2.jsonDataPaths;
-
+  const {
+    staticQueryComponents,
+    jsonDataPaths
+  } = store.getState();
   staticQueryComponents.forEach(staticQueryComponent => {
     // Don't read from file if results were already passed from query runner
     if (resultsMap.has(staticQueryComponent.hash)) return;
--- a/node_modules/gatsby/dist/utils/websocket-manager.js.map
+++ b/node_modules/gatsby/dist/utils/websocket-manager.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/utils/websocket-manager.js"],"names":["path","require","store","fs","readCachedResults","dataFileName","directory","filePath","join","JSON","parse","readFileSync","getCachedPageData","pagePath","getState","jsonDataPaths","pages","page","get","dataPath","jsonName","console","log","undefined","result","id","getCachedStaticQueryResults","resultsMap","cachedStaticQueryResults","Map","staticQueryComponents","forEach","staticQueryComponent","has","hash","componentPath","set","getRoomNameFromPath","WebsocketManager","constructor","isInitialised","activePaths","Set","pageResults","staticQueryResults","errors","websocket","programDir","init","bind","getSocket","emitPageData","emitStaticQueryData","emitError","server","on","s","activePath","send","type","payload","message","errorID","leaveRoom","leave","leftRoom","sockets","adapter","rooms","length","delete","getDataForPath","why","add","data","manager","module","exports"],"mappings":"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","sourcesContent":["// @flow\n\nconst path = require(`path`)\nconst { store } = require(`../redux`)\nconst fs = require(`fs`)\n\ntype QueryResult = {\n  id: string,\n  result: object,\n}\n\ntype QueryResultsMap = Map<string, QueryResult>\n\n/**\n * Get cached query result for given data path.\n * @param {string} dataFileName Cached query result filename.\n * @param {string} directory Root directory of current project.\n */\nconst readCachedResults = (dataFileName: string, directory: string): object => {\n  const filePath = path.join(\n    directory,\n    `public`,\n    `static`,\n    `d`,\n    `${dataFileName}.json`\n  )\n  return JSON.parse(fs.readFileSync(filePath, `utf-8`))\n}\n\n/**\n * Get cached page query result for given page path.\n * @param {string} pagePath Path to a page.\n * @param {string} directory Root directory of current project.\n */\nconst getCachedPageData = (\n  pagePath: string,\n  directory: string\n): QueryResult => {\n  const { jsonDataPaths, pages } = store.getState()\n  const page = pages.get(pagePath)\n  if (!page) {\n    return null\n  }\n  const dataPath = jsonDataPaths[page.jsonName]\n  if (typeof dataPath === `undefined`) {\n    console.log(\n      `Error loading a result for the page query in \"${pagePath}\". Query was not run and no cached result was found.`\n    )\n    return undefined\n  }\n\n  return {\n    result: readCachedResults(dataPath, directory),\n    id: pagePath,\n  }\n}\n\n/**\n * Get cached StaticQuery results for components that Gatsby didn't run query yet.\n * @param {QueryResultsMap} resultsMap Already stored results for queries that don't need to be read from files.\n * @param {string} directory Root directory of current project.\n */\nconst getCachedStaticQueryResults = (\n  resultsMap: QueryResultsMap,\n  directory: string\n): QueryResultsMap => {\n  const cachedStaticQueryResults = new Map()\n  const { staticQueryComponents, jsonDataPaths } = store.getState()\n  staticQueryComponents.forEach(staticQueryComponent => {\n    // Don't read from file if results were already passed from query runner\n    if (resultsMap.has(staticQueryComponent.hash)) return\n\n    const dataPath = jsonDataPaths[staticQueryComponent.jsonName]\n    if (typeof dataPath === `undefined`) {\n      console.log(\n        `Error loading a result for the StaticQuery in \"${\n          staticQueryComponent.componentPath\n        }\". Query was not run and no cached result was found.`\n      )\n      return\n    }\n    cachedStaticQueryResults.set(staticQueryComponent.hash, {\n      result: readCachedResults(dataPath, directory),\n      id: staticQueryComponent.hash,\n    })\n  })\n  return cachedStaticQueryResults\n}\n\nconst getRoomNameFromPath = (path: string): string => `path-${path}`\n\nclass WebsocketManager {\n  pageResults: QueryResultsMap\n  staticQueryResults: QueryResultsMap\n  errors: Map<string, QueryResult>\n  isInitialised: boolean\n  activePaths: Set<string>\n  programDir: string\n\n  constructor() {\n    this.isInitialised = false\n    this.activePaths = new Set()\n    this.pageResults = new Map()\n    this.staticQueryResults = new Map()\n    this.errors = new Map()\n    this.websocket\n    this.programDir\n\n    this.init = this.init.bind(this)\n    this.getSocket = this.getSocket.bind(this)\n    this.emitPageData = this.emitPageData.bind(this)\n    this.emitStaticQueryData = this.emitStaticQueryData.bind(this)\n    this.emitError = this.emitError.bind(this)\n  }\n\n  init({ server, directory }) {\n    this.programDir = directory\n\n    const cachedStaticQueryResults = getCachedStaticQueryResults(\n      this.staticQueryResults,\n      this.programDir\n    )\n    this.staticQueryResults = new Map([\n      ...this.staticQueryResults,\n      ...cachedStaticQueryResults,\n    ])\n\n    this.websocket = require(`socket.io`)(server)\n\n    this.websocket.on(`connection`, s => {\n      let activePath = null\n      // Send already existing static query results\n      this.staticQueryResults.forEach(result => {\n        this.websocket.send({\n          type: `staticQueryResult`,\n          payload: result,\n        })\n      })\n      this.errors.forEach((message, errorID) => {\n        this.websocket.send({\n          type: `overlayError`,\n          payload: {\n            id: errorID,\n            message,\n          },\n        })\n      })\n\n      const leaveRoom = path => {\n        s.leave(getRoomNameFromPath(path))\n        const leftRoom = this.websocket.sockets.adapter.rooms[\n          getRoomNameFromPath(path)\n        ]\n        if (!leftRoom || leftRoom.length === 0) {\n          this.activePaths.delete(path)\n        }\n      }\n\n      const getDataForPath = path => {\n        if (!this.pageResults.has(path)) {\n          const result = getCachedPageData(path, this.programDir)\n          if (result) {\n            this.pageResults.set(path, result)\n          } else {\n            console.log(`Page not found`, path)\n            return\n          }\n        }\n\n        this.websocket.send({\n          type: `pageQueryResult`,\n          why: `getDataForPath`,\n          payload: this.pageResults.get(path),\n        })\n      }\n\n      s.on(`getDataForPath`, getDataForPath)\n\n      s.on(`registerPath`, path => {\n        s.join(getRoomNameFromPath(path))\n        activePath = path\n        this.activePaths.add(path)\n      })\n\n      s.on(`disconnect`, s => {\n        leaveRoom(activePath)\n      })\n\n      s.on(`unregisterPath`, path => {\n        leaveRoom(path)\n      })\n    })\n\n    this.isInitialised = true\n  }\n\n  getSocket() {\n    return this.isInitialised && this.websocket\n  }\n\n  emitStaticQueryData(data: QueryResult) {\n    this.staticQueryResults.set(data.id, data)\n    if (this.isInitialised) {\n      this.websocket.send({ type: `staticQueryResult`, payload: data })\n    }\n  }\n\n  emitPageData(data: QueryResult) {\n    this.pageResults.set(data.id, data)\n    if (this.isInitialised) {\n      this.websocket.send({ type: `pageQueryResult`, payload: data })\n    }\n  }\n  emitError(id: string, message?: string) {\n    if (message) {\n      this.errors.set(id, message)\n    } else {\n      this.errors.delete(id)\n    }\n\n    if (this.isInitialised) {\n      this.websocket.send({ type: `overlayError`, payload: { id, message } })\n    }\n  }\n}\n\nconst manager = new WebsocketManager()\n\nmodule.exports = manager\n"],"file":"websocket-manager.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/utils/websocket-manager.js"],"names":["path","require","store","fs","readCachedResults","dataFileName","directory","filePath","join","JSON","parse","readFileSync","getCachedPageData","pagePath","jsonDataPaths","pages","getState","page","get","dataPath","jsonName","console","log","undefined","result","id","getCachedStaticQueryResults","resultsMap","cachedStaticQueryResults","Map","staticQueryComponents","forEach","staticQueryComponent","has","hash","componentPath","set","getRoomNameFromPath","WebsocketManager","constructor","isInitialised","activePaths","Set","pageResults","staticQueryResults","errors","websocket","programDir","init","bind","getSocket","emitPageData","emitStaticQueryData","emitError","server","on","s","activePath","send","type","payload","message","errorID","leaveRoom","leave","leftRoom","sockets","adapter","rooms","length","delete","getDataForPath","why","add","data","manager","module","exports"],"mappings":";;;;;;AAEA,MAAMA,IAAI,GAAGC,OAAO,CAAE,MAAF,CAApB;;AACA,MAAM;AAAEC,EAAAA;AAAF,IAAYD,OAAO,CAAE,UAAF,CAAzB;;AACA,MAAME,EAAE,GAAGF,OAAO,CAAE,IAAF,CAAlB;;AASA;;;;;AAKA,MAAMG,iBAAiB,GAAG,CAACC,YAAD,EAAuBC,SAAvB,KAAqD;AAC7E,QAAMC,QAAQ,GAAGP,IAAI,CAACQ,IAAL,CACfF,SADe,EAEd,QAFc,EAGd,QAHc,EAId,GAJc,EAKd,GAAED,YAAa,OALD,CAAjB;AAOA,SAAOI,IAAI,CAACC,KAAL,CAAWP,EAAE,CAACQ,YAAH,CAAgBJ,QAAhB,EAA2B,OAA3B,CAAX,CAAP;AACD,CATD;AAWA;;;;;;;AAKA,MAAMK,iBAAiB,GAAG,CACxBC,QADwB,EAExBP,SAFwB,KAGR;AAChB,QAAM;AAAEQ,IAAAA,aAAF;AAAiBC,IAAAA;AAAjB,MAA2Bb,KAAK,CAACc,QAAN,EAAjC;AACA,QAAMC,IAAI,GAAGF,KAAK,CAACG,GAAN,CAAUL,QAAV,CAAb;;AACA,MAAI,CAACI,IAAL,EAAW;AACT,WAAO,IAAP;AACD;;AACD,QAAME,QAAQ,GAAGL,aAAa,CAACG,IAAI,CAACG,QAAN,CAA9B;;AACA,MAAI,OAAOD,QAAP,KAAqB,WAAzB,EAAqC;AACnCE,IAAAA,OAAO,CAACC,GAAR,CACG,iDAAgDT,QAAS,sDAD5D;AAGA,WAAOU,SAAP;AACD;;AAED,SAAO;AACLC,IAAAA,MAAM,EAAEpB,iBAAiB,CAACe,QAAD,EAAWb,SAAX,CADpB;AAELmB,IAAAA,EAAE,EAAEZ;AAFC,GAAP;AAID,CArBD;AAuBA;;;;;;;AAKA,MAAMa,2BAA2B,GAAG,CAClCC,UADkC,EAElCrB,SAFkC,KAGd;AACpB,QAAMsB,wBAAwB,GAAG,IAAIC,GAAJ,EAAjC;AACA,QAAM;AAAEC,IAAAA,qBAAF;AAAyBhB,IAAAA;AAAzB,MAA2CZ,KAAK,CAACc,QAAN,EAAjD;AACAc,EAAAA,qBAAqB,CAACC,OAAtB,CAA8BC,oBAAoB,IAAI;AACpD;AACA,QAAIL,UAAU,CAACM,GAAX,CAAeD,oBAAoB,CAACE,IAApC,CAAJ,EAA+C;AAE/C,UAAMf,QAAQ,GAAGL,aAAa,CAACkB,oBAAoB,CAACZ,QAAtB,CAA9B;;AACA,QAAI,OAAOD,QAAP,KAAqB,WAAzB,EAAqC;AACnCE,MAAAA,OAAO,CAACC,GAAR,CACG,kDACCU,oBAAoB,CAACG,aACtB,sDAHH;AAKA;AACD;;AACDP,IAAAA,wBAAwB,CAACQ,GAAzB,CAA6BJ,oBAAoB,CAACE,IAAlD,EAAwD;AACtDV,MAAAA,MAAM,EAAEpB,iBAAiB,CAACe,QAAD,EAAWb,SAAX,CAD6B;AAEtDmB,MAAAA,EAAE,EAAEO,oBAAoB,CAACE;AAF6B,KAAxD;AAID,GAjBD;AAkBA,SAAON,wBAAP;AACD,CAzBD;;AA2BA,MAAMS,mBAAmB,GAAIrC,IAAD,IAA2B,QAAOA,IAAK,EAAnE;;AAEA,MAAMsC,gBAAN,CAAuB;AAQrBC,EAAAA,WAAW,GAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACZ,SAAKC,aAAL,GAAqB,KAArB;AACA,SAAKC,WAAL,GAAmB,IAAIC,GAAJ,EAAnB;AACA,SAAKC,WAAL,GAAmB,IAAId,GAAJ,EAAnB;AACA,SAAKe,kBAAL,GAA0B,IAAIf,GAAJ,EAA1B;AACA,SAAKgB,MAAL,GAAc,IAAIhB,GAAJ,EAAd;AACA,SAAKiB,SAAL;AACA,SAAKC,UAAL;AAEA,SAAKC,IAAL,GAAY,KAAKA,IAAL,CAAUC,IAAV,CAAe,IAAf,CAAZ;AACA,SAAKC,SAAL,GAAiB,KAAKA,SAAL,CAAeD,IAAf,CAAoB,IAApB,CAAjB;AACA,SAAKE,YAAL,GAAoB,KAAKA,YAAL,CAAkBF,IAAlB,CAAuB,IAAvB,CAApB;AACA,SAAKG,mBAAL,GAA2B,KAAKA,mBAAL,CAAyBH,IAAzB,CAA8B,IAA9B,CAA3B;AACA,SAAKI,SAAL,GAAiB,KAAKA,SAAL,CAAeJ,IAAf,CAAoB,IAApB,CAAjB;AACD;;AAEDD,EAAAA,IAAI,CAAC;AAAEM,IAAAA,MAAF;AAAUhD,IAAAA;AAAV,GAAD,EAAwB;AAC1B,SAAKyC,UAAL,GAAkBzC,SAAlB;AAEA,UAAMsB,wBAAwB,GAAGF,2BAA2B,CAC1D,KAAKkB,kBADqD,EAE1D,KAAKG,UAFqD,CAA5D;AAIA,SAAKH,kBAAL,GAA0B,IAAIf,GAAJ,CAAQ,CAChC,GAAG,KAAKe,kBADwB,EAEhC,GAAGhB,wBAF6B,CAAR,CAA1B;AAKA,SAAKkB,SAAL,GAAiB7C,OAAO,CAAE,WAAF,CAAP,CAAqBqD,MAArB,CAAjB;AAEA,SAAKR,SAAL,CAAeS,EAAf,CAAmB,YAAnB,EAAgCC,CAAC,IAAI;AACnC,UAAIC,UAAU,GAAG,IAAjB,CADmC,CAEnC;;AACA,WAAKb,kBAAL,CAAwBb,OAAxB,CAAgCP,MAAM,IAAI;AACxC,aAAKsB,SAAL,CAAeY,IAAf,CAAoB;AAClBC,UAAAA,IAAI,EAAG,mBADW;AAElBC,UAAAA,OAAO,EAAEpC;AAFS,SAApB;AAID,OALD;AAMA,WAAKqB,MAAL,CAAYd,OAAZ,CAAoB,CAAC8B,OAAD,EAAUC,OAAV,KAAsB;AACxC,aAAKhB,SAAL,CAAeY,IAAf,CAAoB;AAClBC,UAAAA,IAAI,EAAG,cADW;AAElBC,UAAAA,OAAO,EAAE;AACPnC,YAAAA,EAAE,EAAEqC,OADG;AAEPD,YAAAA;AAFO;AAFS,SAApB;AAOD,OARD;;AAUA,YAAME,SAAS,GAAG/D,IAAI,IAAI;AACxBwD,QAAAA,CAAC,CAACQ,KAAF,CAAQ3B,mBAAmB,CAACrC,IAAD,CAA3B;AACA,cAAMiE,QAAQ,GAAG,KAAKnB,SAAL,CAAeoB,OAAf,CAAuBC,OAAvB,CAA+BC,KAA/B,CACf/B,mBAAmB,CAACrC,IAAD,CADJ,CAAjB;;AAGA,YAAI,CAACiE,QAAD,IAAaA,QAAQ,CAACI,MAAT,KAAoB,CAArC,EAAwC;AACtC,eAAK5B,WAAL,CAAiB6B,MAAjB,CAAwBtE,IAAxB;AACD;AACF,OARD;;AAUA,YAAMuE,cAAc,GAAGvE,IAAI,IAAI;AAC7B,YAAI,CAAC,KAAK2C,WAAL,CAAiBV,GAAjB,CAAqBjC,IAArB,CAAL,EAAiC;AAC/B,gBAAMwB,MAAM,GAAGZ,iBAAiB,CAACZ,IAAD,EAAO,KAAK+C,UAAZ,CAAhC;;AACA,cAAIvB,MAAJ,EAAY;AACV,iBAAKmB,WAAL,CAAiBP,GAAjB,CAAqBpC,IAArB,EAA2BwB,MAA3B;AACD,WAFD,MAEO;AACLH,YAAAA,OAAO,CAACC,GAAR,CAAa,gBAAb,EAA8BtB,IAA9B;AACA;AACD;AACF;;AAED,aAAK8C,SAAL,CAAeY,IAAf,CAAoB;AAClBC,UAAAA,IAAI,EAAG,iBADW;AAElBa,UAAAA,GAAG,EAAG,gBAFY;AAGlBZ,UAAAA,OAAO,EAAE,KAAKjB,WAAL,CAAiBzB,GAAjB,CAAqBlB,IAArB;AAHS,SAApB;AAKD,OAhBD;;AAkBAwD,MAAAA,CAAC,CAACD,EAAF,CAAM,gBAAN,EAAuBgB,cAAvB;AAEAf,MAAAA,CAAC,CAACD,EAAF,CAAM,cAAN,EAAqBvD,IAAI,IAAI;AAC3BwD,QAAAA,CAAC,CAAChD,IAAF,CAAO6B,mBAAmB,CAACrC,IAAD,CAA1B;AACAyD,QAAAA,UAAU,GAAGzD,IAAb;AACA,aAAKyC,WAAL,CAAiBgC,GAAjB,CAAqBzE,IAArB;AACD,OAJD;AAMAwD,MAAAA,CAAC,CAACD,EAAF,CAAM,YAAN,EAAmBC,CAAC,IAAI;AACtBO,QAAAA,SAAS,CAACN,UAAD,CAAT;AACD,OAFD;AAIAD,MAAAA,CAAC,CAACD,EAAF,CAAM,gBAAN,EAAuBvD,IAAI,IAAI;AAC7B+D,QAAAA,SAAS,CAAC/D,IAAD,CAAT;AACD,OAFD;AAGD,KA9DD;AAgEA,SAAKwC,aAAL,GAAqB,IAArB;AACD;;AAEDU,EAAAA,SAAS,GAAG;AACV,WAAO,KAAKV,aAAL,IAAsB,KAAKM,SAAlC;AACD;;AAEDM,EAAAA,mBAAmB,CAACsB,IAAD,EAAoB;AACrC,SAAK9B,kBAAL,CAAwBR,GAAxB,CAA4BsC,IAAI,CAACjD,EAAjC,EAAqCiD,IAArC;;AACA,QAAI,KAAKlC,aAAT,EAAwB;AACtB,WAAKM,SAAL,CAAeY,IAAf,CAAoB;AAAEC,QAAAA,IAAI,EAAG,mBAAT;AAA6BC,QAAAA,OAAO,EAAEc;AAAtC,OAApB;AACD;AACF;;AAEDvB,EAAAA,YAAY,CAACuB,IAAD,EAAoB;AAC9B,SAAK/B,WAAL,CAAiBP,GAAjB,CAAqBsC,IAAI,CAACjD,EAA1B,EAA8BiD,IAA9B;;AACA,QAAI,KAAKlC,aAAT,EAAwB;AACtB,WAAKM,SAAL,CAAeY,IAAf,CAAoB;AAAEC,QAAAA,IAAI,EAAG,iBAAT;AAA2BC,QAAAA,OAAO,EAAEc;AAApC,OAApB;AACD;AACF;;AACDrB,EAAAA,SAAS,CAAC5B,EAAD,EAAaoC,OAAb,EAA+B;AACtC,QAAIA,OAAJ,EAAa;AACX,WAAKhB,MAAL,CAAYT,GAAZ,CAAgBX,EAAhB,EAAoBoC,OAApB;AACD,KAFD,MAEO;AACL,WAAKhB,MAAL,CAAYyB,MAAZ,CAAmB7C,EAAnB;AACD;;AAED,QAAI,KAAKe,aAAT,EAAwB;AACtB,WAAKM,SAAL,CAAeY,IAAf,CAAoB;AAAEC,QAAAA,IAAI,EAAG,cAAT;AAAwBC,QAAAA,OAAO,EAAE;AAAEnC,UAAAA,EAAF;AAAMoC,UAAAA;AAAN;AAAjC,OAApB;AACD;AACF;;AApIoB;;AAuIvB,MAAMc,OAAO,GAAG,IAAIrC,gBAAJ,EAAhB;AAEAsC,MAAM,CAACC,OAAP,GAAiBF,OAAjB","sourcesContent":["// @flow\n\nconst path = require(`path`)\nconst { store } = require(`../redux`)\nconst fs = require(`fs`)\n\ntype QueryResult = {\n  id: string,\n  result: object,\n}\n\ntype QueryResultsMap = Map<string, QueryResult>\n\n/**\n * Get cached query result for given data path.\n * @param {string} dataFileName Cached query result filename.\n * @param {string} directory Root directory of current project.\n */\nconst readCachedResults = (dataFileName: string, directory: string): object => {\n  const filePath = path.join(\n    directory,\n    `public`,\n    `static`,\n    `d`,\n    `${dataFileName}.json`\n  )\n  return JSON.parse(fs.readFileSync(filePath, `utf-8`))\n}\n\n/**\n * Get cached page query result for given page path.\n * @param {string} pagePath Path to a page.\n * @param {string} directory Root directory of current project.\n */\nconst getCachedPageData = (\n  pagePath: string,\n  directory: string\n): QueryResult => {\n  const { jsonDataPaths, pages } = store.getState()\n  const page = pages.get(pagePath)\n  if (!page) {\n    return null\n  }\n  const dataPath = jsonDataPaths[page.jsonName]\n  if (typeof dataPath === `undefined`) {\n    console.log(\n      `Error loading a result for the page query in \"${pagePath}\". Query was not run and no cached result was found.`\n    )\n    return undefined\n  }\n\n  return {\n    result: readCachedResults(dataPath, directory),\n    id: pagePath,\n  }\n}\n\n/**\n * Get cached StaticQuery results for components that Gatsby didn't run query yet.\n * @param {QueryResultsMap} resultsMap Already stored results for queries that don't need to be read from files.\n * @param {string} directory Root directory of current project.\n */\nconst getCachedStaticQueryResults = (\n  resultsMap: QueryResultsMap,\n  directory: string\n): QueryResultsMap => {\n  const cachedStaticQueryResults = new Map()\n  const { staticQueryComponents, jsonDataPaths } = store.getState()\n  staticQueryComponents.forEach(staticQueryComponent => {\n    // Don't read from file if results were already passed from query runner\n    if (resultsMap.has(staticQueryComponent.hash)) return\n\n    const dataPath = jsonDataPaths[staticQueryComponent.jsonName]\n    if (typeof dataPath === `undefined`) {\n      console.log(\n        `Error loading a result for the StaticQuery in \"${\n          staticQueryComponent.componentPath\n        }\". Query was not run and no cached result was found.`\n      )\n      return\n    }\n    cachedStaticQueryResults.set(staticQueryComponent.hash, {\n      result: readCachedResults(dataPath, directory),\n      id: staticQueryComponent.hash,\n    })\n  })\n  return cachedStaticQueryResults\n}\n\nconst getRoomNameFromPath = (path: string): string => `path-${path}`\n\nclass WebsocketManager {\n  pageResults: QueryResultsMap\n  staticQueryResults: QueryResultsMap\n  errors: Map<string, QueryResult>\n  isInitialised: boolean\n  activePaths: Set<string>\n  programDir: string\n\n  constructor() {\n    this.isInitialised = false\n    this.activePaths = new Set()\n    this.pageResults = new Map()\n    this.staticQueryResults = new Map()\n    this.errors = new Map()\n    this.websocket\n    this.programDir\n\n    this.init = this.init.bind(this)\n    this.getSocket = this.getSocket.bind(this)\n    this.emitPageData = this.emitPageData.bind(this)\n    this.emitStaticQueryData = this.emitStaticQueryData.bind(this)\n    this.emitError = this.emitError.bind(this)\n  }\n\n  init({ server, directory }) {\n    this.programDir = directory\n\n    const cachedStaticQueryResults = getCachedStaticQueryResults(\n      this.staticQueryResults,\n      this.programDir\n    )\n    this.staticQueryResults = new Map([\n      ...this.staticQueryResults,\n      ...cachedStaticQueryResults,\n    ])\n\n    this.websocket = require(`socket.io`)(server)\n\n    this.websocket.on(`connection`, s => {\n      let activePath = null\n      // Send already existing static query results\n      this.staticQueryResults.forEach(result => {\n        this.websocket.send({\n          type: `staticQueryResult`,\n          payload: result,\n        })\n      })\n      this.errors.forEach((message, errorID) => {\n        this.websocket.send({\n          type: `overlayError`,\n          payload: {\n            id: errorID,\n            message,\n          },\n        })\n      })\n\n      const leaveRoom = path => {\n        s.leave(getRoomNameFromPath(path))\n        const leftRoom = this.websocket.sockets.adapter.rooms[\n          getRoomNameFromPath(path)\n        ]\n        if (!leftRoom || leftRoom.length === 0) {\n          this.activePaths.delete(path)\n        }\n      }\n\n      const getDataForPath = path => {\n        if (!this.pageResults.has(path)) {\n          const result = getCachedPageData(path, this.programDir)\n          if (result) {\n            this.pageResults.set(path, result)\n          } else {\n            console.log(`Page not found`, path)\n            return\n          }\n        }\n\n        this.websocket.send({\n          type: `pageQueryResult`,\n          why: `getDataForPath`,\n          payload: this.pageResults.get(path),\n        })\n      }\n\n      s.on(`getDataForPath`, getDataForPath)\n\n      s.on(`registerPath`, path => {\n        s.join(getRoomNameFromPath(path))\n        activePath = path\n        this.activePaths.add(path)\n      })\n\n      s.on(`disconnect`, s => {\n        leaveRoom(activePath)\n      })\n\n      s.on(`unregisterPath`, path => {\n        leaveRoom(path)\n      })\n    })\n\n    this.isInitialised = true\n  }\n\n  getSocket() {\n    return this.isInitialised && this.websocket\n  }\n\n  emitStaticQueryData(data: QueryResult) {\n    this.staticQueryResults.set(data.id, data)\n    if (this.isInitialised) {\n      this.websocket.send({ type: `staticQueryResult`, payload: data })\n    }\n  }\n\n  emitPageData(data: QueryResult) {\n    this.pageResults.set(data.id, data)\n    if (this.isInitialised) {\n      this.websocket.send({ type: `pageQueryResult`, payload: data })\n    }\n  }\n  emitError(id: string, message?: string) {\n    if (message) {\n      this.errors.set(id, message)\n    } else {\n      this.errors.delete(id)\n    }\n\n    if (this.isInitialised) {\n      this.websocket.send({ type: `overlayError`, payload: { id, message } })\n    }\n  }\n}\n\nconst manager = new WebsocketManager()\n\nmodule.exports = manager\n"],"file":"websocket-manager.js"}
\ No newline at end of file
--- a/node_modules/gatsby/dist/utils/worker.js
+++ b/node_modules/gatsby/dist/utils/worker.js
@@ -3,22 +3,7 @@
 exports.__esModule = true;
 exports.renderHTML = renderHTML;
 
-const fs = require(`fs-extra`);
-
-const path = require(`path`);
-
-const Promise = require(`bluebird`); // copied from https://github.com/markdalgleish/static-site-generator-webpack-plugin/blob/master/index.js#L161
-
-
-const generatePathToOutput = outputPath => {
-  let outputFileName = outputPath.replace(/^(\/|\\)/, ``); // Remove leading slashes for webpack-dev-server
-
-  if (!/\.(html?)$/i.test(outputFileName)) {
-    outputFileName = path.join(outputFileName, `index.html`);
-  }
-
-  return path.join(process.cwd(), `public`, outputFileName);
-};
+const Promise = require(`bluebird`);
 
 function renderHTML({
   htmlComponentRendererPath,
@@ -28,16 +13,13 @@ function renderHTML({
   // This is being executed in child process, so we need to set some vars
   // for modules that aren't bundled by webpack.
   envVars.forEach(([key, value]) => process.env[key] = value);
-  return Promise.map(paths, path => new Promise((resolve, reject) => {
+  return Promise.map(paths, async path => {
     const htmlComponentRenderer = require(htmlComponentRendererPath);
 
-    try {
-      htmlComponentRenderer.default(path, (throwAway, htmlString) => {
-        resolve(fs.outputFile(generatePathToOutput(path), htmlString));
-      });
-    } catch (e) {
-      reject(e);
-    }
-  }));
+    return {
+      path,
+      ...(await htmlComponentRenderer.default(path))
+    };
+  });
 }
 //# sourceMappingURL=worker.js.map
\ No newline at end of file
--- a/node_modules/gatsby/dist/utils/worker.js.map
+++ b/node_modules/gatsby/dist/utils/worker.js.map
@@ -1 +1 @@
-{"version":3,"sources":["../../src/utils/worker.js"],"names":["fs","require","path","Promise","generatePathToOutput","outputPath","outputFileName","replace","test","join","process","cwd","renderHTML","htmlComponentRendererPath","paths","envVars","forEach","key","value","env","map","resolve","reject","htmlComponentRenderer","default","throwAway","htmlString","outputFile","e"],"mappings":";;;;;AAAA,MAAMA,EAAE,GAAGC,OAAO,CAAE,UAAF,CAAlB;;AACA,MAAMC,IAAI,GAAGD,OAAO,CAAE,MAAF,CAApB;;AACA,MAAME,OAAO,GAAGF,OAAO,CAAE,UAAF,CAAvB,C,CAEA;;;AACA,MAAMG,oBAAoB,GAAGC,UAAU,IAAI;AACzC,MAAIC,cAAc,GAAGD,UAAU,CAACE,OAAX,CAAmB,UAAnB,EAAgC,EAAhC,CAArB,CADyC,CACe;;AAExD,MAAI,CAAC,cAAcC,IAAd,CAAmBF,cAAnB,CAAL,EAAyC;AACvCA,IAAAA,cAAc,GAAGJ,IAAI,CAACO,IAAL,CAAUH,cAAV,EAA2B,YAA3B,CAAjB;AACD;;AAED,SAAOJ,IAAI,CAACO,IAAL,CAAUC,OAAO,CAACC,GAAR,EAAV,EAA0B,QAA1B,EAAmCL,cAAnC,CAAP;AACD,CARD;;AAUO,SAASM,UAAT,CAAoB;AAAEC,EAAAA,yBAAF;AAA6BC,EAAAA,KAA7B;AAAoCC,EAAAA;AAApC,CAApB,EAAmE;AACxE;AACA;AACAA,EAAAA,OAAO,CAACC,OAAR,CAAgB,CAAC,CAACC,GAAD,EAAMC,KAAN,CAAD,KAAmBR,OAAO,CAACS,GAAR,CAAYF,GAAZ,IAAmBC,KAAtD;AAEA,SAAOf,OAAO,CAACiB,GAAR,CACLN,KADK,EAELZ,IAAI,IACF,IAAIC,OAAJ,CAAY,CAACkB,OAAD,EAAUC,MAAV,KAAqB;AAC/B,UAAMC,qBAAqB,GAAGtB,OAAO,CAACY,yBAAD,CAArC;;AACA,QAAI;AACFU,MAAAA,qBAAqB,CAACC,OAAtB,CAA8BtB,IAA9B,EAAoC,CAACuB,SAAD,EAAYC,UAAZ,KAA2B;AAC7DL,QAAAA,OAAO,CAACrB,EAAE,CAAC2B,UAAH,CAAcvB,oBAAoB,CAACF,IAAD,CAAlC,EAA0CwB,UAA1C,CAAD,CAAP;AACD,OAFD;AAGD,KAJD,CAIE,OAAOE,CAAP,EAAU;AACVN,MAAAA,MAAM,CAACM,CAAD,CAAN;AACD;AACF,GATD,CAHG,CAAP;AAcD","sourcesContent":["const fs = require(`fs-extra`)\nconst path = require(`path`)\nconst Promise = require(`bluebird`)\n\n// copied from https://github.com/markdalgleish/static-site-generator-webpack-plugin/blob/master/index.js#L161\nconst generatePathToOutput = outputPath => {\n  let outputFileName = outputPath.replace(/^(\\/|\\\\)/, ``) // Remove leading slashes for webpack-dev-server\n\n  if (!/\\.(html?)$/i.test(outputFileName)) {\n    outputFileName = path.join(outputFileName, `index.html`)\n  }\n\n  return path.join(process.cwd(), `public`, outputFileName)\n}\n\nexport function renderHTML({ htmlComponentRendererPath, paths, envVars }) {\n  // This is being executed in child process, so we need to set some vars\n  // for modules that aren't bundled by webpack.\n  envVars.forEach(([key, value]) => (process.env[key] = value))\n\n  return Promise.map(\n    paths,\n    path =>\n      new Promise((resolve, reject) => {\n        const htmlComponentRenderer = require(htmlComponentRendererPath)\n        try {\n          htmlComponentRenderer.default(path, (throwAway, htmlString) => {\n            resolve(fs.outputFile(generatePathToOutput(path), htmlString))\n          })\n        } catch (e) {\n          reject(e)\n        }\n      })\n  )\n}\n"],"file":"worker.js"}
\ No newline at end of file
+{"version":3,"sources":["../../src/utils/worker.js"],"names":["Promise","require","renderHTML","htmlComponentRendererPath","paths","envVars","forEach","key","value","process","env","map","path","htmlComponentRenderer","default"],"mappings":";;;;;AAAA,MAAMA,OAAO,GAAGC,OAAO,CAAE,UAAF,CAAvB;;AAEO,SAASC,UAAT,CAAoB;AAAEC,EAAAA,yBAAF;AAA6BC,EAAAA,KAA7B;AAAoCC,EAAAA;AAApC,CAApB,EAAmE;AACxE;AACA;AACAA,EAAAA,OAAO,CAACC,OAAR,CAAgB,CAAC,CAACC,GAAD,EAAMC,KAAN,CAAD,KAAmBC,OAAO,CAACC,GAAR,CAAYH,GAAZ,IAAmBC,KAAtD;AAEA,SAAOR,OAAO,CAACW,GAAR,CAAYP,KAAZ,EAAmB,MAAMQ,IAAN,IAAc;AACtC,UAAMC,qBAAqB,GAAGZ,OAAO,CAACE,yBAAD,CAArC;;AACA,WAAO;AACLS,MAAAA,IADK;AAEL,UAAI,MAAMC,qBAAqB,CAACC,OAAtB,CAA8BF,IAA9B,CAAV;AAFK,KAAP;AAID,GANM,CAAP;AAOD","sourcesContent":["const Promise = require(`bluebird`)\n\nexport function renderHTML({ htmlComponentRendererPath, paths, envVars }) {\n  // This is being executed in child process, so we need to set some vars\n  // for modules that aren't bundled by webpack.\n  envVars.forEach(([key, value]) => (process.env[key] = value))\n\n  return Promise.map(paths, async path => {\n    const htmlComponentRenderer = require(htmlComponentRendererPath)\n    return {\n      path,\n      ...(await htmlComponentRenderer.default(path)),\n    }\n  })\n}\n"],"file":"worker.js"}
\ No newline at end of file
